



\begin{thm}{Corollary}
Let $\mathfrak{C}$ be a simply connected subset in $\EE^3$ 
which can be presented as intersection of some collection 
of open two-convex set.
Equip $\mathfrak{C}$ with induced length metric and denote by $\mathfrak{C}^*$ its completion.
Then any metric component of $\mathfrak{C}^*$ forms a $\cCat{}{0}$ space.
\end{thm}

\parit{Proof.}
Since the intersection of two-convex sets is two-convex,
we may assume that $\mathfrak{C}$ is formed by intersection of a decreasing sequence of open tow-convex sets $\Omega_1\supset\Omega_2\supset\dots$.

Note that if $\Omega_1\subset \Omega_2$ then there the inclusion
$\Omega_1\to \Omega_2$ induce a short map $\Omega_1^*\to \Omega_2^*$.
Therefore the completions of open two-convex sets containing $\mathfrak{C}$ form an inverse system.
The completion $\mathfrak{C}$ is isometric to the inverse limit of this system.

Since every $\Omega^*$ is $\cCat{}{0}$ we obtain that (2+2)-comparison holds for all quadrouple of points in $\mathfrak{C}$.
Hence the same holds for the completion $\mathfrak{C}^*$.
Passing to any metric component of $\mathfrak{C}^*$ we get a $\cCat{}{0}$ space.
\qeds











\section{Model plane}

A finite union of triangles in $\Lob{2}{\kappa}$ will be also called \index{polygonal set}\emph{polygonal set}.


\begin{thm}{Theorem}\label{thm:polygon-CAT}
Let $P$ be a polygonal set in $\Lob2\kappa$ equipped with induced length metric.
Then $P\in\cCat{}{\kappa}$ if and ony if $P$ is $(2\cdot\varpi\kappa)$-simply connected. 
\end{thm}

\parit{Proof.} According to  generalized Hadamard--Cartan theorem~\ref{thm:hadamard-cartan-gen},
it is sufficient to check that 
\[\curv P\le \kappa.
\eqlbl{eq:curv(P)>=k}\]

By \ref{thm:warp-curv-bound:cbb:a}, a $\kappa$-cone over
a closed interval is $\cCat{}{\kappa}$.
By Reshetnyak's gluing theorem, 
the same holds for a $\kappa$-cone over
a collection of closed intervals.

The inequality \ref{eq:curv(P)>=k} follows 
since a neighborhood of any point in $P$
is isometric to a neighborhood of the tip of a $\kappa$-cone over
a collection of closed intervals.
\qeds


Let $[a_1\dots a_n]$
be a simple closed broken geodesic in the model plane $\Lob{2}{\kappa}$.
A closure  
of a bounded component of 
$\Lob{2}{\kappa}\backslash [a_1\dots a_n]$ 
is called \index{solid polygon}\emph{solid polygon}.

If $\kappa\le 0$ then there is unique polygon which is bounded by $[a_1\dots a_n]$,
while in the case $\kappa>0$
there are two such polygons,
one on each side of $[a_1\dots a_n]$.
Note that the half-spheres in $\Lob{}\kappa$ for $\kappa>0$ are included in the class of polygons.


\begin{thm}{Corollary}\label{thm:2-d-cba}
Let $P$ be a polygon in $\Lob{2}{\kappa}$ equipped with the length-metric. 
\begin{subthm}{thm:2-d-cba:k=<0} 
If $\kappa\le 0$ then $P\in\cCat{}{\kappa}$ 
\end{subthm}
\begin{subthm}{thm:2-d-cba:k>0}
If $\kappa> 0$ and then $P\in\cCat{}{\kappa}$ if and only if $P$ does not contain a hemisphere in its interior. 
\end{subthm}
\end{thm}

\parit{Proof; (\ref{SHORT.thm:2-d-cba:k=<0})}
Note that by construction $P$ is simply connected.
Therefore part (\ref{SHORT.thm:2-d-cba:k=<0})
follows from Theorem \ref{thm:polygon-CAT}.

\parit{(\ref{SHORT.thm:2-d-cba:k>0}).}
Since $\kappa>0$,
applying rescaling, we can assume that $\kappa=1$ and therefore $\Lob2\kappa=\mathbb{S}^2$.

Note that if $P$ contains a closed hemisphere it is not $(2\cdot\pi)$-simply connected;
in fact the $\partial_{\mathbb{S}^2}[\Conv(\partial_{\mathbb{S}^2} P)]$ forms a closed geodesic in $P$ with length smaller that $2\cdot\pi$.

If $P$ is not $(2\cdot\pi)$-simply connected
then it contains a closed geodesic $\gamma$ 
of length smaller than $2\cdot\pi$.
Note that $\gamma$ bounds a convex set $K$ in $\mathbb{S}^2$ 
and  $K\supset \partial_{\mathbb{S}^2} P$.
According to Hemisphere lemma (\ref{lem:hemisphere})
$\gamma$ lies outside of a closed hemisphere.
This hemisphere have to lie in the interior of $P$,
a contradiction.
\qeds



The following theorem 
is a partial case of a more general result proved by Bishop in \cite{bishop:jordan};
see also the discussion after Example 9.1.6 in the book of Burago--Burago--Ivanov \cite{BBI}.

\begin{thm}{Theorem}\label{thm:2d-bishop}
Let $\Omega$ be an open  proper simply connected subset in $\Lob2{\kappa}$.
If $\kappa>0$, assume in addition that $\Omega$ does not contain a closed halphsphere.

Consider $\Omega$ with the induced intrinsic metric.
Then the completion $\Omega^*$ of $\Omega$ is a $\Cat{}{\kappa}$ space.
\end{thm}

\parbf{Remark.}
Note that if $\Omega$ is bounded by a simple closed rectifiable curve its completion of $\Omega^*$ is isometric to the closure $\bar{\Omega}$  of $\Omega$ equipped with the length metric. 
In general, the space $\Omega^*$ admits natural length-preserving map in $\bar{\Omega}$, 
but 
this map might be not injective 
and its image might be proper subset of $\bar{\Omega}$.

%%%%%%%%+PIC???

\parit{Proof.}
Fix the points $x^1,x^2,x^3,x^4\in\Omega$.
Note that it is sufficient to prove that 
\begin{clm}{}\label{clm:2+2-Omega}
(2+2)-point $\kappa$-comparison holds for any four points 
$x^1, x^2, x^3, x^4$ in $\Omega$ 
equipped with the length metric.
\end{clm}

Fix $\eps>0$.
Connect $x^i$ to $x^j$ by a curve $\gamma_{ij}$ in $\Omega$;
such that 
\[\length\gamma_{ij}<\dist{x^i}{x^j}{\Omega}+\eps.\]

Note that there is a polygon $P\subset \Omega$ 
which contains all $\gamma_{ij}$.

By Theorem~\ref{thm:2-d-cba}, $P\in \cCat{}{\kappa}$.
In particular the points  $x^1,x^2,x^3,x^4$ satisfy (2+2)-point comparison in $P$.
By the construction,
\[\dist{x^i}{x^j}{P}\lege \dist{x^i}{x^j}{\Omega}\pm\eps\]
for all $i$ and $j$.

Since $\eps>0$ is arbitrary, \ref{clm:2+2-Omega} follows.
\qeds









































\begin{thm}{Theorem}\label{thm:set-with-smooth-bry:CBB}
Let $K$ be a closed connected subset in $\EE^m$ equipped with the induced length metric.

Assume $K$ is bounded by a smooth hypersurface $S$ 
and $\nu$ is the the orthonormal vector field on $S$ which points outside of $K$.
Then 
$K\in \CBB{}{0}$ if and only if $S$ is convex with respect to $\nu$.
\end{thm}



















\begin{thm}{Corollary}
Two-convex hull of open set in $\EE^3$ is open.
\end{thm}

\parit{Proof.}
Observe that by Proposition~\ref{prop:2-conv-construction}
the two-convex hull of open set is a union of open sets.
\qeds







\section{Sturdy sets}

The following technical assumption on $K$ will help to say away from pathological examples.

\begin{thm}{Definition}
Let $K$ be a closed set in a metric space.
Denote by $\Omega$ the interior of $K$, equip both with the induced length metrics.
We say that the set $K$ is \emph{sturdy} if the induced lenght metric takes finite values and 
if the inclusion $\Omega\hookrightarrow K$ extends to an isometry
from the completion $\overline \Omega$ to $K$.
\end{thm}

As an example of sturdy set one can take a region of plane bounded by rectifiable closed simple curve.
A nonsturdy sets could be found among sets homeomorphic to closed disc 
which a spiraling piece of boundary, so that the intrinsic distance to from the end of the spiral to some (and therefor any) interior point is infinite. 

We are interested in the following general question.

\begin{clm}{}
For which sets $K$ in the Euclidean space 
the constructed space $\overline\Omega$ is $\cCat{}{0}$? 
\end{clm}

Note that if $K$ is strudy, the question can be reformulated in terms of its interior $\Omega$.

\begin{clm}{}
For which open connected open sets $\Omega$ in the Euclidean space 
the (2+2)-point comparison holds?
\end{clm}

Indeed, if the (2+2)-point comparison holds holds it $\Omega$ then the same is true for its completion. 
It remains to note that completion of length space is a length space.

For the inclusions $\phi\:\Omega\hookrightarrow\overline\Omega$ and $\psi\:\Omega\hookrightarrow\Closure\Omega$ there is unique continuous map 
$\theta\:\overline\Omega\to\Closure\Omega$ such that $\psi=\theta\circ\phi$,
but the map $\map$, in general is not onto and not injective.

The map $\theta$ is always length-preserving, and if $K=\Closure\Omega$ is study then it is an isometry.

















\begin{thm}{Proposition}\label{prop:stong-two-convex}
Assume $A$ is a  two-convex subset in $\EE^3$.
Then for any convex set $K$ the restriction homomorphism of first \v{C}ech cohomology
\[\check{H}^1(A,\ZZ_2)\to \check{H}^1(A\cap K,\ZZ_2)\]
is onto.
\end{thm}

\parit{Proof.}
Let $\Omega\subset \EE^3$ be open and two-convex.

Arguing by contradiction, assume $\Omega$ is not strongly two-convex;
that is there is a closed curve $\gamma$
in $\Omega$ 
which is contractable in $\Omega$ but not contractable in the intersection $\Conv\gamma\cap \Omega$.

Denote by ???

Since $\Omega$ is open, 
we can assume that $\gamma$ is smooth
and it is contracted by a smooth map from disc $\DD$ to $\Omega$.

 
\qeds













In particular, if $W$ is a 2-dimensional subspace of $\Lob3\kappa$ 
then the intersection $W\cap K'$ is bounded 
by finite number of locally concave arcs and the  intersections $F_i'\cap W$.
Note that the locally concave arcs have their ends on the ends of $F_i'\cap W$;
the later is formed by a line segment or it degenerates to a point.

\begin{clm}{}\label{clm:intersection-is-polytope}
For any 2-dimesional subspace $W\subset\Lob{3}{\kappa}$,
the intersection $W\cap \Conv_2 \Omega$ is interior of a polytope.
\end{clm}

Indeed, set $L=W\cap \Conv_2 \Omega$.
According to Lemma~\ref{lem:loc-concave}, 
the boundary of $L$ is formed by the intersections s $F'_i\cap W$
and locally concave arcs.

Arguing by contradiction, 
assume that $L$ is not interior of a polytope then there is a smooth extremal point on one of these arcs; 
that is, there is a point $x\in\partial_W L$ such that ???.
Without loss of generality, we can assume that $x$ does not lie on a line connecting a pair of vertices of $F_1',\dots,F_n'$.

Consider the local supporting plane $\Pi$ to $\Lambda$ at $x$
and let $Q_x\ni x$ be the connected component of $\Pi\cap\Lambda'$.

\begin{clm}{}\label{clm:Q-is-interval}
$Q_x$ is an open interval. 
\end{clm}

Indeed,???\claimqeds

Let $Q_x=\l]ab\r[$.
Clearly $a\in\partial F_i'$ and $b\in\partial F_j'$
for some $i$ and $j$.
Since $x$ does not lie on a line connecting the vertices,
we can assume that $a$ is not a vertex of $F_i'$;
denote by $[vw]$ the edge of $F_i'$ containing $a$.

\begin{clm}{}\label{clm:[vw]cPi}
$Q_x$ contains the interior of the triangle $[bvw]$.
\end{clm}

Indeed,???\claimqeds

Note that the claims \ref{clm:[vw]cPi} and \ref{clm:Q-is-interval} contradict eachother.
Therefore \ref{clm:intersection-is-polytope} is proved.


Note that the complement $\Omega^\complement$ is a polytope.
In particular, $\Omega^\complement$ is a union of finite number of convex polytopes,
say 
$\Omega^\complement=R_1\cup\dots\cup R_n$.
For each $i$, the complement $R_i'=R_i\backslash \Conv_2\Omega$ is a convex set.
According to 
Exercise~\ref{ex:polygon-slices} 
and \ref{clm:intersection-is-polytope}, 
$R_i'$ is a convex polytope for each $i$.
Hence $(\Conv_2\Omega)^\complement=\bigcup_i R_i'$ is a polytope.











\begin{thm}{Theorem}\label{thm:sect}
Let $\spc{L}\in\CBB{}\kappa$ and $p\in \spc{L}$.
Given two tangent vectors $u,v\in \T_p$, consider model triangle $\trig{\~\0}{\~u}{\~v}=\modtrig0(\0 u v)$ 
and denote by $\Sect(u v)$ the region in $\EE^2$ bounded by rays $\~\0\~u$ and $\~\0\~v$.

Then for any geodesic $[u v]$ in $\T^\o_p$ there is a distance preserving map $\iota\:\Sect(u v)\to\T^\o_p$ such that $\iota(\~\0)=\0$, $\iota([\~u\~v])=[u v]$.
\end{thm}

\parit{Proof.}
Follows directly from the lemma on flat triangle (\ref{lem:flat-trig}).
\qeds






















Let 
$\spc{L}\in\CBB{}{}$,
$\alpha\:\II\to \spc{L}$ be a curve
$t_0\in \II$
and $p=\alpha(t_0)$.
We say that $v\in\T_p$ is a \emph{right} (\emph{left}) \emph{derivative} of $\alpha$ at $t_0\in\II$, 
briefly, $v=\alpha^+(t_0)$ (correspondingly $v=\alpha^-(t_0)$)
if there is a sequence $v_n\in\T_p'$ such that $v_n\to v$
and $s_n\to 0$ as $n\to\infty$, where
\[s_n=\limsup\frac{\dist{\alpha(t)}{\exp_p(|t-t_0|\cdot v_n)}{}}{|t-t_0|}\]
and the limit is taken for $t\to t_0+$ (correspondingly $t\to t_0-$).

\begin{thm}{Lemma}
Let
$\spc{L}\in\CBB{}{}$,
$\alpha\:\II\to \spc{L}$ be a curve
$t_0\in \II$
and $p=\alpha(t_0)$.
if for any $w\in\T_p'$ we have
\[\lim\frac{\dist{\alpha(t)}{\exp_p(|t-t_0|\cdot w)}{}}{|t-t_0|}
=
\dist{v}{w}{\T_p}.\]
where the limit is taken for $t\to t_0+$ (correspondingly $t\to t_0-$).
\end{thm}


For an interior value $t_0$ of $\II$, 
if $\alpha^+(t_0)$ or $\alpha^-(t_0)$ or both are defined,
we say correspondingly that  $\alpha$ is \emph{right}\index{differentiable!right differentiable} or \emph{left}\index{differentiable!left differentiable} or \emph{both-sided differentiable}\index{differentiable!both-sided differentiable} at $t_0$.
In the exceptional cases, when $t_0$ is the left (correspondingly right) end of $\II$, $\alpha$ is by definition left (correspondingly right) differentiable at $t_0$.

For an interior value $t_0$ of $\II$,
in case if $\alpha$ is both-sided differentiable at $t_0$ and $\alpha^+(t_0)+\alpha^-(t_0)=0$, we say that $\alpha$ is \emph{differentiable}\index{differentiable} at $t_0$.
In the exceptional cases, when $t_0$ is the left (correspondingly right)
we say that $\alpha$ is both-sided differentiable at $t_0$ if $\alpha$ is right (correspondingly left) differentiable at $t_0$.

\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{}{}$ and $\gamma\:\II\to\spc{L}$ be a geodesic then $\gamma$ is both-side differentiable.
\end{thm}





















\parbf{Space of directions.}
Let $\spc{L}\in \CBB{}{}$ and $p\in \spc{L}$.
Consider set of all unit-speed geodesics $\Gamma_p$ starting at $p$.
According to \ref{claim:angle-3angle-inq}, the angle measure $\mangle$ gives a pre-metric on $\Gamma_p$.
The factor-space $\Sigma_p'=\Gamma_p'/\sim$ by the equivalence relation 
\[\gamma_1\sim\gamma_2\ \ \text{iff}\ \ \mangle(\gamma_1,\gamma_2)=0\] 
will be called \emph{space of geodesic directions}\index{space of directions!space of geodesic directions} of $\spc{L}$ at $p$.
The completion of $\Sigma'_p$\index{$\Sigma'_{*}$}, will be called \emph{space of directions}\index{space of directions} of $\spc{L}$ at $p$ and denoted by $\Sigma_p=\Sigma_p \spc{L}$\index{$\Sigma_{*}$}.
The angle $\mangle$ defines metric on $\Sigma_p'$ and it extends to a metric on $\Sigma_p$; further we allways denote by $\Sigma_p$, the metric space $(\Sigma_p,\mangle)$.

Given a geodesic $[p q]$, the corresponding direction in $\Sigma_p$ will be denoted by $\dir{p}{q}$\index{$\dir{*}{*}$}.
The set of all directions of geodesics from $p$ to $q$ will be denoted by $\Dir{p}{q}$\index{$\Dir{{*}}{{*}}$}.
In general, the set $\Dir{p}{q}\subset\Sigma_p$ might be empty.

\parbf{Tangent cone.} $\Cone\Sigma_p$ --- the Euclidean cone over $\Sigma_p$ (see \ref{cones}) will be called \emph{tangent space}\index{tangent space} of $\spc{L}$ at $p$ and we denote it by $\T_p=\T_p \spc{L}$\index{$\T_{*}$}.
As well as space of directions, tangent cone is a complete space.
Set \index{$\ddir{*}{*}$}\index{$\ddir{*}{*}$}
\[\ddir p q\,
\df
\dist[{{}}]{p}{q}{}\cdot\dir p q
\ \ \hbox{and} \ \ 
\Ddir{p}{q}
=
\set{\dist[{{}}]{p}{q}{}\cdot\xi}{\xi\in\Dir{p}{q}}
.\]
Note that $\ddir p q=\ddir p{q'}$ implies $q=q'$; see ???.
The relation $v=\ddir p q$, will be also written as $q=\exp_p v$.
The map $\exp_p$ is defined on a starshaped subset of $\T_p$; 
i.e. if $\exp_pv$ is defined then so is $\exp_p(t\cdot v)$ for any $t\in[0,1]$. 

The subcone $\T_p'=\Cone\Sigma_p'\subset \T_p$ will be called subcone of \emph{geodesic vectors}\index{geodesic tangent vector}.
Clearly, $\T_p'$ is dense in $\T_p$ and $v\in \T_p'$ iff $\exp_p(\eps\cdot v)$ is defined for small $\eps$.
















\section{Tangent cone}\label{sec:tan}

\parbf{Tangent cones and vectors.}
Here we give a definition of tangent cone which works for general metric space.
It should be noted however that the definition below defines a reasonable object only for reasonable spaces, which include $\CBB{}{}$ and $\cCat{}{}$ spaces.

\begin{thm}{Definition}\label{def:tan}
Let $\spc{X}$ be a metric space and $p\in\spc{X}$.
Consider the set $\Gamma_p$ of all constant-speed geodesics which start at $p$;
i.e. $\gamma\in\Gamma_p$ iff $\gamma(t)=\geod_{[pq]}(\lam\cdot t)$ for some $\lam\ge0$.
($\Gamma_p$ includes the constant geoesic $\gamma(t)\equiv p$.)
Let us define a pseudometric on $\Gamma_p$ as
\[\dist{\gamma}{\gamma'}{\Gamma_p}
=
\limsup_{t\to0+}\frac{\dist{\gamma(t)}{\gamma'(t)}{\spc{X}}}{t}\]
for $\gamma,\gamma'\in\Gamma_p$.

The corresponding metric space  for $\Gamma_p$ will be called the \emph{geodesic tangent cone} of $\spc{X}$ at $p$; 
it will be denoted as $\T_p'=\T_p'\spc{X}$.
The completion of $\T_p'$ will be called the tangent cone at $p$, and denoted by $\T_p=\T_p\spc{X}$.
The elements of the  tangent cone will be called \emph{tangent vectors}
(despite in general $\T_p$ is not a vector space).
\end{thm}

Given $\lam\ge0$, there is a natural map $\Gamma_p\to\Gamma_p\:\gamma(t)\mapsto\gamma(\lam\cdot t)$.
For the induced map $\T_p\to\T_p$, we use the notation $v\mapsto \lam\cdot v$.
Clearly, 
\[\dist[{{}}]{\lam\cdot v}{\lam\cdot w}{}=\lam\cdot\dist[{{}}]{v}{w}{}.\]

Given a geodesic $[p q]$, 
the element in $\T_p$ that corresponds to $\geod_{[p q]}$ 
will be called the \emph{direction}\index{direction} of $[p q]$, denoted by $\dir{p}{q}$\index{$\dir{*}{*}$}.
The element in $\T_p$ that corresponds to the geodesic path $\gamma(t)=\geod_{[p q]}(\tfrac{t}{\dist{p}{q}{}})$ 
will be called \emph{logarithm}\index{logarithm} of $[p q]$ and denoted as $\ddir{p}{q}$\index{$\dir{*}{*}$};
clearly 
\[\ddir{p}{q}=\dist[{{}}]{p}{q}{}\cdot\dir{p}{q}.\]

The set of directions of all geodesics from $p$ to $q$ will be denoted by $\Dir{p}{q}$\index{$\Dir{{*}}{{*}}$}.
In general, the set $\Dir{p}{q}\subset\T_p$ might be empty.

%???Showld we call a metric space with a chousen one-parameter family of such maps a cone?


\parbf{Right/left derivatives.}
The definitions of right and left derivatives of curves is given in a few steps;
we first define it for geodesics and then extend it to general curves.

\begin{thm}{Definition}\label{def:curv^+}
Given $\gamma\in\Gamma_p$, we say that $v\in \T_p$ is the right derivative of $\gamma$ at $0$ (briefly, $v=\gamma^+(0)$)
if $\gamma$ maps to $v$ under 
the natural map $\Gamma_p\to \T_p'\subset\T_p$.

Further, let $\II$ be a real interval containing $[0,\eps)$ for some $\eps>0$.
Let  $\alpha\:\II\to\spc{X}$ be a map, 
$\alpha(0)=p$ and $v\in\T_p$.
We write
$v=\alpha^+(0)$
if there is a sequence $\gamma_n\in\Gamma_p$
such that $\gamma^+_n(0)\to v$ as $n\to\infty$ and 
\[\lim_{n\to\infty}(\limsup_{t\to0+}{\dist{\alpha(t)}{\gamma_n(t)}{}}/{t})\to 0.\]

Naturally, we define right/left derivatives of $\alpha$ at $t_0\in\II$ as $\alpha^\pm(t_0)=\check\alpha^+(0)$, where $\check\alpha(t)=\alpha(t_0\pm t)$.
\end{thm}

\parbf{Remarks.} 
Although the above definition will be mostly used for curves, 
we do not require $\alpha$ to be continous.

Note that our sign convention is not standard. 
In particular, for  a smooth curve $\alpha$ in the Euclidean space we have $\alpha'=\alpha^+ =- \alpha^-$.

\begin{thm}{Proposition}\label{prop:unique-right-der}
Let $\spc{X}$ be a metric space,
$p\in \spc{X}$,
$\eps>0$.

\begin{subthm}{prop:unique-right-der:unique}
Given a map $\alpha\:[0,\eps)\to\spc{X}$ such that $\alpha(0)=p$,
there is at most one tangent vector $v\in\T_p$ 
such that $v=\alpha^+(0)$.
\end{subthm}

\begin{subthm}{prop:unique-right-der:exist}
 For any tangent vector $v\in \T_p$ there is a map $\alpha\:[0,\eps)\to\spc{X}$ such that $\alpha^+(0)=v$.
\end{subthm}

\begin{subthm}{prop:unique-right-der:chain}
Given a map $\alpha\:[0,\eps)\to\spc{X}$ such that $\alpha(0)=p$,
and $\theta(t)=\lam\cdot t+o(t)$, $\lam>0$,
we have 
\[(\alpha\circ\theta)^+(0)=\lam\cdot\alpha^+(0).\]
In particular, left part is defined if and only if the right part is defined.
\end{subthm}
\end{thm}

\parit{Proof.} Parts \ref{SHORT.prop:unique-right-der:unique} and \ref{SHORT.prop:unique-right-der:chain} follow directly from definitons \ref{def:curv^+} and \ref{def:tan}.

Let $\gamma^+_n(0)\to v$ be as in the definition \ref{def:curv^+} and $t_n\to0+$ be a monotonic sequence.
Define $\alpha(t)=\gamma_n(t)$ for $t\in (t_{n+1},t_n]$.
For appropriately chousen sequence $(t_n)$, the map $\alpha$ satisfies (\ref{prop:unique-right-der:exist}).
\qeds



\begin{thm}{Definition}\label{def:diff-curv}
Let 
$\spc{X}$ be a metric space 
and $\alpha\:\II\to \spc{X}$ be a curve.

For $t_0\in\II$, 
if $\alpha^+(t_0)$ or $\alpha^-(t_0)$ or both are defined,
we say correspondingly that  $\alpha$ is \emph{right}\index{differentiable!right differentiable} or \emph{left}\index{differentiable!left differentiable} or \emph{both-sided differentiable}\index{differentiable!both-sided differentiable} at $t_0$.
In the exceptional cases where $t_0$ is the left (respectively right) end of $\II$, $\alpha$ is by definition left (respectively right) differentiable at $t_0$.
\end{thm}

























\section{Quadruples}\label{sec:quad}

Let $\spc{X}$ be a metric space.
Consider quadruple of points in $\spc{X}$;
say $\{x^1,x^2,x^3,x^4\}$.
The points $x^i$ will be called \emph{vertices}\index{vertex of the quadruple} of the quadruple.

The quadruple $\{x^1,x^2,x^3,x^4\}$
is called \emph{$\kappa$-admissible}\index{$\kappa$-admissible quadruple} if all 4 model triangles 
$\modtrig\kappa(x^ix^jx^\kay)$ are defined;
otherwise it is called \emph{$\kappa$-inadmissible}\index{$\kappa$-inadmissible quadruple}.

A $\kappa$-admissible quadruple $\{x^1,x^2,x^3,x^4\}$
is called \emph{$\kappa$-model}\index{$\kappa$-model quadruple}
if it is isometric to a quadruple in $\Lob3\kappa$.
The later is equivalent to the fact that 
for one (and therefore any) permutation $(i,j,\kay,\ell)$
of $(1,2,3,4)$, 
we have that the three angles $\angk\kappa{x^i}{x^j}{x^\kay}$,
$\angk\kappa{x^i}{x^\kay}{x^\ell}$ and $\angk\kappa{x^i}{x^j}{x^\ell}$
satisfy all three triangle inequalities 
and
\[\angk\kappa{x^i}{x^j}{x^\kay}+\angk\kappa{x^i}{x^\kay}{x^\ell}+\angk\kappa{x^i}{x^j}{x^\ell}
\le 
2\cdot\pi.\]

Assume $\{x^1,x^2,x^3,x^4\}$ is $\kappa$-admissible.
If 
\[\angk\kappa{x^i}{x^j}{x^\kay}+\angk\kappa{x^i}{x^\kay}{x^\ell}+\angk\kappa{x^i}{x^j}{x^\ell}
\le 
2\cdot\pi\]
for any permutation $(i,j,\kay,\ell)$
of $(1,2,3,4)$, we call 
%it 
$\{x^1,x^2,x^3,x^4\}$ 
\emph{$\kappa$-supermodel}\index{$\kappa$-supermodel quadruple}.
%Note that any $\kappa$-supermodel quadruple is $\kappa$-model.

A $\kappa$-admissible quadruple $\{x^1,x^2,x^3,x^4\}$
is called \emph{$\kappa$-submodel} if it is $\kappa$-model
or for some permutation $(i,j,\kay,\ell)$
of $(1,2,3,4)$ we have 
\[\angk\kappa{x^i}{x^j}{x^\kay}+\angk\kappa{x^i}{x^\kay}{x^\ell}+\angk\kappa{x^i}{x^j}{x^\ell}
>
2\cdot\pi.\eqlbl{eq:>2pi}\]
%%S
In other words, 
$\kappa$-submodels 
consist of all $\kappa$-models and all $\kappa$-admissibles that are not $\kappa$-supermodels, and likewise $\kappa$-supermodels 
consist of all $\kappa$-models and all $\kappa$-admissibles that are not $\kappa$-submodels.

Since \ref{eq:>2pi} forces the three angles $\angk\kappa{x^i}{x^j}{x^\kay}$,
$\angk\kappa{x^i}{x^\kay}{x^\ell}$ and $\angk\kappa{x^i}{x^j}{x^\ell}$ to 
satisfy all three triangle inequalities, then $\kappa$-submodels also may be described as all $\kappa$-admissibles $\{x^1,x^2,x^3,x^4\}$ such that for some permutation $(i,j,\kay,\ell)$ of $(1,2,3,4)$, the three angles $\angk\kappa{x^i}{x^j}{x^\kay}$,
$\angk\kappa{x^i}{x^\kay}{x^\ell}$ and $\angk\kappa{x^i}{x^j}{x^\ell}$
satisfy all three triangle inequalities. 

The following proposition gives yet another description of $\kappa$-submodel.

\begin{thm}{Proposition}\label{prop:submodel}
A $\kappa$-admissible 
quadruple is $\kappa$-submodel 
if and only if one of the following two equivalent conditions holds.

\begin{subthm}{}
For any labeling of the vertices 
by $(p^1,p^2,x^1,x^2)$, at least one of the following two inequalities holds
\begin{enumerate}[(i)]
\item $\angk{\kappa}{p^1}{x^1}{x^2} 
\le 
\angk{\kappa}{p^1}{p^2}{x^1}+\angk{\kappa}{p^1}{p^2}{x^2}$
\item $\angk{\kappa} {p^2}{x^1}{x^2}\le \angk{\kappa} {p^2}{p^1}{x^1} + \angk{\kappa} {p^2}{p^1}{x^2}$.
\end{enumerate}
\end{subthm}

\begin{subthm}{}
There is some labeling of the vertices by $(p,x^1,x^2,x^3)$ so that the three angles 
$\angk\kappa p{x^1}{x^2}$,
$\angk\kappa p{x^2}{x^3}$ and
$\angk\kappa p{x^1}{x^3}$
satisfy all three triangle inequalities.
\end{subthm}

\end{thm}


\parit{Proof.}
Follows from Overlap lemma (\ref{lem:extend-overlap}).
\qeds

















Morever, assume $p,q\in\oBall(K,\tfrac{\varpi\kappa}2)$ and  $p^*,q^*\in K$ be their closest-point projections
and there is a model quadraleteral $[\~p\~p^{*}\~q^{*}\~q]$ in $\Lob2\kappa$
such that $\~p$ and $\~q$ lie on one side from a line $\ell$,
the point $\~p^*$ and $\~q^*$ are closest to $\~p$ and $\~q$ on $\ell$ 
and %???+PIC
\begin{align*}
\dist{\~p}{\~p^*}{\Lob2\kappa}&=\dist{p}{p^*}{\spc{U}},
\\
\dist{\~q}{\~q^*}{\Lob2\kappa}&=\dist{q}{q^*}{\spc{U}},
\\
\dist{\~q^*}{\~q^*}{\Lob2\kappa}&=\dist{q^*}{q^*}{\spc{U}}.
\intertext{Then}
\dist{\~p}{\~q}{\Lob2\kappa}&\le \dist{p}{q}{\spc{U}}.
\intertext{In particular if $\kappa\le 0$ then}
\dist{p^*}{q^*}{\spc{U}}&\le \dist{p}{q}{\spc{U}}.
\end{align*}

To prove the second part of lemma, note that $\mangle\hinge{p^*}{p}{q^*}\ge \tfrac\pi2$.
Otherwise the distance $\dist{p}{x}{\spc{U}}$ to a point $x\in[p^*q^*]\subset K$ would be smaller than $\dist{p}{p^*}{\spc{U}}$,
a contradiction.

The same way we get $\mangle\hinge{q^*}{q}{p^*}\ge \tfrac\pi2$.

Consider the majorization of the quadraleteral $[pp^*q^*q]$ provided by majorization theorem (\ref{thm:major}).

Note that 
\[\mangle\hinge{p^{*}}{p}{q^{*}}\ge \tfrac\pi2,\]
otherwise the distance from $p$ to a point on $[p^{*}q^{*}]$ whold be shorter than $\dist{p}{p^{*}}{}$.
Since $K$ is convex $K\supset[p^{*}q^{*}]$;
the later contradicts Closest-point projection lemma \ref{lem:closest point}.

Applying Reshetnyak's majorization theorem to the quadrilateral $[pp^{*}q^{*}q]$ we get convex model quadraleteral $[\~p\~p^{*}\~q^{*}\~q]$
in $\Lob2\kappa$ 
such that
for any $x\in [pq]$ and any $y\in[p^{*}q^{*}]$ 
and corresponding points $x\~\in [\~p\~q]$ and any $\~y\in[\~p^{*}\~q^{*}]$
we have 
\[\dist{x}{y}{}\le\dist{\~x}{\~y}{}.\] 

COnsider the function $\~f\:\Lob{2}{\kappa}\to\RR$ defined by
\[\~f=\sn\kappa\dist{[\~p^{*}\~q^{*}]}{}{\Lob{2}{\kappa}}\]
By direct calculations, the inequality
\[\~f''+\kappa f\ge 0\]
holds in $\oBall([\~p^{*}\~q^{*}],\tfrac{\varpi\kappa}2)$.












\begin{wrapfigure}{r}{20mm}
\begin{lpic}[t(-7mm),b(0mm),r(0mm),l(0mm)]{pics/polytope(1)}
\end{lpic}
\end{wrapfigure}

\parbf{Remark.}
In the most cases, $\Omega^*$ is isometric to $K$ with induced intrinsic metric,
but in general we only have locally distance preserving map $\Omega^*\to K$ which is onto but in general may be not injective. 
An example can be seen on the picture.




In the proof we will need the following classical result in discrete geometry.

\begin{thm}{Proposition}\label{prop:diagonal}
Assume that $n>3$ 
and $P$ is an $n$-gon in $\Lob{2}{\kappa}$.
If $\kappa>0$ then we assume that $P$ does not contain closed half-sphere in its interior.
Then there is a  diagonal, say $[xy]$, of $P$ 
such that $\l]xy\r[$ lies in the interior of $P$.
\end{thm}

\parit{Proof.}
First note that $P$ has at least one convex vertex, say $v$.
Indeed, otherwise its complement is convex.
The later contradicts either
that $P$ is bounded for $\kappa\le  0$ 
or that $P$ does not contains a half-sphere in its interior for $\kappa\le  0$.

Let $[uv]$ and $[vw]$ be the sides of $P$ meeting at $v$.
If the $\l]uw\r[$ lies in the interior of $P$ 
then the proposition is proved.

%???PIC

Otherwise let $x\in[uv]$ be the point closest to $v$
such that $\l]xw\r[$ does not lie completely in the interior of $P$.
It means that $\l]xw\r[$ contains a vertex of $P$, 
say $z$.
In this case $\l]vz\r[$ lies in the interior of $P$.
Hence the result follows.
\qeds


\parit{Proof of Theorem~\ref{thm:2-d-cba}.}
First let us show that the condition in (\ref{SHORT.thm:2-d-cba:k>0}) is necessary if $\kappa>0$. 
Applying rescaling, we can assume that $\kappa=1$ and therefore $\Lob2\kappa=\SS^2$.

Assume $D=\cBall[p,\tfrac{\pi}2]$ lies in  the interior of $P$.
Given $\eps>0$
consider a triangle $[x^1x^2x^3]$ 
such that $\mangle\hinge{p}{x^i}{x^j}=\tfrac23\cdot\pi$ if $i\ne j$
and 
$\dist{p}{x^i}{}=\tfrac{\pi}2+\eps$ for all $i$.
Note that for small $\eps>0$ the triangle $ [x^1x^2x^3]$ lies in $P$.
On the other hand for some $z\in[x^2x^3]$, the geodesic $[x^1z]$ does not lie in $P$ completely.
Hence 
\[\dist{x^1}{z}{P}>\dist{x^1}{z}{\SS^2};\]
that is, the point-on-side comparison (\ref{cat-monoton}) does not hold for $[x^1x^2x^3]$
and hence $P\z\notin \cCat{}{\kappa}{}$.

If $P$ is a half-sphere then obviously $P\in\cCat{}{\kappa}$.

Assume $P$ is an $n$-gon.
To show that $P\in\cCat{}{\kappa}$,
we apply induction $n$.
The base cases $n=2$ and $3$ are trivial.

The proof of the step of induction,
let us apply Proposition~\ref{prop:diagonal}.
The diagonal $[xy]$ cuts $P$ into two polygons say $Q_1$ and $Q_2$.
By the induction hypothesis $Q_1,Q_2\in\cCat{}{\kappa}$.
Notice that the geodesic $[xy]$ forms a convex set
in $Q_1$ and in $Q_2$.

Note that $P$ can be obtained by gluing $Q_1$ and $Q_2$ along $[xy]$.
Therefore, by Reshetnyak's gluing theorem,
$P\in\cCat{}{\kappa}$.
\qeds













The points $a_1,\dots,a_n$ 
are called \index{vertex of polygon}\emph{vertices} of $P$;
the geodesics $[a_na_1]$, $[a_1a_2],\dots,[a_{n-1}a_n]$ 
\index{side of polygon}\emph{sides} of $P$
and the remaining geodesics between the vertices are called \index{diagonal of polygon}\emph{diagonals} of $P$.

A vertex $a_i$ of $P$ 
is called \index{convex vertex of polygon}\emph{convex} if a the intersection of $P$ with a small ball centered at $a_i$ is convex.
A non-convex vertex is called \index{concave vertex of polygon}\emph{concave}.















Recall that homology sphere is a $n$-dimensional manifold having the homology groups of an $\SS^n$. 

\begin{thm}{Corollary}\label{cor:flag-hom}
If the underlying space of $\spc{S}$ 
is a homology sphere then its cubical analog $\square_{\spc{S}}$ is a homology manifold.
\end{thm}














\parbf{Fundamental group at infinity.}
Let $\spc X$ be a proper topological space
and $K_0, K_1, \dots$
be its \index{exhaustion}\emph{exhaustion} by compact sets;
that is $K_0\subset K_1\subset \dots$ and $\spc X$ is the union of the interiors of $K_n$.

An \index{end}\emph{end} of $\spc X$
is defined as a decreasing sequence 
\[\Omega_0\supset \Omega_1\supset \dots\]
of connected components $\Omega_n$ 
of the complement 
$\spc X\backslash K_n$.
The inclusions 
$\Omega_{n-1}\leftarrow \Omega_{n}$
form an inverse system on $(\Omega_n)$ .

Assume in addition that $\spc{X}$
is locally simply conneted.
Then the inclusions above induce 
homomorphisms of its fundamental groups 
$\pi_1\Omega_{n-1}\leftarrow\pi_1\Omega_n$ 
which also forms an invese system
\[\pi_1\Omega_0\leftarrow \pi_1\Omega_1\leftarrow\dots.\]

More precisely, for each $n$ we have to fix a point $x_n\in \Omega_n$.
Each $\Omega_n$ is path connected 
since it is connected locally path connected.
Therefore we can fix a path in $\Omega_{n-1}$
connecting $x_{n}$ to $x_{n-1}$.
This path defines the needed homomorphism 
\[\pi_1(\Omega_{n-1},x_{n-1})\leftarrow\pi_1(\Omega_n,x_n).\]
This homomorphism is unique up to inner automorphism of $\pi_1(\Omega_{n-1},x_{n-1})$.

The inverse limit $\Gamma=\varprojlim \pi_1\Omega_n$ is called fundamental group of the end.
If the group $\Gamma$ is trivial,
we say that the end is \index{simply connected end}\emph{simply connected}.

Assume
\[\Omega_0'\supset \Omega_1'\supset \dots\]
is a decreasing sequence 
of connected components of the complement 
$\spc{X}\backslash K_n'$ for an other exhaustion $K_n'$ of $\spc{X}$.
We say that the sequence $(\Omega_n)$ defines the same end as $(\Omega'_n)$
if for any $i$ there is $j$ such that 
$\Omega'_i\supset \Omega_j$ and $\Omega_i\supset \Omega_j'$.

Note that the fundamenal group of end is uniquely defined up to isomorphism.

If $\spc{X}$ has one end which is simply connected,
we say that $\spc{X}$ is \index{simply connected at infinity}\emph{simply connected at infinity}.


\begin{thm}{Proposition}\label{prop:example-pi_infty}
Let $\spc{S}$ be a flag complex homeomorphic to a homological manifold
and $\spc{K}=\square_{\spc{S}}$ be its cubical analog.
Assume the universl covering $\tilde{\spc{K}}$ of $\spc{K}$ is simply connected at infinity.
Then $\spc{S}$ is simply connected.
\end{thm}


In the proof we will need the following lemmas.

\begin{thm}{Lemma}\label{lem:deg=1=>epi-pi1}
Let $\spc{M}$ and $\spc{N}$ be compact connected homological manifolds of the same dimension
and $f\:\spc{M}\to \spc{N}$ is a continuous map of degree 1.
Then the induced homomorphism $\pi_1\spc{M}\to \pi_1\spc{N}$
is onto.
\end{thm}

\parit{Proof.}
Assume contrary.
Consider the covering $\phi\:\tilde{\spc{N}}\to \spc{N}$
which corresponds to the image of $\pi_1\spc{M}$
in $\pi_1\spc{N}$.

Note that $f$ factors through $\phi$;
that is there is a map $\tilde f\:\spc{M} \to \tilde{\spc{N}}$
such that $f=\phi\circ f$.



If $\phi$ is an infinite-fold covering then $H_m(\tilde{\spc{N}})=0$.
Therefore $\tilde f([\spc{M}])=0$ 
and hence $f([\spc{M}])=0$;
that is $\deg f=0$, a contradiction.

If $\phi$ is a $\kay$-fold coveing for a finite $\kay>1$
then 
\begin{align*}
\deg f
&=\deg\phi\cdot\deg \tilde f=
\\
&=\kay \cdot \deg \tilde f;
\end{align*}
That is $\deg f$ is devisible by $\kay$,
a contradiction.\qeds

\parit{Proof of Proposition~\ref{prop:example-pi_infty}.}
By Corollary~\ref{cor:flag-cube}, the universal cover $\tilde{\spc{K}}$ is a $\cCat{}{0}$ space.

It remains to show that $\tilde{\spc{K}}$ is not simply connected at the infinity.

Fix a vertex $v\in \tilde{\spc{K}}$;
more precisely, $v$ is a point 
in the inverse image of a vertex of $\spc{K}$.

The space of directions at $v$
is isometric to $\spc{S}$
with the right-angled spherical metric.

Let us denote by $\Sphere[v,r]$ the sphere with center $v$ and  radius $r$ in $\tilde{\spc{K}}$.

Note that 
\begin{itemize}
\item For small $r_0$,
the sphere $\Sphere[v,r_0]$
is homeomorphic to $\spc{S}$.
\item For all values of $r$ except countable set 
$\Sphere[v,r]$ is a manifold.
\item
The map
$\map_r\:\tilde{\spc{K}}\backslash \oBall(v,r)\to \Sphere[v,r]$ 
is given by the map defined as $x\mapsto y$ if $y\in [vx]$
is a deformation retract.
\end{itemize}

Assume $\tilde{\spc{K}}$ is simply connected at infinity.
Choose a sequence of radii $r_n\to\infty$
such that $S_n=\Sphere[v,r_n]$ is a manifold for each $n$.
From above $S_n$ is homotopically equivalent to $\Omega_n=\tilde{\spc{K}}\backslash \cBall[v,r_n]$.
Moreover the restriction of $\map_n=\map_{r_n}$ to $\Omega_n$
is the homotopy equivalence $\Omega_n\to S_n$. 
Therefore $S_n$ is connected for all $n$.

The following diagram commutes 
\[
\begin{tikzcd}
\Omega_{n-1} 
\arrow[r, hookleftarrow] \arrow[d, "\map_{n-1}"] 
& \Omega_n \arrow[d, "\map_n"] 
\\
S_{n-1}\arrow[r, leftarrow, "\map_{n-1}"]& S_n
\end{tikzcd}
\]
Note that the restriction $\map_{n-1}\:S_n\leftarrow S_{n-1}$
has degree 1.
By Lemma \ref{lem:deg=1=>epi-pi1} the induced homomorphism 
$\pi_1S_{n-1}\leftarrow \pi_1S_{n}$ is onto.
Therefore the homomorphism 
$\pi_1\Omega_{n-1}\leftarrow \pi_1\Omega_{n}$ is also onto.
It follows that fundamental group at infinity of 
$\tilde{\spc{K}}$ admits a homomorphism onto $\pi_1\spc{S}=\pi_1 S_0$.
Hence the result follows.
\qeds

\begin{thm}{Corollary}
There is a polyhedral homological manifold $\spc{K}$
such that the universal cover $\tilde{\spc{K}}$ 
is a $\cCat{}{0}$ space which is not simply connected at infinity.
\end{thm}

Recall that \emph{binary icosahedral group} can be defined as the preimage of the icosahedral group under the 2:1 covering homomorphism
$\operatorname{Spin}(3) \to \operatorname{SO}(3)$.
The group $I_2$ has order 120.
The group $I_2$ is perfect; that is $I_2$ coincides with its commutator $[I_2,I_2]$.

The following Lemma follows from the main result in \cite{kervaire}.

\begin{thm}{Lemma}\label{lem:homology-sphere}
Given $m\ge 3$ there is a nonsimply connected $m$-dimensional homology sphere which forms the boundary of a contactable $(m+1)$-dimensional manifold $W$.

Moreover, if $m\ge 4$ then we can assume that $W$ is smooth.
\end{thm}

\parit{New Proof.}
Let $\spc{S}$ be a simplicial complex 
with undelying space formed by homotopy $m$-sphere provided by Lemma \ref{lem:homology-sphere}.

We can assume that $\spc{S}$ is a flag complex;
otherwise pass to its baricentrical subdivision and apply Exercise \ref{ex:baricenric-flag}.

Consider the cubical analog $\spc{K}=\square_{\spc{S}}$ of $\spc{S}$.
By Corollary~\ref{cor:flag-hom}, $\spc{K}$ is homological manifold.

The sphere $\Sphere[v,r]$ bounds a contractible ball 
and its interior is a homological manifold.
Therefore the homology groups of $\Sphere[v,r]$
coincide with the homology groups of $\mathbb{S}^m$.
In particular $\Sphere[v,r]$ has to be connected.
\qeds

In fact one can show that fundamental group at infinity
of the obtained homological manifold is isomorphic to 
star product of countable number of copies of $\pi_1\spc{S}$.

Applying the second statement in Lemma \ref{lem:homology-sphere},
we can smooth singularites of $\spc{K}$ while keeping it aspherical.
This way we get the following.

\begin{thm}{Corollary}
Given $m\ge 4$,
there is a compact aspherical $m$-dimensional manifold 
which universal cover is not homeomorphic to the Euclidean space.
Moreover if $m\ge 5$, we can assume that the manifold is smooth.
\end{thm}
























\newcommand*{\Lob}{\hbox{
\vcenter{\offinterlineskip
\hbox{\CYRL}%
\vskip-1.597ex\hskip-1.9ex\hbox{\color{white}$\mathbf{I}$}%
\vskip-1.597ex\hskip-1.9ex\hbox{$\II$}%
\vskip-.311ex\hskip-2.842ex\hbox{\tiny\color{white}.}}}}















\parit{Proof.}
Without loss of generality, we can assume that $t^0=0$.

Fix $\eps>0$ 
and consider sequence of subfunctions
$f^n(x)\df f_{n\cdot\eps}(x)$.
According to ???, for each $n$, we can solve differential equasion
$$\alpha^+(t)=\nabla_{\alpha(t)}f^n.$$
Therefore thare is a curve $\alpha_\eps$ defined on some fixed interval $[0,t_{\max})$
such that $\alpha_\eps(0)=x^0$ and
$$\alpha_\eps^+(t)= \nabla_{\alpha(t)}f^n$$
it $n\cdot\eps\le t<(n+1)\cdot\eps$.
The value of $t_{\max}$ can be estimated from below from Lipschitz constant of $f_t$ around $(0,x^0)$

\qeds















Gradient flow can be used to deform a mapping with target in $\spc{L}\in\CBB{}{}$. 
For example, if $\spc{X}$ is a metric space, then given a Lipschitz map $\map\:\spc{X}\to \spc{L}$ and
a positive Lipschitz function $\tau\:\spc{X}\to \RR_+$ one can consider the map $\map'$ called
\emph{gradient deformation} of $\map$ which is defined by
$$\map'(x)=\GF_f^{\tau(x)}\circ \map(x),\ \ \ \map'\:\spc{X}\to \spc{L}.$$

From Lemma~\ref{lem:dist-est} it is easy to see that the \emph{dilation}\footnote{i.e. its optimal Lipschitz constant.}
of $\map'$
can be estimated in terms of $\lambda$, $\sup\set{\tau(x)}{x}$, dilation of $\map$ and the
Lipschitz constants of $f$ and $\tau$.

Here is an optimal estimate for the length element of a curve which follows from
Lemma~\ref{lem:dist-est}:

\begin{thm}{Lemma} \label{lem:grad-variation} 
Let $\spc{L}\in\CBB{}{}$,
$\gamma_0(s)$ be a curve in $\spc{L}$ parametrized by arc-length
and $f\:\spc{L}\to\RR$ be a $\lambda$-concave function
and $\tau(s)$ be a non-negative Lipschitz function. 
Consider the curve 
$$\gamma_1(s)=\GF^{\tau(s)}_f \circ\gamma_0(s).$$ 
If $\sigma=\sigma(s)$ is its
arc-length parameter then
$$\d\sigma^2\le e^{2\cdot\lambda\cdot\tau}\cdot\l[\d
s^2+2\d(f\circ\gamma_0)\cdot\d\tau+|\nabla_{\gamma_0(s)}f|^2\d\tau^2\r].$$

\end{thm}

















Therefore it is sufficient to show that $\iota$ is onto.
\[\iota(\spc{X}_\infty)=\spc{X}_\o.
\eqlbl{eq:i(X)=X_o}\]

For a point $x_\o\in \spc{X}_\o$,
choose a sequence $x_n\in \spc{X}_n$ 
such that $x_n\to x_\o$ as $n\to\o$.













If a family of points $x_\eps$ depends on a positive parameter $\eps$, we will write
\[x_{\frac1\o}
=
\lim_{\eps\to\frac1\o}x_\eps\ \ \text{or}\ \ x_\eps\to x_\o\ \t{as}\ \eps\to\tfrac{1}\o\]
meaning that
\[x_{\frac1\o}=\lim_{n\to\o}x_{\frac{1}{n}}.\]
%???DO WE NEED IT???














\parbf{Remark.}
If $\diam \spc{X}_n\to \infty$ as $n\to\o$
then $\spc{X}_\o$ has pairs of points on infinite distance.
In other words $\spc{X}_\o$ has more than one metric components. 

Alternatively, one may define $\o$-limit without reference point.
In this case the $\o$-limit might be an $\infty$-metric space;
i.e., distance between points of the $\o$-limit might also take value $\infty$.
To recover the above $\o$-limit, 
one would need to pass to the subspace of all points on the finite distance from $\star_\o$.













\begin{thm}{Proposition}\label{prop:nested-convex}
Let $\spc{X}$ be a metric space 
$R\in(0,\infty]$
and $B\subset A\subset\spc{X}$ be two nested subsets. 
Assume $A$ is (weakly) $R$-convex in $\spc{X}$ and $B$ is (weakly) convex in $A$ then $B$ is (weakly) $R$-convex in $\spc{X}$.
\end{thm}

\parit{Proof of the claim.}??? Sinse $A$ is convex, any two points $x,y\in B$ can be joined by a geodesic $[x y]$ in $\spc{X}$;
moreover $[x y]\subset A$.
Note that $[x y]$ is also a geodesic in $\Length A$. 
Since $B$ is convex in $\Length A$,
$[x y]\subset B$.
\qeds















Set $\mangle\~p^i=\mangle\hinge{\~p^i}{\~x^\kay}{\~x^j}$. 
It follows that:
\begin{subthm}{two-overlap}
If $\mangle{\~p^1} +\mangle {\~p^2}+\mangle {\~p^3} \le 2\cdot\pi$ and 
triangles $\trig{\~p^3}{\~x^1}{\~x^2}$, $\trig{\~p^2}{\~x^3}{\~x^1}$ do not overlap, then
\begin{align*}
\mangle {\~p^1} 
&> 
\mangle{\~p^2}+ \mangle{\~p^3},
\end{align*}

\end{subthm}
\begin{subthm}{no-overlap} 
No pair of triangles $\trig{\~p^i}{\~x^j}{\~x^\kay}$  overlap if and only if 
\[\mangle{\~p^1} +\mangle {\~p^2}+\mangle{\~p^3}> 2\cdot\pi\]
and\footnote{If $\kappa\le 0$ then the next condition always holds. Indeed in this case the sum of angles in each model triangle is at most $\pi$.
Therefore the second condition in (\ref{SHORT.no-overlap})
holds  some and therefore any relabeling of $x^1, x^2, x^3$.}
\[\mangle\hinge {\~x^1}{\~x^2}{\~p^3}+\mangle\hinge {\~x^1}{\~p^2}{\~x^3}+\mangle\hinge {\~x^1}{\~x^2}{\~x^3}<2\cdot\pi\]
\end{subthm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\parit{``If'' part of (\ref{SHORT.no-overlap}). } 
Suppose triangles $\trig{\~p^3}{\~x^1}{\~x^2}$ and $\trig{\~p^2}{\~x^3}{\~x^1}$ overlap, 
\[\mangle\~p^1 + \mangle\~p^2+\mangle\~p^3 > 2\cdot\pi.
\eqlbl{eq:<p1+<p2+<p3}\]
and
\[
2\cdot\pi>\mangle\hinge {\~x^1}{\~x^2}{\~p^3}+\mangle\hinge {\~x^1}{\~p^2}{\~x^3}+\mangle\hinge {\~x^1}{\~x^2}{\~x^3}\]
By the former, \ref{eq:no-overlap} fails.  
By \ref{eq:<p1+<p2+<p3}, $\mangle\~p^2+\mangle\~p^3 > \pi$. 
Therefore
\[\mangle\~p^1
\le 
2\cdot\pi -(\mangle\~p^2+\mangle\~p^3),\]
which contradicts \ref{eq:<p1+<p2+<p3}.

\parit{``Only if'' part of (\ref{SHORT.no-overlap}).} 
Suppose no two triangles overlap and 
\[\mangle\~p^2 + \mangle\~p^2+\mangle\~p^3 \le 2\cdot\pi.\]  
By \ref{SHORT.two-overlap}), for $\{i,j,k\}=\{1,2,3\}$ we have
\[\mangle\~p^i > \mangle\~p^j+\mangle\~p^\kay.\]
Adding these three inequalities gives
\[ \mangle\~p^1+\mangle\~p^2+\mangle\~p^3 > 2\cdot (\mangle\~p^1+\mangle\~p^2+\mangle\~p^3),\] 
a contradiction.














Thank to Bourbaki, using notation $f\:X\to Y$
we assume that function $f$ is defined on whole $X$.
This is very annoing;
for example, we can not say that $f(x)=1/x$ is a continuous function $f\:\RR\to\RR$ and have to spacify the domain of $f$.
It would have more sense to assume that function $f\:X\to Y$ is defined on a subset of $X$;
this is sometimes called \emph{partially defined function}.
In this case a continous function automatically has to be defined on open subset, since the preimage $f^{-1}(Y)$ has to be open.

We can not fight with this stupid convension.
???













\begin{thm}{Corollary}
Let $\spc{X}_n$ be a sequence of metric spaces
with marked points $x_n\in  \spc{X}_n$.

Assume that there is a proper metric space $\spc{X}$ with marked point $x\in \spc{X}$
such that for each $n$ there is a distance noncontracting map 
$\map_n\:\spc{X}_n\to \spc{X}$ 
such that 
$$\dist{x}{\map_n(z)}{\spc{X}}
=
\dist{x_n}{z}{\spc{X}_n}$$
for any $z\in \spc{X}_n$.
Then a subsequence of $\spc{X}_n$ admits a Gromov--Hausdorff convergence $\GH$
for which the sequence of reference points converges.
\end{thm}
















\begin{thm}{Exercise}
Build a proof of Bishop--Gromov inequality (\ref{thm:bishop-gromov}) based on the following idea without using coarea formula.

Let $\spc{L}\in \CBB{m}{\kappa}$ and $p\in\spc{L}$
consider the map 

Let us define the anulus centered at $p$ and radii $r<R$
as
\[\Anulus(p,r,R)\]

\end{thm}

















\begin{thm}{Theorem}\label{thm:reg-point-stable}
Let $\spc{L}\in\CBB{m}{}$
and $\bm{x}=(x^1,x^2,\dots,x^m)\:\spc{L}\subto\RR^m$ be a distant chart with strut $y\:\spc{L}\subto\RR$.
Set $f=y\circ\bm{x}^{-1}$.  
Then for any $\eps>0$ there is $\delta>0$ such that
if there is a linear subspace $V\subset \RR^m$ 
and a linear function $\ell\:V\to\RR$
such that
\[\d_{\bm{x}}f(v)\lege\ell(v)\pm\delta\cdot|v|\]
for all $v\in V$ 
then $f(\bm{x})$ is $(\kay,\eps)$-regular.
\end{thm}

Applying 
the classification of 1-dimensional $\CBB{}{}$ spaces \ref{thm:dim=1.CBB}
together with theorem above,
we obtain the following.

\begin{thm}{Corollary}
Let $\spc{L}\in\CBB{m}{}$
and $\bm{x}=(x^1,x^2,\dots,x^m)\:\spc{L}\subto\RR^m$ be a distant chart with strut $y\:\spc{L}\subto\RR$
and $p\in\Dom\bm{x}$.
Set $f=y\circ\bm{x}^{-1}\:\RR^m\subto \RR$.
Then
\begin{subthm}{}
If $\d_{\bm{x}(p)}f$ is linear 
then  $\d_p\bm{x}\:\T_p\to \RR^m$ is linear and $\T_p\iso \EE^m$.
\end{subthm}

\begin{subthm}{}
If $\d_{\bm{x}(p)}f$ is linear on subspace of codimension 1 in $\RR^m$ then either $\T_p\iso \EE^{m-1}\times \RR_\ge$ or $\T_p\iso \EE^m$.
\end{subthm}
\end{thm}

















Theorem ~\ref{thm:bishop-gromov} admits the following generalization


\begin{thm}{Generalized Bishop--Gromov inequality}\label{thm:bishop-gromov-gen}
Let $m\ge 2$ and 
$\spc{L}\in\CBB{m}{\kappa}$, 
$S\subset \spc{L}$ be a compact subset.
Set
\begin{align*}
v(R)&=\vol_m\oBall[S,R],
&
\~v(R)&=\vol_m\oBall[ R]_{\Lob{m}{\kappa}}.
\end{align*}
Then the function
\[f\:R\mapsto \frac{v(R)}{\~v(R)}\] 
is non-increasing.
\end{thm}
Recall that for $S\subset \spc{L}$ and $0<r<R$  by  $\mathrm{A}[S,r,R]$  we denote the annulus $\{x\in\spc{L}|$ such that $r\le \dist{x}{S}{}\le R\}$.
\begin{thm}{Corollary}\label{cor:bishop-gromov-annulus}
$\spc{L}\in\CBB{m}{0}$ and let $S\subset \spc{L}$ be a compact subset. Let $0<r<R$.

Then 
\[
\vol_m \mathrm{A}[S,r,R]\le   \vol_m\oBall[S,R]\frac{R^m-r^m}{R^m}
\]
\end{thm}

\begin{proof}{Proof of Theorem ~\ref{thm:bishop-gromov-gen}}

The proof is essentially the same as the proof of Theorem ~\ref{thm:bishop-gromov} modulo the following simple generalization of triangle comparison ~\ref{point-on-side}.

\begin{thm}{Lemma}\label{point-on-side-gen}
Let $\spc{L}\in\CBB{m}{0}$ and let $S\subset \spc{L}$ be a closed subset. For points $p,q\in \spc{L}$  consider the generalized comparison triangle (if it exists)  $\trig{\~p}{\~q}{\~s}=\modtrig\kappa(p q S)$ in $\Lob2\kappa$
with $\dist{\tilde p}{\tilde q}{}=\dist{p}{q}{}$, $\dist{\tilde p}{\tilde s}{}=\dist{p}{S}{}$ and  $\dist{\tilde q}{\tilde s}{}=\dist{q}{S}{}$.

Let $x\in[pS], \tilde x\in [\tilde p\tilde s]$ be such that $\dist{x}{p}{}=\dist{\tilde x}{\tilde p}{}$. Then $\dist{x}{q}{}\ge\dist{\tilde x}{\tilde q}{}$.
\end{thm}
\begin{proof}
Let $s_1,s_2\in S$ be such that $\dist{p}{S}{}=\dist{p}{s_1}{}$ and   $\dist{q}{S}{}=\dist{q}{s_2}{}$.  

Consider the comparison triangle  $\trig{\~p}{\~q}{\~s_1}=\modtrig\kappa(p q s_1)$ and let $\tilde x_1\in [\tilde s_1\tilde p]$ be such that  $\dist{x}{p}{}=\dist{\tilde x_1}{\tilde p}{}$. Then by regular point-on-side comparison we have that $\dist{x}{q}{}\ge \dist{\tilde x_1}{\tilde q}{}$. However, $\dist {q}{s_1}{}\ge\dist{q}{S}{}$ and therefore $\dist{\tilde x_1}{\tilde q}{}\ge \dist{x}{\tilde q}{} $.

\end{proof}

As before let  $Q\subset \Sphere[S,r]$ be the set of all points 
which lie on the geodesics from $S$ to the points on $\Sphere[S,R]$ of length $R$.

And let $f\:Q\to \Sphere[S,R]$ be the map such that $f\:x\mapsto y$ where $y\in \Sphere[S,R]$ is the (necessarily unique) point with $x\in ]py[$ for some $p\in S$  and $\dist{p}{y}{}=R$.

Applying Lemma~\ref{point-on-side-gen} twice we see that $f$ is locally  $(\tfrac{\sn\kappa R}{\sn\kappa r}+\eps)$-Lipschitz for any $\eps>0$. The rest of the proof is the same as the proof of  Bishop-Gromov volume comparison~\ref {thm:bishop-gromov}.


\begin{comment}
The main step is to prove the following generalization of Proposition~\ref{prop:monotonic-spheres}:

Let $s(R)=\vol_{m-1}\Sphere [S,R]$ and, as before, $\tilde s(R)=\vol_{m-1}S[R]_{\Lob{m}{\kappa}}=(\sn\kappa R)^{m-1}\vol_{m-1}\SS^{m-1}$.

Let $Q\subset \Sphere[p,r]$ be the set of all points 
which lie on the geodesics from $S$ to the points on $\Sphere[S,R]$ of length $R$.

and $\phi\:Q\to \Sphere[S,R]$ be the map such that $\phi\:x\mapsto y$ where $y\in \Sphere[S,R]$ is such that $x\in ]py[$ for some $p\in S$  and $\dist{p}{y}{}=R$.
Note that such $p,y, ]p,y[$ are obviously unique and $\phi$ is onto.

Using

\begin{thm}{Proposition}\label{prop:monotonic-spheres-set}
The function $R\mapsto \frac {s(R)}{\tilde s(R)}$ is non-increasing in $R$.
\end{thm}
\begin{proof} {\bf !!!Sketch of the proof!!!}
Let $f(x)=\mdk(\dist {x}{S}{})$. Then $f$ satisfies the inequality $f''+\kappa f\le 1$ outside $S$.
Note that for any $\tilde p\in \Lob{m}{\kappa}$ the function $\tilde f(y)=\mdk(\dist {x}{\tilde p}{})$ defined on $\Lob{m}{\kappa}$ satisfies $\tilde f''+kf=1$.

Let $\GF^t_f$ be the gradient flow of $f$ and $\GF^t_{\tilde f}$ be the gradient flow of $\tilde f$.


Let $Q\subset \Sphere[p,r]$ be the set of all points 
which lie on the geodesics from $S$ to the points on $\Sphere[S,R]$ of length $R$.

and $\phi\:Q\to \Sphere[S,R]$ be the map such that $\phi\:x\mapsto y$ where $y\in \Sphere[S,R]$ is such that $x\in ]py[$ for some $p\in S$  and $\dist{p}{y}{}=R$.
Note that such $p,y, ]p,y[$ are obviously unique and $\phi$ is onto.



The set $Q$ is a closed
and 
\[\vol_{m-1}Q\le \vol_{m-1}\Sphere[S,r].\]

Just as in the proof of Proposition ~\ref{prop:monotonic-spheres} we aim to estimate the Lipschitz constant of $\phi$ on $Q$ and compare it to that of $\tilde \phi$.

Let $T=\cup [p,y]$ over all $p\in S, y\in \Sphere[S,R]$  such that $\dist{p}{y}{}=R$. Clearly $Q\subset T$.

Note that similarly defined subset of the model space $\tilde T$ is equal to $\oBall(\tilde p, R)\backslash \{\tilde p\}$

Suppose $x\in T$. Let $p\in S, y\in \Sphere[S,R]$ be such that $\dist{p}{y}{}=R$ and $x\in ]p,y[$. Then we have that $\nabla_x f=\snk(\dist{x}{p}{})\dir{x}{y}$ and $|\nabla_x f|=\snk(\dist{x}{S}{})$.

Thus,
\[
|\nabla_x f|=\snk(\dist{x}{S}{}) \eqlbl{eq:grad-length}
\]

for all $x\in T$ and \ref{eq:grad-length} almost holds for points near $T$ (to be made precise...)

Therefore  gradient curves of $f$ passing through points of $T$ are parts of reparametrized geodesics of length $R$ starting at $S$ and ending at $\Sphere[S,R]$. 


Let $\tau$ be such that $\GF^\tau_{\tilde f} (\Sphere [\tilde p, r])=\Sphere [\tilde p, R]$.
More explicitly, $\tau$ is defined by

\[
\mdk(R)-\mdk(r)=\int\limits_0^\tau (\mdk(t)')^2\d t=\int_0^\tau (\snk(t))^2\d t
\]


\end{proof}

\end{comment}

\end{proof}



















\begin{thm}{Better??? inverse function theorem}
Let $\spc{L}\in\CBB{m}{\kappa}$ 
and $p,a^0,a^1,a^2,\dots,a^m\in\spc{L}$.

Assume that the point array $\bm{a}=(a^0,a^1,\dots,a^m)$ is $\kappa$-strutting for $p$.
Moreover,
there are $R>0$ and $\eps>0$ such that
for all $i\not=j$ and any $q\in\oBall(p,R)$ we have
\[\<\dir{q}{a^i},\dir{q}{a^j}\>
<\tfrac1m-\eps.\]

Then 
The restriction of the distance map 
$\dist{\bm{a}^{\without 0}}{}{}|\oBall(p,R)$
is an open bi-Lipschitz embedding $\oBall(p,R)\hookrightarrow\RR^m$.

\end{thm}

Let $\spc{L}\in \CBB{m}{\kappa}$.
Assume that for some $\eps>0$,
a point array
$(a^0,a^1,\dots,a^m)$ 
and $p\in\spc{L}$
we have $\angk\kappa p {a^i}{a^j}>\tfrac\pi2+\eps$ for all $i\ne j$.
(In particular $(a^0,a^1,\dots,a^m)$ is $\kappa$-strutting for a point $p\in\spc{L}$.)

Then there is a neighborhood $\Omega$ of $p$
such that for any $q\in\Omega$
and any unit tangent vector $v\in \Sigma_q$
we have
\[???\le\sum_{i=0}^m\langle v,\dir{q}{a^i}\rangle^2\le ???\]

















\section{The case of CBB spaces}

Let $\spc{L}\in \CBB{}{}$ and $f,g\:\spc{L}\subto\RR$ be two semiconcave subfunctions with common domain $\Omega=\Dom f=\Dom g$. 
We say that $f$ \emph{thrusts} $g$  if there is $\eps>0$ such that
$$d_xf(\nabla_xg), d_xf(\nabla_xg)<-\eps.$$
An array of mutually thrusting functions $(f^0,f^1, \dots, f^\kay)$ will be called \emph{thrusting function array}.

For example, if the a point array $(a^0,a^1,\dots,a^\kay)$ struts point $p$ then the restrictions of the distance functions 
$\dist{a^0}{}{}$,
$\dist{a^1}{}{},\dots,\dist{a^\kay}{}{}$,
to a small neigborhood of $p$ is a thrusting function array.
Indeed,
$$\nabla_x\dist{a^i}{}{}$$

\begin{thm}{Proposition}
Let $\eps>0$,
$\spc{L}\in \CBB{}{}$,
$K\subset \spc{L}$ be a convex closed set with nonempty interior $\Omega=\Int K$ and
$\bm{f}=(f_0,f_1,\dots,f_n)$ be an array of strongly concave functions defined on $K\subset\spc{L}$.

Assume 
$$d_xf^i(\nabla_xf^j)<-\eps$$
for any $x\in \Omega$ and any $i\ne j$.
Then $x\in\InWeb\bm{f}$ if and only if 
$\min d_xf^i\le 0$
\end{thm}


Let $x\in\Omega$.
Note that $x\in\Web\bm{f}$ if and only if 
$\nabla_x\max_i\{f_i\}=o$.
Further $x\in\InWeb\bm{f}$ if and only if 
$\nabla_x\max_i\{f_i\}=o$ but ???.



















\section{Besicovitch inequality}%???MAYBE NOT NEEDED???
%???Besicovitch or Besikovitch???

\begin{thm}{Besicovitch's Lemma}\label{lem:besicovitch}
Let $\spc{X}$ be a compact metric space.
Assume $\bm{\psi}=(\psi^1,\dots,\psi^m):\spc{X}\to\RR^m$
be a map such that each coordinate function $\psi^i$
is 1-Lipschitz.
Then 
\[\LongMes_m\spc{X}\ge 
\vol_m[\bm{\psi}(\spc{X})].
\]
\end{thm}

The proof uses Federer's coarea formula (\ref{thm:coarea-federer}). 

\parit{Proof.}
Fix $\eps>0$ and let
$f_1,f_2\dots\:\EE^m\subto \spc{X}$
be the short submaps such that 
\[\spc{X}=\bigcup_n\Im f_n\]
and 
\[\sum_n\vol_m(\Dom f_n)
<
\LongMes_m \spc{X}+\eps.\]

Note that for each $i$ and $n$,
the composition $\psi^i\circ f_n$ is 1-Lipschitz.
It follows that
\begin{align*}
|[\d_x(\bm\psi\circ f_n)]^{\wedge n}|
&\le \lip(\psi^1\circ f_n)\cdots\lip(\psi^m\circ f_n)
\le
\\
&
\le 1.
\end{align*}
for almost all $x\in\Dom f_n$.


Applying Federer's area formula,
for 
$\bm\psi\circ f_n\:\RR^m\subto\RR^m$, 
we get 
\begin{align*}\vol_n(\Dom f_n)
&=
\int\limits_{\Im \bm\psi\circ f_n}|[\d_x(\bm\psi\circ f_n)]^{\wedge n}|\cdot\d_x\vol_m\le
\\
&\le \vol_n(\Im \bm\psi\circ f_n)
\end{align*}

\begin{align*}
\LongMes_m \spc{X}+\eps
&\ge \sum_n\,\vol_n(\Dom f_n)\ge
\\
&\ge \sum_n\,\int\limits_{\Dom f_n}\bigl|[\d_x(\bm\psi\circ f_n)]^{\wedge n}\bigr|\cdot\d_x\vol_n=
\\
&=\sum_n\,\vol_n(\Im \bm\psi\circ f_n)\ge
\\
&\ge \vol_n[\bm\psi(\spc{X})].
\end{align*}
Since $\eps>0$ is arbitrary, 
the result follows.
\qeds


















\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{}$ and $p\in \spc{L}$.
Assume $\T_p\spc{L}\iso\EE^m$.
Then 
$$\LongMes_m\cBall(p,R)\ge\alpha_m\cdot R^m+o(R^m),$$
where $\alpha_m$ denotes the volume of unit ball in $\EE^m$.
\end{thm}

\parit{Proof.}
Without loss of generality we can assume that $R<\tfrac{\varpi\kappa}2$.
According to ???, the restriction of the graient exponent 
$\gexp\mc\kappa_p\:\T_p\to \spc{L}$ 
to the closed $R$-ball in $\T_p$
is $???$-Lipschitz.

In particular the one parameter family of maps 
$\map_R\:\cBall[R]_{\EE^m}\to \spc{L}$ defined as
???
Is ???-Lipschitz.

Fix $\eps>0$.
Choose an $\eps$-net $(x_1,x_2,\dots,x_n)\in \cBall[R]_{\EE^m}$.
From the existence of angle, we get
$$\dist{\map_R(x_i)}{\map_R(x_j)}{\spc{L}}
>
R\cdot\dist{x_i}{x_j}{\EE^m}+o(R).
$$
for all $i$ and $j$.

Applying Corollary for $\map_R$ we get the result.
\qeds




















\begin{thm}{Corollary}
Let $\spc{X}$ be a metric space;
and $K$ be a compact set in $\EE^m$ 
bounded by a smooth hypersurface $\partial K$.
Then there is a $\Const=\Const(K)$ such that
if the map
$\map\:K\to\spc{X}$ is short 
and
\[\dist{\map(x)}{\map(y)}{\spc{X}}>\dist{x}{y}{\EE^m}-\eps\]
for any $x,y\in \partial K$
then 
$$\LongMes_m(\Im\map) \ge \vol_m K
-
\eps\cdot\Const.$$

\end{thm}

\parit{Proof.}
Without loss of generality,
we may assume that $K$ lies completely in the unit cube
$[0,1]^{\times m}$.

Given a point $\bm{z}\in [0,1]^{\times m}$,
we will denote by $z^i$ the $i$-th coordinate of $\bm{z}$,
so 
\[\bm{z}=(z^1,\dots,z^m).\]

Fix $i\in\{1,\dots,m\}$.
Consider the function 
$\psi^i\:\spc{X}\to \RR$
defined as 
\[
\psi^i(x)
=
\inf
\set{\dist{\map(\bm{z})}{x}{\spc{X}}+z^i}{\bm{z}=(z^1,\dots,z^m)\in\partial K}.
\]
Note that 
\[z^i-\eps \le \psi^i(\map(\bm{z})\le  z^i\]
for any $\bm{z}\in\partial K$. 

Now consider the map $\bm{\psi}\:\spc{X}\to \RR^m$,
\[\bm{\psi}(x)=(\psi^1(x),\dots,\psi^m(x)).\]
Note that the image $\bm{\psi}\circ\map$
contains the set $K_\eps$ of all points in $K$ 
which lie on the distance at least $m\cdot\eps$ from $\partial K$.
Clearly 
\[\vol_m K_\eps>\vol_m K-\Const\cdot\eps\]
for some constant $\Const$.

Applying Besicovitch's Lemma (\ref{lem:besicovitch}) we get the result.
\qeds
















Consider a quadruple of distinct points $(x^1,x^2,x^3,x^4)$ in a metric space.
We say that the quadruple is $\kappa$-model if it isometric to a quadruple in $\Lob3\kappa$.

Note that if $(x^1,x^2,x^3,x^4)$ is $\kappa$-model
if the following two conditions hold
\begin{enumerate}[(i)]
\item\label{model4i} Each of the model triangles 
$\modtrig\kappa(x^ix^jx^\kay)$ are defined.
\item\label{model4ii} For one (and therefore any) permutation $(i,j,\kay,\ell)$
of $(1,2,3,4)$, 
we have that the three angles $\angk\kappa{x^i}{x^j}{x^\kay}$,
$\angk\kappa{x^i}{x^\kay}{x^\ell}$ and $\angk\kappa{x^i}{x^j}{x^\ell}$
satisfy all three triangle inequalities 
and
\[\angk\kappa{x^i}{x^j}{x^\kay}+\angk\kappa{x^i}{x^\kay}{x^\ell}+\angk\kappa{x^i}{x^j}{x^\ell}
\le 
2\cdot\pi.\]
\end{enumerate}

If the quadruple $(x^1,x^2,x^3,x^4)$ fails to meet Property~(\ref{model4i}),
we will call it $\kappa$-inadmissible, otherwise we call $\kappa$-admissible.

A $\kappa$-admissible quadruple,
can fail to meet  Property~(\ref{model4ii}) in two distinct ways.
\begin{enumerate}[(a)]
\item\label{model4ii-a} For any permutation $(i,j,\kay,\ell)$
of $(1,2,3,4)$ we have
\[\angk\kappa{x^i}{x^j}{x^\kay}
+
\angk\kappa{x^i}{x^\kay}{x^\ell}
+
\angk\kappa{x^i}{x^j}{x^\ell}
\le 
2\cdot\pi.\]

In this case, for each $i$,
one of the three triangle inequality fails 
for the following three angles $\angk\kappa{x^i}{x^j}{x^\kay}$,
$\angk\kappa{x^i}{x^\kay}{x^\ell}$ and $\angk\kappa{x^i}{x^j}{x^\ell}$.
Without loss of generality we may assume that
\[
\angk\kappa{x^1}{x^2}{x^3}
+
\angk\kappa{x^1}{x^3}{x^4}
<
\angk\kappa{x^1}{x^2}{x^4}.
\eqlbl{eq:angle-non-trig-inq}\]
In this case, 
consider two model triangles $[\~x^1\~x^2\~x^3]=\modtrig\kappa(x^1x^2x^3)$
and
$[\~x^1\~x^3\~x^4]=\modtrig\kappa(x^1x^3x^4)$
so that they lie on opposite sides of $[\~x^1\~x^3]$.
Note that \ref{eq:angle-non-trig-inq} implies that 
\[\dist{\~x^2}{\~x^4}{\Lob2\kappa}
<
\dist{x^2}{x^4}{\spc{X}}.
\]
Since 
\[
\angk\kappa{x^3}{x^2}{x^1}
+
\angk\kappa{x^3}{x^1}{x^4}
+
\angk\kappa{x^3}{x^2}{x^4}\le 2\cdot\pi,
\]
the later implies 
\[
\angk\kappa{x^3}{x^2}{x^1}
+
\angk\kappa{x^3}{x^1}{x^4}
<
\angk\kappa{x^3}{x^2}{x^4}.
\]




\item\label{model4ii-b} For at least one permutation $(i,j,\kay,\ell)$
of $(1,2,3,4)$ we have
\[\angk\kappa{x^i}{x^j}{x^\kay}
+
\angk\kappa{x^i}{x^\kay}{x^\ell}
+
\angk\kappa{x^i}{x^j}{x^\ell}
> 
2\cdot\pi.\]
\end{enumerate}
The following two diagrams explain what happen in each case when you try to embed the quadruple in $\Lob2\kappa$.
The solid lined 

\begin{center}
%\begin{wrapfigure}{l}{44mm} 
\begin{lpic}[draft,t(0mm),b(7mm),r(0mm),l(0mm)]{pics/cba-cbb-quad}
\lbl[t]{13,-1;(\ref{model4ii-a})}
\lbl[t]{58,-1;(\ref{model4ii-b})}
\end{lpic}
\end{center}

In case (\ref{model4ii-a}), we may take











\parit{Proof.}
Denote by $S(p,R)$ and $S(\~p,R)\subset \Lob{m}{\kappa}$
the spheres with center $p$ and $\~p$ and radius $R$ in $\spc{L}$ and in $\Lob{m}{\kappa}$
correspondingly. 
Note that 
\begin{align*}
S(p,R)&=(\dist{p}{}{})^{-1}(R),
&
S(\~p,R)&=(\dist{\~p}{}{})^{-1}(R).
\end{align*}
Denote by $a(R)$ and $\~a(R)$ the areas of $S(p,R)$ and $S(\~p,R)$ correspondingly;
i.e.,
\begin{align*}
a(R)&=\vol_{m-1} S(p,R),
&
\~a(R)&=\vol_{m-1} S(\~p,R).
\end{align*}

Let us prove the following.

\begin{clm}{}\label{clm:a(R)}
The function 
\[R\mapsto \frac{a(R)}{\~a(R)}\]
is not increasing in
$(0,\varpi\kappa)$.
\end{clm}

\parit{Proof of the claim.}
We need to prove that 
\[ \frac{a(R^1)}{\~a(R^1)}\ge \frac{a(R^2)}{\~a(R^2)}
\eqlbl{eq:a(R)}\]
if $0<R^1< R^2<\varpi\kappa$.

For each point $x\in S(p,R^2)$ 
choose a point $\bar x \in S(p,R^1)$
which lie on a geodesic $[px]$;
according to Corollary~\ref{cor:dim>proper} at least one such path exists.

According to Corollary~\ref{cor:monoton:2-sides}, 
the map $x\mapsto \bar x$ is injective and moreover
\[\dist{\bar x}{\bar y}{}
\ge
\frac{\sn\kappa R^1}{\sn\kappa R^2}\cdot\dist[{{}}]{x}{y}{}+o(\dist{x}{y}{}).\]
Applying the above inequality in the definition of Hausdorff measure,
we get
\[a(R^1)
\ge
\l(\frac{\sn\kappa R^1}{\sn\kappa R^2}\r)^{m-1}
\cdot
a(R^2)\] 
Clearly 
\[\~a(R^1)
=
\l(\frac{\sn\kappa R^1}{\sn\kappa R^2}\r)^{m-1}
\cdot
\~a(R^2).\]
Hence \ref{eq:a(R)} follows.
\claimqeds

Applying Coarea formula (\ref{thm:coarea}) and Claim~\ref{clm:a(R)},
we get
\[
\begin{aligned}
\frac{v(R)}{a(R)}
&=
\frac1{a(R)}
\cdot
\int\limits_0^R a(r)\cdot\d r
\ge
\\
&\ge \frac{1}{\~a(R)}\cdot \int\limits_0^R \~a(r)\cdot\d r
=
\\
&=
\frac{\~v(R)}{\~a(R)}
\end{aligned}
\eqlbl{eq:a/v}
\]
for all $R>0$.

From the Coarea formula, we get 
\begin{align*}
v'&\ae a, & \~v'&\ae\~a. 
\end{align*}
Applying  \ref{eq:a/v}, 
we get
\[(\ln\circ f)'
\ae
\frac{a}{v}-\frac{\~a}{\~v}
\le 0.
\]
Since $f$ is locally Lipschitz, this proves the theorem.

\parit{(\ref{SHORT.thm:bishop-gromov:bishop}).}
Let $\spc{L}\in\CBB{m}{\kappa}$
$p\in \spc{L}$.
Consider $\kappa$-cone $\spc{K}=\Cone^\kappa\Sigma_p$
(see ???).
According to ???, $\spc{K}\in\CBB{m}{\kappa}$.
Note that each point in $\spc{K}$ can be described as a pair 
$(\xi,R)$, where $\xi\in\Sigma_p$ and $R\in\RR_\ge$ is the distance to the origin of the $\kappa$-cone $\spc{K}$.

Assume $\diam \spc{L}\le \varpi\kappa$
(according to ??? this holds if $m\ge 2$).
For each point $x\in\spc{L}$ choose a geodesic $[px]$;
its existence follows from ???.
Define map
$\spc{L}\to\spc{K}$
by $x\mapsto\bar x=(\dir px,\dist{p}{x}{})$.

The map $x\mapsto \bar x$ maps $\oBall(p,R)$ into $\oBall(\bar p,R)$ and from ???, we have 
\[\dist{\bar x}{\bar y}{\spc{K}}
\ge 
\dist{x}{y}{\spc{L}}\]
for any $x,y\in \spc{L}$.
In particular, for any $R\ge 0$,
\[\vol_m \oBall(\bar p,R)\ge \vol_m \oBall(p,R).\]



















\parbf{Jacobians.}
Assume $\spc{L}\in \CBB{\kay}{}$, $\spc{M}\in\CBB{m}{}$
and $f\:\spc{L}\subto \spc{M}$ is a locally Lipschitz map which is linearly differentiable at point $p\in\Dom f$;
i.e., 
(1) $\d_p f$ is defined,
(2) both $\T_p$ and $\Im(\d_pf)\subset \T_{f(p)}$ are isometric to Euclidean spaces
and (3) $\d_p f\:\T_p\to \Im(\d_pf)$ is linear.
In this case the value
\[|(\d_pf)^{\wedge n}|\]
is defined and it is called
\emph{$n$-th Jacobian of $f$ at $p$}.

\begin{thm}{Proposition}\label{prop:jack}
Let 
$\spc{L},\spc{M},\spc{N}\in\CBB{<\infty}{}$ and $f\:\spc{L}\subto\spc{M}$, $h\: \spc{M}\subto\spc{N}$
be locally Lipschitz submaps.
Then, for any integer $n$, 
the $n$-th Jacobians 
$$|(\d_p f)^{\wedge n}|,\ \  
|(\d_p [h\circ f])^{\wedge n}|,\ \  
|(\d_q h)^{\wedge n}|$$
are defined for almost all $p\in\Dom f$, $p\in\Dom (h\circ f)$ and $q\in\Dom h$ correspondingly. 
Moreover
\begin{align*}
|(\d_pf)^{\wedge n}|&\le|\d_pf|^n
& &\t{and}
&
|(\d_p[f\circ h])^{\wedge n}|
&\le|(\d_{h(p)}f)^{\wedge n}|\cdot|(\d_ph)^{\wedge n}|.
\end{align*}
if both left and right hand sides are defined.

In particular
\begin{subthm}{prop:jack:bilip-left}
If $f$ is a $e^{\mp\eps}$-bi-Lipschitz map then
\[ 
|(\d_p[f\circ h])^{\wedge n}|
\lege 
e^{\pm n\cdot\eps}\cdot|(\d_ph)^{\wedge n}|.\]
\end{subthm}
\begin{subthm}{prop:jack:bilip-right}

If $h$ is a $e^{\mp\eps}$-bi-Lipschitz map then
\[ 
|(\d_p[f\circ h])^{\wedge n}|
\lege 
e^{\pm n\cdot\eps}\cdot|(\d_pf)^{\wedge n}|.\]
\end{subthm}


\end{thm}

\parit{Proof.}
According to Corollary~\ref{cor:rademacher-cbb-sourse} of Rademacher's theorem
implies that $f$ and $h$ have linear differential almost everywhere in their domains of definitions. 

It remains to 
apply Proposition~\ref{prop:lin-algebra-1}.
\qeds

















\begin{thm}{Proposition}
Any $\CBB{m}{}$ space satisfies Besicovitch's condition.
\end{thm}

\parit{Proof.}
Let $\spc{L}\in \CBB{m}{\kappa}$;
without loss of generality, we may assume that $\kappa\le 0$.

Assume that the points $p,x^1,x^2,\dots x^n\in\spc{X}$
satisfy the inequalities
\[\dist{x^i}{x^j}{}>\max\{\eps,\dist{p}{x^i}{}-\eps\}\]
for some fixed $\eps>0$ and all $i\ne j$.

Note that there is $\delta>0$
such that 
$$\mangle \hinge p{x^i}{x^j}>\delta$$
if $\dist{p}{x^i}{},\dist{p}{x^j}{}>2\cdot\eps$.
In fact one can take  $\delta=\~\mangle\mc\kappa\{\eps_0;2\cdot\eps_0;2\cdot\eps_0\}$.

Therefore at most $\pack_\delta\SS^{m-1}$ of points $\{x_1,x_2,\dots,x_n\}$ lie outside of $\cBall[p,2\cdot\eps]$.

On the other hand, since $\dist{x^i}{x^j}{}>\eps$, for all $i\ne j$; there at most ??? of  points $\{x_1,x_2,\dots,x_n\}$ which lie  in $\cBall[p,2\cdot\eps]$.

Hence $n\le \pack_\delta\Sigma_p$.
According to ???, $\Sigma_p\le \SS^{m-1}$.
Therefore the Besicovitch condition holds for $r_0=1$ and $N=\pack_\delta\SS^{m-1}$.
\qeds
















\section{Density and space of directions}

\begin{thm}{Proposition}
Let $\spc{L}\in\CBB{m}{\kappa}$.
Then 
\[\dens_p\SphMes_m=1\ \ \Leftrightarrow\ \ \Sigma_p\iso\SS^{m-1}\]
for any point $p\in \spc{L}$.
\end{thm}

From ??? it will follow that 
\[\dens_p\SphMes_m=\frac{\SphMes_{m-1}\Sigma_p}{\SphMes_{m-1}\SS^{m-1}}.\]

\begin{thm}{Corollary}
Let $\spc{L}\in\CBB{m}{\kappa}$.
Then 
\begin{subthm}{}
$\SphMes_m$-almost all point in $\spc{L}$ have tangent cones $\EE^m$. 
\end{subthm}

\begin{subthm}{}
Given $\delta>0$, there is a closed set $\mathfrak{C}_\delta\subset \spc{L}$ such that $\SphMes_m\mathfrak{C}_\delta=0$ and the complement $\spc{L}\backslash\mathfrak{C}_\delta$ can be covered by $e^{\mp \delta}$-bi-Lipschitz distance charts.
\end{subthm}

\end{thm}


\parit{Proof.}
Assume $\Sigma_p\iso\SS^{m-1}$.
By ???, for any $\eps>0$ there is a spherical neighborhood
of $p$ admits a $e^{\mp\eps}$-bi-Lipshitz map to $\RR^m$.
Hence ($\Leftarrow$) follows.

Now assume $\Sigma_p$ is not isometric to $\SS^{m-1}$.
By ???, $\rad\Sigma_p<\pi$;
i.e., there is a direction $\xi\in \Sigma_p$ such that 
$\mangle(\xi,\eta)<\pi-\eps$ for any $\eta\in\Sigma_p$ and some fixed $\eps>0$.

Without loss of generality, we may assume that $\xi$ is a geodesic direction;
i.e., $\xi=\dir{p}{q}$ for some geodesic $[pq]$.
Moreover, by ???, we may assume that $\T_q\iso\EE^m$.
Therefore by ???, we have $\T_{\bar q}\iso\EE^m$ for any $\bar q\in\l]pq\r]$.

Let us estimate 
$\SphMes_m\oBall(p,R)$ 
for a fixed small value $R>0$.

Fix small $\delta>0$.
Applying Lebesgue's density theorem (\ref{thm:lebesgue-density})
and Vitali covering theorem (\ref{thm:vitali}),
we can find a countable collection of disjoint balls $\cBall(p_1,R_1),\cBall(p_2,R_2),\dots$ such that for each $n$, 
the ball $\cBall[p_1,R_1]$ is $e^{\mp\delta}$-bi-Lipschitz to a subset of $\EE^m$, each ball $\cBall[p_1,R_1]$ lies completely in $\oBall(p,R)$ and 
\[\SphMes_m\l(\oBall(p,R)\l\backslash \bigcup_n\cBall[p_n,R_n]\r.\r)=0.\]

According to ???,
\[\SphMes_m\oBall(p_n,R_n)\le \sum_n \~v\mc\kappa(R_n)\]
for each $n$.
Therefore
\[\SphMes_m\oBall(p,R)\le \sum_n \~v\mc\kappa(R_n)\]

Choose $\bar q\in \l]pq\r]$ so that $\dist{p}{\bar q}{}<\delta$.
For each point $x\in \oBall(p,R)$, 
choose a geodesic $[\bar q x]$.
Consider the map $\oBall(p,\delta)\to \T\mc\kappa_{\bar p}\iso \EE^m$
defined as $x\mapsto \ddir{\bar q}{x}$.
This way we get a distance noncontracting map $\oBall(p,\delta)\to \ModBall_{R+\delta}[\kappa]$.

Notice that ???; indeed ???.

It follows that 
\[\sum_n \~v\mc\kappa(R_n)\le \~v\mc\kappa(R+\delta)-\~v\mc\kappa(\eps\cdot R)\]
Since 


Given $\eps>0$, choose a point $p'\in\spc{L}$ such that 
$\dist{p}{p'}{}<\eps^2$ and $\mangle(\xi,\dir{p}{p'}$
$\Sigma_p\iso\SS^{m-1}$
if and only if $\rad\Sigma_p=\pi$.

If $\rad\Sigma_p<\pi$ then ???
\qeds







\section{Volume}

Let us denote by $\vol^n$ the $n$-dimensional Lebegues measure on $\EE^n$.

Let us define upper and lower $n$-dimensional volume of subsets in general metric space.
They will be denoted further as $\overline\vol^n$ and $\underline\vol^n$ correspondingly.

Let $\spc{X}$ be a metric space and $A\subset \spc{X}$.
Set
\[\underline\vol^n A
=
\inf\l\{\sum_i\vol^n V_i\r\},\]
where the infimum is taken for all countable collection of $\vol^n$-measurable sets $V_i\subset \EE^n$
such that there is a collection of short submaps $f_i\:\EE^n\subto\spc{X}$
such that $V_i\subset\Dom f_i$ and $\bigcup_i f_i(V_i)\supset A$.

Further, set
\[\overline\vol^n A
=
\sup\l\{\sum_i\vol^n W_i\r\}.\]
Where the supremum is taken for all countable collection of $\vol_n$-measurable sets $W_i\subset \EE^n$
such that there is a collection of short submaps $h_i\:\spc{X}\subto\EE^n$
such that $W_i=\Im h_i$ and $\bigcup_i \Dom h_i\supset A$.

\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{}$ space and $A\subset\spc{L}$ be a Borel set then
\[\underline\vol_n A=\overline\vol_n A.\]

\end{thm}

\parit{Proof.}
First note that inequality
\[\underline\vol_n A\le\overline\vol_n A\]
holds for any subset $A\subset\spc{L}$.
Thus  it only remains to show that 
\[\underline\vol_n A\ge\overline\vol_n A.
\eqlbl{low-vol>up-vol}\]

Fix a point $p\in\spc{L}$.
Let $\kay=\rank_p$.
According to ???, there is a Lipschtz submap $\map_p\:\EE^\kay\subto\spc{L}$ such that all points with rank $\le\kay$ in a neighborhood $\Omega\ni p$ belong to $\Im\map_p$.
If $\kay<m$ then clearly $\overline\vol^m\Im\map_p=0$.
In this case, \ref{low-vol>up-vol} trivially holds for any $A\subset \Im\map_p$.

Thus we may assume that $A$ contains only points with rank $m$.
According to ???, $A$ can be covered by countable number of distance charts.
Therefore we may assume that $A$ lies completely in the domain of one distance chart $\bm{x}\:\spc{X}\subto\RR^m$.

According to ???,
almost all points $z\in\Dom\bm{x}$ have Euclidean tangent cone.
According to ???, for any $\eps>0$ and any such point $z\in \Dom\bm{x}$ there is a $e^{\mp\eps}$-bi-Lipschitz chart of a neighborhood of $z$.
Thus, given $\eps>0$,
a subset of full measure in $A$ 
can be covered by domains of by  $e^{\mp\eps}$-bi-Lipschitz charts.

In other words, we can assume that $A$ lies in a $e^{\mp\eps}$-bi-Lipschitz chart $\bm{x}\:\spc{L}\subto\RR^m$ for any given $\eps>0$.
Note that in this case
\[\underline\vol^n A\ge(1-\eps)^m\cdot\vol\bm{x}(A)\]
and
\[\overline\vol^n A\le(1+\eps)^m\cdot\vol\bm{x}(A).\]
Therefore for any $\eps>0$ we have
\[\underline\vol^n A
\ge
\l(\tfrac{1-\eps}{1+\eps}\r)^m\cdot\overline\vol^n A.\]
Hence \ref{low-vol>up-vol}.
\qeds

\section{Volume}

We define $m$-volume as $m$-dimensional spherical measure. 

Denote by $\alpha^m$ the Lebesgue measure of the unit ball 
in $m$-dimensional Euclidean space. 
The constant $\alpha^m$ can be written using Eulers's gamma function.
$$\alpha^m=\frac{\pi^{\frac m2}}{\Gamma(\frac m2+1)}.$$

Assume $\spc{X}$ is a metric space 
and $E\subset \spc{X}$ is a Borel subset set
\[\vol^m E
\df
\alpha^m
\cdot
\lim_{\eps\to0}\inf\set{\sum_{i=1}^\infty (\rad E_i)^n}{\bigcup_{i=1}^\infty E_i=E,\ \rad E_i<\eps\ \t{for each}\  i}.\]

Note that $\vol^0$ is the counting measure.
The normalization constant 
$\alpha^m$ 
in the definition is used to make the volume of unit $n$-dimensional cube equal $1$.

\begin{thm}{Doubling property}
For any real value $\kappa$ and integer $m$ there is a constant 
$C$ such that if $\spc{L}\in\CBB{m}{\kappa}$ then for any $p\in \spc{L}$, we have
$$\vol\oBall(p,2\cdot R)\le C\cdot \vol^m\oBall(p,R)$$
for any $p\in \spc{L}$ and $R\le 1$.
\end{thm}

\parit{Proof.}
Consider the function $f=\dist[2]{p}{}{}$.
According to ???, $f$ is ???-concave in $\oBall(p,2\cdot R)$.

Consider the gradient flow $\GF^t_f\:\spc{L}\to \spc{L}$.
Set $\map(x)=\GF^{\ln 2}_f(x)$.

According to ???, 
$$\dist{\map(x)}{\map(y)}{}\le ???\cdot\dist{x}{y}{}$$
Clearly $\map(\oBall(p, R))=\oBall(p,2\cdot R)$.
Hence the result follows.
\qeds

\begin{thm}{Vitali covering theorem}
Let $\spc{L}\in\CBB{}{}$ and $E\subset\spc{L}$ be a Borel set.
Given an arbitrary function $r\:EE\to \RR_>$ there is a countable collection of disjointed balls 
$B_n=\cBall[x_n,R_n]$ such that 
$R_n\le r(x_n)$ for each $n$,
and 
$$\vol^m\left[E\backslash \left(\bigcup_n\cBall[x_n,R_n]\right)\right]=0$$
\end{thm}


\begin{thm}{Lemma}
Let $W$ is the union of a finite collection of balls
$B^i=\oBall(x^i , r^i)$, $i\in F=\{1,\dots,n\}$
then there is a set $S\subset F$ so that
\begin{subthm}{}
The balls $B^i$ with
 $i\in S$ are disjoint.
\end{subthm}

\begin{subthm}{}$W\subset \bigcup_{i\in S}B^i$
\end{subthm}
\end{thm}

\parit{Proof.} 
Order the  balls $B^i$ so that $r^1>\dots>r^n$.
Set $i_1=1$.
Discard all $B^j$ intersecting $B^{i_1}$ and 
let $B^{i_2}$ be the first remaining ball.
Discard all $B^j$ which intersect $B^{i_2}$
and let $B^{i_3}$ be the first remaining ball???
\qeds


\begin{thm}{Proposition}\label{prop:vol=<}
Let $\spc{L}\in\CBB m\kappa$.
Then
$$\vol^m\oBall(p,R)\le \vol^m\ModBall^m_R[\kappa]$$
for any $p\in \spc{L}$ and any $R>0$.
\end{thm}

\parit{Proof.}
According to Corollary~\ref{cor:S>Sigma},
there is a distance noncontracting map $\map\:\Sigma_p\to\SS^{m-1}$.

Fix $\~p\in \Lob m\kappa$.
Since $\Sigma_{\~p}\iso\SS^{m-1}$,
we can identify $\SS^{m-1}$ and $\Sigma_{\~p}$.

For any point $x\in\oBall(p,R)$,
choose a geodesic $[px]$.
Let $\~x\in\Lob m\kappa$ be the (necessary unique) point such that
$\dir{\~p}{\~x}=\map(\dir px)$ and $\dist{\~p}{\~x}{}=\dist{p}{x}{}$.
According to ???, the map $\map[2]\:x\mapsto \~x$ is distance noncontracting.
Clearly, 
$$\map[2](\oBall(p,R)_{\spc{L}})\subset \oBall(p,R)_{\Lob m\kappa}.$$
Hence the result follows.
\qeds

\begin{thm}{Corollary}
Let $\spc{L}\in\CBB m\kappa$ and $E$ be a Borel set.
Then given $\eps>0$ there is a covering of $E$ by a countable collection of closed balls $\cBall[x^n,R^n]$ such that $R_n<\eps$ 
for any $n$ and 
$$\vol^m E+\eps>
\frac{\pi^{\frac m2}}{\Gamma(\frac m2+1)}\cdot\sum (R^n)^{\cdot m}
$$
\end{thm}



\begin{thm}{Proposition}\label{prop:vol-sing-reg}
Let $\spc{L}\in\CBB{m}{}$ then 
\begin{subthm}{prop:vol-sing-reg:reg}
$\vol^m\spc{L}>0$.
\end{subthm}
\begin{subthm}{prop:vol-sing-reg:sing}
$\vol^m\Sing_\spc{L}=0$.
\end{subthm}
\end{thm}

\parit{Proof.}
Part \ref{prop:vol-sing-reg:reg} follows directly from existence of distance chart; see ???.

\parit{(\ref{prop:vol-sing-reg:sing}).}
Denote by $\Sing_\eps$ the set of points $p\in\spc{L}$ such that $\vol\Sigma_p\le e^{-\eps}\cdot\vol\SS^{m-1}$.
According to 


Let $\spc{L}\in \CBB{m}{}$.
Given a point $p\in \spc{L}$ set 
$$\dens(p)=\lim \frac{\vol\oBall(p,\eps)}{\alpha_m\cdot\eps^{\cdot m}}.$$

From ???, $\dens(p)\le 1$ for any $p\in\spc{L}$.
The following statement can be proved along the same lines as Lebesgue theorem of points of density.

\begin{thm}{Proposition}
Let $\spc{L}\in\CBB{}{}$ then
$\dens(p)=1$
for almost all points $p\in \spc{L}$.
\end{thm}


\section{Lebesgue's density}

In this section we show that Lebesgue density theorem
admits a straightforward generalization 
to finitely dimensional $\CBB{}{}$ spaces. 

Let $\spc{L}\in \CBB{m}{}$ and $f\:\spc{L}\to\RR$ be a locally $\vol_m$-integrable function.
Given a point $p\in\spc{L}$,
the value 
$$\dens_pf\df\lim_{\eps\to 0}\frac{1}{\alpha_m\cdot\eps^m}\cdot\int\limits_{\oBall(p,\eps)}f(x)\d_x\vol_m$$
is called density of $f$ at $p$.


\begin{thm}{Lebesgue differentiation theorem}\label{thm:leb-dens}
Let $\spc{L}\in \CBB{m}{}$.
Then 
$$ f(p)=\dens_pf$$
for any locally $\vol_m$-integrable function $f\:\spc{L}\to\RR$
and $\vol_m$-almost all $p\in\spc{L}$.
\end{thm}

Set $\dens_p\df\dens_p1$, where $1$ stays for function which returns $1$ for any point of the space $\spc{L}$.
Equivlently,
$$\dens_p=\lim_{\eps\to 0}\frac{\vol_m\oBall(p,\eps)}{\alpha_m\cdot\eps^m}.$$
Note that according to ???
$\dens_p=1$ if and only if $p$ is Euclidean space.


\begin{thm}{Corollary}
In any $\CBB{m}{}$-space, $\vol_m$-almost all points are Euclidean.
\end{thm}

\parit{Proof.}
Consider function $f\:\spc{L}\to \RR$ 
such that $f(p)= 1$ for any $p\in\spc{L}$.
According to Theorem~\ref{thm:leb-dens},
$$\dens_pf=1$$
for almost all $p\in\spc{L}$.
\qeds

























\section{Lebesgue's density theorem}

Let $\spc{X}$ be a metric space
equipped with the Borel regular measure $\mu$. 
Given a point $p\in \spc{X}$, 
define \emph{spherical $m$-density} of $\mu$ at $p$
the following way
\[\dens^m_p\mu\df\liminf_{\eps\to0+}\frac{\mu(\cBall[p,\eps])}{\eps^m}.\]

Here is an analog of the Lebesgue's density theorem for $\CBB{}{}$ spaces.

\begin{thm}{Lebesgue's density theorem}\label{thm:lebesgue-density}
Let $\spc{L}\in\CBB{m}{\kappa}$.
Then 
\[\dens_p^m(\SphMes_m)\le 1\]
at any point $p\in \spc{L}$.
Moreover 
\[\dens_p^m(\SphMes_m)= 1\]
for $\SphMes_m$-almost all points $p\in \spc{L}$.
\end{thm}

Let $m$ and $\kappa$ be as in the formulation of the theorem.
Denote by $\~v\mc\kappa(R)$ the volume of ball of radius $R$ in $\Lob{m}{\kappa}$.
Note that
\[\~v\mc\kappa(R)=\alpha_m\cdot R^m+o(R^m),\]
where $\alpha_m$ denotes the volume of the unit ball in $\EE^m$.

\begin{thm}{Lemma}\label{lem:R_n<R}
Let $\spc{L}\in\CBB{m}{\kappa}$,
$p\in\spc{L}$ and $0<R\le \varpi\kappa$.
Assume $\oBall(p_1,R_1),\oBall(p_2,R_2),\dots$ be a countable collection of disjoint balls in $\oBall(p,R)$.
Then 
\[\sum_n \~v\mc\kappa(R_n)\le \~v\mc\kappa(R).\]

\end{thm}

\parit{Proof.}
Assume that $\T_p\iso \EE^m$.

Recall that $\T_{p}\mc\kappa$ stays for $\T_{p}$ 
equipped with metric
$$\dist{x}{y}{\T_{p}\mc\kappa}=\side\kappa\hinge o{x}{y},$$
where $o$ denotes the origin of $\T_{p}$;
see ??? for a more precise definition.

Since $\T_p\iso\EE^m$, we have $\T_p\mc\kappa\iso\Lob{m}{\kappa}$.

For each $p_n$ choose a geodesic $[pp_n]$,
set $w_n=\ddir{p}{p_n}\in\T_{p}\mc\kappa$.
According to the hinge comparison (\ref{angle}),
\[\dist{w_m}{w_n}{\T_{p}\mc\kappa}\ge \dist{p_m}{p_n}{\spc{L}}\]
for any $m$ and $n$
and 
\[\dist{o}{w_n}{\T_{p}\mc\kappa}= \dist{p}{p_n}{\spc{L}}\]
for any $n$.
In particular the balls $\oBall(w_n,R_n)$ in $\T_p\mc\kappa\iso\Lob{m}{\kappa}$ are disjoint and they all lie in $\oBall(o,R)\subset \Lob{m}{\kappa}$.
Hence the result follows.

If $\T_p$ is not isometric to $\EE^m$,
we can apply \ref{LinDim+-f} to find a point $p'$
such that the distance $\eps=\dist{p}{p'}{}$ is arbitrary small and $\T_{p'}\iso\EE^m$.

In this case all the balls $\oBall(p_n,R_n)$ lie in
$\oBall(p',R+\eps)$.
The same argument as above shows that 
\[\sum_n \~v\mc\kappa(R_n)\le \~v\mc\kappa(R+\eps).\]
Since $\eps>0$ is arbitrary, the result follows.
\qeds


\parit{Proof of \ref{thm:lebesgue-density}.}
The first part of proposition follows from Corollary~\ref{cor:short-map-to-ball}.
Indeed, ???.

To prove the second part, assume the contrary;
i.e., the set of points with density $<1$ 
has positive spherical $m$-measure.
Choose  $\delta>0$
so that there is a subset $A\subset\spc{L}$ 
so that $\SphMes_m A>0$ 
and 
\[\dens^m_a(\SphMes_m)<1-\delta\] 
for any $a\in A$.
Without loss of generality we can assume that 
the set $A$ is bounded and
the value $\delta$ is sufficiently small.

\begin{clm}{}\label{clm:SphMes>1-delta/10}
There is a ball $\oBall(p,R)$ with radius $R<\delta$,
such that
\[\SphMes_m(\oBall(p,R)\cap A)>(1-\tfrac{\delta}{10})\cdot R^{\cdot m}.\]

\end{clm}

Indeed, applying the definition of the spherical measure, 
we can cover $A$ be a countable collection of balls $\cBall[p_n,R_n]$ such that
\[\SphMes_m A>(1-\tfrac{\delta}{10})\cdot\sum_n R_n^{\cdot m}.\]
and $R_n<\delta$ for each $n$.

It follows that,
\ref{clm:SphMes>1-delta/10} holds 
for one of the balls $\cBall[p_n,R_n]$.
\claimqeds

\begin{clm}{}\label{clm:SphMes<1-delta/2}
For any ball $\oBall(p,R)$ in $\spc{L}$ with radius $R<\delta$, we have
\[\SphMes_m(\oBall(p,R)\cap A)<(1-\tfrac{\delta}{5})\cdot R^{\cdot m}.\]

\end{clm}

Indeed, fix a point $a\in A\cap \oBall(p,R)$.
Since $\dens_a^m\SphMes_m<(1-\delta)$,
there is a arbitrary small value 
$r>0$ such that 
\[\SphMes_m\oBall[a,r]<(1-\tfrac\delta2)\cdot r^{\cdot m}.\]
Such balls $\oBall[a,r]$ form a Vitali covering of $A\cap \oBall(p,R)$.
Denote this covering by $\mathfrak B$.
We can assume in addition that any ball $B[a,r]$ from $\mathfrak B$ lies completely in $\oBall(p,R)$.

According to the Vitali covering theorem (\ref{thm:vitali}), we can cover whole measure of $A$ by a countable collection of disjoint balls $\cBall[a_n,r_n]$ from $\mathfrak B$. 

Since $\delta>0$ is sufficiently small,
Lemma~\ref{lem:R_n<R} implies that
\[\sum_n r_n^{\cdot m}<(1+\tfrac{\delta}{10})\cdot R^{\cdot m}.\]
Therefore
\begin{align*}
\SphMes_m(\oBall(p,R)\cap A)
&\le\sum_n\SphMes_m(\oBall(a_n,r_n)\cap A)
<
\\
&<(1-\tfrac{\delta}{2})\cdot\sum_n r_n^m
\le
\\
&\le (1-\tfrac{\delta}{5})\cdot R^{\cdot m}.
\end{align*}
\claimqedsf

Finally notice that the claims \ref{clm:SphMes>1-delta/10} and \ref{clm:SphMes<1-delta/2} contradict each other.
\qeds

\begin{thm}{Corollary}
Let $\spc{L}\in\CBB{m}{}$
and $A\subset \spc{L}$.
Then given $\delta>0$ there is a countable collection of disjoint balls
$\cBall[p_1,R_1],\cBall[p_2,R_2],\dots$ in $\spc{L}$.
Such that 
\[\SphMes_m \l(A\backslash \bigcup_n\cBall[p_n,R_n]\r)=0\]
and 
$R_n<\delta$,
$\SphMes_m (A\cap \cBall[p_n,R_n])>(1-\delta)\cdot R^m$ 
for any $n$,

\end{thm}













The following stetement is also classical,
it is also called Bieberbach's inequality.

\begin{thm}{Isodiametric inequality}\label{prop:bieberbach-ball}
Among all the subsets of $\EE^m$ with diameter $1$,
the ball has the maximal Euclidean volume.
\end{thm}


\parit{Proof.} 
Let $K$ be a set in $\EE^m$ with diameter $1$.
Passing to its convex hull does not decrease the volume and keeps diameter the same.
Therefore we can assume that $K$ is convex.

Consider the set 
\[K'=\set{\tfrac{x-y}2}{x,y\in K}.\]
Note that $K'$ is cetrally symmetric with respect to $0$,
$\diam K'\le \diam K$ and 
applying Brunn--Minkowski inequality we get that
\[\vol_m K'\ge \vol_m K\]

Finally,
$K'\subset \cBall[0,\tfrac 12]$.
In particular,
\[\vol_m K'\le \vol_m \cBall[0,\tfrac 12].\]
Hence the result follows.\qeds























\section{Besicovitch covering theorem}\label{sec:besicovitch-covering}

In this section we extend Besicovitch covering theorem to finite dimensional $\CBB{}{}$ spaces.



The proof is a straightforward generalization of the proof for the Euclidean space. 
In fact the standard proof works for any proper metric space which satisfies the following property,
this property holds for Euclidean space
and also for $\CBB{}{}$ spaces; see Proposition ???.

\begin{thm}{Definition}
We say that a metric space $\spc{X}$ 
satisfies \index{Besicovitch's condition}\emph{Besicovitch's condition} if there are $\eps_0>0$
and a positive integer $N$
such that if for some fixed $\eps\in(0,\eps_0)$ 
the distances between the points $p,x^1,x^2,\dots x^n\in\spc{X}$
satisfy the following inequalities
\[\dist{x^i}{x^j}{}>\max\{\eps,\dist{p}{x^i}{}-\eps\}\] 
and all $i\ne j$ 
then
$n\le N$.
\end{thm}



The proof relies on the following lemma.

\begin{thm}{Besicovitch covering lemma}\label{lem:besicovitch-covering}
Let $\kappa\in\RR$,
$0<R<\tfrac{\varpi\kappa}2$, 
$\spc{L}\in \CBB{m}{\kappa}$ and $A\subset\spc{L}$.

Assume that to each point $a\in A$
corresponds an closed $B_a=\cBall[a,R_a]$ with radius 
$R_a\le R$.
Then there is a sequence of balls $B_n=B_{a_n}$ (finite or infinite) such that
the balls $\{B_n\}$ cover $A$
and the sequence $(B_n)$ can be divided into $M=\Const(m,\kappa,R)$ subsequences with mutually disjointed balls in each.
\end{thm}

\parit{Proof.}
Given a bounded set $W$ of positive numbers, 
we say that $r\in W$ is \emph{almost maximal} if $r>\tfrac9{10}\cdot \sup W$.

Denote by $\mathfrak{B}$ the set of balls $\{B_a\}_{a\in A}$.

First assume that $A$ is bounded.

Let us choose a sequence of balls $B_1$, $B_2,\dots$ from $\mathfrak{B}$ using the following algorithm.
\begin{itemize}
\item Set $\mathfrak{B}_1=\mathfrak{B}$.
\item Choose from $\mathfrak{B}_1$ a ball $B_1$ with almost maximal radius.
\item Discard from $\mathfrak{B}_1$ the balls with centers in $B_1$;
denote by $\mathfrak{B}_2$ the set of remaining balls.
\item Choose from $\mathfrak{B}_2$ a ball $B_2$ with almost maximal radius.
\item Discard from $\mathfrak{B}_2$ the balls with centers in $B_2$,
denote by $\mathfrak{B}_3$ the set of remaining balls.
\item and so on.
\end{itemize}
This algorithm might terminate at some integer $n$ if $\mathfrak{B}_n=\emptyset$; otherwise we get an infinite sequence of balls.

It remains to show that the constructed sequence $B_n=\cBall[a_n,R_n]$ satisfies the condition of the lemma.
First note the following.

\begin{clm}{}\label{clm:R_n-->0} If the sequence $B_n$ is infinite then $R_n\to0$ as $n\to\infty$.
\end{clm}

Indeed, otherwise $\dist{a_m}{a_n}{}>\eps$ for some fixed $\eps>0$.
Since $A$ is bounded, the later contradicts Corollary~\ref{cor:dim>proper}.\claimqeds


\begin{clm}{}
The balls $\{B_n\}$ cover $A$.
\end{clm}

Assume contrary; 
i.e., there is $a\in A$ which is not covered. 
Then 
the ball $\cBall[a,R_a]$ had never been chosen in the above algorithm.
Hence $R_n>\tfrac{9}{10}\cdot R_a>0$ for any $n$,
which contradicts \ref{clm:R_n-->0}.\claimqeds

Fix a positive integer $k$.
A ball $B_i$ will be called \index{bad ball}\emph{bad}
if $i<k$ and $B_i\cap B_k\ne \emptyset$. 

\begin{clm}{}
For each positive integer $k$,
there are at most ??? bad balls.
\end{clm}



Assume contrary. Then there are at least ??? bad balls with centers in $\tfrac32 \cdot B_k$ or there are ??? bad balls with centers in the complement of $\tfrac32 \cdot B_k$.

In the first case we get a contradiction with ???

In the second case

Assume $i<j<\kay$ and both balls $B_i$ and $B_j$ intersect $B_\kay$,
so 
\[\dist{a_i}{a_\kay}{}\le R_i+R_\kay\ \ \text{and}\ \ \dist{a_j}{a_\kay}{}\le R_j+R_\kay\]
By construction we have
\begin{align*}
R_i
&\ge  
\tfrac{9}{10}\cdot R_j&
R_j
&\ge 
\tfrac{9}{10}\cdot R_\kay
\\
\dist{a_i}{a_j}{}&> R_i,&
\dist{a_i}{a_k}{}&> R_i,&
\dist{a_j}{a_k}{}&> R_j.
\end{align*}
From the hinge comparison (\ref{angle}), we get 
$$\mangle\hinge{a_\kay}{a_i}{a_j}>\delta,$$
where $\delta=\Const(R,\kappa)>0$.

Therefore
\begin{clm}{}\label{clm:M}
Given $B_\kay$, there are at most $M_0=\pack_\delta\SS^{m-1}$ indexes $i<\kay$ for which $$B_i\cap B_\kay\ne\emptyset.$$

\end{clm}
Let us use the claim \ref{clm:M} inductively to divide the sequence $(B_n)$ into $M_0$ subsequences of mutually disjointed balls.
Assume we already divided all balls $B_i$ for $i<n$ into $M_0$ sequences.
By ???,
$B_n$ intersects at most $M_0-1$  balls $B_i$ for $i<n$.
Therefore one of the $M_0$ subsequences does not contain any ball intersecting $B_n$, so we can move $B_0$ into this sequence.

We finished the proof in case $A$ is bounded.
If $A$ is unbounded, 
fix a reference point $\star\in \spc{L}$ 
and present $A$ as the union of the following sequence collection of bounded sets
\[A_n=\set{a\in A}{ n<\tfrac{\dist{\star}{a}{}}{2\cdot R}\le n+1}.\]
Apply the lemma for each $A_n$ and take the union of obtained collection of balls.

Note that a ball with center at $a\in A_n$, might intersect only the balls with centers in $A_{n-1}$, $A_n$ or $A_{n+1}$.
Therefore for $A$, the statement of the lemma holds for $M=3\cdot M_0$.
\qeds



\parit{Proof.}
We can assume that all balls in $\mathfrak{B}$ have radii at most $1$;
otherwise discard form $\mathfrak{B}$ all the balls with radii bigger than $1$.

Let us construct the sequence $B_1,B_2,\dots$ using the following algorithm.

\begin{itemize}
\item Set $\mathfrak{B}_1=\mathfrak{B}$ and $A_1=A$.
\item Apply Besikovitch covering lemma for $\mathfrak{B}_1$.
We get at most countable collection $\{B_n\}$ of mutually disjointed balls from $\mathfrak{B}_1$ which cover fraction at least $\tfrac{1}M$ of total measure of $A_1$.
\item Choose from $\{B_n\}$ a finite subcollection which cover fraction at least $\tfrac{1}{2\cdot M}$ of total measure of $A_1$.
Denote the obtained balls as $B_{1,1},\dots,B_{1,n_1}$ and 
$$W_1=\bigcup_{i=1}^{n_1}B_{1,i}$$
\item Set $A_2= A_1\backslash W_1$ and let $\mathfrak{B}_2$ be subset of $\mathfrak{B}_1$ which is formed by all balls in $\mathfrak{B}_1$ which do not intersect $W_1$. 
\item Apply Besikovitch covering lemma for $\mathfrak{B}_2$.
We get at most countable collection $\{B_n\}$ of mutually disjointed balls from $\mathfrak{B}_2$ which cover fraction at least $\tfrac{1}M$ of total measure of $A_2$.
\item Choose from $\{B_n\}$ a finite subcollection which cover fraction at least $\tfrac{1}{2\cdot M}$ of total measure of $A_2$.
Denote the obtained balls as $B_{2,1},\dots,B_{2,n_2}$ and 
$$W_2=\bigcup_{i=1}^{n_2}B_{2,i}$$
\item and so on...
\end{itemize}
This algorithm might terminate at some integer $n$ if $\mu A_n=O$, or it runs infinite time.
In any case we get at most countable collection of mutually disjointed balls $\{B_{i,j}\}$.

Note that 
\[\mu A_n\le (1-\tfrac1{2\cdot M})^n\cdot\mu A.\]
In particular, $\mu A_n\to 0$ as $n\to\infty$.

Since 
\[A_n=A\backslash \bigcup_{i<n} B_{i,j},\]
the collection $\{B_{i,j}\}$ is the desired one.
\qeds























The proof is a straightforward generalization 
of the classical proof of Besicovitch.
Namely, Besicovitch use the following property of Euclidean space

An other way to prove this theorem is to show that $\CBB{}{}$ space is directionally limited
and get it as a corollary of \cite[Theorem 2.8.14]{federer}.
The directionally limited spaces were introduced in \cite[2.8.9]{federer},
essentially these are the spaces where proof of Besicovitch covering theorem
works;
so in a way this condition is similar to the Besicovitch's condition.
Let us state the simplified version of this condition which is sufficient for our needs, compare \cite[page 7]{heinonen}).







The theorem above is a direct corollary
of \cite[Theorem 2.8.14]{federer}.


The Vitali covering theorem as stated here 
follows from
The proofs of both covering theorems are straightforward generalizations of their original Euclidean versions.
The Vitali covering theorem form general metric spaces is proved in ???.

The proof of Besicovitch covering theorem for the Euclidean space,
say see ???,
use only the that Euclidean space satisfies Besicovitch's condition
as it stated in the following definition.

\begin{thm}{Definition}
We say that a metric space $\spc{X}$ 
satisfies \index{Besicovitch's condition}\emph{Besicovitch's condition} if there are $\eps_0>0$
and a positive integer $N$
such that if for some fixed $\eps\in(0,\eps_0)$ 
the distances between the points $p,x^1,x^2,\dots x^n\in\spc{X}$
satisfy the following inequalities
\[\dist{x^i}{x^j}{}>\max\{\eps,\dist{p}{x^i}{}-\eps\}\] 
and all $i\ne j$ 
then
$n\le N$.
\end{thm}

The Besicovitch condition is a strong version of doubling.
Indeed, any space which satisfies Besicovitch's condition
is also doubling;
to see this take $r$ as in 
the definition of doubling space (\ref{def:doubling-space}) and apply the above definition for $\eps=\tfrac r2$. 
The converse does not hold,
for example the Heisenberg group 
equipped with left invariant subriemannian metric
is doubling but does not satisfy Besicovitch's condition,
see \cite[Lemma 4.4]{SW}%CHECK???
.

Summarizing, to prove the Besicovitch covering theorem,
we need to prove the following proposition and then repeat the 
classical proof of Besicovitch, see for example ???.































\begin{thm}{Vitali covering Lemma}\label{lem:vitali}
Let $\spc{X}$ be a metric space,
$A\subset \spc{X}$ is arbitrary set
and
$\mathfrak{B}$ is collection of balls in $\spc{X}$ which cover $A$.
Then there is at most countable collection of disjoint balls 
$\{B_n\}_{n\in\IndexSet}\subset\mathfrak{B}$ such that
$$\bigcup_{n\in\IndexSet} 3\cdot B_n\supset A.$$
\end{thm}


\parit{Proof.}
Assume first that $A$ is bounded,
say $A\subset \Omega=\oBall(p,R)$.
According to Proposition~\ref{prop:bounded=>finite-measure}, $\mu \Omega<\infty$.

Let us denote by $\mathfrak{B}_0$ the subset of $\mathfrak{B}$ formed by all the balls which lie completely in $\oBall(p,R)$.
Note that the collection $\mathfrak{B}_0$ 
still forms a 
Vitali covering of $A$.

Choose a ball $B_1$ in  $\mathfrak{B}$
which has almost maximal radius;
i.e., if $R_1$ is the radius of $B_1$ 
then $2\cdot R_1$ exceeds the supremum of radii of balls in $\mathfrak{B}_0$.

Denote by $\mathfrak{B}_1$ the subset of all balls in $\mathfrak{B}_0$ which do not intersect $B_1$.
Note that $\mathfrak{B}_1$ forms a Vitali covering of $A\backslash B_1$.

Now let us continue this operation recursively.
If $\mathfrak{B}_1$ is not empty, choose a ball $B_2$ in $\mathfrak{B}_1$ of almost maximal radius 
and pass to subset $\mathfrak{B}_2$ of all the balls of $\mathfrak{B}_1$ which do not intersect $B_2$.

If we get $\mathfrak{B}_n=\emptyset$ on the $n$-th then the process terminates.
In this case we get a finite set of disjoint balls $B_1,B_2,\dots,B_n$ which cover $A$,
in particular 
\[ A\subset \bigcup_iB_i. 
\]

Otherwise we get an infinite collection of dijoint balls
$B_1,B_2,\dots$.
Note that 
\[\sum_i\mu B_i
\le 
\mu [\oBall(p,R)]<\infty.
\eqlbl{eq:sum-mu-Bi}\]

Denote by $R_n$ the radius of $B_n$.
By \ref{eq:sum-mu-Bi} and Proposition~\ref{prop:doubling&balls-comparison},

\[R_n\to 0\ \text{as}\ n\to\infty.
\eqlbl{eq:Ri->0}\]

\begin{clm}{}
Note that
\[A\backslash 
\bigcup_{i\le n}B_i
\subset 
\bigcup_{i>n}3\cdot B_i\]
for each $n$.
\end{clm}

Indeed, assume contrary; i.e., there is 
\[x\in A\backslash 
\left(\bigcup_{i\le n}B_i\cup \bigcup_{i> n}3\cdot B_i\right).\]
Choose a ball $B\in\mathfrak{B}_n$ centered  at $x$
denote its radius as $r$.
Note that $B\cap B_i=\emptyset$ for all $i$.
From above we get $r<2\cdot R_i$ for any $i>n$.
The later contradicts \ref{eq:Ri->0}.

If $A$ is unbounded, fix a point $\star\in\spc{X}$ and consider the subsets 
\begin{align*}
A_n&=\set{a\in A}{\dist{\star}{a}{}\lege n\pm \tfrac14}
\\
\Omega_n&=\set{x\in \spc{X}}{\dist{\star}{x}{}\lege n\pm \tfrac12}
\end{align*}

Note that $\Omega_n$ is open,
$\mu\Omega_n<\infty$,
$A_n\subset \Omega_n$
and all the sets $\Omega_n$ are disjoint.

Applying ???, we get at most countable collection 
of balls from $\mathfrak{B}$ which cover $\mu$-almost all $A_n$ such that each ball in the collection lies in $\Omega_n$.
Taking union of all these collection produce a cover of $\bigcup_n A_n$,
denote the balls in the collection as 
$B_1,B_2,\dots$ and let $Z$ be the union of all of them.
\qeds














\begin{thm}{Corollary}\label{cor:meas=CBB}
Let $\spc{L}\in\CBB{m}{\kappa}$
Then 
\[\LongMes_m A
= 
\frac{\alpha_m}{2^m}\cdot\HausMes_m A
%=\tfrac{1}{2^\kay\cdot\alpha_\kay}\cdot\SphMes_\kay A
\]
for any set $A\subset  \spc{L}$.
\end{thm}

\parit{Proof.}
According to Proposition~\ref{prop:meas-inq-general},
we only need to show that 
\[\LongMes_\kay A
\le
\alpha_\kay\cdot\HausMes_\kay A.\]

???The later follows from 
\ref{thm:bishop-inq:long} 
and \ref{prop:carath<carath}.
\qeds














In the proof we will use the following construction.

\parbf{Metric on the mapping cylinder.}
Assume $\spc{X}$ and $\spc{Y}$ are metric spaces,
$A\subset \spc{X}$ is a closed subset and 
$f\:A\to \spc{Y}$ be a continuous map.

Denote by $\spc{X}^\eps$
the product space $\spc{X}\times [0,\eps]$ equipped with $\ell_\infty$ metric;
i.e. 
\[\dist{(x,t)}{(x',t')}{\spc{X}^\eps}
\df\max\{\dist{x}{x'}{\spc{X}},|t-t'|\}.
\]

Now consider the space $\spc{Z}$ which obtained by gluing $\spc{X}^\eps$ to $\spc{Y}$ according to the rule $(x,0)\sim f(x)$ for any $x\in A$.

Note that if 
\[
\dist{f(x)}{f(x')}{\spc{Y}}
>
\dist{x}{x'}{\spc{X}}-\eps
\]

Then the embedding 
$\iota_\eps\:\spc{X}\hookrightarrow\spc{Z}$,
defined as $\iota_\eps\:x\mapsto (x,\eps)$
is distance preserving.

Further, if the map $f$ is short then
the natural embedding $\spc{Y}\hookrightarrow\spc{Z}$ is distance preserving.




\parit{Proof.}
Without loss of generality, we may assume that 
$K$ 
lies in the unit cube $[0,1]^{\times m}$.

Let $\spc{Z}$ be the mapping cylinder space described above for the map $f=\map|\partial K$.

From above, it follows that $\iota_\eps\:[0,1]^{\times m}\hookrightarrow\spc{Z}$ is distance preserving.

It is easy to construct a continuous map 
$h\:[0,1]^{\times m}\to \spc{Z}$
which coincides with $\iota_\eps$ on the boundary of the cube and with image formed by the union of the following three sets
$\map (K)$,
$\iota_\eps([0,1]^{\times m}\backslash K)$
and $\partial K\times [0,\eps]$.

Note that $\vol_m \partial K\times [0,\eps]\le 2\cdot \eps\cdot \vol_{m-1} \partial K$.
Applying Besicovitch inequality~\ref{thm:besicovitch-inq} for the map $h$, we get the result.\qeds














Recall that $\Int K$ denotes the interior of $K$.
Let us equip $\Int K$ with the length metric induced from $\Lob{m}{\kappa}$
and denote by $\Shef K$ the completion of the obtained metric space.

Note that for reasonable polytopes $\Shef K$ is naturally isometric to $K$ equipped with the induced length metric,
but this is not always the case.
For example if $K$ is not ??? i.e., a triangulation of $K$ has simplices of dimension $\le m-1$ which are not formed by a face of a simplex of dimension $m$;
the same happens if a simplex of dimension $\le m-2$ has a non-connected link.














Let $D\subset\RR^2$ be an open set
and $f\:D\to\RR^n$ be a continuous map.
We say that $f$ is saddle map if for any linear function $\ell\:\RR^n\to\RR$ the composition $\ell\circ f$ does not have points of local 
minimum in the interior of $D$.


\begin{thm}{Corollary}
Assume that $D\subset \RR^2$ and the map 
$(x,y)\mapsto (x,y,f(x,y))\:D\to\RR^3$ is saddle.
Then $D???\in\Cat{}{0}$.
\end{thm}


\begin{thm}{Theorem}
Let $D\subset\RR^2$ be a disc
disc and $f:\Omega\to\EE^2$ be a saddle Lipschitz map.
Let us equip $D$ with the metric,
for two points $x,y\in D$ define the distance 
$\dist{x}{y}{D}$ as 
$$\inf_{\gamma}\length(f\circ\gamma),$$
where 
$\gamma$ runs along all the curves connecting $x$ to $y$.
Then $D$ with the described metric is a $\Cat{}{0}$ space.
\end{thm}












According to Theorem~\ref{thm:cat-unique}, 
for any $x\in\oBall(p,\pi)$,
there is unique geodesic $[px]$.
Consider the map $\map[2]\:\spc{U}\to\cBall(p,\pi/2)$ given by
\[
\map[2](x)
=
\l[
\begin{aligned}
&x
&&\t{if}
&0&\le\dist{p}{x}{}\le\tfrac{\pi}{2},
\\
&\geod_{[px]}(\pi-\dist{p}{x}{})
&&\t{if}
& \tfrac{\pi}{2}&<\dist{p}{x}{}<\pi,
\\
&p
&&\t{if}
& \pi&\le \dist{p}{x}{}.
\end{aligned}
\r.
\]
From ??? comparison, the map $\map[2]$ is short and it clearly retracts onto $\cBall[p,\tfrac{\pi}{2}]$.

Thus we may assume that $\spc{U}=\cBall[p,\tfrac{\varpi\kappa}{2}]$.














\section{Almost isometric distance chart???}

\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{\kappa}$ and $p\in\spc{L}$.
Assume $\T_p\iso\EE^m$.
Then for any $\eps>0$
there is a spherical neighborhood of $p$
which admits a $e^{\mp\eps}$-bi-Lipschitz embedding in $\EE^m$.
\end{thm}

\begin{thm}{Lemma}\label{lem:pack(S^m)+}
Let $\spc{L}\in\CBB{m}{\kappa}$ and $p\in\spc{L}$.
Assume for the directions $\zeta^0,\zeta^1,\dots,\zeta^m\in\Sigma_p$ the following conditions hold 
\begin{subthm}{}
$\mangle(\zeta^i,\zeta^j)>\tfrac\pi2+\eps$ for all $i\not=j$.
\end{subthm}
Then 
\[???\ge \sum_{i=0}^m\<\xi,\zeta^i\>^2\ge ???\]
for any direction $\xi\in \Sigma_p$.
\end{thm}


Given positive integer $m$, 
set 
\[\theta_m\df\arccos(-\tfrac1m).\]
Note that $\pack_{\theta_m}\SS^{m-1}=m$ but $\pack_{\theta_m-\delta}\SS^{m-1}\ge m+1$ for any $\delta>0$.
The theorem above will follow easily from the following proposition

\begin{thm}{Proposition}
Given positive integer $m$ and $\eps>0$ there is $\delta>0$ 
such that the following holds.

If $\spc{L}\in\CBB{m}{\kappa}$ and $p,a^0,\dots,a^m\in \spc{L}$ are such that
\[\angk{\kappa}{p}{a^i}{a^j}>\theta_m-\delta\]
for all $i\ne j$.
Then a spherical neighborhood of $p$ admits a $e^{\mp\eps}$-bi-Lipschitz embedding into $\EE^m$.
\end{thm}

\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{m}{}$ and $p\in \spc{L}$.
Assume $\xi^0,\xi^1,\dots,\xi^m$ be unit tangent vectors at $p$.
Let $\~\xi^0,\~\xi^1,\dots,\~\xi^m$ be the unit vectors 
\end{thm}








\section{???}


The following lemma is analogous to Theorem~\ref{thm:web:Up-convex}.

\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{m}{\kappa}$,
$\bm{f}=(f^0,f^1,\dots,f^\kay)\:\spc{L}\to \RR^{\kay+1}$
be an array of 1-Lipschitz semiconcave functions, 
$p\in\Dom\bm{f}$ and $\eps>0$.
Assume that 

\begin{subthm}{}
$\min_i\d_pf^i\le 0$;
\end{subthm}

\begin{subthm}{} $\d_xf^i(\nabla_xf^j)<-\eps$ for any $i\ne j$ and $x\in \Dom\bm{f}$;
\end{subthm}

\begin{subthm}{}
$???\eps\cdot(f^0)''(p)+\sum_{i>0}(f^i)''(p)\le 0$.
\end{subthm}
Then the subfunction $h\:\RR^\kay\subto\RR$
\[h(x^1,x^2,\dots,x^\kay)=\max\set{f^0(q)}{f^i(q)\ge x^i\ \text{for}\ \ i>0}\]
is defined in a neighborhood of $f^{\ne0}(p)\in\RR^\kay$
and $f''\circ\phi^{\ne0}(p)\le \Lambda$
for 
\[\Lambda=\Lambda(\eps,\lambda^0,\lambda^1,\dots,\lambda^\kay)=???.\]

Moreover the map $\map\:\RR^\kay\to\spc{L}$ defined as 
\[\Phi(x^1,x^2,\dots,x^\kay)
=
\argmax\set{\phi}{\phi^i(p)\ge x^i\ \text{for}\ \ i>0}\]
is defined and ???-continuous in a neighborhood of $\phi^{\ne0}(p)\in\RR^\kay$,

\end{thm}




Note that it is sufficient to prove the formula 
in the following three special cases.
\begin{enumerate}
\item\label{coarea:main-case} $\T_p\iso \EE^m$ and $\T_{f(p)}\iso \EE^\kay$ for any $p\in A$.
\item\label{coarea:case2} $\vol_mA=0$.
\item\label{coarea:case3} $\vol_\kay f(A)=0$.
\end{enumerate}
Indeed, arbitrary set $A$ sets
can be presented as a union of three disjoint sets 
$A_1\cap A_2\cap A_3$
such that

\[A_2=\set{x\in A}{\T_x\not\iso\EE^m}.\]

According to ??? $\vol_m A_2=0$;
therefore once the case~\ref{coarea:case2} is proved 
we can assume that
$\T_p\iso \EE^m$ for any $p\in A$.

Further, 
set 
\[A_3=\set{x\in A}{\T_{f(x)}\not\iso\EE^\kay}.\]
Again according to ??? $\vol_\kay f(A_2)=0$;
therefore once the case~\ref{coarea:case3} is proved 
we can assume in addition that
$\T_{f(p)}\iso \EE^\kay$ for any $p\in A$.
Apply case~\ref{coarea:main-case}, we get the statement.

Now we will prove each case separately.





Let us subdivide $A$ into three subsets
$A=A_1\cap A_2\cap A_3$;
the subset $A_1$ consists of all points $p\in A$ 
such that both $p$ and $f(p)$ are Euclidean;
i.e., $\T_p\iso \EE^m$ and $\T_{f(p)}\iso \EE^\kay$.

Without loss of generality,
we may assume that 
$\Dom f\subset \spc{L}$ 
and $\Im f\subset\spc{M}$ are bounded.

Since $\Im f$ is bounded, the theorem on distance embedding (\ref{thm:dist-emb}),
there is a  bi-Lipschitz embedding 
$\iota\:\Im f\hookrightarrow\EE^n$
for some positive integer $n$.
Hence there is a real constant $\Lambda>1$ such that
\[|(\d_pf)^{\wedge \kay}|
\lege
\Lambda^{\pm1}\cdot|(\d_p[\iota\circ f])^{\wedge \kay}|\]
for $\vol^m$-almost all $p\in A$.

By Proposition \ref{prop:coarea-rough} we may remove from $A$ and set of zero volume.

By ???, 
we may assume that $\T_p\iso\EE^m$ for any $p\in A$.
This implies in particular that given $\eps>0$ 
there is a countable collection of $e^{\pm\eps}$-bi-Lipschitz submaps,
$\phi_n\:\spc{L}\subto \EE^m$
such that the domains of $\phi_n$ cover $A$.

Further we may assume that the differential $\d_p(\iota\circ f)$ 
is defined and linear at any $p\in A$.

Set $N=\tfrac{n!}{k!\cdot(n-k)!}$;
consider all the orthogonal projections $\proj^1,\proj^2,\dots,\proj^N$ of $\EE^n$ to $\kay$-dimensional coordinate subspaces. 
Note that if $\d_p(\iota\circ f)$ is linear then
so are the differentials $\d_p(\proj^i\circ\iota\circ f)$
for all $i$.
Clearly,
\[|(\d_p[\iota\circ f])^{\wedge \kay}|
\lege
(N\cdot\Lambda)^{\pm1}
\cdot
\sum_{i=1}^N|(\d_p[\proj^i\circ\iota\circ f])^{\wedge \kay}|.
\eqlbl{eq:jac=<LN}\]

If $\vol^\kay f(A)=0$ then $\vol^\kay [\proj^i\circ\iota\circ f(A)]=0$
for all $i$.
Applying Federer's coarea formula for the maps 
$\proj^i\circ\iota\circ f\circ (\phi^{j})^{\circ(-1)}\:\EE^m\to\EE^\kay$ together with \ref{eq:jac=<LN},
we get that 
$$\int\limits_A|(\d_x f)^{\wedge m}|\cdot\d_x\vol^\kay=0$$




Summarizing the constructions above, we got a chain of maps
$$\EE^m
\xto{g}
\spc{L}
\xto{f}
\spc{M}
\xto{\iota}\EE^n
\xto{\proj^i}\EE^\kay
$$
where $i\in\{1,\dots,N\}$ and the classical coarea formula applicable 
for any compositions 
$$h^i=\proj^i\circ\iota\circ f\circ g;$$
i.e., \ref{eq:coarea} holds for $f=h^i$.

Since $g$ is locally Lipschitz,
for any $X\subset \EE^m$,
if $\vol^{\kay-m} X=0$ 
then $\vol^{\kay-m} g(X)=0$.

It follows that coarea formula holds if $\vol^\kay f(A)=0$.
Indeed, in this case the coarea of $f|A$ vanish
and the left hand side in \ref{eq:coarea}


$\vol_m g^{-1}(A)=0$ implies 
we get that $\vol_m g^{-1}(A)$


Note that to prove coarea formula, 
it is sufficient to show the following two inequalities
\[
\int\limits_A|(\d_x f)^{\wedge m}|\cdot\d_x\vol^\kay
\lege
e^{\pm\eps}\cdot\int\limits_{\spc{M}}\vol^{\kay-m}( f^{-1}(y)\cap A)\cdot\d_y\vol^m.\eqlbl{eq:coarea+-}
\]
hold for any $\eps>0$.


Note that coarea formula holds if $\vol_\kay f(A)=0$.
Indeed, in this case right hand side of \ref{eq:coarea} vanish,
so we need to show that the left hand side vanish.

Applying 


 



\parit{Proof.}
The proof is given in a sequence of generalizations.

\begin{clm}{}\label{clm:coarea-2}
The theorem holds if $\spc{M}=\EE^m$.
\end{clm}

\parit{Proof of the claim.}
Let us apply Lemma~\ref{lem:chart+(m-1)-rect} for $\spc{L}$ and small $\eps>0$.
We get a countable collection of $e^{\pm\eps}$-bi-Lipschitz charts $\bm{x}_n\:\spc{L}\subto \RR^m$
which cover $\spc{L}\backslash\mathfrak{C}$,
where the remaining set $\mathfrak{C}$ is colsed and $\vol^m\mathfrak{C}=0$.
and countably $(m-1)$-rectifiable;
i.e.,  $\mathfrak{C}$ lies in the image of countable collection of Lipschitz submaps;
say
$w_n\:\RR^{m-1}\subto\spc{L}$.

Let us present $A$ as a countable disjoined union of Borel sets
$B_1,B_2,\dots$ and $C_1,C_2,\dots$, 
such that $B_n\subset \Dom \bm{x}_n$ and $C_n\subset \Im w_n$ for each $n$.

For each $n$, we have 
\[
|(\d_p f)^{\wedge m}|
\lege
e^{\pm m\cdot\eps}\cdot|(\d_{\bm{x}_n(p)} [f\circ \bm{x}_n^{-1}])^{\wedge m}|\]
for almost all $p\in\Dom\bm{x}_n$.
Applying Claim~\ref{clm:coarea-1} for $f\circ \bm{x}_n^{-1}\:\EE^\kay\to\EE^m$, we get
\[\int\limits_{B_n}|(\d_x f)^{\wedge m}|\cdot\d_x\vol_\kay
\lege
e^{\pm m\cdot\eps}
\cdot
\int\limits_{\spc{M}}
\vol_{\kay-m}( f^{-1}(y)\cap B_n)\cdot\d_y\vol^m.
\eqlbl{eq:coarea-Bn}\]

Note that for each $n$
we have $\vol^\kay C_n=0$.
Therefore
\[\int\limits_{C_n}|(\d_x f)^{\wedge m}|\cdot\d_x\vol^\kay=0.\]
Set $\Lip_n=\lip w_n$.
Applying Claim~\ref{clm:coarea-1}, we get
\begin{align*}
0&\le \int\limits_{\EE^m}
\vol^{\kay-m}( f^{-1}(y)\cap C_n)\cdot\d_y\vol^m
\le 
\\
&\le
\Lip_n^\kay
\cdot
\int\limits_{\EE^m}
\vol^{\kay-m}[( f\circ w_n)^{-1}(y)\cap  w_n^{-1}(C_n)]\cdot\d_y\vol^m
=
\\
&=
\Lip_n^\kay
\cdot
\int\limits_{w_n^{-1}(C_n)}|(\d_x [f\circ w_n])^{\wedge m}|\cdot\d_x\vol^\kay
=
\\
&=0
\end{align*}
More formally, we apply the claim for the set is $w_n^{-1}(C_n)\times 0\subset\EE^{\kay-1}\times \RR=\EE^{\kay}$
and the map 
$(\bm{z},t)\mapsto f\circ w_n(\bm{z})$,
where $(\bm{z},t)\in \EE^{\kay-1}\times \RR=\EE^{\kay}$.

In particular, since both sides vanish, we get
\[\int\limits_{C_n}|(\d_x f)^{\wedge m}|\cdot\d_x\vol_\kay
= \int\limits_{\spc{M}}
\vol^{\kay-m}( f^{-1}(y)\cap C_n)\cdot\d_y\vol^m
\eqlbl{eq:coarea-Cn}\]
for all $n$.

Summing up \ref{eq:coarea-Bn} and \ref{eq:coarea-Cn} for all $n$,
we obtain
\[
\int\limits_A|(\d_x f)^{\wedge m}|\cdot\d_x\vol^\kay
\lege
e^{\pm m\cdot\eps}\cdot\int\limits_{\spc{M}}
\vol^{\kay-m}( f^{-1}(y)\cap A)\cdot\d_y\vol^m.
\]
Since $\eps>0$ is arbitrary, the claim follows.
\claimqeds

\begin{clm}{}\label{clm:coarea-3}
The theorem holds.
\end{clm}



\parit{Proof of the Claim.}
Let us apply Lemma~\ref{lem:chart+(m-1)-rect} for $\spc{M}$ and a small $\eps>0$.
We obtain a countable collection of $e^{\pm\eps}$-bi-Lipschitz distant charts 
$\bm{x}_n\:\spc{M}\subto\RR^m$,
which cover $\spc{M}\backslash\mathfrak{C}$, for some  closed set $\mathfrak{C}$ with zero $m$-volume.
Let us present $A$ as a disjoned union of a countble collection of Borel sets 
$A'\subset f^{-1}(\mathfrak{C})$
and $B_n\subset f^{-1}(\Dom\bm{x}_n)$. 

Since $\spc{M}$ is proper (see Corollary~\ref{cor:dim>proper}),
it is sufficient to prove the lemma in case 
$f(A)$ is bounded, say $f(A)\subset \oBall(p,R)$ for some $p\in\spc{M}$ and $R<\infty$.

By the theorem on distance embedding (\ref{thm:dist-emb}),
there is a bi-Lipschitz embedding 
$\iota\:\oBall(p,R)\hookrightarrow\EE^n$
for some positive integer $n$.
Hence, there is a finite constant $\Lambda>1$ such that
\[|(d_pf)^{\wedge \kay}|
\lege
\Lambda^{\pm1}\cdot|(d_p[\iota\circ f])^{\wedge \kay}|\]
for $\vol^m$-almost all $p\in A$.

Set $N=\tfrac{n!}{k!\cdot(n-k)!}$;
consider all the orthogonal projections $\proj^1,\proj^2,\dots,\proj^N$ of $\EE^n$ to $\kay$-dimensional coordinate subspaces. 
Note that if $\d_p[\iota\circ f]$ is linear then
so are the differentials $\d_p[\proj^i\circ\iota\circ f]$
for all $i$.
Clearly,
\[|(\d_p[\iota\circ f])^{\wedge \kay}|
\lege
(N\cdot\Lambda)^{\pm1}
\cdot
\sum_{i=1}^N|(\d_p[\proj^i\circ\iota\circ f])^{\wedge \kay}|.
\eqlbl{eq:jac=<LN}\]

Since $\vol^m[\proj^i\circ\iota\circ f(A')]=0$, 
by Claim~\ref{clm:coarea-2} applied for $A'$ and map $\proj^i\circ\iota\circ f
$,
we get
\begin{align*}
0&\le\int\limits_{A'}|(\d_x[\proj^i\circ\iota\circ f])^{\wedge m}|\cdot\d_x\vol^\kay
=
\\
&=
\int\limits_{\spc{M}}
\vol_{\kay-m}([\proj^i\circ\iota\circ f]^{-1}(y)\cap A')\cdot\d_y\vol^m
=
\\
&=0.
\end{align*}
Summing up and applying \ref{eq:jac=<LN},
we get 
\[\int\limits_{A'}|(\d_xf)^{\wedge m}|\cdot\d_x\vol^\kay=0.\]
Since $\vol^mf(A')=0$,
\[\int\limits_{\spc{M}}
\vol^{\kay-m}(f^{-1}(y)\cap A')\cdot\d_y\vol^m=0.\]
In particular, since both sides vanish, we get
\[\int\limits_{A'}|(\d_xf)^{\wedge m}|\cdot\d_x\vol^\kay
=
\int\limits_{\spc{M}}
\vol^{\kay-m}(f^{-1}(y)\cap A')\cdot\d_y\vol^m.
\eqlbl{eq:A'}
\]

Further, applying Claim~\ref{clm:coarea-2},
for the  maps $\bm{x}_n\circ f$, we get
\[
\int\limits_{B_n}|(\d_x[\bm{x}_n\circ f])^{\wedge m}|\cdot\d_x\vol^\kay
=
\int\limits_{\EE^m}
\vol^{\kay-m}([\bm{x}_n\circ f]^{-1}(y)\cap B_n)\cdot\d_y\vol^m.
\]
Clearly
\begin{align*}
|(\d_x[\bm{x}_n\circ f])^{\wedge m}|
&\lege
e^{\pm m\cdot\eps}\cdot |(\d_x f)^{\wedge m}|
\intertext{and for any $W\subset\Dom\bm{x}_n$}
\vol^m(W)
&\lege
e^{\pm m\cdot\eps}\cdot\vol^m\bm{x}(W).
\end{align*}
Hence 
\[
\int\limits_{B_n}|(\d_xf)^{\wedge m}|\cdot\d_x\vol_\kay
\lege
e^{\pm2\cdot m\cdot\eps}\int\limits_{\spc{M}}
\vol^{\kay-m}(f^{-1}(y)\cap B_n)\cdot\d_y\vol^m.
%\eqlbl{Bn}
\]
Summing up \ref{eq:A'} and \ref{Bn},
we get
\[
\int\limits_{A}|(\d_xf)^{\wedge m}|\cdot\d_x\vol_\kay
\lege
e^{\pm2\cdot m\cdot\eps}\int\limits_{\spc{M}}
\vol^{\kay-m}(f^{-1}(y)\cap A)\cdot\d_y\vol^m.
\]
Since $\eps>0$ is arbitrary, the theorem and the claim follow.
\qedqeds

\begin{thm}{Lemma}\label{lem:chart+(m-1)-rect}
Let $\spc{L}\in\CBB{m}{}$.
Then there is a countable collection of distance charts
$\bm{x}_n\:\spc{L}\subto\RR^m$
such that the set $\mathfrak{C}=\spc{L}\backslash\bigcup_n\Dom\bm{x}_n$
is countably $(m-1)$-rectifiable.

Moreover, given $\eps>0$,
all the distance charts $\bm{x}_n\:\spc{L}\subto\RR^m$ can be chousen to be  $e^{\pm\eps}$-bi-Lipschitz.
\end{thm}












\section{Rest}

\begin{thm}{Corollary}
Let $\mu$ be the $m$-dimesnional spherical measure on a metric space $\spc{X}$.
Assume that 
there is a function $\phi(x)=x+o(x)$ such that
$$\mu\oBall(x,R)\le\phi(R^m)$$
for any $x\in\spc{X}$ and $R>0$.
Then 
$$\densinf_p\df\liminf_{R\to0}\frac{\mu\oBall(x,R)}{R^m}=1$$
for $\mu$-almost all $x\in\spc{L}$.
\end{thm}

\parit{Proof.}
Assume contrary.
Then for some $\eps>0$ there is a set $A$ with $\mu A>0$
such that $\densinf_x<1-\eps$
for any $x\in A$.

We can choose a covering of $A$ be balls $B_n=\oBall(x_n,R_n)$
such that 
\[\sum_n R_n^m<(1+\eps)\cdot\mu A.\]
It follows that
$$\mu(A\cap B_n)>(1-\eps)\cdot\mu B_n$$
for some $n$.
Set $A'=A\cap B_n$.

Apply Besicovitch covering theorem for $A\cap B_n$.
We get a covering of $A'$ by closed balls $\{D_\kay\}$ such that
$D_\kay\subset B_n$ for each $n$ and 
$\mu D_\kay\le (1-\eps)\cdot R^m_\kay$ for each $\kay$.

We get that 
$$\mu(A\cap B_n)<(1-\eps)\cdot  \mu B_n,$$
a contradiction.
\qeds











\begin{thm}{Proposition}
Composition of two M\"obius transformations is a M\"obius transformation.
\end{thm}

\parit{Proof.}
Consider two M\"obius transformations
\begin{align*}
f_1(z)&=\frac{a_1\cdot z + b_1}{c_1\cdot z + d_1},
&
f_2(z)=\frac{a_2\cdot z + b_2}{c_2\cdot z + d_2}.
\end{align*}
Then 
\begin{align*}
f_1\circ f_2(z)
&=\frac{a_1\cdot\frac{a_2\cdot z + b_2}{c_2\cdot z + d_2}  + b_1}{c_1\cdot\frac{a_2\cdot z + b_2}{c_2\cdot z + d_2}  + d_1}
=
\\
&=\frac{(a_1\cdot a_2+b_1\cdot c_2)\cdot z+(a_1\cdot b_2+b_1\cdot d_2)}
{(c_1\cdot a_2+d_1\cdot c_2)\cdot z+(c_1\cdot b_2+d_1\cdot d_2)}
\end{align*}

Finally note that 
\begin{align*}(a_1\cdot a_2+b_1\cdot c_2)&\cdot(c_1\cdot b_2+d_1\cdot d_2)-(a_1\cdot b_2+b_1\cdot d_2)\cdot(c_1\cdot a_2+d_1\cdot c_2)=
\\
&=(a_1\cdot d_1-b_1\cdot c_1)\cdot(a_2\cdot d_2-b_2\cdot d_2).
\end{align*}

Therefore the transformation $f_1\circ f_2$ is nondegenerate since the right hand side is a product of two nonzero complex numbers.
\qeds


\begin{thm}{Proposition}
Inverse of M\"obius transformation is a M\"obius transformation.
\end{thm}

\parit{Proof.}
For a M\"obius transformation
$$f(z)=\frac{a\cdot z + b}{c\cdot z + d},$$
consider the M\"obius transformations
$$h(z)=\frac{d\cdot z - b}{-c\cdot z + a}.$$
It is straightforward to check that $f\circ h(z)=h\circ f(z)=z$ for any $z$.
\qeds







If a canonical representation $F\circ\bm{f}$
can be obtained from representation 
$H\circ\bm{h}$ by permuting coordinates or adding/removing a coordinate on which 

Two canonical representations 
$H\circ\bm{h}$ and $F\circ\bm{f}$ 
are regarded to be the same 
if they are differ only by permutation of coordinates of $\RR^\kay$.  
More precisely, 
if there is a permutation $\sigma$ of $(1,2,\dots,\kay)$ such that 
\begin{clm}{}
$F(x^{\sigma(1)},x^{\sigma(2)},\dots,x^{\sigma(\kay)})
\equiv
H(x^1,x^2,\dots,x^\kay)$
and
$f^i\equiv h^{\sigma(i)}$
for all $i$.
\end{clm}










\parbf{Differential.}
Assume that differential $\d_p\dist{\bm{a}}{}{}$ of the distance $\dist{\bm{a}}{}{}\:\spc{L}\to\RR^\kay$
is defined;
this is always the case if $\spc{L}\in\CBB{}{}$.
Then the differential  $\d_p\phi$ 
of the composite function $\phi\can F\circ\bm{f}$ 
can be also considered as a composite function with the canonical representation 
$\d_{\bm{f}(p)}F\circ\d_p\bm{f}$.











\begin{thm}{Proposition}???
Let $\spc{L}\in\CBB{m}{\kappa}$,
$\theta>0$ 
and $p,a^0,a^1,a^2,\dots,a^m\in\spc{L}$.
Assume that the point array $(a^0,a^1,a^2,\dots,a^m)$ is $\kappa$-strutting for $p$
and $\angk\kappa p{a^0}{a^i}>\tfrac\pi2+\theta$ for any $i\ne 0$.
Then there is a neighborhood $\Omega\ni p$ such that $\dist{\bm{a}^{\without 0}}{}{}|\Omega$ 
is a bi-Lipschitz map with constants $\Lip_\theta^{\min}=???$ and $\Lip_\theta^{\max}=???$.

In particular if $\theta$ is sufficiently close to $\arcsin\tfrac1{\sqrt{m}}$
then both constants $\Lip_\theta^{\min}$ and $\Lip_\theta^{\max}$ are close to 1.
\end{thm}

\parit{Proof} ???.












\begin{align*}
\d_p\phi(\nabla_p\psi)
&=\sum_i\partial_i F
\cdot
\min
\set{-\<\nabla_p\psi,\xi\>}{\xi\in\Dir{p}{a^i}}\le
\\
&\le
-\sum_i\partial_i F
\cdot
(d_p\psi)(\dir{p}{a^i})
=
\\
&=-\sum_{i,j}
\partial_i F
\cdot
\partial_j G
\cdot
\min\set{-\<\dir{p}{a^i},\zeta\>}{\zeta\in\Dir p{b^j}}
=
\\
&
\sum_{i,j}
\partial_i F
\cdot
\partial_j G
\cdot
\<\dir{p}{a^i},\dir{p}{b^j}\>=
\\
&=
\sum_{i,j}
\partial_i F
\cdot
\partial_j G
\cdot
\cos\mangle\hinge{p}{a^i}{b^j}\le
\\
&\le
\sum_{i,j}
\partial_i F
\cdot
\partial_j G
\cdot
\cos\angk\kappa{p}{a^i}{b^j}=
\\
&=\sdk\kappa{p}{\phi}{\psi}
\end{align*}



















\parbf{Remark.}
The condition (\ref{SHORT.def:MD:refl}) is equivalet to the condition that $F(x^1,x^2,\dots,x^\kay)$ is a semiconcave subfunction of $(x^1)^2,(x^2)^2,\dots,(x^\kay)^2$???. 
This condition is important only in the case when 
 $\Dom F$ contains point on coordinate hyperplanes of $\RR^\kay$.
In particular, for any $p\in\spc{L}$, the function $\dist[2]{p}{}{}$ as well as the restriction $\dist{p}{}{}|\spc{L}\backslash\{p\}$ are multidistance subfunctions,
but the distance function $\dist{p}{}{}$ is not a multidistance as a function on whole space $\spc{L}$. 

\medskip












\parbf{Convexity of composite functions.}
Here we do some calculus, we give an estimates for second derivative of composite functions on metric space.

Let us start with some definitions --- we need to extend inequality on Hessian to nonsmooth case.
Given a subfunction $F\:\RR^\kay\subto\RR$ and a quadratic form $Q$ on $\RR^\kay$, we will write $\Hess F\le Q$ (correspondingly $\Hess F\ge Q$) if
\[\bm{x}\mapsto F(\bm{x})-Q(\bm{x})\]
is a concave (correspondingly convex) subfunction on $\RR^\kay$.
Given an array $\bm{x}\in\Dom F$, we will write $\Hess_{\bm{x}}F\le Q$ 
(correspondingly $\Hess_{\bm{x}} F\ge Q$) 
if for any $\eps>0$ there is a neighborhood $\Omega\ni\bm{x}$ 
such that 
$\Hess (F|\Omega)\le Q+\eps\|\bm{x}\|^2$ 
(correspondingly $\Hess (F|\Omega)\ge Q-\eps\|x\|^2$); 
here $\|{*}\|$ denotes the standard Euclidean norm on $\RR^\kay$ and $F|\Omega$ is the restriction of $F$ to $\Omega$.

\begin{thm}{Proposition}\label{prop:conv-comp}
Let $\spc{X}$ be a metric space and  $\bm{\phi}=(\phi^1,\phi^2,\dots,\phi^\kay)$ be array of semiconcave functions $\phi^i\:\spc{X}\to\RR$ 
and $F\:\RR^\kay\subto\RR$ be a subfunction increasing in each argument.
Set $f=F\circ\bm{\phi}$, and let $p\in\Dom f=\bm{\phi}^{-1}\Dom F$.
Assume $\Hess_{\bm{\phi}(p)}F\le Q$ for some quadratic form $Q$ on $\RR^\kay$.
Assume further that for some real numbers $\lambda^i\ge 0$, $\Lambda$, $\Lip^1,\Lip^2,\dots,\Lip^\kay$, we have
\begin{align*}
\lambda^i 
&\ge (\phi^i)''(p),
&
\Lambda
&\le \liminf_{x,y\to p}\frac{Q(\bm{\phi}(x)-\bm{\phi}(y))}{\dist[2]{x}{y}{}},
&
\Lip^i
&\ge\limsup_{\bm{w}\to\bm{\phi}(p)}\partial_iF(\bm{w}).
\end{align*}
Then
\[f''(p)
\le 
\Lambda
+
\sum_{i=1}^\kay\Lip^i\cdot\lambda^i.\]

In particular, 
if $\bm{\phi}\:\spc{X}\to\RR^\kay$ is a bi-Lipschitz embedding in a neighborhood of $p$ 
and
\[F(\bm{x})=-K\cdot\|\bm{x}-\bm{\phi}(p)\|^2+\sum_{i=1}^\kay x^i\] 
for large enough real $K$ 
then $f$ to be strongly concave around $p$.
\end{thm}

\begin{thm}{Corollary}\label{cor:conv-comp}
Let $\spc{X}$ be a metric space and  $\bm{\phi}=(\phi^1,\phi^2,\dots,\phi^\kay)\:\spc{X}\subto\RR^\kay$ 
be an array of semiconcave subfunctions with a common domain which defines a $[a,b]$-bi-Lipschitz map
and $F\:\RR^\kay\subto\RR$ be a subfunction increasing in each argument.
Consider subfunction $f=F\circ \bm{\phi}$.

Assume $F''\ge \Lambda\ge 0$,
$(\phi^i)''\le \lambda$ for each $i$.
Then 
$$f''\ge \Lambda\cdot a^2+\lambda.$$
\end{thm}



\parit{Proof.}
Without loss of generality, we can assume that $\spc{X}$ is a real interval 
--- that follows form Definition~\ref{def:f''}.
If all functions $\phi^i$ and $F$ are smooth,
the statement follows from standard calculus.
In general case, one should present $F$ and $\phi^i$ as a limits of smooth semiconcave functions with the same bounds on second derivative and Hessian and then pass to the limit.
\qeds

















The Haudorff distance between two sets $A, B\subset \spc{X}$, briefly $\Hdist(A,B)$,
is defined as 
$$\Hdist(A,B)\df\sup\set{\dist{A}{x}{}-\dist{B}{x}{}}{x\in \spc{X}}.$$

Hausdorff distance turns the set of non-empty bounded closed subsets of $\spc{X}$ into a metric space in its own right.
Most importantly,
it defines convergence --- we say that a sequence of closed bounded sets $A_n$ in $\spc{X}$ converges to a closed bounded set $A_\infty$ (briefly $A_n\Hto A_\infty$) if $\Hdist(A_n,A_\infty)\to 0$.
In other words, given closed bounded sets $A_1,A_2,\dots$ and $A_\infty$ in $\spc{X}$
we write $A_n\Hto A_\infty$ if the distance functions 
$\dist{A_n}{}{}$ converge uniformly to the distance function $\dist{A_n}{}{}$.

To make Hausdorff convergence suitable for unbounded sets, we need to change uniform convergence to pointwise convergence in the last definition.
This new type of convergence was first intoduced by Wijsman in \ref{wijsman}.
More precicely we say that a sequence of closed sets $A_n$ in the space $\spc{X}$ converges 
to $A_\infty$ (briefly $A_n\Hto A_\infty$) if the distance functions 
$\dist{A_n}{}{}$ converge pointwise to the distance function $\dist{A_n}{}{}$.



\begin{thm}{Definition}
Let $A$ and $B$ be two closed subsets of a complete metric space $\spc{X}$ and $p\in\spc{X}$.
Set 
\begin{align*}
\alpha(r)&=\sup\set{\dist{B}{a}{}}{a\in A\cap\oBall(p,r)}\\
\beta(r)&=\sup\set{\dist{A}{b}{}\,}{b\in B\cap\oBall(p,r)}\\
\phi_p(r)=\phi_p(A,B;r)&=\max\{0,\alpha(r),\beta(r)\}
\end{align*}
The function $\phi_p\:\RR_\ge\to\RR_\ge$ is called \emph{Hausdorff profile}\index{Hausdorff profile} of $A$ and $B$ at $p$.
\end{thm}

The next proposition follows directly from the above definition.

\begin{thm}{Proposition}\label{prop:profile}???
Hausdorff profile is nondecreasing function. 
Moreover, if $\phi_p$ and $\phi_q$ are Hausdorff profiles of a pair of sets at points $p$ and $q\subset\spc{X}$
then $\phi_p(R)\le \phi_q(R+\dist{p}{q}{})$.
$\phi_p(A,C,r)\le \phi_p(A,B,r+\phi(A,B;r))+\phi_p(B,C,r+\phi(B,C;r))$.
\end{thm}

\begin{thm}{Definition} 
Let $A_1, A_2,\dots$ and $A_\infty$ be a closed sets in a metric space $\spc{X}$
and $p\in\spc{X}$.
Let us denote by $\phi_n$ the Hausdorff profile of $A_n$ and $A_\infty$ at $p$.
We say that $A_n$ conveges to $A_\infty$ in the sense of Hausdorff (briefly $A_n\to A_\infty$)
if  $\phi_n\to 0$ pointwise on $\RR_\ge$ as $n\to\infty$.
\end{thm}

It follows from Proposition~\ref{prop:profile}, 
that Hausdorff convegence does not depend on the choice of $p$.
The above definition is equivalent to the fact that given a real $R>0$ there is a sequence $R_n\to R+$ such that the bounded sets $A_n'= A_n\cap\cBall[p,R_n]$ converges to $A_\infty'=A_\infty\cap\cBall(p,R)$ in the sense of definition ???.

\section{Gromov--Hausdorff convergence}
\label{sec:GH}
\index{Gromov--Hausdorff convergence}

Here we define Gromov--Hausdorff convergence.
First we give a general definition for proper spaces 
and then discuss special properties of this convergence if the limit is compact.
The definitions presented here slightly differ from the original definitions given in ???, ???.
Mainly, we fix a sequence of approximations,
that makes possible to define convergence of the points, measures and functions induced by the Gromov--Hausdorff convergence.
















\section{???Radial curves and concave functions}

In this section we establish some comparison of radial curves for curvature $0$ and native $\lambda$-concave subfunctions.

\begin{thm}{Theorem} \label{thm:rad+conc}
Let $\spc{L}\in \CBB{m}{}$, 
$\lambda\ge 0$, 
$f\:\spc{L}\subto\RR$ be an native $\lambda$-concave subfunction such that $\Dom f$ is convex.
If $\sigma$ is  a  radial curve for curvature $0$ in $\Dom f$ with respect to $p\in\Dom f$ then the function
\[\theta(t)=\{f\circ\sigma(t)-f(p)-\tfrac{\lambda}{2}\cdot t^2\}/t\]
is non-increasing.
\end{thm}

\begin{thm}{Theorem} 
Let $\spc{L}\in \CBB{m}{}$, 
$\lambda\ge 0$, 
$f\:\spc{L}\subto\RR$ is a native subfunction satisfying $f''+\kappa\cdot  f\le \lambda$ 
and $\Dom f$ is convex. 
If $\sigma$ is  a radial curve for curvature $\kappa$ in $\Dom f$ with respect to $p\in\Dom f$ then the function
\[\theta(t)=\{f\circ\sigma(t)-f(p)-t^2\cdot\lambda/2\}/t\]
is non-increasing.
\end{thm}

\parit{Proof.} 
Recall from ???, that for $p\not=q$, 
\[(\d_q\dist{p}{}{})(v)=-\max_{\xi\in\Dir qp}\<\xi,v\>.\]
Thus, for any $v\in\T_p$,
\[\<\nabla_q\dist{p}{}{},v\>+\max_{\xi\in\Dir qp}\<\xi,v\>\ge 0.\]

Since $f$ is a native $\lambda$-concave function,
it has a supporting vector $s$ at $p$.
Therefore
\[(\d_q f)(\nabla_q\dist{p}{}{})+\min_{\xi\in\Dir qp}\{(\d_q f)(\zeta)\}
\le
-\l[\<\nabla_q\dist{p}{}{},s\>+\max_{\xi\in\Dir qp}\<\xi,s\>\r]\le0\]

On the other hand, since $f$ is $\lambda$-concave,
\[(\d_q f)(\zeta)\ge \frac{f(p)-f(q)-\lambda\cdot\dist[2]{p}{q}{}/2}{\dist{p}{q}{}}\ \ \text{for any}\
\ \zeta\in \Dir qp,\]
therefore
\[(\d_q f)(\nabla_q\dist{p}{}{})
\le
\frac{f(q)-f(p)+\lambda\cdot\dist[2]{p}{q}{}/2}{\dist{p}{q}{}}.\]

Set $\alpha_\xi(t)=\gexp(t\cdot\xi)$, $q=\alpha_\xi(t_0)$, then 
$\alpha^+_\xi(t_0)
=
\tfrac{\dist{p}{q}{}}{t}\cdot\nabla_{q}\dist{p}{}{}$ as in ???. 
Therefore,
\begin{align*}
(f\circ\alpha_\xi)^+(t_0)
&=
(\d_q f)(\alpha^+_\xi(t_0))
\le
\\
&\le
\frac{\dist{p}{q}{}}{t_0}\l[\frac{f(q)-f(p)+\lambda\cdot\dist[2]{p}{q}{}/2}{\dist{p}{q}{}}\r]
=
\\
&=
\frac{f(q)-f(p)+\lambda\cdot\dist[2]{p}{q}{}/2}{t_0}
\le
\\
\intertext{since $\dist{p}{q}{}\le t_0$ and $\lambda\ge 0$,}
&\le \frac{f(q)-f(p)+\lambda\cdot t^2_0/2}{t_0}
=
\\
&=\frac{f(\alpha_\xi(t_0))-f(p)+\lambda\cdot t^2_0/2}{t_0}.
\end{align*}
Substituting this inequality in the expression for derivative of $\theta$,
\[\theta^+(t_0)=\frac{(f\circ\alpha_\xi)^+(t)}{t_0}
-\frac{f\circ\gexp_p(t_0\cdot\xi)- f(p)}{t_0^2}-\lambda /2,\] we get
$\theta^+\le 0$, i.e. $\theta$ is non-increasing. 

Clearly, $\theta(0)=(\d_p f)(\xi)$ and so the first statement follows.\qeds
















From claim \ref{Z-for-zajicek}, it is sufficient to show that 
$$W\subset \bigcup Z[\bm{e}_i,a,b],$$
where the union is taken for all basis vectors $\bm{e}_i$ of $\RR^n$ and all pairs of rational numbers $a\not=b$.

Let $\bm{x}\in \oBall(\bm{0},\eps)$.
Sinse $f$ is concave, 
its differential $\d_{\bm{x}}f\:\RR^m\to\RR$ is also concave.
Consider subset $D_{\bm{x}}$ of all vectors $\bm{v}\in\RR^m$ such that $f$ is differentiable in the direction $\bm{v}$; or equivalently $\d_{\bm{x}}f(\bm{v})+\d_{\bm{x}}f(-\bm{v})=0$.
Clearly $D_p$ is a linear subspace of $\RR^m$.

Further, $\bm{x}\in W$ if and only if $\dim D_{\bm{x}}<m$.
In particular, 
$\bm{e}_i\notin D_{\bm{x}}$ for some $i$ 
and thus $\bm{x}\in Z[\bm{e}_i,a,b]$ for some distinct rational values $a$ and $b$.
\qeds




\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{}$ then the set of singular points in $\spc{L}$ is countably $(m-1)$-rectifable.
\end{thm}

See also ??? for a slightly more exact formulation.

\parit{Proof.}
Note that from Theorem~\ref{thm:rank=kay},
we get that the set of all points in $\spc{L}$ of rank $<m$,
is a countably $(m-1)$ rectifiable set.

According to ??? and ???,
each point of rank $m$ in $\spc{L}$ can be covered by a distance chart.
Therefore it is sufficient to prove the following:

\begin{clm}{}
For any distance chart $\bm{x}\:\spc{L}\subto\RR^m$,
the set of singular points in $\Dom\bm{x}$
is contably $(m-1)$-rectifiable.
\end{clm}









\begin{clm}{}\label{Z-for-zajicek}
Given $\bm{u}$ and $a\not=b$, 
the set $Z[\bm{u},a,b]$ of all solutions of
$$h_{\bm{u}, a}(\bm{x})
=
h_{\bm{u}, b}(\bm{x})$$ 
forms a subset of a graph of a $\DC$-function.
\end{clm}

\parit{Proof of the claim.}
Let us denote by $H$ the hyperplane in $\RR^m$ perpendicular to $\bm{u}$.
Set $z=\l[h_{\bm{u}, a}(\bm{x})-h_{\bm{u}, b}(\bm{x})\r]|_H$.
From Claim~\ref{h-for-zajicek}, $z$ is a $\DC$-function.
It is straighforward to check that
$$ Z[\bm{u},a,b]
=\set{\bm{h}+\tfrac{z(\bm{h})}{a-b}\cdot\bm{u}}{\bm{h}\in H\cap\oBall(\bm{0},\eps)}.$$
I.e., $Z[\bm{u},a,b]$ is a graph of $z$ over $H$ in $\oBall(\bm{0},\eps)$.
\claimqeds
















\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{}$ and $p\in\spc{L}$.
Assume $\rank_p=m-1$ then either $p\in\partial\spc{L}$
or there is a Lipschitz submap 
$w_p\:\RR^\kay\subto\spc{L}$
and a neigborhood $\Omega\ni p$
such that 
$$\Im w_p
\supset
\set{q\in \Omega}{\rank_q\le m-1}.
$$ 
\end{thm}

\parit{Proof.}
Choose strutters $a^0,a^1,\dots,a^{m-1}$ for $p$.
Note that for a small $\eps>0$,
if  $\acute p\lege p\pm\eps$ and $\acute a^i\lege a^i\pm\eps$ for each $i$
then point array $(\acute a^0,\acute a^1,\dots,\acute a^{m-1})$ strutts $\acute p$.
In particular $\rank_{\acute p}\ge \kay$ for any $\acute p\in\oBall(p,\eps)$.

Applying ???,
there is a nondecresing concave real-to-real function $\phi$ and 
a finite collection of points  $\{a^j_i\}$ in $\oBall(a^i,\eps)$
such that 
$$f^i=\sum_j\phi\circ\dist{a^j_i}{}{},$$
are strongly concave in a neigborhood of $p$; say $\Omega\ni p$.

Hence we are in position to allpy Theorem~\ref{thm:web} to the space $K$ 
and the function array $(-f^0,-f^1,\dots,-f^{m-1})$.
Set $w_p$ to be the corresponding baricentric map;
this is a Lipschitz map from $\Delta^\kay$ to $K$.

\begin{clm}{Claim}
Assume $q\in \Omega$ and $rank_q=m-1$.
Then $w_p^{-1}(q)$ contains an interval in $\Delta^{m-1}$. 
\end{clm}
 

According to ???,
we can assume that $\Omega$ is the interior of 
a compact convex set $K\subset \oBall(p,\eps)$.
Moreover, 
we can assume that $\Xi=(\dist{\bm{a}}{}{})(\Omega)$ is a convex set in $\RR^m$.
Clearly $\dist{\bm{a}}{p}{}\in\partial \Xi$
\qeds

















\begin{thm}{Corollary???}
Let $\spc{L}\in\CBB{m}{}$
then the set of all points in $\spc{L}$ with rank $\le \kay$
is a countably rectifiable closed set.

Moreover $W^{\kay}$ is the set of all points in $\spc{L}$ with rank $\ge\kay$ and $V^\kay$ to be the set of all points with rank equal $\kay$ then

\begin{subthm}{}
$V^\kay$ is closed locally $\kay$-rectifiable relatively $W^\kay$.
\end{subthm}

\begin{subthm}{}
$V^m$ is open subset of $\spc{L}$ which can be covered by a coundable number of domains of distance charts.
\end{subthm}

\end{thm}











\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}\kappa$ then almost all points in $\spc{L}$ are Euclidean;
i.e. the set of points $p\in \spc{L}$ such that $\T_p$ is not isometric to $\EE^m$ has vanishing $m$-dimensional Hausdorff measure.
\end{thm}

\parit{Proof.}
According to ???, it is sufficient to show that any point 
$p\in\spc{L}$ 
 with $\rank_p=m$ admits a neighborhood $\Omega\ni p$
such that almost  all points in $\Omega$ are Euclidean.
Let $(b,a^1,a^2,\dots,a^m)$ be a $\kappa$-strutting array for $p$.
According to ???
the function $f=\dist{b}{}{}\circ(\dist{\bm{a}}{}{})^{-1}$ is semiconcave in a neighborhood of $\dist{\bm{a}}{p}{}\in\RR^m$.
Thus, according to Alexandrov's theorem,
$f$ is differantable almosteverywhere in ???.
Therefore, it is suffice to prove the following:

\begin{clm}{Claim}
If $f$ is differentiable at $\dist{\bm{a}}{q}{}$ for some $q\in \Omega$ then $q$ is a Euclidean point; i.e. $\T_q\iso\EE^m$.
\end{clm}

\parit{Proof of the claim}
Inded,???
\claimqeds






The following statement makes possible to extend number of results in geometric measure theory from Euclidean space to Alexandrov spaces;
in a slightly weaker form it appears in  \cite[???]{BGP}.

\begin{thm}{Corollary}
For any space $\spc{L}\in\CBB{m}{}$ 
one can choose can countably many distant charts $\bm{x}\:\spc{L}\subto\RR^m$, which cover $\spc{L}\backslash\mathfrak{C}$,
where $\mathfrak{C}$ is a closed countably $(m-1)$-rectifiable sets.

Moreover $\mathfrak{C}$ can be presented as a union $\partial\spc{L}\cup\mathfrak{C}'$,
where $\mathfrak{C}'$ is a closed countably $(m-2)$-rectifiable sets.
\end{thm}










\begin{thm}{Theorem}
Any $\spc{L}\in\CBB{m}\kappa$ is locally $m$-rectifiable.
\end{thm}

\parit{Proof.}
Assume $p\in\spc{L}$ be a Euclidean point; i.e. $\T_p\iso\EE^m$ and $R\le\varpi\kappa/2$.
Set $B=\cBall[\0,R]\subset\T_p$.
Note that $\cBall[p,R]\subset\gexp\mc\kappa_p(\cBall(\0,R))$.
Hence the result.
\qeds








Note that we can assume that $f(A)$ is bounded;
say $f(A)\subset \oBall(p,R)$ for a finite $R$.
Let us apply 

In the proof we also use 
\emph{approximate differentail}%
\index{differential!approximate differentail} 
as defined in \cite[3.1.2]{federer}.
Assume $A\subset\EE^\kay$ and $\bm{f}\: A\to \EE^m$ be a map.
We say that a linear function $L\:\EE^\kay\to\EE^m$ is approximate differential of $\bm{f}$ at $a\in A$
(briefly $L=\ApD_a\bm{f}$)
if there is a subset $A'\subset A$ which has density $1$ at $a$ and such that
$$\bm{f}(x)=f(a)+L(x-a)+o(x-a)$$
for $x\in A'$.


Note that if $\ApD_af$ is defined then
it is unique 
and  $a$ is a density point of $A$; 
moreover $L$ is unique.


If $\bm{f}=(\bm{h}|A)$ for some Lipschitz function 
$\bm{h}\:\EE^\kay\to\EE^m$ then 
$\ApD_af$ coinsides with $d_af$ for almost all $a\in A$.

We define approximate $n$-Jacobian
in the same way as $n$-Jacobian, but using approximate differential:
$$\ApJac^n_p f\df
|\wedge^n(\ApD_pf)|.$$ 

Further, any Lipschitz function $\bm{f}\:A\to \EE^m$
can be extended to a Lipzchitz function defined on whole $\EE^\kay$.
(If $f^i$ the coordinate functions of $\bm{f}$,
then one may defien $\bm{h}=(h^1,h^2,\dots,h^m)$
with
$$h^i(x)=\inf\set{f^i(y)+\Lip\cdot|x-y|}{y\in A},$$
where $\Lip=\lip \bm{f}$;
in this case $\lip \bm{h}\le m\cdot \Lip$.
Alternatively one may apply Kirszbraun's theorem ??? and this way obtain $\bm{h}$ 
with $\lip \bm{h}= \Lip$.)

Therefore the Theorem~\ref{thm:coarea-federer} can be generalized the following way:

\begin{thm}{Theorem}\label{thm:coarea-ApD}
Let $\kay\ge m$,
$A\subset \EE^\kay$ be a Borel set 
and $\map\:A\to\EE^m$ be a Lipschitz map.
Then 
$$\int\limits_A(\ApJac^m_x\map)\cdot\d_x\vol_\kay
=
\int\limits_{\EE^m}\vol_{\kay-m}(\map^{-1}(y)\cap A)\cdot\d_y\vol_m.$$
\end{thm}

In the proof we will also use 
local existance of bi-Lipschitz embedding 
of Alexandrov space into Euclidean space 
of sufficiently large dimension.

\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{m}{}$, 
$\spc{X}\in\CBB{\kay}{}$
and $f\:\spc{L}\to\spc{X}$ be a Lipschitz map.
Assume for some Borel set $A\subset \spc{L}$, 
we have $\vol^\kay f(A)=0$ then 
$$\int\limits_A|(\d_pf)^{\wedge\kay}|\cdot\d_p\vol^m=0.$$

\end{thm}










\begin{thm}{Coarea formula} Let $\spc{L}\in\CBB{m}{}$ and $\bm{f}\:\spc{L}\subto\RR^\kay$ be a Lipscitz submap.
Then its jacobian ??? is defined almost everywhere.
Moreover for any ??? function $u\:\spc{L}\to\RR$ with support in $\Dom \bm{f}$,
we have 
$$\int\limits_E u(p) \jac_p^\kay f\cdot\d_p\vol^m
=
\int\limits_{f(E)}\d_x\vol^\kay
\int\limits_{f^{-1}(x)}u\cdot\d_y\vol^{m-\kay}$$
\end{thm}

\parit{Proof.} In case $\spc{L}=\EE^m$, the statement follows directly from  \cite[3.2.11]{federer}. 
Namely

\begin{clm}{Claim}\label{coarea-Rn} 
Let $\bm{f}\: \RR^m\to\RR^\kay$ be a Lipschitz submap and $u\:\RR^m\to\RR$ be a function with support in $\Dom\bm{f}$, $m>\kay$. 
Then
$$\int\limits_E u(p)\cdot\jac_p^\kay f\cdot\d_p\vol^m
=
\int\limits_{f(E)}\d_x\vol^\kay
\int\limits_{f^{-1}(x)}u\cdot\d_y\vol^{m-\kay}$$
for every measurable set $E$.
Let $\Omega\subset \RR^m$ be an open subset and $g$
 be a continuous Riemannin metric which is defined on a subset $A\subset \Omega$ of full measure.???
\end{clm}

The theorem can be reduced to the claim \ref{coarea-Rn}, once we prove the following:???

\begin{clm}{Claim}
Given $\eps>0$ there is a 
\end{clm}


\begin{thm}{Theorem}
Let $\spc{L}\in \CBB{m}{}$. 
Then there is a countable collection of Lipschitz maps $\ell_{i,\kay}\:\RR^\kay\to \spc{L}$ such that all $\ell_{i,m}$ are bi-Lipschitz, $\bigcup_{i,\kay}\ell_{i,\kay}=\spc{L}$. 
\end{thm}










\begin{subthm}{thm:inverse-function:lift}???
Assume $\spc{L}_n\in\CBB{m}{\kappa}$ and $a^i_n,b_n\in\spc{L}_n$ be such that there is a Gromov--Hausdorff convergence
$\GH\:(\spc{L}_n, a^i_n,b_n)\GHto(\spc{L},a^i,b)$.
Then for all large $n$,
(\ref{SHORT.thm:inverse-function:strut}) 
and (\ref{SHORT.thm:inverse-function:chart}) 
holds for $a^i_n,b_n$ in 
$$\Omega_n
=
(\dist{\bm{a}_n}{}{})^{-1}\circ\dist{\bm{a}}{}{}(\Omega)
\subset
\spc{L}_n.$$ I.e.,
\begin{enumerate}[a$')$]
\item $(b_n,a^1_n,a^2_n,\dots,a^m_n)$ is a $\kappa$-strutting for any $q_n\in\Omega_n$
\item The restriction of the distance map 
$$\dist{\bm{a}_n}{}{}|_{\Omega_n}
=
(\dist{a^1_n}{}{}|_{\Omega_n},\dist{a^2_n}{}{}|_{\Omega_n},\dots,\dist{a^m_n}{}{}|_{\Omega_n})$$ 
is an open bi-Lipschitz embedding  $\Omega_n\to\RR^m$.
\end{enumerate}





\end{subthm}






The proof of general case use Coarea formula (\ref{thm:coarea}),
but if $\kappa=0$ 

\parit{Proof of Bishop--Gromov inequality for $\kappa=0$.} 
We need to prove that 
$$ \frac{v(R_1)}{\~v(R_1)}\ge \frac{v(R_2)}{\~v(R_2)}$$
if $R_1< R_2$.

For each point $x\in \spc{L}$ choose a geodesic path $\geod_{[px]}$;
at least one such path exists by ???.


Define homotety $(R_1/R_2)$-homothety
as 
$$\map(x)=\geod_{[px]}(\lam).$$

From ???, we have 
$$\dist{\map(x)}{\map(y)}{}
\ge
\frac{R_1}{R_2}\cdot\dist[{{}}]{x}{x}{}\eqlbl{eq:R1/R2}$$
for any pair of points $x,y\in\spc{L}$.

Since $\map$ maps $\oBall(p,R_2)$ to $\oBall(p,R_1)$ and from \ref{eq:R1/R2},
we get
\begin{align*}
\vol_m\oBall(p,R_1)
&\ge
\vol_m\map(\oBall(p,R_2))
\ge
\\
&\ge 
\l(\frac{R_1}{R_2}\r)^m
\cdot
\vol_m\oBall(p,R_2).
\end{align*}
Since $\kappa=0$, we have 
$$\frac{\~v(R_1)}{\~v(R_2)}=\l(\frac{R_1}{R_2}\r)^m.$$
Hence the result.\qeds









In this section we extend some results from geometric measure theorey to Alexandrov space.
The proofs work in much wider context of \emph{almost Riemannian spaces} which defined below:

\begin{thm}{Definition}
A length space $\spc{X}$ is calles \emph{almost Riemannian space}
if for any $\eps>0$ there is open subset $\Omega\subset \spc{X}$ such that 
\begin{subthm}{}
For any point $x\in\Omega$ there is an $[\tfrac1{1+\eps},1+\eps]$-bi-Lipschitz chart;
i.e. there is an open $[\tfrac1{1+\eps},1+\eps]$-bi-Lipschitz embedding $\map\:\spc{X}\subto\EE^m$ such that $\Dom\map\ni x$.
\end{subthm}{}

\begin{subthm}{}
$\Omega$ is dense in $\spc{L}$ and moreover $\spc{L}\backslash\Omega$ has vanishing $m$-dimensional Hausdorff measure.
\end{subthm}{}

\begin{subthm}{}
 $\Omega$ the intrinsic metric of $\Omega$ coinsides with inherite metric from $\spc{L}$.
\end{subthm}
\end{thm}


\begin{thm}{Proposition}
Any $\CBB{m}{}$ space is almost Riemannian
\end{thm}

\parit{Proof.}
Choose sufiiciently small $\delta>0$; $\delta=???(m,\eps)$ will do.
Consider set 
$$\Omega=\set{x\in\spc{X}}{\vol\Sigma_x>\vol\SS^{m-1}-\eps}$$
According to ???, any point $x\in\Omega$ admits a $[\tfrac1{1+\eps},1+\eps]$-bi-Lipschitz chart.
Further, according to ??? $\Omega$ is convex; 
in particular, its intrinsic metric coinsides with inherite metric from $\spc{L}$.
From ???, it follows that $\Omega$ is everywhere dense.
Finally, according to ???, the set $\spc{L}\backslash\Omega$ is countable union of $(m-1)$-rectifiable sets.
In particular it has vanishing Hausdorff measure.  \qeds

Our next aim is to generalize coarea formula for almost Riemannian spaces and therefore to $\CBB{<\infty}{}$ spaces.
To do this we first need to give a definition of Jacobian which would have sense for any metric space

Recall that for a map $h\:\EE^\kay\to\EE^\kay$,
which is differentiable at $p\in \EE^\kay$,
the $\kay$-jacobian of $h$ at $p$ (further denoted as $\jac^\kay_p h$) 
is defined as ???.









Let $g$ and $h$ be two nonnegative quadratic forms on $\RR^m$.
For any $\kay$-dimensional linear subspace $V$ in $\RR^m$,
$g$ and $h$ define a $\kay$-volume form, say $\vol^\kay(g|V)$ and $\vol^\kay (h|V)$.
Let us define the $\kay$-jacobian of $h$ with respect to $g$ as supremum
$$\jac^\kay(h/g)=\sup\set{\frac{\vol^\kay(h|V)}{\vol^\kay(g|V)}}{\dim V=\kay}.$$
The above supremum is well defined if and only if $g$ is positive definite.

Now assume $\spc{L}\in \CBB{m}{}$, $\spc{M}\in \CBB{n}{}$
and $f\:  \spc{L}\subto \spc{M}$ be a locally Lipscitz submap.

Consider a locally Lipscitz submap $\map\: \RR^m\subto \spc{L}$.
According to Rademacher's theorem (???),
the differentials $d_{\bm{x}}\map$ and $d_{\bm{x}}(f\circ\map)$ are defined and linear at almost all $\bm{x}\in\Dom f$.
In particular, both functions $g=v\mapsto (d_{\bm{x}}\map(v))^2$ and $h=v\mapsto (d_{\bm{x}}f\circ\map(v))^2$ are quadratic forms.
Assume $p=\map \bm{x}$ and $g>0$, theen define 
$$\jac^\kay_p f
\df
\jac^\kay (g/h).$$


\begin{thm}{Proposition}
The $\jac^\kay_p f$ define above is indeppendent from the choice of map $\map$.
More precicely:

Let $\spc{L}\in \CBB{m}{}$, $\spc{M}\in \CBB{n}{}$
and $f\:  \spc{L}\subto \spc{M}$ be a locally Lipscitz submap.
Assume there are two maps $\map, \map[2]\: \RR^m\subto \spc{L}$,
such that ???
\end{thm}



Given an integer $\kay\ge0$,
one can the maps $\wedge^\kay (d_{\bm{x}}\map)\:\wedge^\kay\T_{\bm{x}}\to\wedge^\kay\T_{\map(\bm{x})}$ induced by $d_{\bm{x}}\map$
and $\wedge^\kay(d_{\bm{x}}(f\circ\map))\:\wedge^\kay\T_{\bm{x}}\to\wedge^\kay\T_{f\circ\map(\bm{x})}$.

If 

Given $\kay$-dimensional subspace $V^\kay$ of $\T_{\bm{x}}=\RR^m$
Let us denote  by $\det(\d_{\bm{x}}f|V^\kay)$ the ratio of volume forms defined by the metric 




We were not be able to find an easy way to prove area and coarea formulas for $\CBB{}{}$ spaces.


First we need a definition of $n$-Jacobian which would work for general metric space.

Assume $\spc{X}$ and $\spc{Y}$ are two metric spaces,
$\map\:\spc{X}\subto\spc{Y}$ is a submap 
and $x\in\Dom\map$.
Define $n$-Jacobian of $\map$ at $x$ the following way
$$\jac^n_x\map
=
\limsup_{\eps\to0+}\frac{\vol_n \map(\oBall(x,\eps))}{\vol_n\ModBall_\eps}.$$

\begin{thm}{Proposition}
Let $\spc{L}\in \CBB{l}{}$,
$\spc{M}\in\CBB{m}{}$ 
and $\map\:\spc{L}\subto\spc{M}$ be a locally Lipshitz map.
Set $n=\min\{l,m\}$.
Then for any $x\in\Dom\map$,
we have
$$\jac^n_x\map\le(\lip_x\map)^n.$$

Moreover, the $\jac^n_x\map$ coinsides with standard $n$-Jacobian if $\map$ is differentiable at $x$;
i.e. if $\T_x\spc{L}$ and $\T_{\map(x)}\spc{M}$ are Euclidean spaces
and the differential $\d_x\:\T_x\to\T_{\map(x)}$ is defined and linear then
$$\jac^n_x\map
=
\sup\{|\det(b\circ\d_x\map\circ a)|\},$$
where supremum is taken for all short linear maps $a\:\RR^n\to \T_x$ and $b\:\T_{\map(x)}\to \RR^n$.
\end{thm}


Note that 
$$(\lip_x\map)^n\ge\jac^n_x\map\ge 0$$ 
for any $x\in\Dom\map$.
Further, given two submaps $\map\:\spc{X}\to\spc{Y}$ and $\map[1]\:\spc{Y}\to\spc{Z}$ and $x\in\Dom\map\circ\map[1]$ we have
$$(\colip_x\map)^n\cdot\jac^n_{\map(x)}\map[1]\le\jac^n_x(\map\circ\map[1])\le (\lip_x\map)^n\cdot\jac^n_{\map(x)}\map[1],$$
$$\jac^n_x(\map\circ\map[1])\le (\lip_{\map(x)}\map[1])^n\cdot\jac^n_{x}\map.$$

Note that if both $\T_x\spc{X}$ and $\T_{\map(x)}\spc{Y}$ are Euclidean spaces and the differential $\d_x\map\:\T_x\to\T_{\map(x)}$ is defined and linear then 
$$\jac^n_x\map
=
???.$$
The later is the standard definition of $n$-Jacobian








Here we apply results of ??? to $\cCat{}{}{}$ spaces.

\begin{thm}{Lemma}\label{lem:bary-cat}
Let $\spc{U}\in\cCat{}{\kappa}$
and $a^0,a^1,\dots a^m$ be an array of points in $\spc{U}$ such that
$\dist{a^i}{a^j}{}< \tfrac{\varpi\kappa}{10}$. 
Then the barycentric simplex $s$ with vertexes at $a^i$ is defined.

Moreover, if $K\subset \spc{U}$ is a convex closed subset which contains all $a^i$
then $\Im s\subset K$.

In particular, if $\diam \spc{U}\le \tfrac{\varpi\kappa}{10}$
then for any array of vertexes $a^0,a^1,\dots a^m$ in $\spc{U}$,
the barycentric simplex is defined.
\end{thm}

\parit{Proof.}
Consider $\spc{B}=\cBall[a^0,R]\subset\spc{U}$.
According to \ref{cor:convex-balls}, $\spc{B}$ is closed convex set of $\spc{U}$,
in particular, $\spc{B}\in\cCat{}{\kappa}$.

Note that for each $i$ the distance function $\dist[2]{a^i}{}{}$ is strongly convex in $\spc{B}$.

Given $\bm{x}\in\Delta^m$ set $f_{\bm x}=\sum_{i=0}^m \dist[2]{a^i}{}{}$.
By the triangle inequality, 
$$f_{\bm x}(p)> f_{\bm x}(a^0)$$
for any $p\in\spc{U}\backslash\spc{B}$
and $\bm{x}\in\Delta^m$.

Applying \ref{thm:bary} for the space $\spc{B}$, we get that
$s(\bm{x})=\argmin f_{\bm x}$
is defined for any $\bm{x}\in\Delta^m$.
Moreover $s\:\Delta^m\to\spc{B}$ is Lipschitz
 and $s(\Delta^m)\subset \spc{B}$.
In particular 
$$\diam s(\Delta^m)
\le
\diam \spc{B}
\le
2\cdot R$$ 

Further, apply to $s$ the generalized Rademacher's theorem (\ref{thm:rademacher}).
We get a set $Q\subset\Delta^m$ of full measure such that
the differential $\d_{\bm{x}}s$ is defined and linear for all $\bm{x}\in Q$.

Assume $s$ is nondegenerate; 
i.e. $\Omega=s(\Delta^m)\backslash s(\partial\Delta^m)$ is nonempty.
According to \ref{bary-R^n}, $\Omega$ is homeomorphic to $m$-dimensional manifold.
By Szpilrajn's theorem (\ref{thm:szpilrajn}), $m$-dimensional Hausdorff measure of $\Omega$ has to be positive.
It follows %??? it shold be area formula here or something else...
that  $\Im\d_{\bm{x}}s$ is $m$-dimensional subspace for some $\bm{x}\in Q$;
in particular $\LinDim \spc{U}\ge m$.
\qeds















\begin{wrapfigure}{r}{32mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(2mm)]{pics/qab-simplex(0.75)}
\lbl[tl]{20,20;$o$}
\lbl[t]{19, 0;$\dot a^0$}
\lbl[l]{38,32;$\dot a^1$}
\lbl[r]{1,32;$\dot a^2$}
\lbl[b]{19,33;$\dot b^0$}
\lbl[tr]{10,17;$\dot b^1$}
\lbl[lt]{29,17;$\dot b^2$}
\end{lpic}
\end{wrapfigure}





As usual $o$ denotes the origin of $\T_q$.

Choose unit vectors $\dot a^0,\dot a^1,\dots,\dot a^m$ in $E$
to be the vertexes of a regular $m$-simplex $\Delta$,
so that $o$ is the center of $\Delta$.
Denote by $\dot b^i$ the center of the face of $\Delta$ opposite to $\dot a^i$.
As it follows from Line strip lemma ???,
for any $p\not= q$, the inequality
$$\mangle(\dir q p,\dot a^i)\ge \tfrac\pi2
\eqlbl{eq:<(v,a)>=pi/2}$$
holds for at least one value $i$.

Choose small $\delta>0$;
$\delta=\tfrac1{100\cdot m}$ will do.
Apply Claim~\ref{clm:finite-config-cba} 
to $2\cdot m$ vectors $\{\dot a^i,\dot b^i\}_{i=0}^m$ in $\T_q$.
We obtain a conficuration of $2\cdot m$ 
points, $\{a^i,b^i\}_{i=0}^m$ in $\spc{U}$.
We may assume that $\lam$ is small with respect to $\varpi\kappa$, 
say $\lam<\tfrac{\varpi\kappa}{100}$.
Let $p$ be the minimum point of function $f=\max_i\{\dist{a^i}{}{}\}$%
%???the existance and uniqueness of such $p$ follows from ???
.
Note that for any $x\in \spc{U}$
$$\max_i\{\mangle\hinge p x {a^i}\}\ge \tfrac\pi2,$$
otherwise $f(\bar x)<f(p)$ for some $\bar x\in [px[$.
I.e., we get the first part of (\ref{SHORT.thm:dim-infty-CBA:bary}).

Further, note that the inequlality
$$\dist{p}{a^i}{}\le \dist{q}{a^i}{}=\lam.
\eqlbl{|pa|>=lam}$$
holds for each $i$.
If $p\not= q$, fix $i$ for which \ref{eq:<(v,a)>=pi/2} holds,
so 
$$\mangle\hinge q p {a^i}>\tfrac\pi2-\delta.
\eqlbl{eq:>pi/2-delta}$$
Since $\lam$ is small with respect to $\varpi\kappa$,
the ??? comparison together with \ref{|pa|>=lam} and \ref{eq:>pi/2-delta} imply 
$$\dist{q}{p}{}<3\cdot\delta\cdot\lam.$$
In particular, ,
\begin{align*}
\dist{a^i}{p}{}&\approx \lam\cdot(1\pm5\cdot\delta)\cdot\dist[{{}}]{\dot a^i}{o}{},
\\
\dist{p}{b^j}{}&\approx \lam\cdot(1\pm5\cdot\delta)\cdot\dist[{{}}]{o}{\dot b^j}{},
\\
\dist{a^i}{b^j}{}&\approx \lam\cdot(1\pm5\cdot\delta)\cdot\dist[{{}}]{\dot a^i}{\dot b^j}{}.
\end{align*}
Sinse $\delta$ is small, the angle comparison ??? imples that
$\mangle \hinge p{a^i}{b^j}<\tfrac{\pi}{2}{}$
for all $i\not=j$.
Hence we get the second part of (\ref{SHORT.thm:dim-infty-CBA:bary}).





















To prove the theorem, we need the following lemma.




\begin{thm}{Lemma}\label{lem:nondeg-test-with-faces}
Let $\spc{U}\in\cCat{}{\kappa}$,
and $\bm{a}=(a^0,a^1,\dots a^\kay)$ be an array of radius $<\tfrac{\varpi\kappa}2$.
Then $\bm{a}$ is degenerate if and only if 
$$\Web({\dist{\bm{a}^{\without i}}{}{}})
\subset 
\bigcup_{j\not=i}
\Web({\dist{\bm{a}^{\without j}}{}{}}).$$
for each $i$.
\end{thm}

\parit{Proof.} 
%??? maybe this should be proved in more general settings???
Suppose there is a point $p\in \Web({\dist{\bm{a}^{\without i}}{}{}})$ such that
$p\not\in \Web({\dist{\bm{a}^{\without j}}{}{}})$ for all $j\not=i$.
Then 
\qeds










\begin{thm}{Proposition}\label{prop:web-test}
Let $\spc{U}\in\cCat{}{\kappa}$
and $\bm{a}=(a^0,a^1,\dots a^\kay)$ be a point array.
Assume there is $z\in\spc{U}$ such that $\dist{z}{a^i}{}<\tfrac{\varpi\kappa}{2}$ for each $i$.
Then $p\in \Web \dist{\bm{a}}{}{}$ 
if and only if $\dist{z}{p}{}<\tfrac{\varpi\kappa}{2}$ and
$$\inf\set{\max_i\{\mangle\hinge p x {a^i}\}}{x\in \spc{U}}\ge \frac\pi2.
$$

\end{thm}








\parit{Proof (\ref{SHORT.lem:nondeg-test-with-balls:min-point}).}
First let us prove it in the case $\kappa\le 0$.
In this case $f^2$ is a strongly convex function,
therefore according to Lemma~\ref{lem:argmin(convex)},
there is unique minimum point $p$ of $f^2$ and therefore $f$.

Further, if $p\in\cBall[a^j,r^j]$ for some $j$,
then $p$ is also a local minimum point of function 
$$h^j(x)=\max_{i\not=j}\{\dist{\cBall[a^i,r^i]}{x}{}\}.$$
Note that $h^j$ is convex, therefore $p$ is a minimum point of $h^j$;
i.e., $$p\in \bigcap_{i\not=j} \cBall[a^i,r^i]$$ 
which contradicts $\bigcap_i \cBall(a^i,r^i)=\emptyset$.

By recaling, the remaining case $\kappa>0$ can be reduced to the case $\kappa=1$;
i.e. $\spc{U}\in \cCat{}{1}$.
Set $\mathring{\spc{U}}=\Cone\spc{U}$,
let $\imath\:\spc{U}\hookrightarrow\mathring{\spc{U}}$ be the natural embedding.
According to ???, $\mathring{\spc{U}}\in \cCat{}{0}$.
Set $$B_i=\set{v\in\mathring{\spc{U}}}{|v|\le1\ \t{and}\ \<v,\imath(a^i)\>}.$$
Note that $B_i$ are convex sets in $\mathring{\spc{U}}$,
thus one can apply the same argument as above to the function 
$$f(x)=\min_i\{\dist{B_i}{x}{}\}.$$


First let us show that 
$$\Web\dist{\bm{a}}{}{}\not\subset \bigcup_i\cBall[a^i,r^i].
\eqlbl{eq:web-notin-balls}$$
To do this, set $f^i=\md\kappa\dist{a^i}{}{}-\md\kappa r^i$ 
and consider function $f=\min_i f^i$.
We will show that function $f$ has unique minimum point say $p$
and  $p\not\in \cBall[a^i,r^i]$ for any $i$;
clearly $p\in \Web\dist{\bm{a}}{}{}$ hence \ref{eq:web-notin-balls}.

Let $z\in\spc{U}$ be a point such that
$\dist{z}{a^i}{}<\tfrac{\varpi\kappa}2$ for each $i$.
In clearly  $f''+\kappa\cdot f\le 1$ in
$\cBall[z,\tfrac{\varpi\kappa}2]$.


\parit{(\ref{SHORT.lem:nondeg-test-with-balls:inweb}).} 
From the definition of web (???), 
we have that 
$$\Web\dist{\bm{a}^{\without j}}{}{}\subset\bigcup_{i\not=j}\cBall[a^i,r^i].$$
On the other hand, the point $p$ which is constructed in (\ref{SHORT.lem:nondeg-test-with-balls:min-point}) belongs to $\Web\dist{\bm{a}}{}{}$;
hence the result.













\begin{subthm}{lem:nondeg-test-with-balls:min-point}
There is unique point $p\in \spc{U}$
which minimize the function 
$$f(x)=\max_i\{\dist{\cBall[a^i,r^i]}{x}{}\}.$$
Moreover, the point $p$ does not lie in any $\cBall[a^i,r^i]$ for any $i$.
\end{subthm}

\begin{subthm}{lem:nondeg-test-with-balls:inweb}
 $\InWeb\dist{\bm{a}}{}{}$ is not empty.
\end{subthm}













Assume a $\cCat{}{\kappa}$ space $\spc{U}$ 
has linear dimension $= m$.
Then according to theorem ??? 
any $\kay$-dimensional $\kappa$-baricentric simplex in $\spc{U}$ is degenerate for all $\kay>m$;
In other words,
for any $\kappa$-baricentric simplex $\spx{\imath(\bm{a})}\mc\kappa\to\spc{U}$
we have 
$$
\spx{\imath(\bm{a})}\mc\kappa(\Delta)=\spx{\imath(\bm{a})}\mc\kappa(\Delta_m),
\eqlbl{eq:dim-web}$$
where $\Delta_m$ demotes $m$-skeleton of $\Delta$. 

\parit{Proof.}
Without loss of generality we can assume that $i=0$.

Consider projection
$$\proj\:\RR^{\kay+1}\to\RR^\kay\:(x^0,x^1,\dots,x^\kay)\mapsto (x^1,\dots,x^\kay);$$
so $\bm{f}^{\without 0}=\proj\circ\bm{f}$.

Note that $\proj|_{\Min\bm{f}(\spc{X})}$ is injective and continuous.
According to Theorem~\ref{thm:bary-gen} $\Min\bm{f}(\spc{X})=\bm{f}(\Web\bm{f})$ is compact.
Hence $\proj|_{\Min\bm{f}(\spc{X})}$ is an embedding.

Assume $p\in \Web\bm{f}$ and 
$\Pi$ be a supporting hyperplane of $\Up\bm{f}(\spc{X})$ at $\bm{f}(p)$.
Note that if $\Pi$ is perpendicular to a coordinate hyperplane in $\RR^{\kay+1}$,
then $p\in \Web \bm{g}$ for some proper subarray $\bm{g}$ of $\bm{f}$.
I.e. if $p\in \InWeb\bm{f}$ then $\Pi$ can not be perpendicular to any coordinate hyperplane.
It follows that $\proj|_{\Min\bm{f}(\spc{X})}$ is locally bi-Lipschitz.

Applying Theorem~\ref{thm:web}, 
we get that $\bm{f}^{\without 0}=\proj\circ\bm{f}$ 
induces an open $C^{\frac12}$-embedding on $\InWeb \bm{f}$.
\qeds


\begin{thm}{Definition}
Let $\kappa\in\RR$ and $\spc{U}\in\cCat{}{\kappa}$.
A point array $\bm{a}=(a^0,a^1,\dots,a^\kay)$ in $\spc{U}$ is said to be 
\emph{nondegenerate (or $\kappa$-nondegenerate)}\index{nondegenerate} 
if $\rad\bm{a}\z<\tfrac{\varpi\kappa}{2}$
and
$\InWeb\bm{a}\not=\emptyset$. 
\end{thm}



Here is the main result of this section.
Recal that \emph{web embedding} is defined in \ref{prop-def:web-embedding}.











Let $\spc{U}\in\cCat{}{\kappa}$
and $\bm{a}\z=(a^0,a^1,\dots,a^\kay)$ be a point array in $\spc{U}$ of radius $<\tfrac{\varpi\kappa}{2}$. 
Then 
$\dist{\bm{a}^{\without 0}}{}{}=(\dist{a^1}{}{},\dots,\dist{a^\kay}{}{})$ 
induces an open $C^{\frac12}$-embedding 
$\InWeb\dist{\bm{a}}{}{}\hookrightarrow\RR^{\kay}$.

The inverse $\map\:\RR^{\kay}\subto \spc{U}$ 
of the restriction $\dist{\bm{a}^{\without 0}}{}{}|_{\InWeb\bm{f}}$ 
is called 
\emph{$\dist{\bm{a}}{}{}$-web embedding}\index{web embedding} 
with \emph{strutt}\index{strutt} $\dist{a^0}{}{}$.

Moreover the subfunction $\dist{a^0}{}{}\circ\map$ is a semiconvex and locally Lipschitz.
\end{thm}

\begin{thm}{Proposition-Definition}\label{prop-def:web-embedding}
Let $\spc{X}$ be a complete geodesic space 
and $\bm{f}\z=(f^0,f^1,\dots,f^\kay)\:\spc{X}\to\RR^{\kay+1}$ 
be an array of strongly convex and locally Lipschitz functions.
Then 
$\bm{f}^{\without 0}=(f^1,\dots,f^\kay)$ induces an open $C^{\frac12}$-embedding 
$\InWeb\bm{f}\hookrightarrow\RR^{\kay}$;
the inverse $\map\:\RR^{\kay}\subto \spc{X}$ of the restriction $\bm{f}^{\without 0}|_{\InWeb\bm{f}}$ 
is called 
\emph{$\bm{f}$-web embedding}\index{web embedding} 
with strutt $f^0$.

Moreover the subfunction $f^0\circ\map$ is a strongly convex and locally Lipschitz.
\end{thm}
















\begin{thm}{Theorem}\label{thm:loc-lip-inverse}
Let $\spc{U}\in\cCat{}{\kappa}$,
and $\bm{a}=(a^0,a^1,\dots a^\kay)$ be a nondegenerate point array.
Then the $\dist{\bm{a}}{}{}$-web embedding $\map\:\RR^\kay\subto\spc{U}$ with strutt $\dist{a^0}{}{}$ is defined and the subfunction $f=(\dist{a^0}{}{})\circ\map$ is a convex and locally Lipschitz.

Moreover, if for any point $b\in\spc{U}$ 
the point array $b,a^0,a^1,\dots,a^\kay$ is degenerate, then  

\begin{subthm}{thm:loc-lip-inverse:loc-lip-inverse}
The submap $\map$  is locally bi-Lipshitz.
In particular, accoding to Rademacher's thoerem (\ref{thm:rademacher}),  
$\map$ and $f=(\dist{a^0}{}{})\circ\map$ are differentiable at almost all $\bm{x}\in\Dom\map$.
\end{subthm}

\begin{subthm}{thm:loc-lip-inverse:almost=1}
If both $\map$ and $(\dist{a^0}{}{})\circ\map$
are
differentiable
at all $\bm{x}\in \Dom\map$
then
$$
\frac{\dist{\map(\bm{y})}{\map(\bm{z})}{}}{|\d_{\bm{x}}(\bm{y}-\bm{z})|}
\to 1
$$
as $\bm{y}$, $\bm{z}\to \bm{x}$.
\end{subthm}
\end{thm}













\begin{thm}
{Corollary}
Let $\spc{U}\in\cCat{}{\kappa}$,
and $\bm{a}=(a^0,a^1,\dots a^\kay)$ be a nondegenerate point array
such that for any $b\in \spc{U}$ the  point array
$(b,a^0,a^1,\dots a^\kay)$ is degenerate.

Then for any $p\in\InWeb\dist{\bm{a}}{}{}$
there is $\eps>0$ such that
for any $b\in \oBall(p,\eps)$,
there the set 
$$Z=\set{z\in \spc{U}}{\dist{a^i}{z}{}\le\dist{a^i}{b}{} \ \ \t{for each}\ \ i}$$
has diameter at most $\dist{(\Web\dist{\bm{a}}{}{})}{b}{}/\eps$.

\end{thm}









Finally, let us show that $\Web\bm{f}$ is a compact set.
Since $\map$ is continuous, by \ref{eq:Web=Im}, it is sufficient to show that
there is a retruction $r\:\RR^{\kay+1}\to K$ to a compact set $K\subset \RR^{\kay+1}$
such that $\map=\map\circ r$.

For $n\le \kay$ set $\bm{f}_n=(f^0,f^1,\dots,f^n)$;
denote by $\map_n$ the corresponding map $\RR^{n+1}\to\spc{X}$.
We will use induction by $n$ to show that there are comact sets $K_n$ such that $\map_n(K_n)=\Web\bm{f}_n$;
so we can take $K=K_\kay$.
\parit{Base:} $n=0$ is trivial.
\parit{Step:} Assume $\map_{n-1}(K_{n-1})=\Web\bm{f}_{n-1}$ for a compact set $K_{n-1}\subset \RR^{n}$.
In this case $\Web\bm{f}_{n-1}$ is compact and we can choose  $\lam\in\RR$, 
such that for each $i<n$ we have
\begin{itemize}
\item $f^n(x)-\lam < f^i(x)$ for any $x\in \Web\bm{f}_n$ and
\item $f^n(z)+\lam > f^i(z)$ where $z$ is the minimum point of $f^n$.
\item $K_{n-1} \subset \cBall[\bm{0},\lam]$
\end{itemize}
Clearly $\Web\bm{f}_n=\map_n(K_{n-1}\times \RR)$.
Then one can take 
$K_n
=
K_{n-1}\times [-10\cdot\lam,10\cdot\lam])
\in 
\RR^{\kay+1}$.









Given an array $\bm{f}\z=(f^0,f^1,\dots,f^\kay)$,
we denote by $\bm{f}^{\smallsetminus i}$ the array $\bm{f}$ without $f^i$;
i.e., $\bm{f}^{\smallsetminus i}=(f^0,\dots,f^{i-1},f^{i+1},\dots,f^\kay)$.

\begin{thm}{???Corollary}
Let $\spc{X}$ be a complete geodesic space.
An array of strongly convex and locally Lipschitz functions 
$\bm{f}\z=(f^0,f^1,\dots,f^\kay)\:\spc{X}\to\RR^{\kay+1}$ 
is nondegenerate if and only if there is a point
$p\in \Web\bm{f}^{\smallsetminus 0}\backslash \bigcup_{i>0}\Web\bm{f}^{\smallsetminus i}$
\end{thm}
 










\begin{thm}{Definition}\label{def:crucify}
Let $\spc{U}\in\cCat{}{\kappa}$
and for $p,a^0,a^1,\dots,a^\kay\in\spc{U}$ we have
$\dist{p}{a^i}{}<\varpi\kappa$.
We say that a point array $\bm{a}=(a^0,a^1,\dots,a^\kay)$
\emph{crucifies}\index{crucifies} 
$p$ if 
$\mangle\hinge p{a^i}{a^j}>\tfrac\pi2$ and
 for any $x\in\spc{U}$, the inequality
$
\mangle\hinge p x {a^i}
\ge \frac\pi2,
$
holds for at least one value of $i$.
\end{thm} 

The above definition can be reformulated entirely in terms of the space of directions $\Sigma_p$ and the geodesic directions $\alpha^i=\dir p{a^i}$: 
for any $\xi\in\Sigma_p$ 
the inequality $\mangle(\xi,\zeta^i)\ge\tfrac\pi2$ holds for at least one $i$
and $\mangle(\alpha^i,\alpha^j)>\tfrac\pi2$ for all $j\not=i$.












\section{Rough Besikovitch's inequality}


\begin{thm}{Rough Besikovitch's inequality}\label{lem:besikovitch}
Let  $\map$ be a continuous map of unit $m$-cube $[0,1]^m$ to a metric space $\spc{X}$.
Assume for any two opposite faces $A^i$ and $B^i$ of $[0,1]^m$,
we have $\dist{\map(A^i)}{\map(B^i)}{}\ge a$.
Then 
$$\HausMes_m\map([0,1]^m)\ge \vol_m\ModBall^m(\tfrac{a}{2}).$$

\end{thm}

The proof uses the same idea as in
the proof of classical Besikovitch's inequality;
see for example \cite[5.6.9]{BBI}.

\parit{Proof.}
Without loss of generality we can assume that $a=1$.

For each $i$,
define a function $f^i\: \spc{X}\to [0,1]$ 
as $f^i(x) = \min\{1, \dist{\map(A^i)}{x}{}\}$.
Further, define $\bm{f}\:\spc{X}\to[0,1]^m$
as
$\bm{f}(x) = (f^1(x),\dots, f^m(x))$. 

The functions $f^i$ are nonexpanding;
therefore $\bm{f}\:\spc{X}\to ([0,1]^m,\|{*}\|_\subinfty)$ is short.

Clearly
$\bm{f}\circ\map(A_i)\subset A_i$ for each $i$.
Since $\dist{\map(A^i)}{\map(B^i)}{}\ge 1$,
we also have that  $\bm{f}\circ\map(B_i)\subset B_i$ for each $i$. 
It follows that $\bm{f}\circ\map\:[0,1]^m\to [0,1]^m$ is a degree one map.
Thus the restriction of $\bm{f}$ to $\map([0,1]^m)$ is surjective.
Hence 
$$\HausMes_m\map([0,1]^m)\ge \HausMes_m([0,1]^m,\|{*}\|_\subinfty)=\vol_m\ModBall^m(\tfrac12).$$
\qedsf






\begin{thm}{Besikovitch's inequality}
Prove the following stronger analog of Rough Besikovitch's inequality (\ref{lem:besikovitch}).
Lat $\spc{X}$ be a $\cCat{}{}$ or $\CBB{}{}$ space and $\map\:[0,1]^n\to\spc{X}$ be a continuous map.
Assume that for any pair of opposite faces $A^i$, $B^i$ of the cube $[0,1]^n$, 
we have $\dist{\map(A^i)}{\map(B^i)}{\spc{X}}\ge 1$.
Show that $\HausMes_n\Im\map\ge 1$.
\end{thm}






\parit{(\ref{SHORT.LinDim-CBA})$\Rightarrow$(\ref{SHORT.thm:dim-infty-CBA:bary}).}
Without loss of generality, we can assume that $\kappa=1$.

Let us choose sufficiently fine triangulation $\triangulation$ of unit $m$-cube $[0,1]^m$,
say daimeter of each simplex is at most $\tfrac1{10}$.
Denote by $\{v^1,v^2,\dots,v^\kay\}$ the set of its vertexes.

Note that we can find arbitrary small $\delta>0$ ($\delta<1$ will do)
and  a finite set $\{w^1,w^2,\dots,w^\kay\}$ in $\spc{U}$,
such that 
$$|\tfrac{1}{\delta}\cdot\dist{w^i}{w^j}{\spc{U}}
-\dist{v^i}{v^j}{[0,1]^m}|
<
\tfrac1{10}.
\eqlbl{eq:delta/10}$$ 
Indeed, choose $p\in \spc{U}$ such that $\T_p$ contains a subcone which isometric to the Euclidean $m$-space, so there is an isometry $\imath\:[0,1]^m\to \T_p$.
For each $i$,
choose a geodesic $\gamma^i$ which starts at $p$ 
and $\dist{(\gamma^i)^+(0)}{\imath(v^i)}{}<\tfrac1{10}$.
Clearly
$$\dist{\gamma^i(\delta)}{\gamma^j(\delta)}{\spc{U}}
=
\delta\cdot\dist[{{}}]{(\gamma^i)^+(0)}{(\gamma^j)^+(0)}{\T_p}+o(\delta).$$
We obtain \ref{eq:delta/10} by taking $w^i=\gamma^i(\delta)$.

From Lemma~\ref{lem:bary-cat},
we can extend the map $v^i\mapsto w^i$ to a map $\map\:[0,1]^m\to \spc{U}$ which is barycentric on each simplex of $\triangulation$.
From the same lemma, we get that $\diam\map(\Delta)<\tfrac15\cdot\delta$ for any simplex $\Delta$ of $\triangulation$.

It follows that for any pair $A^i$ and $B^i$ of opposite faces of $[0,1]^m$,
we have $\dist{\map(A^i)}{\map(B^i)}{}>\tfrac35\cdot\delta$.
According to Rough Besikovitch's inequality (\ref{lem:besikovitch}),
there is an $m$-simplex $\Delta^m$ in $\triangulation$ such that $\HausMes_m\map(\Delta^m)>0$.
Let $(a^0,a^1,\dots,a^m)$ be the vertexes of $\Delta^m$.
Then according to ???,  $\InWeb(\map(a^0),\map(a^1),\dots,\map(a^m))\not=\emptyset$.
Finally, according to ???, the conditon in (\ref{SHORT.thm:dim-infty-CBA:bary}) holds for any $p\in \InWeb(\map(a^0),\map(a^1),\dots,\map(a^m))\not=\emptyset$.

\parbf{Remark for AKP.}??? The configuration in (\ref{SHORT.thm:dim-infty-CBA:bary}) can be constructed directly.
Start with such configuration in the euclidean subspace of a tangent space;
take good approxiamtions of $a^0$ in $\spc{U}$ and take the point $p$ which minimize say maximum of distances to the end-points. 
But somehow I can not write it nicely???













ALTERNATIVE \parit{(\ref{SHORT.LinDim-CBA})$\Rightarrow$(\ref{SHORT.thm:dim-infty-CBA:bary}).}
Let $v^0,v^1,\dots v^m$ be vetrexes of regular $m$-simplex and $o$ be its center.
Set $\theta_m=\mangle\hinge o{v^0}{v^1}$; so $\cos\theta_m=-\tfrac1m$.

Choose $p\in \spc{U}$ such that $\T_p$ contains a subcone $E$ which isometric to the Euclidean $m$-space.
Given $\delta>0$, one can find two arrays of points $a^0,a^1,\dots a^m$ and $b^0,b^1,\dots,b^m$
such that 
$|\mangle\hinge{p}{a^i}{a^j}-\alpha_m|<\delta$,
$|\mangle\hinge{p}{b^i}{a^j}-\pi+\alpha_m|<\delta$,
for all $i\not=j$.

Fix sufficiently small $\eps>0$ and set 
$\bar a^i=\geod_{[pa^i]}(\eps)$ 
and 
$\bar b^i=\geod_{[pb^i]}(\tfrac\eps m)$.

Let $\bar p$ be the minimum point of $\max_i\dist{\bar a^i}{}{}$.
Note that 

Choose $p\in \spc{U}$ such that $\T_p$ contains a subcone $E$ which isometric to the Euclidean $m$-space.
Let us choose in $E$ a basis $v^1,\dots,v^m$ and set $v^0=-v^1-v^2-\dots-v^m$.
Clearly $(v^0,v^1,\dots,v^m)$ crucifies $o$ --- the origin og $E$.
Set $w^i=-\tfrac1m{\cdot}v_i$, so $w_i$ are the centroids of the faces of $m$-simplex with vertexes $v^i$ in $E$.

Choose geodesic vectors $\acute{v}^i\approx v^i$ and $\acute{w}^i\approx w^i$, 
say $\dist{\acute{v}^i}{v^i}{}$, $\dist{\acute{w}^i}{w^i}{}<\delta$ for sufficiently small $\delta>0$.
For small enough $\eps>0$,
set $a^i_\eps=\exp_p(\eps{cdot}v^i)$ and $b^i_\eps=\exp(\eps{\cdot}w^i)$.
Let $p_\eps$ be the point the minimum point of $\max_i\dist[2]{a^i}{}{}$;
the existance and uniqueness of $p_\eps$ for all small $\eps>0$ follows from ???.




Fix sufficiently small $\delta>0$.
and choose geodesics  $\alpha^0,\alpha^1,\dots \alpha^m$ and $\beta^0,\beta^1,\dots \beta^m$ starting at $p$,
such that 
$\dist{\log{p}{(\alpha^i)^+(0)}}{v^i}{\T_p}<\delta$
and $\dist{\log{p}{(\beta^i)^+(0)}}{w^i}{\T_p}<\delta$.

For small enough $\eps$, set 
$a^i=\alpha^i(\eps)$ and $b^i=\beta^i(\eps)$.

Given $r<\min_i\dist p{a^i}{}$, set 
$\bar a^i_r=\geod_{[pa^i]}(r)$.


For origin $o\in E$ choose a crucifying array $(v^0,v^1,\dots,v^m)$ in $E$;
we may assume that $|v^i|=1$ for each $i$.
For each $i$,
choose a unitspeed geodesic $\gamma^i$ which starts at $p$ 
and $(\gamma^i)^+(0)\approx v^i$.
Clearly
$$
\dist{\gamma^i(\delta)}{\gamma^j(\delta)}{\spc{U}}
=
\delta\cdot\dist[{{}}]{(\gamma^i)^+(0)}{(\gamma^j)^+(0)}{\T_p}+o(\delta).
$$
Fix sufficiently small $\delta$ and set $a^i_\delta=\gamma^i(\delta)$.
Let $p_\delta$ be the minimum point of $\max_i\dist{a_i}{}{}$;
existance and uniqueness of $p_\delta$ follows from???.

Let us show that $p_\delta$ is crucified by $a^i_\delta$ for all sufficiently small $\delta>0$;
Clearly ...;
i.e. we only need to show only that 













\section{???CBA spaces with linear dimension $=m$}

The following theorem is an extension of Lemma~\ref{lem:bary-cat}.
The proof is mirror-symmetirc to the proof of Theorem~\ref{thm:inverse-function}.

\begin{thm}{Theorem}
Let $\spc{U}\in\cCat{}{\kappa}$,
$\rad\spc{U}<\varpi\kappa/2$
and $\mathfrak{S}\not=\emptyset$ is a Kleiner spine
with vertexes at $a^0,a^1,\dots,a^m\in \spc{U}$.
Assume there is an open set $\Omega$
such that for any $b\in \Omega$ the baricentric simplex with vertexes $b,a^0,\dots,a^m$ is degenerate.
Then the map $F_0\:\mathfrak{S}\to\RR^m$ defined as  $F_0(z)=(\dist{a^1}{z}{},\dots,\dist{a^m}{z}{})$
is locally bi-Lipschitz in $\mathfrak{S}\cap\Omega$.

In particular, if all baricentric $(m+1)$-simplexes are degenerous then $F_0$ is locally bi-Lipshitz.
\end{thm}

To prove the above theorem we will need the following lemma:

\begin{thm}{Lemma}\label{lem:nondeg-bs-test}
Let $\spc{U}\in\cCat{}{\kappa}$,
$\rad\spc{U}<\varpi\kappa/2$
and $\mathfrak{S}\not=\emptyset$ is a Kleiner spine
with vertexes at $a^0,a^1,\dots,a^m\in \spc{U}$.

Then for any $x\in \mathfrak{S}$,
there is $\eps>0$ such that for some $x'\in \mathfrak{S}$ and $b\in\spc{U}$
we have 
$\dist{x}{b}{}, \dist{x}{x'}{}<\eps$ 
and $\mangle\hinge{x'}{b}{a^i}<\tfrac\pi2+\eps$ 
holds for each $i$
then the array $b,a^0,a^1,\dots,a^m$ is nondegenerate.
\end{thm}


\begin{thm}{Theorem}
Let $\spc{U}\in\cCat{}{\kappa}$,
$\rad\spc{U}<\varpi\kappa/2$
and $\mathfrak{S}\not=\emptyset$ is a Kleiner spine
with vertexes at $a^0,a^1,\dots,a^m\in \spc{U}$.
Assume that the map $F_0\:\mathfrak{S}\to\RR^m$ defined as  $F_0(z)=(\dist{a^1}{z}{},\dots,\dist{a^m}{z}{})$
is locally bi-Lipshitz in a relatively open set $\Omega\subset \mathfrak{S}$.
Then for almost all $x\in \Omega$,
there is a Euclidean norm $\|{*}\|$ on $\RR^m$ 
such that 
$$\frac{\dist{y_n}{z_n}{}}{\|F_0(y_n)-F_0(z_n)\|}\to 1$$
as $y_n,z_n\to x$.
\end{thm}




\begin{thm}{Theorem}\label{thm:nondeg-cba}
Let $\spc{U}\in\cCat{}{\kappa}$, 
$\LinDim\spc{U}=m$,
$s\:\Delta^m\to\spc{U}$ be nondegenerate $\kappa$-barycentric simplex
with vertexes at $b,a^1,\dots a^m$.
Set $\mathfrak{S}=s(\Delta^m)\backslash s(\partial\Delta^m)$
(that is the Kliener's spine of $s$)
and $\dist{\bm{a}}{}{}\:\spc{U}\to\RR^m$ for the distance map 
$x\mapsto \dist{\bm{a}}{x}{}=(\dist{a_1}{x}{},\dist{a_2}{x}{},\dots,\dist{a_m}{x}{})$.

Then 
\begin{subthm}{thm:nondeg-cba:loc-lip}
The restriction $F=\dist{\bm{a}}{x}{}|_{\mathfrak{S}}$ has an inverse 
$\map\:\RR^m\subto\mathfrak{S}$ which is locally Lipschitz.
\end{subthm}

\begin{subthm}{thm:nondeg-cba:1+-eps}
For almost all $\bm{x}\in \Dom\map$,
there is a Euclidean norm $\|{*}\|$ on $\RR^m$ 
such that 
$$\frac{\dist{F(\bm{y}_n)}{F(\bm{z}_n)}{}}{\|\bm{y}_1-\bm{y}_0\|}\to 1$$
as $\bm{y}_n,\bm{z}_n\to\bm{x}$.
\end{subthm}
\end{thm}

It follows that for the finite-dimensional case, 
the embedding in the Theorem~\ref{thm:dim-infty-CBA} can be made Lipschitz,
instead of H\"older.
Namely:

\begin{thm}{Corollary}\label{cor:dim-finite-CBA}
If $\spc{U}\in\cCat{}{\kappa}$ and  $\LinDim\spc{U}=m$
then for any $\eps>0$ 
there is $[1\mp\eps]$-bi-Lipschitz embedding 
of an open domanin of $\EE^m$ 
into $\spc{U}$.
\end{thm}

\parit{Proof.}
According to Lemma~\ref{lem:bary-cat},
there is a nondegenerate $\kappa$-barycentric simplex $s\:\Delta^m\to \spc{U}$.
Applying Theorem~\ref{thm:nondeg-cba},
we get the result.
\qeds




\parit{Proof.}
Let us denote by $s\:\Delta^m\to \spc{U}$ and $S\:\Delta^{m+1}\to \spc{U}$ the barycentric simplex with vertexes $a^0,a^1,\dots a^m$ and 
$b,a^0,a^1,\dots a^m$.
According to Lemma~\ref{lem:bary-cat} both $s$ and $S$ are defined.
Cleary $s$ is restriction of $S$ to one face.

Note that conditions \ref{lem:nondeg-cba:in-bary-simplex} and \ref{lem:nondeg-cba:not-in-bry} 
imply that $p\in \mathfrak{S}=s(\Delta^m)\backslash s(\partial\Delta^m)$.
Indeed the condition \ref{lem:nondeg-cba:in-bary-simplex} imply that $p\in s(\Delta^m)$ 
while the condition \ref{lem:nondeg-cba:not-in-bry} imply that $p\not\in s(\partial\Delta^m)$.
\qeds
















Fix arbitrary $\eps>0$.
$$\mangle\hinge{x_n}{a^i}{y_n}<\tfrac\pi2+\eps
\ \ 
\t{and}
\ \  
\mangle\hinge{y_n}{a^i}{x_n}<\tfrac\pi2+\eps
\eqlbl{eq:<pi/2+eps-for-a's}$$
for all large $n$.
Further, from ??? comparison
$$\mangle\hinge{x_n}{b}{y_n}+\mangle\hinge{y_n}{b}{x_n}<\pi+\eps
\eqlbl{eq:<pi/2+eps-for-b}$$
for all large $n$.

Since $\LinDim\spc{U}=m$,
all $(m+1)$-dimensional barycentric simplexes in $\spc{U}$ are degenerate (see ???).
The later contradicts \ref{eq:<pi/2+eps-for-a's}, \ref{eq:<pi/2+eps-for-b} and Lemma~\ref{lem:nondeg-bs-test}.









Now assume that for some $x\in K$ and $y\in \spc{U}$ we have 
$$\mangle\hinge x{a_i}y<\tfrac\pi2+\eps\eqlbl{eq:<pi/2+eps}$$
We may assume that distance $\dist{x}{y}{}$ is sufficiently small.
In particular, $\dist{y}{a_i}{}<\tfrac\pi{10}$ for all $i$.
Thus, according to Lemma~???,
the barycentric simplex $\check s\:\Delta^{m+1}\to\spc{U}$ 
with vertexes $y$, $a_0$, $a_1,\dots,a_m$ is defined.
Denote by $A_i$ the face of $\Delta^{m+1}$ opposite from $a_i$.










\begin{thm}{Proposition}\label{prop:in-bary-cba}
Let $\spc{U}\in\cCat{}{\kappa}$,
and $s\:\Delta^m\to \spc{U}$ be a barycentric simplex
with vertexes at $a^0,a^1,\dots,a^m$.
Then $p\in s(\Delta^m)$ if an only if 
for any $q\in \spc{U}$ the inequality
$$\mangle\hinge{p}{q}{a^i}\ge\tfrac\pi2$$
holds for at least one $i$.
\end{thm}

\parit{Proof.}
Follows immidetely from ??? and ??? comparisson (???).
\qeds







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Barycentric simplex}\label{sec:barycentric}



The barycentric simplex was introduced in \cite{kleiner};
it is a construction which works in a general metric space.
Roughly, it gives a $\kay$-\nospace dimensional submanifold for a given ``nondegenerate'' array of $\kay+1$ strongly convex functions.

Let us denote by $\Delta^\kay\subset \RR^{\kay+1}$\index{$\Delta^m$} 
the \emph{standard $\kay$-simplex}\index{standard simplex}; 
i.e. $\bm{x}=(x_0,x_1,\dots,x_n)\in\Delta^\kay$ if $\sum_{i=0}^\kay x_i=1$ and $x_i\ge0$ for all $i$.

Let $\spc{X}$ be a metric space 
and $\bm{f}=(f^0,f^1,\dots,f^\kay)\:\spc{X}\to \RR^{\kay+1}$ be a function array.
Consider the map $\spx{\bm{f}}\:\Delta^\kay\to \spc{X}$,\index{$\spx{\bm{f}}$} defined by 
$$\spx{\bm{f}}(\bm{x})=\argmin\sum_{i=0}^\kay x_i\cdot f^i,$$
where $\argmin f$\index{$\argmin$} denotes a point of minimum of $f$.
The map $\spx{\bm{f}}$ will be called a \emph{barycentric simplex}\index{barycentric simplex of function array} of $\bm{f}$.
In general, a barycentric simplex of function array might be undefined and need not be unique. 

It is clear from the  definition, that if 
$\bm{\hat f}$ is a subarray of $\bm{f}$
then $\spx{\bm{\hat f}}$ coincides with the restriction of $\spx{\bm{f}}$ to the corresponding face of $\Delta^\kay$.

The following theorem shows that the barycentric simplex is defined 
for an array of strongly convex functions on a complete geodesic space. 
In order to formulate it, we need to introduce a partial order $\succcurlyeq$ on $\RR^{\kay+1}$.

\begin{thm}{Definition}\label{def:supset+succcurlyeq}
For two real arrays $\bm{v}$, $\bm{w}\in \RR^{\kay+1}$,
$\bm{v}=(v^0,v^1,\dots,v^\kay)$ 
and 
$\bm{w}=(w^0,w^1,\dots,w^\kay)$, 
we will write
$\bm{v}\succcurlyeq\bm{w}$ if $v^i\ge w^i$ for each $i$.

Given a subset $Q\subset \RR^{\kay+1}$, define its \emph{superset}\index{superset}
\index{$\SupSet$}
$$\SupSet Q =\{\bm{v}\in\RR^{\kay+1}\mid\exists\, \bm{w}\in Q\ \t{such that}\ \bm{v}\succcurlyeq\bm{w}\}.$$

\end{thm}


\begin{thm}{Theorem on barycentric simplex}\label{thm:bary}
Assume $\spc{X}$ is a complete geodesic space and 
$\bm{f}\z=(f^0,f^1,\dots,f^\kay)\:\spc{X}\to\RR^\kay$ is an array of strongly convex and locally Lipschitz functions.

Then the barycentric simplex $\spx{\bm{f}}\:\Delta^\kay\to \spc{X}$
is uniquely defined and moreover:

\begin{subthm}{bary-Lip} $\spx{\bm{f}}$ is Lipschitz. %The Lipshitz constant of $\spx{\bm{f}}$ is %???we will need the constant
\end{subthm}

\begin{subthm}{bary-iff} The set $\SupSet{\bm{f}(\spc{X})}\subset\RR^{\kay+1}$ is convex,
and
$p\in \spx{\bm{f}}(\Delta^\kay)$ if and only if
$\bm{f}(p)\in\Fr\l[\SupSet{\bm{f}(\spc{X})}\r]$.
In particular, $\bm{f}\circ\spx{\bm{f}}(\Delta^\kay)$ lies on a convex hypersurface in $\RR^{\kay+1}$.
\end{subthm}

\begin{subthm}{bary-embed} The restriction $\bm{f}|_{\spx{\bm{f}}(\Delta^\kay)}$  has  $C^{\frac{1}{2}}$-inverse.
\end{subthm}

\begin{subthm}{bary-R^n} 
The set $\Web=\spx{\bm{f}}(\Delta^\kay)\backslash\spx{\bm{f}}(\partial\Delta^\kay)$
is $C^{\frac{1}{2}}$-homeomorphic to an open domain in $\RR^\kay$.
\end{subthm}
\end{thm}

The set $\Web$ described above will be called \emph{Kleiner's web}\index{Kleiner's web} of $\bm{f}$.
If $\Web$ is nonempty, we say the barycentric simplex $\spx{\bm{f}}$ is \emph{nondegenerate}\index{nondegenerate}.

We precede the proof of the theorem with the following lemma.

\begin{thm}{Lemma}\label{lem:argmin(convex)}
Assume $\spc{X}$ is a complete geodesic metric space and let  $f\:\spc{X}\to\RR$ be a locally Lipschitz, strongly convex function.  Then the minimum point 
$p=\argmin f$ 
is uniquely defined.
\end{thm}

\parit{Proof.}
Assume that $x$ and $y$ are distinct minimum points of $f$. 
Then for the midpoint $z$ of a geodesic $[x y]$ we have
$$f(z)<f(x)=f(y),$$ 
a contradiction. 
It only remains to show existence.

Fix a point $p\in  \spc{X}$; 
let $\Lip\in\RR$ be a Lipschitz constant of $f$ in a neighborhood of $p$.
Without loss of generality, we can assume that $f$ is $1$-convex.
Consider function $\phi(t)=f\circ\geod_{[px]}(t)$.
Clearly $\phi$ is $1$-convex and $\phi^+(0)\ge -\Lip$.
Setting $\ell=\dist{p}{x}{}$, we get 
\begin{align*}
f(x)
&=
\phi(\ell)
\ge
\\
&\ge
f(p)-\Lip\cdot\ell+\tfrac{1}{2}\cdot\ell^2
\ge
\\
&\ge f(p)-\tfrac{1}{2}\cdot{\Lip^2}.
\end{align*}

In particular,
$$s
\df
\inf\set{f(x)}{x\in \spc{X}}
\ge
f(p)-\tfrac{1}{2}\cdot{\Lip^2}.$$
If $z$ is a midpoint of $[x y]$ then  
$$s\le f(z)
\le
\tfrac{1}{2}\cdot f(x)+\tfrac{1}{2}\cdot f(y)-\tfrac{1}{8}\cdot\dist[2]{x}{y}{}.
\eqlbl{midpoint}$$
Choose a sequence of points $p_n\in \spc{X}$  such that $f(p_n)\to s$.
Applying \ref{midpoint}, for $x\z=p_n$, $y\z=p_m$, we get that $(p_n)$ is a Cauchy sequence. 
Clearly, $p_n\to \argmin f$.
\qeds


 

\parit{Proof of theorem \ref{thm:bary}.}
Without loss of generality, we can assume that each $f^i$ is $1$-convex.
Thus, for any $\bm{x}\in\Delta^\kay$, 
the convex combination $\sum x_i\cdot f^i\:\spc{X}\to\RR$ is also $1$-convex.
Therefore, according to Lemma~\ref{lem:argmin(convex)}, $\spx{\bm{f}}(\bm{x})$ is defined.



\parit{(\ref{SHORT.bary-Lip}).} 
Since $\Delta^\kay$ is compact, it is sufficient to show that $\spx{\bm{f}}$ is locally Lipschitz.

For $\bm{x},\bm{y}\in\Delta^\kay$,
set 
\begin{align*}
f_{\bm{x}}
&=\sum x_i\cdot f^i,
&
f_{\bm{y}}
&=\sum y_i\cdot f^i,
\\
p
&=\spx{\bm{f}}(\bm{x}),
&
q
&=\spx{\bm{f}}(\bm{y}).
\end{align*}
Let $\ell=\dist[2]{p}{q}{}$.
Note the following:
\begin{itemize}
\item The function $\phi(t)=f_{\bm{x}}\circ\geod_{[p q]}(t)$ has minimum at $0$. 

Therefore $\phi^+(0)\ge 0$
\item The function $\psi(t)=f_{\bm{y}}\circ\geod_{[p q]}(t)$ has minimum at $\ell$. 

Therefore $\psi^-(\ell)\ge 0$.
\end{itemize}
From $1$-convexity of $f_{\bm{y}}$, we have
$\psi^+(0)+\psi^-(\ell)+\ell\le0$.

Let $\Lip$ be a Lipschitz constant for all $f^i$ in a neighborhood $\Omega\ni p$.
Then $\psi^+(0)\le \phi^+(0)+\Lip\cdot\|\bm{x}-\bm{y}\|_{{}_1}$, 
where $\|\bm{x}-\bm{y}\|_{{}_1}=\sum_{i=0}^\kay|x_i-y_i|$.
I.e., given $\bm{x}\in\Delta^\kay$, there is a constant $\Lip$ such that
$$\dist{\spx{\bm{f}}(\bm{x})}{\spx{\bm{f}}(\bm{y})}{}=\ell\le \Lip\cdot\|\bm{x}-\bm{y}\|_{{}_1}$$
for any $\bm{y}\in\Delta^\kay$.
In particular, there is $\eps>0$ such that if $\|\bm{x}-\bm{y}\|_{{}_1},$ $\|\bm{x}-\bm{z}\|_{{}_1} <\eps$ then $\spx{\bm{f}}(\bm{y})$, $\spx{\bm{f}}(\bm{z})\in\Omega$. 
Thus, the same argument as above implies 
$$\dist{\spx{\bm{f}}(\bm{y})}{\spx{\bm{f}}(\bm{z})}{}
=
\ell\le \Lip\cdot\|\bm{y}-\bm{z}\|_{{}_1}$$
for any $\bm{y}$ and $\bm{z}$ sufficiently close to $\bm{x}$;
i.e. $\spx{\bm{f}}$ is locally Lipschitz.

\parit{(\ref{SHORT.bary-iff}).} The ``only if'' part is trivial, let us prove  the ``if''-part.

Note that convexity of $f^i$ implies that
for any two points $p,q\in \spc{X}$ and $t\in[0,1]$ we have
$$(1-t)\cdot\bm{f}(p)+t\cdot \bm{f}(q)
\succcurlyeq
\bm{f}\circ\geodpath_{[p q]}(t).
\eqlbl{n-convex}$$
where $\geodpath_{[p q]}$ is geodesic path form $p$ to $q$; 
i.e. $\geodpath_{[p q]}(t)=\geod_{[p q]}(\tfrac{t}{\dist{p}{q}{}})$. 

From \ref{n-convex}, we have that $\SupSet[\bm{f}(\spc{X})]$ is a convex subset of $\RR^{\kay+1}$.
If $\max_{i}\{f^i(q)\z-f^i(p)\}\ge0$ for any $q\in \spc{X}$ then $\bm{f}(p)$ lies in the boundary of $\SupSet[\bm{f}(\spc{X})]$.
Take a supporting vector $\bm{x}\in\RR^{\kay+1}$ to $\SupSet(\bm{f}(\spc{X}))$ at $\bm{f}(p)$.
Thus $\bm{x}\not=\bm{0}$ and $\sum_i x_i\cdot[w^i-f^i(p)]\ge0$ for any 
$\bm{w}\in \SupSet[\bm{f}(\spc{X})]$. In particular, $\sum_i x_i\cdot v_i \ge 0$ for any $v=(v_1,\ldots, v_k)$ with all $v_i\ge 0$.  Hence $x_i\ge 0$ for all $i$ and 
$\bm{x}'=\frac{\bm{x}}{\|\bm{x}\|}_{{}_1}\in\Delta^\kay$. 
Thus, $p=\spx{\bm{f}}(\bm{x}')$. 

\parit{(\ref{SHORT.bary-embed}).}
The restriction $\bm{f}|_{\spx{\bm{f}}(\Delta^\kay)}$ is Lipschitz.
Thus we only have to show that it has a  $C^{\frac{1}{2}}$-inverse.
Given $\bm{v}\in\RR^{\kay+1}$, consider the function 
$h_{\bm{v}}\: \spc{X}\to \RR$ given by
$$h_{\bm{v}}(p)=\max_{i}\{f^i(p)-v^i\}.$$
Define a map $\map \:\RR^{\kay+1}\to \spc{X}$ by
$\map (\bm{v})=\argmin h_{\bm{v}}$.

Clearly $h_{\bm{v}}$ is $1$-convex.
Thus, according to \ref{lem:argmin(convex)}, $\map (\bm{v})$ is uniquely defined for any $\bm{v}\in\RR^{\kay+1}$.
From (\ref{SHORT.bary-iff}), for any $p\in \spx{\bm{f}}(\Delta^\kay)$ we have
$\map \circ\bm{f}(p)=p$.

It remains to show that $\map $ is $C^{\frac{1}{2}}$-continuous.
Clearly, 
$$|h_{\bm{v}}-h_{\bm{w}}|
\le\|\bm{v}-\bm{w}\|_\subinfty
\df
\max_{i}\{|v^i-w^i|\},$$
for any $\bm{v},\bm{w}\in\RR^{\kay+1}$.
Set $p=\map (\bm{v})$ and $q=\map (\bm{w})$.
Since $h_{\bm{v}}$ and $h_{\bm{w}}$ are 1-convex,
\begin{align*}
h_{\bm{v}}(q)
&\ge 
h_{\bm{v}}(p)+\tfrac{1}{2}\cdot\dist[2]{p}{q}{},
&
h_{\bm{w}}(p)
&\ge 
h_{\bm{w}}(q)+\tfrac{1}{2}\cdot\dist[2]{p}{q}{}.
\end{align*}
Therefore,
$$\dist[2]{p}{q}{}\le 2\cdot\|\bm{v}-\bm{w}\|_\subinfty.$$
Hence the result.


\parit{(\ref{SHORT.bary-R^n}).} 
Let $S=\Fr\SupSet(\bm{f}(\spc{X}))$.
Note that orthogonal projection to the hyperplane $\WW^\kay$ in $\RR^{\kay+1}$ defined by equation $x_0+x_1+\dots+x_n=0$ gives a bi-Lipschits homeomorphism $S\to \WW^\kay$.

Clearly%???
, $\bm{f}({\spx{\bm{f}}(\Delta^\kay)}\backslash\spx{\bm{f}}(\partial\Delta^\kay))$ 
is an open subset of $S$.
Hence the result.
\qeds




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%









\begin{thm}{Lemma}
Let $\spc{X}$ be a complete geodesic space 
and $\bm{f}\z=(f^0,f^1,\dots,f^\kay)\:\spc{X}\to\RR^{\kay+1}$ 
is an array of strongly convex and locally Lipschitz functions.
Then 
$\Web\bm{f}$ is a bounded set.
\end{thm}

\parit{Proof.}
Without loss of generality we may assume that all $f^i$ are $1$-convex.
Fix a point $p\in\spc{X}$;
let $\Lip$ be a Lipshitz constant for all $f^i$ in a neighbohood of $p$.

Each point $z\in \Web\bm{f}$ is a minimum point for a function
$$h_{\bm{v}}(x)=\max_i\{f^i(x)-v^i\}.$$
Clearly $h_{\bm{v}}$ is $\Lip$-Lipschitz in a neigbohood of $p$.

Clearly $h_{\bm{v}}$ is $1$-convex and $h_{\bm{v}}\circ\geod_{[xp]}$ has minimum at $0$ and $\Lip$-Lipschitz in a neigborhood of $\dist{x}{p}{}$.
It follows that $\dist{x}{p}{}\le \Lip$.
\qeds














Further, according to Rademacher's theorem (\ref{thm:rademacher}),
there is a set of full measure $A\subset \Dom\map=\Im F\subset \RR^m$ 
such that for any $\bm{x}\in A$
the  differential $\d_{\bm{x}}\map\:\T_{\bm{x}}\to\T_{\map(\bm{x})}$ is defined and linear
and $v\mapsto|\d_{\bm{x}}\map(v)|^2$ is a quadratic form on $\RR^m$.
Since ???, this quadratic form is not degenerate.
Therefore it defines a Euclidean metric on $\RR^m$.

Choose $\bm{x}\in A\cap S$ and consider $\RR^m$ equiped with this metric;
i.e.,
$$|\bm{y}_0-\bm{y}_1|
\df
|\d_{\bm{x}}(\bm{y}_0-\bm{y}_1)|$$
for any $\bm{y}_0,\bm{y}_1\in \RR^m$.
With this metric the differential $\d_{\bm{x}}\map\:\T_{\bm{x}}\to\T_{\map(\bm{x})}$ is isometric.
In particular, we have 
$$
\dist{\map(\bm{y}_0)}{\map(\bm{y}_1)}{}
=
|\bm{y}_1-\bm{y}_0|+o(|\bm{y}_0-\bm{x}|+|\bm{y}_1-\bm{x}|).
\eqlbl{eq:diff=isom}
$$

It is easy to see that \ref{eq:diff=isom} and \ref{eq:diff=affine} together 
imply that given $\eps$, 
the map $\map$ is $e^{\mp\eps}$-bi-Lipschitz
in a sufficiently small neighborhood of $\bm{x}$.






\begin{thm}{Lemma}
Let $\spc{U}\in\cCat{}{\kappa}$,
$R<\tfrac{\varpi\kappa}{10}$
and $b,a^0,a^1,\dots a^m$ be an array of points in $\spc{U}$ such that
$\dist{b}{a^i}{}\le R$ and $\dist{a^i}{a^j}{}\le R$.
Assume that the baricentric simplex $s$ with vertexes at $a^i$ is defined 
and nondegenerate; 
i.e.,  $\mathfrac{S}=s(\Delta^m)\backslash s(\partial\Delta^m)$ is nonempty.
Then for any point $p\in \mathfrac{S}$ there is $\eps>0$ such that if for some point $b\in\spc{U}$
we have $\mangle\hinge{p}{b}{a_i}<\tfrac\pi2+\eps$.
\end{thm}

Note that baricentric simplex with points is nondegenerate if there is a point $p$ such that
\begin{enumerate}
\item\label{in-bary-simplex} for any point $x\in \spc{U}$ there is $i$ such that $\mangle\hinge px{a^i}>\pi/2$ and
\item\label{not-in-bry} for any $i$ there is $x_i$ such that $\mangle\hinge px{a^j}>\pi/2$ for any $j\not=i$.
\end{enumerate}
(The condition~\ref{in-bary-simplex} garantees that $p$ belongs to the image of baricentric map and
The condition~\ref{not-in-bry} garantees that $p$ does not belong tothe image of the boundary.)

Assume a baricentrical simplex with vertexes $a^0,a^1,\dots,a^m$ is well defined.







\begin{thm}{No-overlap lemma}\label{lem:overlap}
Let $\trig{\~x^1}{\~x^2}{\~x^3}$ be a triangle in $\Lob2{\kappa}$, $\~p^1,\~p^2,\~p^3$ be points inside $\trig{\~x^1}{\~x^2}{\~x^3}$ (i.e. in $\Conv(\~x^1,\~x^2,\~x^3)$) such that
\begin{subthm}{lem:overlap:px=px}
$\dist{\~p^i}{\~x^k}{}=\dist{\~p^j}{\~x^k}{}$ if $\{i,j,k\}=\{1,2,3\}$,
\end{subthm}
\begin{subthm}{}
no two triangles $\trig{\~p^i}{\~x^j}{\~x^k}$ overlap.
\end{subthm}
Then
$$\mangle\hinge {\~p^1}{\~x^2}{\~x^3} 
+\mangle\hinge {\~p^2}{\~x^3}{\~x^1}
+\mangle\hinge {\~p^3}{\~x^1}{\~x^2}
>2\cdot\pi.$$

\end{thm}

\begin{wrapfigure}{r}{20mm}
\begin{lpic}[t(-3mm),b(0mm),r(0mm),l(0mm)]{pics/contr-no-overlap(0.4)}
\lbl[rt]{37,34;$\~p^1$}
\lbl[tl]{10,36;$\~p^2$}
\lbl[bl]{14,6;$\~p^3$}
\lbl[lb]{13,51;$\~x^1$}
\lbl[tr]{12,0;$\~x^2$}
\lbl[l]{44,30;$\~x^3$}
\end{lpic}
\end{wrapfigure}

\parbf{Remark.}
If $\kappa\le 0$, one can prove the lemma without using condition \ref{SHORT.lem:overlap:px=px}).
This follows immediately from the formula that relates the sum of angles for the hexagon
$[\~p^1\~x^2\~p^3\~x^1\~p^2\~x^3]$ and its area:
$$ \mangle\~p^1
-
\mangle\~x^2
+
\mangle\~p^3
-
\mangle\~x^1
+
\mangle\~p^2
-
\mangle\~x^3
=2\cdot\pi-\kappa\cdot{\area}.
$$

In case $\kappa>0$, condition \ref{SHORT.lem:overlap:px=px}) is essential.
A counterexample to the lemma for $\kappa>0$ without condition a) can be constructed by perturbing the degenerate spherical configuration on the picture.

%???Is this proof mine or there are some references?

\begin{wrapfigure}[11]{r}{44mm}
\begin{lpic}[t(-5mm),b(0mm),r(0mm),l(0mm)]{pics/4-pnt-kirsz(0.4)}
\lbl[b]{45,35;$\~p^3$}
\lbl[t]{42,62;$\~p^1$}
\lbl[l]{21,49;$\~p^2$}
\lbl[lb]{4,96;$\~x^3$}
\lbl[tr]{9,3;$\~x^1$}
\lbl[b]{103,56;$\~x^2$}
\lbl[l]{54,100;$\dot x^2$}
\end{lpic}
\end{wrapfigure}

\parit{Proof.} Without loss of generality, we can assume that 
$$\mangle \~p^1\le \mangle \~p^2+\mangle \~p^3.
\eqlbl{eq:p2=<p1+p3}$$

Rotate triangle $\trig{\~p^3}{\~x^1}{\~x^2}$ around $\~x^1$ to make $[\~x^1\~p^3]$ coincide with $[\~x^1\~p^2]$.
Let us denote by $\dot x^2$ the image of $\~x^2$ after rotation.
Then
$\mangle\hinge{\~x^1}{\~x^3}{\dot x^2}
\z<\mangle\hinge{\~x^1}{\~x^3}{\~x^2}$, thus
$\dist{\~x^3}{\dot x^2}{}<\dist{\~x^3}{\~x^2}{}$ and therefore
\begin{align*}
\mangle\~p^1
&>\mangle\hinge{\~p^2}{\~x^3}{\dot x^2}
=
\\
&=
\min\{\mangle\~p^3+\mangle\~p^2,\pi -(\mangle\~p^3+\mangle\~p^2)\}.
\end{align*}
From \ref{eq:p2=<p1+p3}, we get 
$$\mangle\~p^1> \pi -(\mangle\~p^3+\mangle\~p^2).$$
Hence the lemma follows.\qeds













%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Lifting globalization}




The map $\map\:\Gamma\to\spc{U}$ constructed in the above theorem will be called $\varpi\kappa$-covering of $\spc{U}$ at $p$.
In case $\kappa\le0$, ??? 


First we prove a partial case of Lifting theorem --- the Radial lemma (???).

Let us start from technical definition

\begin{thm}{Definition}
\label{def:radial_uniqueness}
A subset $B$ of a metric space $\spc{X}$ satisfies 
\emph{radial uniqueness with respect to $p\in \spc{X}$}%
\index{radial uniqueness}
if for any $q\in B$ there is exactly one geodesic path of $\spc{X}$ from $p$ to $q$;  
and 
\emph{continuous radial uniqueness}%
\index{continuous radial uniqueness}
if in addition, that geodesic depends continuously on $q$.
\end{thm}

%\parbf{Remark.} Continuous radial uniqueness follows,  by \ref{cor:homotopy}, from radial uniqueness and the following ``strictly unique'' condition  \cite{buyalo:lecture}: for each geodesic  $\gamma$ from $o$ there is $\epsilon>0$ such that all other local geodesics of $\spc{U}$ with the same endpoints as  $\gamma$ have length $\ge\length\gamma+\epsilon$.

\begin{wrapfigure}{r}{27mm}
\begin{lpic}[t(-5mm),b(0mm),r(0mm),l(0mm)]{pics/weel_with_spokes(0.50)}
\end{lpic}
\end{wrapfigure}

Let us give an example of space 
of curvature $\le\kappa$ for any $\kappa$, 
satisfying radial uniqueness with respect to $p$ 
but not continuous radial uniqueness. 
It will also violate conclusion of Radial globalization theorem for all small $\kappa$.

\parbf{Wheel with many spokes.} To each point of $\SS^1$, 
glue (see ???) the right endpoint of a copy of the unit interval, and obtain a point $p$ by identifying all the left endpoints. 

\medskip

\begin{thm}{Radial lemma}
\label{thm:cba-global-2}
Let $\spc{U}$ be complete intrinsic space 
with $\curv\spc{U}\le\kappa$ 
and $p\in\spc{U}$.
Assume $\spc{U}$ satisfies continuous radial uniqueness with respect to $p$.
Then 
$$\cBall[p,\varpi\kappa/2]\in\cCat{}{\kappa}.$$

\end{thm} 





\parit{Proof of Lifting globalization theorem (\ref{thm:globalization-lift}).} 
The proof of the following claim is similar to the proof of Claim~\ref{clm:homotopy} in the proof of Radial lemma.

\begin{clm}{Claim}\label{clm:homotopy-from-p}
Let  $\alpha\:[0,1]\to \spc{U}$ be a path of length $\ell<\varpi\kappa$
such that $\alpha(0)=p$
Then there is unique continous family of local geodesic paths $\gamma_t\:[0,1]\to B$
such that $\gamma_0(t)=p$, $\gamma_t(0)=p$ and $\gamma_t(1)=\alpha(t)$ for all $t\in[0,1]$.

Moreover, for any $t$,
$$\length\gamma_t\le\length\alpha|[0,t]$$
and for given $t$ equality holds if and only if the restriction $\alpha|[0,t]$ is a reparametrization of $\gamma_t$
\end{clm}

\parit{Proof of the claim.}
Assume $\gamma_t$ can be constructed for $t$ in a maximal subinterval $\II$ of $[0,1]$.
from Corollary~\ref{cor:loc-family}, $\II$ has to be open in $[0,1]$.
From the second part of Corollary~\ref{cor:loc-family},
we get that
$$\length\gamma_t\le\length\alpha|[0,t]$$
for any $t\in\II$.
In particular $\length\gamma_t\le\ell$;
therefore by Corollary~\ref{cor:loc-family}
$$t\mapsto\gamma_t\:\II\to\Gamma^{\spc{B}_p}$$ 
is a uniformly continuous curve.
Applying  Proposition~\ref{prop:geo-complete}, we can extend $\gamma_t$ to the closure of $\II$.

Hence $\II$ is open and closed subset of $[0,1]$;
i.e. $\II=[0,1]$.
\qeds

Let $\Gamma=\Gamma^\spc{U}_p[\varpi\kappa]$.
Then according to ???, $\oneend_p\:\Gamma\to\spc{U}$ is a local isometry, in particular 
Given $\gamma\in\Gamma$ one can consider path $\hat\gamma\:[$
The Claim~\ref{clm:homotopy-from-p} implies the following property of $\Gamma$:




Assume $\alpha\:[0,1]$
Assume $\gamma_t\:[0,1]\to\spc{U}$ be a homotopy of local geodesic paths
such that $\gamma_0(t)=\gamma_t(0)=p$ for all $t\in[0,1]$.
Set $\alpha(t)=\gamma_t(1)$.
Applying open-close argument with Corollary~\ref{cor:homotopy0} and , we get
$$\length\alpha|[0,t]\ge\length\gamma_t$$
for all $t\in [0,1]$ 
and equality holds if and only if $\alpha|[0,t]$ is a reparametrization of $\gamma_t$.





Set $\Gamma=\Gamma_{p}^\spc{U}[\varpi\kappa/2]$.
Let $\star\in\Gamma$ be constant path $\star(t)\equiv p$
and $\map=\oneend_p|_\Gamma$.

According to \ref{prop:geo-complete}, $\Gamma$ is complete.
From ???,  $\map\:\Gamma\to \spc{U}$ is a local isometry;
in particular $\curv\Gamma\le\kappa$.



The statements (\ref{SHORT.thm:globalization-lift:p}) and (\ref{SHORT.thm:globalization-lift:rad}) trivially hold.
Thus it reamins to prove 
Statement (\ref{SHORT.thm:globalization-lift:lift})
and that $\Gamma\in\cCat{}{\kappa}$.

\parit{(\ref{SHORT.thm:globalization-lift:lift}).}
Given a path $\alpha$ in $\spc{U}$ with length $\le\varpi\kappa/2$,
there is unique homotopy of local geodesic paths $\gamma_t$, 
such that $\gamma_0=\star$ and
$\gamma_t(0)=p$, $\gamma_t(1)=\alpha(t)$ for $t\in[0,1]$.
Moreover, $\length\gamma_t\le\length\alpha|_{[0,t]}$.

Indeed, given a path $\alpha$ in $\spc{U}$ with length $\le\varpi\kappa/2$,
we can apply ??? to construct unique homotopy of local geodesic paths $\gamma_t$, such that $\gamma_0=\star$ and
$\gamma_t(0)=p$, $\gamma_t(1)=\alpha(t)$ for $t$ in the maximal subinterval $[0,t_{\max}]\subset [0,1]$.
Note that if $t_{\max}<1$ then $\length\gamma_{t_{\max}}=\varpi\kappa/2$
According to ??? $\length\gamma_t\le\length\alpha|_{[0,t]}$.

Define $\hat\alpha(t)=\gamma_t$; by the construction (\ref{SHORT.thm:globalization-lift:lift}) holds.

\medskip

Now we use the above construction to prove the following property of $\Gamma$.

\begin{clm}{Property}
$\star$ can be joined to any point $\xi\in\Gamma$ by a unique geodesic path $\geod^\circ_{[\star\xi]}$.
Moreover, the map 
$$\xi\mapsto\geod^\circ_{[\star\xi]}\:\Gamma\to\Geo_\star\Gamma$$
is continuous. 
\end{clm}

Any point $\xi\in\Gamma$ is a local geodesic path in $\spc{U}$ which starts at $p$.
Now $\hat\xi$ gives a local geodesic path from $\star$ to $\xi$.
Clearly $\length\hat\xi=\length\xi$,
set $\ell=\length\hat\xi$.

Assume there is a path in $\Gamma$ with length $\le\ell$
which joins $\star$ to $\xi$ in $\Gamma$.
In other words, there is a map homotopy of locally geodesic paths say $\gamma_t\:[0,1]\to\spc{U}$ such that 
$\gamma_0(t)\equiv p$, $\gamma_1(t)\equiv\xi(t)$
and the path $\sigma\:t\mapsto\gamma_t(1)\:[0,1]\to\spc{U}$ 
has length $\le \ell$.

Then according to ???, $\length\sigma\ge\length\gamma_1$ and equality holds only if $\sigma$ is a reparametriaztion of $\gamma_1$.
In particular, $\gamma_1$




Given a point $\xi\in\Gamma$,
consider a path $\psi$ from $\star$ to $\xi$ which is nearly minimizing the distatance; i.e.

Let $\alpha$ and $\gamma_t$ be as in the above claim.
Define path $\hat\alpha\:[0,1]\to \spc{B}$ as $\hat\alpha\:t\mapsto \gamma_t$.
Clearly $\map\circ\hat\alpha=\alpha$.
Since $\map$ is a local isometry, we have $\length\hat\alpha=\length\alpha$.

Applying the same construction to $\gamma_1$, we get a local geodesic path $\hat\gamma_1$ in $\spc{B}$.
From Claim~\ref{clm:lift-of-path},
$$\length\hat\gamma_1
=
\length\gamma_1
\le
\length\alpha
=
\length\hat\alpha.$$
and equality holds if and only if $\hat\alpha=\hat\gamma_1$.

In particular $\spc{B}$ satisfies continuous radial uniqueness at $p$.

It remains??? to apply Radial globalization theorem (\ref{thm:cba-global-2}).\qeds



%\parbf{Remark for AKP.} Here we could also discuss locally convex/convex spaces.  They satisfy No-conj-pts by cat's-cradle proof. This plus Alexandrov globalization is another route to globalizatin


\begin{thm}{Lemma}
Let $\spc{U}$ be complete space with $\curv\spc{U}\le\kappa$,
$\alpha\:[0,1]\to\spc{U}$ be a path of lenght $<\varpi\kappa$
and $p=\alpha(0)$.
Then there is unique homotopy 
$$\gamma\:(t,\tau)\mapsto\gamma_t(\tau)\:[0,1]\times[0,1]\to\spc{X}$$
such that for each $t\in [0,1]$, we have
\begin{subthm}{}
$\gamma_t\:[0,1]\to\spc{X}$ is a local geodesic path, 
\end{subthm}
\begin{subthm}{}
$\gamma_t(0)=\gamma_0(t)=p$ and $\gamma_t(1)=\alpha(t)$.
\end{subthm}


Moreover, 
$$\length\gamma_t\le\length(\alpha|[0,t])$$ 
for any $t\in[0,1]$.
\end{thm}

Fix $\kappa\in \RR$.

Let $\spc{U}$ be a complete space with $\curv\spc{U}\le\kappa$ and $p\in\spc{X}$.




\begin{thm}{Corollary}\label{cor:loc-family-one-point}
Let $\spc{U}$ be complete space,
$\curv\spc{U}\le\kappa$, 
$\gamma\:[0,1]\to\spc{U}$ be a local geodesic path with length $\ell<\varpi\kappa$
and $p=\gamma(0)$.
Then for some neigborhoods $\Omega\ni\gamma(1)$ 
there is unique continous map
$$x\mapsto\gamma_x\:\Omega\to\Gamma^\spc{U}$$
such that $\gamma_{x}(0)=p$, $\gamma_{x}(1)=x$ for any $x\in\Omega$
and $\gamma(1)\mapsto\gamma$.


Moreover, 
\begin{subthm}{}
The map $\lip_x(x\mapsto\gamma_x)\le \Lip(\ell)$
\end{subthm}



\begin{subthm}{}
There is a space $\spc{N}\in\cCat{}{\kappa}$ 
and two isometric embeddings
$\imath\:\Omega\to \spc{N}$ 
such that 
$\dist{\hat p}{\imath(x)}{\spc{N}}=\length\gamma_x$
for any some fixed $\hat p\in\spc{N}$ and $x\in \Omega$.
\end{subthm}
\end{thm}


\begin{thm}{Proposition}\label{lem:cat-geos3-cba}
Let $\spc{U}$ be complete space with $\curv\spc{U}\le\kappa$ and $p\in\spc{U}$.
Then the restriction
$\map=\oneend_p|\Gamma^\spc{U}_p(\varpi\kappa)$
is an open locally bi-Lipshitz immersion 
which is locally isometric on $\bar\Gamma^\spc{U}_p[\varpi\kappa/2]$.

Moreover, given a path $\alpha\:[0,1]\to\spc{U}$ such that
$\alpha(0)=p$ and $\length\alpha<\varpi\kappa$ there is unique homotopy $\gamma_t\:[0,1]\to\spc{U}$, such that $\gamma_t\in\Gamma^\spc{U}_p(\varpi\kappa)$,
$\gamma_t(0)=\gamma_0(t)=p$ and $\gamma_t(1)=\alpha(1)$ for all $t\in[0,1]$.
\end{thm}

As a corollary of Patchwork lemma, we get the following extension of Lemma~\ref{lem:cat-geos2}.

\begin{thm}{Corollary}\label{cor:homotopy0}
Let $\spc{U}$ be space with $\curv\spc{U}\le\kappa$.
Then the map 
$$\ends\:\Geo^{\varpi\kappa}\spc{U}\to \spc{U}\times\spc{U}$$ 
is an open locally bi-Lipschitz immersion.
\end{thm}

\parit{Proof.} It is sufficirent to check the conclusion of the corollary in a neighborhood of given local geodesic path $\alpha\in\Geo^{\varpi\kappa}\spc{U}$.

Apply Patchwork lemma (\ref{lem:patch}) to a local geodesic path $\alpha$ in $\spc{U}$ of length $<\varpi\kappa$.
Let  
$\hat\alpha\:[0,1]\to\spc{N}$, 
$\map\:\spc{N}\to\spc{U}$
and $\hat\Omega\subset\spc{N}$
be as in the formulation of Patchwork lemma.

Note that curve $\gamma$ in $\hat\Omega$ is a local geodesic of $\spc{N}$ if and only if $\map\circ\gamma$ is a local geodesic in $\spc{U}$.
Thus the corollary follows from Lemma~\ref{lem:cat-geos2}
\qeds


















Here we prove technical statements needed in the next section. 

Now we introduce some constructions in the space of local geodesic paths in abstract metric space.

Consider a metric space $\spc{X}$ 
and denote by $\Gamma^\spc{X}$ 
the space of all local geodesic  paths $\gamma\:[0,1]\to\spc{X}$ 
(see definition in Section~\ref{sec:geods}).
Let us equip $\Gamma^\spc{X}$ with uniform metric;
i.e., given $\gamma^1,\gamma^2\in \Gamma^\spc{X}$,
set 
$$\dist{\gamma^1}{\gamma^2}{}
=
\dist{\gamma^1}{\gamma^2}{\Gamma^\spc{X}}
=
\max\set{\dist{\gamma^1(t)}{\gamma^2(t)}{\spc{X}}}{t\in [0,1]}.$$
Further, let us define 
\emph{endpoints map}%
\index{endpoints map}
$$
\ends\:\gamma\mapsto (\gamma(0),\gamma(1))\:\Gamma^\spc{X}\to\spc{X}\times\spc{X}
$$

Further, given  $p\in\spc{X}$,
denote by $\Gamma_p^\spc{X}$ the subspace in $\Gamma^\spc{X}$ formed by all local geodesic paths which start at $p$; 
i.e. 
$\Gamma^\spc{X}_p=\set{\gamma\in\Gamma^\spc{X}}{\gamma(0)=p}$.
and define the 
\emph{endpoints map}%
\index{endpoints map}
$$
\oneend_p\:\gamma\mapsto \gamma(1)\:\Gamma^\spc{X}_p\to\spc{X}
$$


Let us introduce notation for the following subspaces of $\Gamma^\spc{X}$ and $\Gamma^\spc{X}_p$
for given $r\in(0,\infty]$.

\begin{itemize}
\item Denote by $\Gamma^\spc{X}(r)$ 
and $\bar\Gamma^\spc{X}[r]$ 
the subspace in $\Gamma^\spc{X}$ formed by all local geodesic paths with length $<r$ and correspondingly $\le r$.

\item Denote by 
$\Gamma^\spc{X}_p(r)$ 
and 
$\bar\Gamma^\spc{X}_p[r]$
the subspace in $\Gamma^\spc{X}_p$ formed by all local geodesic paths with length $<r$ and correspondingly $\le r$.
\end{itemize}

Now using notation above, 
we formulate two propositions about $\cCat{}{}$ spaces:

\begin{thm}{Proposition}\label{lem:cat-geos3}
Let $\spc{U}\in\cCat{}{\kappa}$ and $p\in\spc{U}$.
Then the restriction
$\map=\oneend_p|\Gamma^\spc{U}_p(\varpi\kappa)$
is an open locally bi-Lipschiz embedding
and it is isometric on $\bar\Gamma^\spc{U}_p[\varpi\kappa/2]$.

Morover, the subfunction $\length\circ\map^{-1}$ coinsides with $\dist{p}{}{}$ in whole domain of definition. 
\end{thm}

\parit{Proof.}
From Globalization theorem (\ref{thm:alex-patch}), it follows that $\map$ is an embedding.
Clearly $\map$ is $1$-Lipschitz.

For $r\in(0,\varpi\kappa)$, 
set 
$$\Lip(r)
=
\max
\set{\frac{\sn\kappa\bar r}{\sn\kappa r}}{0\le\bar r\le r};$$ 
clearly $\Lip$ is continuous 
and $\Lip(r)=1$ if $r\le\varpi\kappa/2$.
From Corollary~??? it follows that $\map^{-1}$ is 
$\Lip(r)$-Lipschiz in $\oBall(p,r)$.
Hence the main part of the proposition.

The second part is trivial.
\qeds

\begin{thm}{Proposition}\label{lem:cat-geos2}
Let $\spc{U}\in\cCat{}{\kappa}$.
Then the restriction $\map=\ends|\Gamma^\spc{U}(\varpi\kappa)$
is an open locally bi-Lipschitz embedding.
\end{thm}

\parit{Proof.}
Note that according to Corollary~\ref{cor:loc-geod-are-min}, 
any $\gamma\in\Gamma^\spc{U}(\varpi\kappa)$ is a geodesic path.
Applying Globalization theorem (\ref{thm:alex-patch}),
we get that $\map$ is an open embedding.
Obviousely $\map$ is a short map.
On the other hand ???%SHOULD WE DO IT FROM MAJOARIAZTION???
\qeds

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Now we turn our attansion to the spaces of geodesics of space with an upper curvature bound.









Since $\Gamma$ is locally geodesic (see Claim~\ref{clm:loc-iso}),
\ref{eq:rad-conv} imlies that $\spc{B}_r$ is locally convex and therefore $\curv\spc{B}_r\le\kappa$.
Further, from \ref{eq:dist=length} and ???, $\spc{B}_r$ is complete.



In particular,
if $\dist{\hat p}{\xi}{},\dist{\hat p}{\zeta}{}\le \varpi\kappa/2-\eps$  for some $\eps>0$
and $\hat\alpha$ is a path of $\Gamma$ with length $<\varpi\kappa$ from $\xi$ to $\zeta$ 
then any locally geodesic path from $\xi$ to $\alpha(t)$ lies in 
$\cBall[\hat p,\varpi\kappa-\eps]$.
According to ???, $\cBall[\hat p,\varpi\kappa-\eps]$ is complete, 
thus applying curve-shortening homotopy ???, 
we get a local geodesic path $\gamma$ from $\xi$ to $\zeta$ in $\Gamma$ with 
$\length \gamma<\length\alpha$.

According to ???, if a geodesic path $\gamma$ has ends in $\spc{B}_r$ then $\gamma\subset\spc{B}_r$.
Thus it remains to show that any two points in $\spc{B}_r$ can be joined by a geodesic.








From ???, it follows that $\cBall[\hat p,r]\subset\Gamma$ is complete for any $r<\varpi\kappa???$.

It remains to prove the following lemma.
Indeed, once it is proved one only has to take $\spc{B}_p=\cBall[\hat p,\varpi\kappa/2]$???.


\begin{thm}{Radial lemma}
Let $\Gamma$ be intrinsic space with $\curv\Gamma\le\kappa$
and $\hat p\in\Gamma$.
Assume that 
for any $r<\varpi\kappa$ the ball $\cBall[\hat p,r]$ is complete
and for any $x\in\oBall(\hat p,\varpi\kappa)$,
 there is unique geodesic $[\hat p x]$ which depends continuousely from $x$;
i.e. $\geodpath_{[\hat p z]}\rightrightarrows\geodpath_{[\hat p x]}$ as $z\to x$.
Then 
$$\cBall[\hat p,\varpi\kappa/2]\in\cCat{}{\kappa}.$$

\end{thm}

\parit{Proof of Radial lemma (\ref{thm:cba-global-2}).} 




Let $\gamma$ be a local geodesic path such that $\gamma(0),\gamma(1)\in \oBall(\hat p,\varpi\kappa/2)$.
From Claim~\ref{clm:rad-conv}, we have that 
if $\gamma$ lies in $\oBall(\hat p,\varpi\kappa/2)$  
then
$$\length\gamma\le \dist{\hat p}{\gamma(0)}{}+\dist{\hat p}{\gamma(1)}{},\ \ \t{and}
\eqlbl{eq:B-length}$$
$$\dist{\hat p}{\gamma(t)}{}\le\max\{\dist{\hat p}{\gamma(0)}{},\dist{\hat p}{\gamma(1)}{}\})
\ \ \t{for any}\ \ 
t.
\eqlbl{eq:B-conv}$$ 
Moreover if $\gamma$ does not lie in $\oBall(\hat p,\varpi\kappa/2)$ completely then
$$\length\gamma\ge2\cdot\varpi\kappa- \dist{\hat p}{\gamma(0)}{}-\dist{\hat p}{\gamma(1)}{}>\varpi\kappa.
\eqlbl{eq:B-length2}$$

Fix $r<\varpi\kappa/2$ and consider subspace $\spc{B}_r=\cBall[\hat p,r]\subset\spc{U}$.
The inequalities \ref{eq:B-length}  and \ref{eq:B-length2} imply that  $\spc{B}_r=\cBall[\hat p,r]$ forms convex subsets in $\Gamma$;
since $\spc{B}_r$ is also closed, we have $\curv\spc{B}_r\le\kappa$.
Further, from \ref{eq:B-length} we have the following:

\begin{clm}{Claim}\label{clm:<pi}
All local geodesics in $\spc{B}_r$ 
have length at most $2\cdot r<\varpi\kappa$.
\end{clm}

Now we use above claim to prove the followng:
 
\begin{clm}{Claim}\label{clm:homotopy}
Let  $\alpha\:[0,1]\to \spc{B}_r$ be a path
and $\gamma\:[0,1]\to \spc{B}_r$ be a local geodesic path 
such that $\gamma(1)=\alpha(0)$.
Then there is unique continous family of local geodesic paths $\gamma_t\:[0,1]\to \spc{B}_r$
such that $\gamma_0=\gamma$, $\gamma_t(0)=x$, $\gamma_t(1)=\alpha(t)$ for all $t$.
\end{clm}

\parit{Proof of the claim.}
The uniquness follows from  Claim~\ref{clm:<pi} and Corollary~\ref{cor:loc-family}.

Assume $\gamma_t$ can be constructed for $t$ in a maximal subinterval $\II$ of $[0,1]$.
From Corollary~\ref{cor:loc-family}, $\II$ has to be open in $[0,1]$
and 
$$t\mapsto\gamma_t\:\II\to\Gamma^{\spc{B}_{\hat p}}$$ 
is a uniformly continuous curve.
Applying  Proposition~\ref{prop:geo-complete}, we can extend $\gamma_t$ to the closure of $\II$.
Hence $\II$ is open and closed subset of $[0,1]$;
i.e. $\II=[0,1]$.
\qeds

Now let us show that given $x,y\in \spc{B}_r$ there is unique local geodesic path $\gamma_{xy}\:[0,1]\to \spc{B}_r$ from $x$ to $y$.









Let us show that for any $ r\le\varpi\kappa/2$ the ball $\oBall(p, r)$ forms a convex set in $\spc{U}$.
Indeed, let $x,y\in\oBall(p, r)$, clearly $\dist{x}{y}{}<\varpi\kappa$.
According to ???, there is a geodesic $[xy]$.
By triangle inequality $[xy]$ lies in $\cBall(p,\varpi\kappa)$.
But if $[xy]\not\subset\cBall(p, r)$ then Claim~\ref{clm:rad-conv} implies that $\dist{x}{y}{}>\varpi\kappa$, a contradiction.

The closed ball $\cBall[p,\varpi\kappa]$ is weakly convex as a completion of $oBall(p,\varpi\kappa)$.
Further for all $r<\varpi\kappa/2$ the closed ball
$\cBall[p,r]$ is convex since it coinsides with the intersection of all 
$\oBall[p,R]$ for all $R\in(r,\varpi\kappa/2)$.








\begin{clm}{Claim}\label{clm:unique-lgp}
For any two points $x,y\in B$ there is unique local geodesic path $\gamma_{xy}$ from $x$ to $y$.

Moreover $\gamma_{xy}$ is minimizing for all $x,y\in B$ 
and the map 
$(x,y)\mapsto \gamma_{xy}\:B\times B\to\Gamma^\spc{U}$ is continuous.
\end{clm}

\parit{Proof of the claim.} 
Consider a path $\alpha$ from $y$ to $p$ in $B$
(one can take $\alpha$ to be geodesic path).
Given a local geodesic path $\gamma$  


Given two points $x_0,y_0\in B$,  choose sufficiently small $\eps>0$
($\eps<\tfrac1{7}\max\{\varpi\kappa/2-\dist{p}{x_0}{},\varpi\kappa/2-\dist{p}{y_0}{}\}$ will do).
From \ref{eq:B-length}, any locally geodesic path $\gamma$
from a point in $\oBall(x_0,\eps)$ to a point in $\oBall(y_0,\eps)$ has length less than $\varpi\kappa-2\cdot\eps$.
According to Corollary~\ref{cor:homotopy0}, 
for any such path $\gamma$ 
there is continuous family of locally geodesic paths $\gamma_{xy}$ 
which contain $\gamma$ and connects any point $x\in\oBall(x_0,\eps)$ of $y\in\oBall(y_0,\eps)$.
Further from \ref{eq:B-conv}, any local geodesic path in $\gamma_{xy}$ lies in $B$.

In particular, the number $\#(x,y)$ 
of locally geodesic paths from $x$ to $y$ is locally constant function on $B\times B$.
It remains to note that $B\times B$ is connected 
and the constatnt path is the only locally geodesic path in $B$ from $p$ to $p$;
the later follows from Claim~\ref{clm:rad-conv}.
\qeds

Assume $\alpha$ be a path in $B$.
According to Claim~\ref{clm:unique-lgp},
there is unique 
local geodesic path $\gamma_t\:[0,1]\to B$ such that $\gamma_t(0)=\alpha(0)$ and $\gamma_t(1)=\alpha(1)$.
According to the second part of Corollary~\ref{cor:homotopy0}, $\length\gamma_1\le\length\alpha$.

Therefore $B$ is geodesic and  $\gamma_{xy}$ forms 
unique (minimizing!) geodesic path from $x$ to $y$.













\section{Radial globalization}

In the following theorem we require only that geodesic from a given point $p$ to a point $q$ in some ball around $p$ is unique and depend continuousely from $q$.
This condition is essentially weaker that the one in Globalization theorem (\ref{thm:alex-patch}); the conclusion is also weaker. 











To formulaate an appropriate generalization of this statement to arbitrary upper curvature bound, we have to introduce a notion of $R$-covering for some $R\in (0,\infty]$.

\begin{thm}{Definition}\label{def:R-cover}
Let $\spc{X}$ and $\spc{Y}$ be a metric spaces with base points $x_0\in\spc{X}$ and $y_0\in\spc{Y}$.

A locallly isometric map $\map\:\spc{X}\to\spc{Y}$ is called 
\emph{metric $R$-cover}%
\index{metric $R$-cover} 
of $\spc{Y}$ at $y_0$ 

\begin{subthm}{}
$\map(x_0)=y_0$.
\end{subthm}

\begin{subthm}{}
For any path $\alpha$ of length $\le R$ in $\spc{Y}$ which starts at $x_0$ there is unique path $\hat\alpha$ in $\spc{X}$ which stats in $x_0$ and $\map\circ\hat\alpha=\alpha$.
\end{subthm}

\begin{subthm}{}
The base point $x_0$ can be connected to any point $x\in\spc{X}$ by a path with length $\le R$.
\end{subthm}

If in addition $\spc{X}$ is simply connected then $\map$ is called universal metric $R$-cover.
\end{thm}









\begin{thm}{Corollary (Homotopy straightening)}
\label{cor:straight}
Let $\spc{U}$ be complete space and $\curv\spc{U}\le\kappa$. 
Then any continuous family of curves $\tau_r(s), \,0\le r,s\le 1$, of length $< \varpi\kappa$ in $\spc{U}$ may be continuously deformed into a continuous family of local geodesic paths, keeping endpoints fixed, and strictly decreasing lengths of all $\tau_r$ that are not left fixed. 
\end{thm}

\parit{Proof.}  By the local-geodesic homotopy corollary (\ref{cor:homotopy}), the constant geodesic with image $\tau_r(0)$ may be continuously deformed through local geodesic paths of $\spc{U}$ by moving one end along $\tau_r$ until it reaches $\tau_r(1)$,  holding the other end fixed at $\tau_r(0)$. That is, there is a deformation through uniquely determined, continuously varying ``local-lines-of-sight for $\tau_r$ from $\tau_r(0)$''. 

Now we carry out this straightening procedure simultaneously on all $\tau_r$.  Specifically, let $\gamma_{r,s}\:[0,s]\to \spc{U} $ be the continuously deformed local geodesic path from $\tau_r(0)$ to $\tau_r(s)$, reparametrized by $[0,s]$. Then the desired deformation is given by $H\:[0,1]^3\to \spc{U}$, where
$$
H(r,s,t)=
\begin{cases}
\gamma_{r,s}(t),\quad & t\le s,\\
\tau_r(s),\quad & t\ge s.
\end{cases}
$$

By Patchwork lemma (\ref{lem:no_conj_pts}) applied to the local geodesic path from $\tau_r(0)$ to $\tau_r(s)$, there is a metric space $\spc{Y}$ containing a triangle whose  sidelengths  are $\dist {\tau_r(s)}{\tau_r(s+\epsilon)}{}, \length \gamma_{r,s}$ and $\length \gamma_{r,s+\epsilon}$.  By the triangle inequality,
$$ \length \gamma_{r,s+\epsilon} \le \length \gamma_{r,s} + \epsilon.$$
The claim about decreasing lengths follows.
\qeds

Now we turn to two globalization theorems (\ref{thm:cba-global-1} and \ref{thm:cba-global-2}) that hold for spaces of curvature $\le\kappa$ for any choice of $\kappa$.  These theorems were proved in  \cite{a-b:cbc}.


Our first globalization theorem states that every point $p$ in a complete space of curvature $\le\kappa$ is associated with a $\Cat{}{\kappa}$ ball of radius $\varpi\kappa/2$ in $\Geo_{\,p\,}\spc{U}$:

 \begin{thm}{Theorem (Lifting globalization)}
\label{thm:cba-global-1}
Suppose $\spc{U}$ is complete and $\curv\spc{U}\le\kappa$. 
Set $B=\oBall(o_p,\varpi\kappa/2)\subset \Geo_{\,p\,}\spc{U}$;  that is, $B$ consists of all local geodesic paths in $\oBall(p,\varpi\kappa/2)\subset \spc{U}$ with initial point $p$???NOT QUITE RIGHT???.  
Then $B$ in its intrinsic metric  is a $\Cat{}{\kappa}$ space.
\end{thm}









\begin{wrapfigure}[7]{r}{45mm}
\begin{lpic}[%draft, 
t(-15mm),b(0mm),r(0mm),l(0mm)]
{sbapics/patchwork(0.20)}
\lbl[]{100,90;$\spc{Y}_2$}
\lbl[]{190,150;$\hat{A}_3$}
%\lbl[tr]{48,38;$w$}
%\lbl[lb]{77,96;$x$}
%\lbl[lt]{85,4;$y$}
\end{lpic}
\end{wrapfigure}









In the proof we will use the following claim in metric geometry

\begin{clm}{Claim}\label{clm:gluing}
Let $\spc{X}$ be a metric space 
and $A, B\subset\spc{X}$.
Then 
$$\Length(A\cup B)
\iso
(\Length A)\sqcup_\sim (\Length B)$$
where $\sim$ identify points in $A\sqcup B$ which correspond to the same point in $\spc{X}$.
\end{clm}

\parit{Proof of the claim.} The proof should be straightforward once glung is defined???\qeds
 












\begin{wrapfigure}{r}{42mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(3mm)]{pics/loc-geod(0.11)}
\lbl[rb]{15,10;$p$}
\lbl[rb]{110,58;$x$}
\lbl[bl]{240,58;$z$}
\lbl[lb]{343,10;$y$}
\end{lpic}
\end{wrapfigure}






\begin{thm}{Corollary (Local-geodesic homotopy)}
\label{cor:homotopy}
Let $\spc{U}$ be locally complete 
$\curv\spc{U}\le\kappa$ 
and $\gamma\in\Geo^{\varpi\kappa}\spc{U}$.  
Let $\sigma_i\:[a,b]\to \spc{U}$ for $i=0,1$ be two unitspeed curves starting at $\gamma(0)$ and $\gamma(1))$ respectively.  Then $\gamma$ can be uniquely continuously deformed through local geodesic paths $\gamma_s$ joining $\sigma^0(s)$ and $\sigma^1(s)$, and the deformation is locally Lipschitz, for as long as  the $\gamma_s$ remain in a complete subset of $\spc{U}$ and satisfy  $\length\gamma_s< \varpi\kappa$.
\end{thm} 
 


\parit{Proof.} 
By the no-conjugate-points theorem (\ref{thm:no_conj_pts}), $\gamma$ may be uniquely continuously deformed through local geodesic paths $\gamma_s$, for $s$ sufficiently close to $a$. 
By Patchwork lemma (\ref{lem:no_conj_pts}), majorization (\ref{thm:major}) and Proposition~\ref{prop:majorize-geodesic}, if $s'$ is sufficiently close to $s$, then $\dist{\gamma_s(t)}{\gamma_{s'}(t')}{}$ is at most the corresponding distance in $\Lob2{\kappa}$ between points on some geodesic quadrilateral with sidelengths 
$$\length\gamma_s, \length\gamma_{s'}, \dist{\sigma^0(s)}{\sigma^0(s')}{}, \dist{\sigma^1(s)}{\sigma^1(s')}{}.$$  
It follows that the map $s\mapsto\gamma_s\in\Geo \spc{U}$ is locally Lipschitz in $t$, and if $(s_n)$ is a  Cauchy sequence in $\RR$, where $\length\gamma_{s_n}< \varpi\kappa-\epsilon$, then $(\gamma_{s_n})$ is a Cauchy sequence in $\Geo \spc{U}$. Now  an open-closed argument completes the proof. 
\qeds





\parit{Proof of the claim.}
Let us denote by $\alpha_t$ the geodesic path from $p$ to $\gamma(t)$.
According to Patchwork lemma (\ref{lem:no_conj_pts}), for any $t$, the path $\alpha_t$ has a closed neigborhood $N$ such that $\Intr N\in \cCat{}{\kappa}$.
Note that $\dist{p}{}{N}$ coinsides with $\dist{p}{}{\spc{U}}$ in a neigborhood $\Omega\subset N$ of $\alpha$;
in particular $\md\kappa\circ\dist{p}{}{N}\equiv \md\kappa\circ\dist{p}{}{\spc{U}}$ in $\Omega$.
Applying ???, we get that $f=\md\kappa\circ\dist{p}{}{N}$ is satisfies $f''+\kappa\cdot f\ge 1$ in a small neighborhood of $\alpha_t$.
Thus $t\mapsto\md\kappa\circ\dist{p}{\gamma(t)}{\spc{U}}$ is concave in $\oBall(p,???)$.




First we claim that the distance function $\dist{p}{}{}$ is convex on $B$. 
Let $\gamma:\II\to B $ be a geodesic of $B$.  
By Patchwork lemma  (\ref{lem:no_conj_pts}) applied to the unique and continuously varying geodesic paths from $p$ to $\gamma(t)$, 
the function comparison (\ref{function-comp}) for $f=\md\kappa\circ \dist{p}{}{}\circ \gamma$ holds on $\II$. Since distance from the center is convex in a ball of radius $<\varpi\kappa/2$ in $\Lob2\kappa$, then so is $\dist{p}{}{}$.  The convexity is strict except for radial directions.  

Therefore the maximum of $\dist{p}{}{}\circ \gamma$ occurs at an endpoint and there are no internal maximum points. Accordingly, \emph{geodesics deformed by the local-geodesic homotopy corollary (\ref{cor:homotopy}) 
must remain in $B$ if their endpoints remain in  $B$}.

\begin{clm}{Claim}
Given two point $x,y\in B$ there is at least one local geodesic path from $x$ to $y$.
\end{clm}

Consider two radial geadesic paths $\sigma_0,\sigma_1\:[0,1]\to B$;
i.e. $\sigma_0(0)=\sigma_1(0)=p$.
Let us construct a homotopy of locally geodesic paths $\gamma_t$ such that $\gamma_t(0)\equiv\sigma_0(t)$, $\gamma_t(1)\equiv\sigma_1(t)$ which statrts with trivial path $\gamma_0(t)\equiv p$.
According to Corollary~\ref{cor:homotopy0}, if $\length\gamma_t<\varpi\kappa$ for some $t$ then one can extend homotopy on a unique way to a neigborgood of $t$. 
Assume constructed a homotopy for a proper subinterval $[0,t_{\max})\subset[0,1]$,
then according to ??? there is a limit $\gamma_{t_{\max}}=\lim_{t\to t_{\max}-}\gamma_t$ and according to ??? $\gamma_{t_{\max}}$ is a local geodesic path.
Further from ???, we get that $\length\gamma_t\le???$ for all $t$.
Thus open and close argument gives implies the existance of homotopy.




Now we use the local-geodesic homotopy corollary to show there is at most one local geodesic path of length $<\varpi\kappa$ in $B$ joining any two points of $B$.  Indeed, suppose there are two. Deform this local geodesic pair by moving the furthest endpoint from $p$ toward $p$ along a radial geodesic until the endpoints are equidistant from $p$, and then moving both endpoints toward $p$ preserving equidistance.  
The deformed local geodesic paths are furthest from $p$ at their endpoints, so they eventually move into a $\Cat{}{\kappa}$ neighborhood of $p$.  Therefore the pairs must coalesce, contradicting uniqueness in the local-geodesic homotopy corollary.

Next, we claim $B$ is a geodesic space.  Suppose $\tau:[0,1]\to B$ is a curve of length $<\varpi\kappa$. 
By the homotopy straightening corollary (\ref{cor:straight}) applied to the  family $\tau_r=\tau$, there is a local geodesic path $\gamma$ in $B$ with $\gamma(0)=\tau(0)$, $\gamma(1)=\tau(1)$, and $\length\gamma\le\length\tau$.  
By the uniqueness of local geodesic paths in $B$, $\gamma$ satisfies the latter  inequality for any choice of $\tau$ with the same endpoints, and so $\length\gamma=\dist{\tau(0)}{\tau(1)}{}$.  Since $\diam(B)<\varpi\kappa$, we have proved that geodesics of $B$ between any two points  exist and are unique.  

By the local-geodesic homotopy corollary, geodesics of $B$ from any point $q\in B$ depend continuously on their righthand endpoints. For any geodesic $\gamma$ in  $B$, apply Patchwork lemma (\ref{lem:no_conj_pts}) to the geodesic path from $q$ to $\gamma(t)$.  It follows that    $f=\md\kappa\circ \dist{q}{}{}\circ \gamma$ satisfies the function comparison (\ref{function-comp}).  
Therefore  $B\in\Cat{}{\kappa}$ by Theorem~\ref{thm:function-comp}.















\begin{thm}{Lemma (Reshetnyak gluing)}\label{lem:cba-gluing}
Let $\spc{U}^1, \spc{U}^2\in\Cat{}{\kappa}$,  
$A^i\subset\spc{U}^i$ be closed $\varpi\kappa$-convex subsets, and  $\imath\:A^1\to A^2$ be an isometry.
Define an equivalence relation $\sim$ on $\spc{U}^1\sqcup \spc{U}^2$  by setting $a\sim\imath(a)$ and consider glued space $\spc{X}=\spc{U}^1\sqcup_\sim \spc{U}^2$.

Then both canonical mappings $\jmath^i\:\spc{U}^i\to\spc{X}$ are isometric 
and the set
$$A=\jmath^1(A^1)=\jmath^2(A^2)\subset\spc{X}$$ 
is a $\varpi\kappa$-convex.

Moreover:

\begin{subthm}{gluing1}
If $\spc{X}$ is geodesic then $\spc{X}\in\Cat{}{\kappa}$.
\end{subthm} 
 
\begin{subthm}{gluing2}
If $\spc{U}^1, \spc{U}^2$ are complete, 
then $\spc{X}$ is a complete $\Cat{}{\kappa}$ space.
 \end{subthm} 
\end{thm}










\begin{subthm}{thm:prop-gexp:func} 
??? 
Let $\spc{L}\in \CBB{m}{\kappa}$,  
$f\:\spc{L}\to\RR$ be a native $\lambda$-concave function $\lambda\ge 0$. 
Then for any $p\in \spc{L}$ and $\xi\in \Sigma_p$
$$f\circ\gexp_p(t\cdot\xi)
\le 
f(p)+t\cdot(\d_p f)(\xi)+t^2\cdot\lambda/2.$$
Moreover, the function
$$\theta(t)=\{f\circ\gexp_p(t\cdot\xi)-f(p)-t^2\cdot\lambda/2\}/t$$
is non-increasing.
\end{subthm}









\section{???Exact distance estimates}

\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{}{\kappa}$,
$p,q\in\spc{L}$
and $f\:\spc{L}\subto\RR$ satisfies $f''+\kappa\cdot  f\le \lambda$.
Consider model data
$\~p,\~q\in \Lob2{\kappa}$ and a function $\~f\:\Lob2{\kappa}\to \RR$ such that $\~f''+\kappa\cdot \~f= \lambda$, $\dist{\~p}{\~q}{}=\dist{p}{q}{}$, $\~f(\~p)=f(p)$ and 		$\~f(\~p)=f(p)$.
Set $g=\itg\kappa\circ(\md\kappa)^{-1}\circ f$ and $\~g=\itg\kappa\circ(\md\kappa)^{-1}\circ \~f$

Then for any $t,\tau\ge 0$, we have
$$\dist{\GF_{g}^t(p)}{\GF_{\itg\kappa\circ f}^\tau(q)}{}
\le
\dist{\GF_{\~g}^t(\~p)}{\GF_{\itg\kappa\circ \~f}^\tau(\~q)}{}$$ 
once the left part is defined.
\end{thm}

\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{}{\kappa}$ 
and $P\subset \spc{L}$ is a closeed subset.
Assume for two points $x,y\in\spc{L}\backslash P$, there is a model configuration
$\~x,\~y,\~p\in \Lob2{\kappa}$ 
such that $\dist{\~x}{\~y}{}=\dist{x}{y}{}$, $\dist{\~p}{\~x}{}=\dist{P}{x}{}$ and $\dist{\~p}{\~y}{}=\dist{P}{y}{}$.
Set $f=\itg\kappa\circ\dist{P}{}{}$ 
and $\~f=\itg\kappa\circ\dist{\~p}{}{}$.

Then for any $t,\tau\ge 0$, we have
$$\dist{\GF_{f}^t(x)}{\GF_{f}^\tau(y)}{}
\le
\dist{\GF_{\~f}^t(\~x)}{\GF_{\~f}^\tau(\~y)}{}$$ 
once the left part is defined.
\end{thm}













\section{Radial curves: definition}\label{sec:rad-curv}

The radial curves are gradient curves for distance functions with special parametrization.
This parametrization makes them to behave as unitspeed geodesics in a natural comparison sense.

\begin{thm}{Definition}\label{def:rad-curv}
Assume $\spc{L}\in\CBB{}{}$, 
$\kappa\in\RR$, 
and $A\subset \spc{L}$ be a closed subset.
A curve $\sigma\:[s_{\min},s_{\max})\to \spc{L}$  is called 
\emph{$\dist{A}{}{}$-radial curve for curvature $\kappa$} 
if
$s_{\min}
\z=
\dist{A}{\sigma(s_{\min})}{}\in(0,\tfrac{\varpi\kappa}2)$, 
and it satisfies the following differential equation
$$\sigma^+(s)
\z=
\frac{\tg\kappa\dist[{{}}]{p}{\sigma(s)}{}}{\tg\kappa s}
\cdot
\nabla_{\sigma(s)}\dist{A}{}{}.
\eqlbl{eq:rad}$$
for any $s\in[s_{\min},s_{\max})$, here $\tg\kappa x=\frac{\sn\kappa x}{\cs\kappa x}$.

If $x=\sigma(s_{\min})$, we say that $\sigma$ is \emph{initiated in}  $x$.
\end{thm}

Redial curves for curvature $\kappa$ 
work best for $\CBB{}{\kappa}$-spaces.

In the most of applications we consider one-point sets $A=\{p\}$.

Note that according to definition $s_{\max}\le\tfrac{\varpi\kappa}2$.

\begin{thm}{Definition}\label{def:rad-geod}
Let $\spc{L}\in\CBB{}{}$
and $A\subset \spc{L}$ be a closed subset.
A unitspeed geodesic  $\gamma\:\II\to \spc{L}$  is called 
\emph{$\dist{A}{}{}$-radial geodesic}\index{radial geodesic} if 
$\dist{A}{\gamma(s)}{}\equiv s$.
\end{thm}

The proof of the following two propositons follows directly from the definitions: 

\begin{thm}{Proposition}
Let $\spc{L}\in\CBB{}{}$,
$A\subset\spc{L}$ be a closed subset.
Then any $\dist{A}{}{}$-radial geodesic 
$\gamma\:[s_{\min},s_{\max})
\to 
\spc{L}$ 
is an $\dist{A}{}{}$-radial curve for any curvature $\kappa$ such that $\tfrac{\varpi\kappa}{2}
\ge 
s_{\max}$.
\end{thm}

\begin{thm}{Proposition}\label{prop:dist<s}
Let $\spc{L}\in\CBB{}{}$,
$A\subset\spc{L}$ be a closed subset 
and $\sigma\:[s_{\min},s_{\max})\to \spc{L}$ be a $\dist{A}{}{}$-radial curve for curvature $\kappa$.
Then for any $s\in [s_{\min},s_{\max})$, 
we have $\dist{A}{\sigma(s)}{}\le s$.

Moreover, 
\begin{subthm}{}
If for some $s_0$ we have $\dist{A}{\sigma(s_0)}{}= s_0$ 
then the restriction $\sigma|_{[s_{\min},s_0]}$ is a $\dist{A}{}{}$-radial geodesic.
\end{subthm}
\end{thm}

\begin{thm}{Existence and uniqueness}\label{rad-curv-exist}
Let $\spc{L}\in\CBB{}{}$, 
$\kappa\in\RR$, 
$A\subset\spc{L}$ be a closed subset, 
and $x\in \spc{L}$.
Assume
$0
<
\dist{A}{x}{}
<
\tfrac{\varpi\kappa}2$.
Then there is unique $\dist{A}{}{}$-radial curve $\sigma\:[\dist{A}{x}{},\tfrac{\varpi\kappa}2)\to \spc{L}$ 
for curvature $\kappa$
which initiated at $x$.
\end{thm}


\parit{Proof. (Existance)}
Set\index{$\itg\kappa$} 
$$\itg\kappa\:[0,\tfrac{\varpi\kappa}2)\to\RR,
\ \ 
\itg\kappa (t)=\int\limits_0^t\tg\kappa\under t\cdot\d\under t.$$
Clearly $\itg\kappa$ is smooth and increasing.
Thus???, the composition 
$$f=\itg\kappa\circ\dist{A}{}{}$$ 
is semiconcave in the $\tfrac{\varpi\kappa}2$-neighborhood of $A$

Therefore, according to \ref{thm:exist-grad-curv}, there is an $f$-gradient curve $\alpha\:[0,t_{\max})\to \spc{L}$ which starts at $x$; i.e. $\alpha(0)=x$.

Now consider solution of differential equation $\tau(t)$, $\tau'=(\tg\kappa\tau)^2$ and $\tau(0)=r$ 
(that is also a gradient curve in $[0,\tfrac{\varpi\kappa}2)$ for function $\itg\kappa$).
Direct calculations show that composition $\alpha\circ\tau^{-1}$ 
forms an $\dist{A}{}{}$-radial curve for curvature $\kappa$.

\parit{(Uniqueness)} Assume $\sigma_1,\sigma_2$ be two $\dist{A}{}{}$-radial curves for curvature $\kappa$ which initiated at $x$.
Then compositions $\sigma_i\circ\tau$ both give $f$-gradient curves.
By Picard's theorem (\ref{thm:unique}), we have
$\sigma_1\circ\tau 
\equiv 
\sigma_2\circ\tau$.
Therefore $\sigma_1(s)=\sigma_2(s)$ once both sides defined.
\qeds










\section{Radial comparisons}\label{sec:rad-curv}

In this section we show that radial curves in some comparison sense behave as unitspeed geodesics.
First we formulate the results in partial case --- for $\dist{A}{}{}$-radial curve with $A$ formed by one point set $A=\{p\}$.

\begin{thm}{Radial monotonicity}\label{rad-mon}
Let $\spc{L}\in\CBB{}{\kappa}$ 
$p, q\in \spc{L}$ be distinct.
Assume $\sigma\:  [s_{\min},\tfrac{\varpi\kappa}2)\to \spc{L}$
is an $\dist{p}{}{}$-radial curve for curature $\kappa$.
Then the function 
$$s\mapsto 
\tangle\mc\kappa\{
\dist{q}{\sigma(s)}{};
\dist{p}{q}{},
s
\}$$
is nonincreasing in all the domain of definition.
\end{thm}

\begin{thm}{Radial comparison}\label{rad-comp}
Let $\spc{L}\in\CBB{}{\kappa}$ 
and $p\in \spc{L}$.
Assume $\rho\:  [r_{\min},\tfrac{\varpi\kappa}2)\to \spc{L}$
and    $\sigma\:[s_{\min},\tfrac{\varpi\kappa}2)\to \spc{L}$
are two $\dist{p}{}{}$-radial curves for curvature $\kappa$.
Set
$$\phi_{\min}=\angkk\kappa p{\rho(r_{\min})}{\sigma(s_{\min})}.
$$
Then for any $r\in[r_{\min},\tfrac{\varpi\kappa}2)$ and  $s\in[s_{\min},\tfrac{\varpi\kappa}2)$,
we have
$$
\tangle\mc\kappa\{\dist{\rho(r)}{\sigma(s)}{};r,s\}
\le \phi_{\min},
$$
or equivalently,
$$
\dist{\rho(r)}{\sigma(s)}{}
\le \side\kappa\{\phi_{\min};r,s\}.
$$

\end{thm}

Now we give more general version of the above results wich work for $\dist{A}{}{}$-radial curves with arbitrary closed set $A$.

\begin{thm}{General radial monotonicity}\label{gen-rad-mon}
Let $\spc{L}\in\CBB{}{\kappa}$,
$A\subset \spc{L}$ be a closed subset
and $q\in\spc{L}\backslash A$.
Assume $\sigma\:  [s_{\min},\tfrac{\varpi\kappa}2)\to \spc{L}$
is an $\dist{A}{}{}$-radial curve for curature $\kappa$.
Then the function 
$$s\mapsto 
\tangle\mc\kappa\{
\dist{q}{\sigma(s)}{};
\dist{A}{q}{},
s
\}$$
is nonincreasing in all the domain of definition.
\end{thm}

To formulate generalized radial comparison,
we need to introduce a short cut notation.
Given a set $A$ and two points $x$ and $y$ in a metric space define
$$
\angkk\kappa A{x}{y}
\df
\tangle\mc\kappa\{
\dist{x}{y}{};
\dist{A}{x}{},
\dist{A}{y}{}
\}
$$
Note that distances $\dist{x}{y}{}$, 
$\dist{A}{x}{}$ and 
$\dist{A}{y}{}$ might not satisfy the triangle inequality.
Therefore the comparison angle $
\angkk\kappa A{x}{y}$ might be undeined even for $\kappa\le0$.

\begin{thm}{General radial comparison}\label{gen-rad-comp}
Let $\spc{L}\in\CBB{}{\kappa}$ 
and $A\subset \spc{L}$ be a closed set.
Assume $\rho\:  [r_{\min},\tfrac{\varpi\kappa}2)\to \spc{L}$
and    $\sigma\:[s_{\min},\tfrac{\varpi\kappa}2)\to \spc{L}$
are two $\dist{A}{}{}$-radial curves for curature $\kappa$.
Assume further that 
$$\phi_{\min}
=
\angkk\kappa A{\rho(r_{\min})}{\sigma(s_{\min})}
$$
is defined.
Then for any $r\in[r_{\min},\tfrac{\varpi\kappa}2)$ and  $s\in[s_{\min},\tfrac{\varpi\kappa}2)$,
we have
$$
\dist{\rho(r)}{\sigma(s)}{}
\le \side\kappa\{\phi_{\min};r,s\}.
$$

\end{thm}

We give proves only to the one-point-set versions of radial monotonicity and radial comparison.
We do it by two reasons: first in the most of applications we need only this one-point-set version and
second the proof of general radial comparison is almost exactly the same, one can consider to check it as a simple exercise.

We prove both of the theorems simultaniousely.
The proof is an application of \ref{lem:grad-lip} plus trigonometric manipulations.
We prove it first the simplest case $\kappa=0$
and then harder case $\kappa\not=0$.
The arguments for case $\kappa\not=0$ are nearly the same, but it requre an extra idea.

We proof case $\kappa=0$ separately since it is easier to follow.
In fact we do not really need it, once the case $\kappa\not=0$ is proved, 
the case $\kappa=0$ can be obtained by a limit procedure.

\begin{wrapfigure}[5]{r}{60mm}
\begin{lpic}[t(-5mm),b(0mm),r(0mm),l(0mm)]{pics/rad-notation(0.16)}
\lbl[tr]{54,5;$p$}
\lbl[rb]{57,159;$\rho(r)$}
\lbl[r]{25,85;$\rho$}
\lbl[bl]{151,140;$\sigma(s)$}
\lbl[rt]{147,65;$\sigma$}
\lbl[br]{110,80;$S$}
\lbl[bl]{56,80;$R$}
\lbl[bl]{120,10;$\spc{L}$}
\lbl[b]{105,155;$\ell$}
\lbl[b]{305,150;$\ell$}
\lbl[rb]{252,80;$r$}
\lbl[br]{308,80;$s$}
\lbl[bl]{258,38;$\phi$}
\lbl[bl]{310,10;$\Lob2\kappa$}
\end{lpic}
\end{wrapfigure}

\parit{Proof of \ref{rad-mon} and \ref{rad-comp} in case $\kappa=0$.}
Set
\begin{align*}
R=R(r)&=\dist{p}{\rho(r)}{},
\\
S=S(s)&=\dist{p}{\sigma(s)}{},
\\
\ell=\ell(r,s)&=\dist{\rho(r)}{\sigma(s)}{},
\\
\phi=\phi(r,s)&=\tangle\mc0\{\ell(r,s);r,s\}.
\end{align*}
It will be sufficient to prove the following two inequalities:
$$\frac{\partial^+\phi}{\partial r}(s_{\min},r)\le 0,\ \ \ \ \ \ \ \ \frac{\partial^+\phi}{\partial s}(s,r_{\min})\le 0\eqno(*)\mc0_\phi$$
$$
s\cdot\frac{\partial^+\phi}{\partial s}
+
r\cdot\frac{\partial^+\phi}{\partial r}\le 0.
\eqno(**)\mc0_\phi
$$

\begin{wrapfigure}{r}{45mm}
\begin{lpic}[t(-5mm),b(0mm),r(0mm),l(0mm)]{pics/r-s(0.18)}
\lbl[lb]{114,16;$r_{\min}$}
\lbl[lb]{14,66; $s_{\min}$}
\lbl[b]{177,179; {\small $(r_0,s_0)$}}
%\lbl[lb]{125,128,45; {\tiny $(r(t),s(t))$}}
\end{lpic}
\end{wrapfigure}
Once they are proved,
the radial monotonicity follows from $(*)\mc0_\phi$.
The radial comparison follows from both $(*)\mc0_\phi$ and $(**)\mc0_\phi$.
Indeed, one can connect $(s_{\min},r_{\min})$ and $(s_0,r_0)$ in $[s_{\min},\infty)\times[r_{\min},\infty)$ 
by a join of coordinate line and a segment defined by $r/s=r_0/s_0$.
According to $(*)\mc0_\phi$ and $(**)\mc0_\phi$, the value of $\phi$ does not increase while pair $(r,s)$ moving along this join.
Thus $\phi(r_0,s_0)\le\phi(r_{\min},s_{\min})=\phi_{\min}$.

It remains to show $(*)\mc0_\phi$ and $(**)\mc0_\phi$. 
First let us rewrite the inequalities $(*)\mc0_\phi$ and $(**)\mc0_\phi$ in an equivalent form:
$$
\frac{\partial^+\ell}{\partial s}(s,r_{\min})
\le 
\cos\tangle\mc0\{r_{\min};s,\ell\},
\ \ 
\frac{\partial^+\ell}{\partial r}(s_{\min},r)
\le 
\cos\tangle\mc0\{s_{\min};r,\ell\},\eqno(*)\mc0_\ell$$

$$
s\cdot\frac{\partial^+\ell}{\partial s}
+
r\cdot\frac{\partial^+\ell}{\partial r}\le 
 s\cdot\cos\tangle\mc0\{r;s,\ell\}
+
r\cdot\cos\tangle\mc0\{s;r,\ell\}=\ell.
\eqno(**)\mc0_\ell
$$

Set 
$$f=\tfrac{1}{2}\cdot\dist[2]{p}{}{}.\eqno(A)\mc0$$ 
Clearly $f$ is $1$-concave and
$$\rho^+(r)=\tfrac{1}{r}\cdot\nabla_{\rho(r)} f\ \ \t{and}\ \ \sigma^+(s)=\tfrac{1}{s}\cdot\nabla_{\sigma(s)} f.\eqno(B)\mc0$$
Thus from \ref{lem:grad-lip}, we have
$$\frac{\partial^+\ell}{\partial r}
=
-\tfrac{1}{r}\cdot\<\nabla_{\rho(r)} f,\dir{\rho(r)}{\sigma(s)}\>
\le\frac{{\ell^2}+{R^2}-{S^2}}{2\cdot\ell\cdot r}.\eqno(C)\mc0$$
Since $R(r)\le r$ and $S(s_{\min})=s_{\min}$, we get 
$$
\begin{aligned}
\frac{\partial^+\ell}{\partial r}(r,s_{\min})
&\le
\frac{{\ell^2}+r^2-s_{\min}^2}{2\cdot\ell\cdot r}
=\\
&=
\cos\tangle\mc0\{s_{\min};r,\ell\},
\end{aligned}
\eqno(D)\mc0
$$
which is the first inequality in $(*)\mc0_\ell$.
By switching places of $\rho$ and $\sigma$ we obtain the second inequality in $(*)\mc0_\ell$.
Further, summing together $(C)\mc0$ with its mirror-inequality for $\frac{\partial^+\ell}{\partial s}$, we get
$$r\cdot\frac{\partial^+\ell}{\partial r}
+
s\cdot\frac{\partial^+\ell}{\partial s}\le \frac{{\ell^2}+{R^2}-{S^2}}{2\cdot\ell }+\frac{{\ell^2}+{S^2}-{R^2}}{2\cdot\ell }= \ell\eqno(E)\mc0$$
which is $(**)\mc0_\ell$.
\qeds

\parit{Proof of \ref{rad-mon} and \ref{rad-comp} in case $\kappa\not=0$.} Set as before
\begin{align*}
R=R(r)&=\dist{p}{\rho(r)}{},&\ell&=\ell(r,s)=\dist{\rho(r)}{\sigma(s)}{}
\\
S=S(s)&=\dist{p}{\sigma(s)}{},&\phi&=\phi(r,s)=\tangle\mc\kappa\{\ell(r,s);r,s\}.
\end{align*}
The statement follows from the following three inequalities:
$$\frac{\partial^+\phi}{\partial r}(s_{\min},r)\le 0,\ \ \ \ \ \ \ \ \ \ \frac{\partial^+\phi}{\partial s}(s,r_{\min})\le 0\eqno(*)\mc\pm_\phi$$
$$
\sn\kappa s\cdot\cs\kappa S\cdot\frac{\partial^+\phi}{\partial s}
+
\sn\kappa r\cdot\cs\kappa R\cdot\frac{\partial^+\phi}{\partial r}\le 0\eqno(**)\mc\pm_\phi
$$

Once they are proved,
the radial monotonicity follows from $(*)\mc\pm_\phi$.
The radial comparison follows from both $(*)\mc0_\phi$ and $(**)\mc\pm_\phi$.
Indeed, functions $s\mapsto \sn\kappa s\cdot\cs\kappa S$ and $r\mapsto \sn\kappa r\cdot\cs\kappa R$ are Lipschitz.
Thus there is a solution for differential equation
$$(r',s')=(\sn\kappa s\cdot\cs\kappa S,\sn\kappa r\cdot\cs\kappa R)$$ 
with any initial data. $(r_0,s_0)\in[r_{\min},\tfrac{\varpi\kappa}2)\times[s_{\min},\tfrac{\varpi\kappa}2)$.
(Unlike case $\kappa=0$ the solution can not be written explicitly.)
Since $\sn\kappa s\cdot\cs\kappa S$, $\sn\kappa r\cdot\cs\kappa R>0$, this solution $(r(t),s(t))$ must meet one of coordinate rays
$\{r_{\min}\}\times[s_{\min},\tfrac{\varpi\kappa}2)$ or $[r_{\min},\tfrac{\varpi\kappa}2)\times\{s_{\min}\}$.
I.e., one can connect pair $(s_{\min},r_{\min})$ to $(s_0,r_0)$ by a join of coordinate line and the solution $(r(t),s(t))$.
According to $(*)\mc\pm_\phi$ and $(**)\mc\pm_\phi$, the value of $\phi$ does not increase while pair $(r,s)$ moving along this join.
Thus $\phi(r_0,s_0)\le\phi(r_{\min},s_{\min})$.

As before we rewrite the inequalities $(*)\mc\pm_\phi$ and $(**)\mc\pm_\phi$ in terms of $\ell$:
$$
\begin{aligned}
\frac{\partial^+\ell}{\partial s}(s,r_{\min})
&\le 
\cos\tangle\mc\kappa\{r_{\min};s,\ell\},
\\
\frac{\partial^+\ell}{\partial r}(s_{\min},r)
&\le 
\cos\tangle\mc\kappa\{s_{\min};r,\ell\},
\end{aligned}
\eqno(*)\mc\pm_\ell
$$

$$
\begin{aligned}
\sn\kappa s&\cdot\cs\kappa S\cdot\frac{\partial^+\ell}{\partial s}
+
\sn\kappa r\cdot\cs\kappa R\cdot\frac{\partial^+\ell}{\partial r}\le 
\\
&\le\sn\kappa s\cdot\cs\kappa S\cdot\cos\tangle\mc\kappa\{r;s,\ell\}
+
\sn\kappa r\cdot\cs\kappa R\cdot\cos\tangle\mc\kappa\{s;r,\ell\}
\end{aligned}
\eqno(**)\mc\pm_\ell
$$
Further, set
$$f=-\tfrac{1}{\kappa}\cdot\cs\kappa\circ\dist{p}{}{}
=
\md\kappa\circ\dist{p}{}{}-\tfrac{1}{\kappa}.\eqno(A)\mc\pm$$
Clearly $f''+\kappa\cdot  f\le 0$ and
$$
\begin{aligned}
\rho^+(r)&=\frac{1}{\tg\kappa r\cdot\cs\kappa R}\cdot\nabla_{\rho(r)} f
\\
\sigma^+(s)&=\frac{1}{\tg\kappa s\cdot\cs\kappa S}\cdot\nabla_{\sigma(s)} f.
\end{aligned}
\eqno(B)\mc\pm$$
Thus from \ref{lem:grad-lip}, we have
$$\begin{aligned}
\frac{\partial^+\ell}{\partial r}
&=
-\frac{1}{\tg\kappa r\cdot\cs\kappa R}
\cdot
\<\nabla_{\rho(r)} f,\dir{\rho(r)}{\sigma(s)}\>
\le
\\
&\le
\frac
{1}
{\tg\kappa r\cdot\cs\kappa R}
\cdot
\frac
{\cs\kappa S-\cs\kappa R\cdot\cs\kappa\ell}
{\kappa\cdot\sn\kappa\ell}
=
\\
&=
\frac
{\frac{\cs\kappa S}{\cs\kappa R}-\cs\kappa\ell}
{\kappa\cdot\tg\kappa r\cdot\sn\kappa\ell}.
\end{aligned}
\eqno(C)\mc\pm$$
Note that for all $\kappa\not=0$,
the function $x\mapsto\frac{1}{\kappa\cdot\cs\kappa x}$ is increasing.
Thus, since $R(r)\le r$ and $S(s_{\min})=s_{\min}$, we get 
$$\begin{aligned}
\frac{\partial^+\ell}{\partial r}(r,s_{\min})
&\le 
\frac
{\frac{\cs\kappa s_{\min}}{\cs\kappa r}-\cs\kappa\ell}
{\kappa\cdot\tg\kappa r\cdot\sn\kappa\ell}
=
\\
&=
\frac
{{\cs\kappa s_{\min}}-\cs\kappa\ell\cdot\cs\kappa r}
{\kappa\cdot\sn\kappa r\cdot\sn\kappa\ell}=
\\
&=\cos\tangle\mc\kappa\{s_{\min};r,\ell\},
  \end{aligned}\eqno(D)\mc\pm$$
which is the first inequality in $(*)\mc\pm_\ell$ for $\kappa\not=0$.
By switching places of $\rho$ and $\sigma$ we obtain the second inequality in $(*)\mc\pm_\ell$.
Further, summing together $(C)\mc\pm$ with its mirror-inequality for $\frac{\partial^+\ell}{\partial s}$, we get
$$\begin{aligned}
\sn\kappa r\cdot\cs\kappa R\cdot\frac{\partial^+\ell}{\partial r}
&+
\sn\kappa s\cdot\cs\kappa S\cdot\frac{\partial^+\ell}{\partial s}\le
\\
&\le
\frac
{{\cs\kappa S}\cdot\cs\kappa r-\cs\kappa\ell\cdot\cs\kappa R\cdot\cs\kappa r}
{\kappa\cdot\sn\kappa\ell}
+\\
&\ \ \ \ +
\frac
{{\cs\kappa R}\cdot\cs\kappa s-\cs\kappa\ell\cdot\cs\kappa S\cdot\cs\kappa s}
{\kappa\cdot\sn\kappa\ell}=
\\
&=
\sn\kappa r\cdot\cs\kappa R\cdot
\frac
{\cs\kappa s-\cs\kappa\ell\cdot\cs\kappa r}
{\kappa\cdot\sn\kappa r\cdot\sn\kappa\ell}
+\\
&\ \ \ \ +
\sn\kappa s\cdot\cs\kappa S\cdot
\frac
{\cs\kappa r-\cs\kappa\ell\cdot\cs\kappa s}
{\kappa\cdot\sn\kappa s\cdot\sn\kappa\ell}
=
\\
&=\sn\kappa r\cdot\cs\kappa R\cdot\cos\tangle\mc\kappa\{r;s,\ell\}
+\\
&\ \ \ \ +\sn\kappa s\cdot\cs\kappa S\cdot\cos\tangle\mc\kappa\{s;r,\ell\}
\end{aligned}
\eqno(E)\mc\pm$$
which is $(**)\mc\pm_\ell$.\qeds


\begin{thm}{Corollary}\label{cor:rad-comp}
Let $\kappa\le0???$,
$\spc{L}\in\CBB{}{\kappa}$ 
and $p, q\in \spc{L}$.
Assume $\sigma\:[s_{\min},\tfrac{\varpi\kappa}2)\to \spc{L}$ is a $\dist{p}{}{}$-radial curves and $\dist{p}{q}{}\le \tfrac{\varpi\kappa}2$.
Then for any $w\ge 1$, 
the function
$$
s\mapsto \tangle\mc\kappa\{\dist{q}{\sigma(s)}{};\dist{p}{q}{},w\cdot s\}
$$
is non-increasing in whole domain of definition.
\end{thm}

\parit{Proof of \ref{cor:rad-comp}.}
???
\qeds














The next corollary shows that $\geod_{[p x]}$ can be extended behind $x$ as a unitspeed geodesic then it coinsides with radial curve starting at $x$ w.r.t. $p$.


\begin{thm}{Corollary}
Let 
$\spc{L}\in\CBB{}{\kappa}$, 
$\Kappa\in\RR$, 
$p, x\in \spc{L}$, 
$\dist{p}{x}{}<\tfrac{\varpi\Kappa}2$
and $\bar x\in [p x]$.
Let $\sigma$ be a $p$-radial curve  which is initiated at $\bar x$. 
Then 
$$\geod_{[p x]}(s)=\sigma(s)$$ 
at each $s\in \Dom\geod_{[p x]}\cap\Dom\sigma$.
\end{thm}

\parit{Proof.} Follows directly from \ref{prop:dist<s} and \ref{rad-curv-exist}. \qeds









Few times we need prove that certain gradinet curves have uniqueness of past, but it is hard to choose the generality for such theorem.

So far the only cases when we needed are formed by geodesics, but maybe with nonlinear reparametrization... Maybe even the following would be enough for all practical needs:

\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{}{}$, 
$p,q\in \spc{L}$ 
and $\alpha\:\II\to\spc{L}\backslash\{p\}$ 
be a $\dist{p}{}{}$-gradient curve.
Assume $\alpha(t_0)\in\l]pq\r[$ for some $t_0\in \II$ then
$\alpha(t)\in \l]pq\r[$ for all $t<t_0$,
morover
and
$\gamma\:\II\to \spc{L}$ be a unitspeed geodesic from $p$ to $q$.

\end{thm}

\begin{thm}{Lemma}
Let $\phi\RR\to\RR$ be a semiconcave function and $\phi^+(t)>0$ for all $t$.
Then $\alpha$ is an $f$ gradient curve
if and only if $\alpha\circ???$ is a $\phi\circ f$-gradient curve. 
\end{thm}




\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{}{}$,
$f,g\:\spc{L}\subto \RR$ be two semiconcave functions 
and $\alpha\:\II\to\spc{L}$ is a curve.
Assume 
\begin{subthm}{}
$\alpha(t)$ is a $f$-gradinet curve and $\alpha(-t)$ is a $g$-gradient curve.
\end{subthm}

\begin{subthm}{}
There is a constant $s$ such that $f+g\le s$ and $(f+g)\circ\alpha\equiv s$.
\end{subthm}
Then for any other $f$-gradient curve $\beta\:\JJ\to\spc{L}$,
with $\JJ\subset\II$, if $\alpha(t_0)=\beta(t_0)$ for some $t_0\in \JJ$ then $\alpha(t)=\beta(t)$ for all $t\in\JJ$.
\end{thm}


\begin{thm}{Theorem} \label{thm:grad-curv-unique-past}
???
Let $\spc{L}\in\CBB{}{}$ 
and
$f\:\spc{L}\subto \RR$ 
be locally Lipschitz and $f''+\kappa\cdot f\le \lambda$ for some real numbers $\kappa$ and $\lambda$.
Assume there is a unitspeed geodesic $\gamma\:\II\to\spc{L}$ such that $(f\circ\gamma)''+\kappa\cdot (f\circ\gamma)\equiv\lambda$ and SOME MORE???.
Then there is a reparametrization $\phi\:\JJ\to\II$ such that
$\gamma\circ\phi$ is an $f$-gradient curve.
Moreover if for some interval 
Assume $\hat\alpha\:[0,s_{\max})\to\Dom f$ is an $f$-gradient-like curve,
all geodesics $[\hat\alpha(s_0)\hat\alpha(s_1]$ lie in $\Dom f$
and $(f\circ\hat\alpha)''=\lambda$ everywhere on $[0,s_{\max})$.
Then $\hat\alpha$ is a unitspeed geodesic.

Moreover, if $\hat\beta\:\II\to\spc{L}$ is an other $f$-gradient-like curve 
such that $\II\subset[0,s_{\max})$ 
and $\hat\beta(s_0)=\hat\alpha(s_0)$ for some $s_0\in\II$ 
then $\hat\beta(s)=\hat\alpha(s)$ for all $s\le s_0$ in $\II$.
\end{thm} 

\parit{Proof.}???
Set 
$$\alpha(s_{\max})=\lim_{s\to s_{\max}-}\alpha(s).$$
and
$$\ell(s)
=
\dist{\alpha(0)}{\beta(s)}{}+\dist{\beta(s)}{\alpha(s_0)}{}.$$
Sinse $(f\circ\hat\alpha)''=0$, we have $(f\circ\hat\alpha)'$ is constant;
let us denote it by $w$.

Clearly
\begin{align*}
\ell^+(s)
&\ae
-\l(\<\dir{\beta(s)}{\alpha(s_0)},
\nabla_{\beta(s)}f\>
+
\<\dir{\beta(s)}{\alpha(0)},
\nabla_{\beta(s)}f\>
\r)\ge
\\
&\ge \frac{f\circ\beta(s)-f\circ\alpha(s_{\max})}{\dist{\alpha(s_{\max})}{\beta(s)}{}}
+
\frac{f\circ\beta(s)-f\circ\alpha(0)}{\dist{\alpha(0)}{\beta(s)}{}}
\ge
\\
&\ge 
\frac{w\cdot\dist[{{}}]{\alpha(0)}{\beta(s)}{}}%
{\dist[{{}}]{\alpha(s_{\max})}{\beta(s)}{}\cdot \dist[{{}}]{\alpha(0)}{\beta(s)}{}}\cdot\ell(s)
+
w\cdot
\end{align*}


Fix $s\in[0,s_{\max})$ and set $\ell=\dist{\alpha(0)}{\alpha(t)}{}$.
Consider a unitspeed geodesic 
$\geod_{[\alpha(0)\alpha(t)]}\:[0,\ell]\to\spc{L}$.
Note that 

\qeds





Let $\spc{L}\in\CBB{m}{\kappa}$,
$x,y\in \spc{L}$ be a pair of distinct points.
Let us define bisector of $x$ and $y$ as
$$\Bis(x,y)=\set{p\in\spc{L}}{\dist{x}{p}{}=\dist{y}{p}{}}.$$

Further, set $f=\tfrac{1}{2}\cdot\min\{\dist[2]{x}{}{},\dist[2]{y}{}{}\}$ and choose $R>0$.
Define gradient $R$-bisector of $x$ and $y$  
as the set of points $q\in\spc{L}$ such that there is $p\in\Bis(x,y)$ and nonnegative number $t\le \ln\tfrac{R}{\dist{x}{p}{}}$ such that $q=\alpha_p(t)$,
where $\alpha_p$ is an $f$-gradient curve which starts at $p$. 
The gradient $R$-bisector of $x$ and $y$ will be further denoted as $\GradBis(R;x,y)$

\begin{wrapfigure}[8]{r}{30mm}
\begin{lpic}[t(-5mm),b(0mm),r(0mm),l(0mm)]{pics/gradient-bisector-triangle(0.4)}
\lbl[br]{21,31;$x$}
\lbl[tl]{43,22;$y$}
\lbl[rb]{44,63,67;{\small $\GradBis(\ $}}
\lbl[b]{44,63,53;{\small $R$}}
\lbl[lb]{44,63,27;{\small $\ ;x,y)$}}
\lbl[]{55,45;$\spc{L}$}
\end{lpic}
\end{wrapfigure}

\parbf{Remark.}
Note that $|\nabla_pf|\le\min\{\dist{x}{p}{},\dist{y}{p}{}\}$.
Therefore $\GradBis(R;x,y)$ contains only points on distance $\le R$ from both $x$ and $y$;
among these, it contains all points on the bisector $\Bis(x,y)$.
But in general $\GradBis(R;x,y)$ is bigger than the set $$\Bis(x,y)\cap\cBall(R,x)=\Bis(x,y)\cap\cBall(R,y).$$
For example, assume that space $\spc{L}\in\CBB{}{0}$ is isometric to a solid plane triangle, then,
the set $\GradBis(R;x,y)$ for some $x,y\in\spc{L}$ might contain segments on the boundary of $\spc{L}$ (as on the figure).


\begin{thm}{Lemma on gradient bisector}\label{lem:GB}
Let $\spc{L}\in\CBB{m}{\kappa}$, 
$x,y\in \spc{L}$ be a pair of distinct points.
Set $\Lip=???(\kappa,R)$
Then there is a $\Lip$-Lipschitz map $\map\:\SS^{m-1}\to\spc{L}$ such that 
$\Im\map\supset\GradBis(R;x,y)$.
\end{thm}

\parit{Proof.}
Without loss of generality, we can assume that $\kappa= -1$.

Set as above $f=\tfrac{1}{2}\cdot\min\{\dist[2]{x}{}{},\dist[2]{y}{}{}\}$.

Denote by $\Sphere$ the metric sphere of radius $\tfrac{\dist{x}{y}{}}{2}$ with the center at $x$; 
i.e.
$$\Sphere=\set{p\in\spc{L}}{\dist{x}{p}{}=\tfrac{\dist{x}{y}{}}{2}}.$$

\begin{clm}{Claim}\label{clm:metric-sphere<sphere}
There is a $(\sinh\tfrac{\dist{x}{y}{}}{2})$-Lipshitz map 
$h\:\SS^{m-1}\to\spc{L}$ such that 
$$\Sphere\subset h(\SS^{m-1}).$$

\end{clm}

\parit{Proof of the claim.}
First assume that $x$ is Euclidean;
i.e. $\T_x\iso\EE^m$.
For each direction $\xi\in\Sigma_x\iso\SS^{m-1}$, 
draw the radial curve $\sigma_\xi(t)$ with $\sigma^+_\xi(0)=\xi$ (see ???).
From \ref{rad-comp}, 
it follows that if $\xi^1,\xi^2\in\Sigma_x$ and $\mangle(\xi^1,\xi^2)=\phi$ then $\dist{\sigma_{\xi^1}(t_1)}{\sigma_{\xi^2}(t_2)}{}\le \side\kappa \{\phi,t_1,t_2\}$.
In particular, the map $h\:\xi\mapsto\sigma_\xi(\tfrac{\dist{x}{y}{}}{2})$ is a $(\sinh\tfrac{\dist{x}{y}{}}{2})$-Lipschitz map from $\Sigma_x\iso\SS^{m-1}$ to $\spc{L}$.

If $x$ is not  Euclidean apply the above construction for a sequence of Euclidean points $x_n\to x$ 
and pass to the partial limit of corresponding maps $h_n\:\SS^{m-1}\to\spc{L}$.
\qeds

Set 
$$T\z=\ln\tfrac{2\cdot R}\eps\ \ \t{and}\ \ \lambda=2\cdot R\cdot \tfrac{\cosh(2\cdot R)}{\sinh(2\cdot R)}???.$$
Note that the function 
$f''(p)
\le 
\lambda$
 for any  $p\in\cBall(x,2\cdot R)$ (it follows from ??? and ???).
Further for any $t\in[0,T]$ and any $p\in\cBall(x,\eps)$,
we have $\GF^t_f(p)\in\cBall(x,R)$, where $\GF$ denotes $f$-gradinet flow; see ???.

According to ???, the restriction $\GF^T_f|_{\cBall(x,\eps)}$ is $e^{T\cdot \lambda}$-Lipschitz.
Hence the composition $\map=\GF^T_f\circ h$ is ???-Lipschitz.


It remains to show that $\map(\SS^{m-1})\supset \GradBis(R;x,y)$.
From Claim \ref{clm:metric-sphere<sphere}, it is enough to show that $\GF^T_f(\Sphere_\eps)\supset\GradBis(R;x,y)$.
Let $q\in\GradBis(R;x,y)$, $p\in\Bis(x,y)$ and $t\in???$ be as in the definition of gradient bisector (???).
Then




It remains to show that $\Im\map_R\supset \RB\kappa(R;x,y)$.
First note that
if $\dist{x}{q}{}=\dist{y}{q}{}=s_0$ then $q\in\Im\map_{s_1}$ for any $s_1\ge s_0$.
Indeed, as it follows from ???, $\Im\map_s$ separates $x$ and $y$ in $\spc{L}$.
Thus, for any choice of geodesics $[q x]$ and $[q y]$, 
the set $\Im\map_s$ contains at least one point on $[x q]\cup[q y]$.
However, it can not contain any point except $q$.
Indeed, according to ??? if $f$-radial curve ends in an interior point of an $f$-radial??? geodesic, 
then it coinsides with this geodesic on the whole integral of definition; i.e $s<s_0$, a contradiction.

Now assume $p\in \RB\kappa(R;x,y)$.
Thus,
there are numbers $s_0\le s_1\le R$, and point $q$ as in the construction of radial bisector (\ref{constr:Rad-bis}).
From above, we have that for any $s\ge s_0$ there is $\xi(s)\in\Sigma_x$ such that $q=\sigma_{\xi(s)}(s)$.
Note that the set $\sigma_{\xi(s)}[s,\infty)$ coinsides with $\sigma[s_0,\infty)$ 
for any $s\ge s_0$.
Further note, that the map $\tau\:s\mapsto \sigma_{\xi(s)}(R)$ is continuous%
\footnote{Note however that the map $s\mapsto\xi(s)$ might be non-continuous.}
for $s\in[s_0,R]$.
Clearly, $\tau(R)=q$ and $\tau(s_0)=\sigma(R)$.
Thus, the curve $\tau|_{[s_0,R]}$ runs along $\sigma|_{[s_0,R]}$ in opposite direction.
In particular, for some $s\in[s_0,R]$, we have
$p=\sigma_{\xi(s)}(R)$.
Therefore $p\in\Im\map_R$.

Finally, if $x$ is not Euclidean, choose a sequence of regular points $x_n\to x$ (the existence of this sequence follows from \ref{LinDim+-f}).
Applying the above argument, we get the existence of a sequence of $(\sn\kappa R)$-Lipschitz maps $\map_{R;n}\:\SS^{m-1}\to\spc{L}$ such that 
$\Im\map_{R;n}
\supset
\RB\kappa(R;x_n,y)$.
From ???, it follows that $\RB\kappa(R;x_n,y)$ converges 
in the Hausdorff sense to $\RB\kappa(R;x,y)$ ???WHY???.
Thus one can take $\map_R$ to be a partial limit of $\map_{R;n}$ as $n\to\infty$.
\qeds




\parit{Proof of \ref{thm:dist-emb}.}
Note that for any choice of $\bm{a}\in\spc{L}^\kay$,
the distance map $\dist{\bm{a}}{}{}\:\spc{L}\to\RR^\kay$ is $\kay$-Lipschitz.
Thus it remains to show that one can choose $\kay$, $\bm{a}$ and $\eps>0$ on such a way that 
$$|\dist{a^i}{x}{}-\dist{a^i}{y}{}|>\eps\cdot\dist[{{}}]{x}{y}{}
\ \ \t{for at least one}\ \ i
\eqlbl{eq:bilip}$$
and any $x,y\in\Omega$.

Without loss of generality,
we can assume that $\kappa\le 0$ (see ???).
Assume we want to choose all $a^i$ in $\oBall(z,r)$ for some $0<r\le R$;
that is only needed to prove (\ref{SHORT.thm:dist-emb:close.to.z}).

For small enough $\delta>0$,
choose $\bm{a}$ so that the set $\{a^1,a_2,\dots,a^\kay\}$ 
forms a \emph{maximal $\delta$-packing}\index{maximal $\eps$-packing} in $\oBall(z,r)$;
i.e. $\kay=\pack_\delta\oBall(z,r)$ and $\dist{a^i}{a^j}{}>\delta$ for all $i\not=j$.
Note that according to \ref{pack}, we have $\kay>\Const/\delta^m$ for some $\Const>0$.
Thus, we can assume that

\begin{wrapfigure}{l}{22mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]{pics/pp-1(0.45)}
\lbl[rt]{10,3;$x$}
\lbl[lt]{33,3;$y$}
\lbl[l]{42,51;$p$}
\lbl[r]{26,60;$p'$}
\lbl[r]{20,46;$\sigma(s)$}
\lbl[t]{21,31;$q$}
\lbl[l]{4,30;$\spc{L}$}
\end{lpic}
\end{wrapfigure}
$$\kay>\pack_{\delta_1}\SS^{m-1},
\ \ \t{where}\ \ 
\delta_1=\frac{\delta}{2\cdot\sn\kappa (2\cdot R)}.\eqlbl{delta-def}$$


For fixed $x,y\in\spc{L}$ and arbitrary point $p\in\spc{L}$, 
let us describe a construction of a new point $p'$ on gradient bisector of $x$ and $y$.
Assume $\dist{x}{p}{}\ge\dist{y}{p}{}$; 
if not --- switch $x$ and $y$ in all the following construction.
Choose a point $q\in [x p]$ such that $\dist{x}{q}{}=\dist{y}{q}{}$.
Set $s_0=\dist{x}{q}{}=\dist{y}{q}{}$ and $s_1=\dist{x}{p}{}$.
As above, set $f=\min\{\dist{x}{}{},\dist{y}{}{}\}$.
Let $\sigma\:[s_0,\infty)\to\spc{L}$ be an $f$-radial 
curve which starts at $q$.
Then set $p'=\sigma(s_1)$.
Clearly, $s_1\le 2\cdot R$; hence $p'\in \RB\kappa(2\cdot R;x,y)$.

\begin{wrapfigure}{r}{22mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]{pics/pp-1-model(0.45)}
\lbl[rt]{10,5;$\~x$}
\lbl[lt]{33,5;$\~y$}
\lbl[rb]{42,52;$\~p$}
\lbl[lb]{3,52;$\~p'$}
\lbl[l]{24,19;$\~q$}
\lbl[l]{40,17;$\Lob2{\kappa}$}
\end{lpic}
\end{wrapfigure}

Now let us construct corresponding model configuration.
Consider a model triangle $\trig{\~x}{\~y}{\~p}=\modtrig\kappa(x y p)$ in $\Lob2{\kappa}$.
Let $\~p'$ be the reflection of $\~p$ in the bisecting perpendicular to $[\~x\~y]$
and $\~q$ lie on the intersection of $[\~x\~p]$ and $[\~y\~p']$.
From ??? comparison, 
$\dist{\~y}{\~q}{}\le s_0$
and clearly $\dist{\~y}{\~q}{}+\dist{\~q}{\~p}{}=s_1=\dist{y}{q}{}+\dist{q}{p}{}$.
It follows that $\mangle\hinge{\~y}{\~p}{\~q}\le\angk{\kappa}{y}{p}{q}$.
Thus, from radial comparison (???MORE GENERAL THAN \ref{rad-comp}???), we have 
$$\dist{p}{p'}{}\le\dist{\~p}{\~p'}{}.
\eqlbl{eq:|p p'|}$$

Assume 
$x,y\in\Omega$, 
$p\in\oBall(z,r)$,
and $|\dist{p}{x}{}-\dist{p}{y}{}|\le\eps\cdot\dist[{{}}]{x}{y}{})$.
Clearly $\dist{x}{y}{}$, $\dist{x}{p}{}$, $\dist{y}{p}{}\le 2\cdot R$;
thus $p'\in\RB\kappa(2\cdot R;x,y)$.
Direct calculations show that 
$\dist{\~p}{\~p'}{}<\sqrt{\eps}$ 
for all small enough $\eps>0$.
Inequality \ref{eq:|pp'|} implies that we can fix $\eps=\eps(\delta,\kappa,\RR)>0$ so small that 
$$\dist{p}{p'}{}<\sqrt{\eps}<\tfrac\delta 4.
\eqlbl{eps-def}$$

Now assume \ref{eq:bilip} does not hold; i.e.
$$|\dist{p^i}{x}{}-\dist{p^i}{y}{}|\le\eps\cdot\dist[{{}}]{x}{y}{}
\ \ \t{for each}\ \ i.
$$
Then for each $i$ we have $\dist{a^i}{{a^i}'}{}<\sqrt{\eps}$.
Therefore $\dist{{a^i}'}{{a^j}'}{}>\delta-2\cdot\sqrt{\eps}>\tfrac\delta2$.
Applying the lemma on gradient bisector (\ref{lem:GB}), we get a contradiction with \ref{delta-def}.

\parit{(\ref{SHORT.thm:dist-emb:L_n-->L})} ???
\qeds












A constant-speed reparametrization of geodesic will be called \emph{constant-speed geodesic}\index{constant-speed geodesic}.
More precicely, a curve $\gamma\:\II\to\spc{X}$ is  
constant-speed geodesic path if $\gamma(t)=\bar\gamma(\Const\cdot t)$ for some $\Const\in\RR$ and geodesic $\bar\gamma$.












\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{m}{\kappa}$
$\hmy{f},\hmy{h}\in\MD(\spc{L},\RR)$
and $x\in\Dom\hmy{f}\cap\Dom\hmy{h}$.
Then for any $v\in \hmy{\partial}_x\hmy{f}$ and $w\in\hmy{\partial}_x\hmy{h}$,
we have 
$$\<v,w\> \le \scal\mc\kappa_x(\hmy{f},\hmy{h}).$$

\end{thm}

\parit{Proof.}
Let $f\can F\circ\dist{\bm{p}}{}{}$ 
and $h\can H\circ\dist{\bm{q}}{}{}$.
Given $\eps >0$, choose a smooth supporting function $\bar F$ of $F$ at $\dist{\bm{p}}{x}{}$ 
and geodesics $[p^ix]$ such that for the vector array $v^i=\partial\bar F\cdot\dir{x}{p^i}$, we have
\begin{align*}
\<v,w\>&\le\sum_i\<v^i,w\>\le\\
\intertext{Further, for each $i$, choose a smooth supporting function $\bar H^i$ of $H$ at $\dist{\bm{q}}{x}{}$ 
and geodesics $[q^jx]$ such that for the vector array $w^{ij}=\partial\bar H^i\cdot\dir{x}{q^j}$, we have}
&\le\sum_{i,j}\<v^i,w^{ij}\>\le
\intertext{Finally, applying ??? for each array $w^{1j},w^{2j},\dots,w^{?j}$ and $\alpha_i=???$, we can construct $w^j\in\biguplus_i\alpha_i\cdot w^{ij}$, so we get}
&\le\sum_{i,j}\<v^i,w^{j}\>.
\end{align*}
\qedsf

\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{m}{\kappa}$ and $p\in\spc{L}$.
Then for arbitrary multidistant function $\hmy{f}$ which is defined at $p$, there is a choice of supporting vector $\SuppVec_p\hmy{f}\in\partial_p\hmy{f}$ 
such that for any two subfunctions $\hmy{f}, \hmy{h}\in\MD(\spc{L},\RR)$ defined at $p$,
we have
$$\<\SuppVec_p\hmy{f},\SuppVec_p\hmy{h}\>
\le 
\scal\mc\kappa_p(\hmy{f},\hmy{h}).
\eqlbl{eq:SuppVec}$$

\end{thm}
Informally, $\scal\mc\kappa_p(\hmy{f},\hmy{h})$ serves as comparison aanalog of $\<\d_p\hmy{f},\d_p\hmy{h}\>$.
In particular, as it follows from \ref{eq:SuppVec} if $\spc{L}$ is Riemannian and functions $\hmy{f}$, $\hmy{h}$ are smooth at $p$ then 
$$\<\d_p\hmy{f},\d_p\hmy{h}\>
\le 
\scal\mc\kappa_p(\hmy{f},\hmy{h}).$$


\parit{Proof.}
In order to describe the choice of $\SuppVec_p\hmy{f}$ we need to introduce an analog of addition in tangent cone at $p$.

Let us fix a choice of geiodesic $[vw]$ in $\T_p$ for any two vectors $v,w\in\T_p$.
Set $\plus(v,w)=2\cdot z$, where $z$ is the midpoint of $[vw]$.
From ??? comparison, it follows that 
$$\<x,v\>+\<x,w\>\ge \<x,\plus(v,w)\>.
\eqlbl{eq:plus(v,w)}$$
for any $x\in\T_p$.

Further, define recurcevly 
$$\plus(v^1,v^2,\dots,v^\kay)=\plus(v^1,\plus(v^2,\dots,v^\kay)).
\eqlbl{eq:plus(v^1..v^k)}$$
From \ref{eq:plus(v,w)}, we get
$$\sum_{i,j}\<v^i,w^i\>
\ge
\<\plus(v^1,v^2,\dots,v^\kay),\plus(w^1,w^2,\dots,w^n)\>\eqlbl{eq:plus-plus}$$
for any two arrays $(v^1,v^2,\dots,v^\kay)$ and $(w^1,w^2,\dots,w^n)$ of vectors in $\T_p$.

If tangent cone is Euclidean, the described ``addition'' coinside with usual addition.
For general tangent cone the value of $\plus(v^1,v^2,\dots,v^\kay)$ might depend on the order of items, it also depends on the choice of geodesics made above.


Let $\hmy{f}\can F\circ\dist{\bm{a}}{}{}$.
Choose a smooth supporting function $\bar F$ of $F$ at 
$\dist{\bm{a}}{p}{}$ and a geodesic $[pa^i]$ for each $i$.
Let $v^i=\partial_i\bar F\cdot \dir{p}{a^i}$ for each $i$.
Then set 
$$\SuppVec_p\hmy{f}=\plus(v^1,v^2,\dots,v^\kay).$$

It follows from \ref{eq:plus-plus} and definition of comparison scalar product above,
that the introduced $\SuppVec_p$ satisfies \ref{eq:SuppVec}.
\qeds














\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{}$ and $\hmy{f}\in\MD(\spc{L},\RR)$.
Then $\hmy{f}$ is locally Lipschitz semiconcave subfunction.
Moreover for any $p\in\Dom{\hmy{f}}$ the set of supporting vectors $\partial_p\hmy{f}$ is not empty.
\end{thm}

\parit{Proof.}???\qeds







that for any $z\in\T_p$, we have
\begin{align*}
\<\nabla_x\hmy{f},z\>
&\ge
\d_x\hmy{f}(z)=
\\
&=\d_{\dist{\bm{p}}{x}{}}F\circ\d_x\dist{\bm{p}}{}{}(z)
\\
&=
\inf
\set{\d_{\dist{\bm{p}}{x}{}}\bar F\circ\d_x\dist{\bm{p}}{}{}(z)}%
{\bar F\in\mathcal{S}_xF}
\\
&=
-\sup
\set{\sum_i\partial_i\bar F\cdot\<v^i,z\>}%
{\bar F\in\mathcal{S}_xF, v^i\in\Dir{x}{p^i}}
\end{align*}
where $\mathcal{S}_xF$ denotes the set of all smooth supports of $F$ at $\dist{\bm{p}}{x}{}$.
Further, 






%\item\label{sn-cn_k-diff-eq}
%It is straightforward to check that for fixed $a$ and $\phi$, the functions 
%$$y(t)=\sn\kappa(\side\kappa(\phi;a,t))\ \ \text{and}\ \ y(t)=\cs\kappa(\side\kappa(\phi;a,t))$$
% satisfies the following differential equation:
%$$y''+\kappa\cdot  y=0.$$










Define a sequence of submaps $\map_n\:\RR^m\subto n\blow\spc{L}:n\cdot x\mapsto n\blow\map(x)$.
Clearly all $\map_n$ are $\Lip$-Lipschitz.
Thus the $\o$-limit $\map_\subinfty\:\RR^m\to \T_q$ of $\map_n$ is also $\Lip$-Lipshitz.
Clearly??? $\map_\subinfty$ is an inverse of 
$\d_q f=\d_q\dist{\bm{a}}{}{}$.














Let $f(q)=\dist{q}{x}{}+\dist{q}{y}{}$. Then $f$ is concave on $ \oBall(z,\eps/4)$ by (~\ref{concave-pi/2}) as a sum of two concave functions. 
By the first variation formula we see that $z$ is a local extremum point of $f$ which must be a  maximum as $f$ is concave on $ \oBall(z,\eps/4)$.


Let $q\in \oBall(z,\eps/4)$. 
Then $\dist{q}{x}{}+\dist{q}{y}{}=f(q)\le f(z)=\dist{x}{z}{}+\dist{z}{y}{}=\dist{x}{y}{}$. 
This violates the triangle inequality unless the inequality in the above formula is an equality. 
Hence $\dist{q}{x}{}+\dist{q}{y}{}=\dist{x}{y}{}$ which by uniqueness of the shortest $[xy]$ implies that $q\in [xy]$.













\begin{wrapfigure}{r}{37mm}
\begin{lpic}[t(0mm),b(10mm),r(0mm),l(0mm)]{pics/strong-ang(0.4)}
\lbl[l]{50,85;$q$}
\lbl[l]{4,27;$\bar q$}
\lbl[br]{33,21;$\bar q_n$}
\lbl[rt]{4,3;$p$}
\lbl[t]{90,0;$x$}
\lbl[t]{18,0;$x_n$}
\lbl[t]{50,1;$\bar x$}
{\small
\lbl[lb]{9,7;$\phi$}
\lbl[l]{26,7,20;$<\phi-\tfrac\eps2$}
}
\end{lpic}
\end{wrapfigure}









and set $\bar q_n=\geod_{[x_n q]}(\ell)$.
From \ref{eq:phi-eps}, we have $\liminf_n\angk\kappa{x_n}q p\ge \pi-\phi+\eps$.
From the hinge comparison (\ref{angle}), for all large $n$ we have
$$\angk\kappa{x_n}{\bar x}{\bar q_n}
\le\mangle\hinge{x_n}x q
\le \pi - \mangle\hinge{x_n}q p
\le \pi-\angk\kappa{x_n}q p
< \phi-\tfrac\eps2.$$

Let $\gamma_0$ be the $\o$-limit of $[x_nq]$ in $\spc{L}^\o$. Then by above and angle semicontinuity ~\ref{lem:ang.semicont} we have that the angle between $\geod_0(t)$ and $[px]$ is at most $\phi-\eps/2$. This contradicts the definition of $\phi$.









\parbf{Remark.}
Without compactness, this theorem does not hold. 
For example, consider constant sequence of spaces  $\spc{X}_n=\RR_\ge$ and $\spc{X}_\subinfty=\RR_\ge$, $\bar{\spc{X}}_\subinfty=\RR$.
Then $\spc{X}_n\GHtoh{a_n}\spc{X}_\subinfty$ with the sequence of identity maps
$a_n\:\RR_\ge\to\RR_\ge$ at the same time 
$\spc{X}_n\GHtoh{\bar a_n}\bar{\spc{X}}_\subinfty$
for sequence $\bar a_n\:\RR_\ge\to\RR$ defined as $\bar a_n(x)=x-n$.












\begin{subthm}{}
For any point $x_\subinfty\in\spc{X}_\subinfty$ there is a sequence of points  $x_n\in\spc{X}_n$ such that $\rho(x_n,x_\subinfty)\to0$. 
\end{subthm}


n}\label{def:GH}
Let $\spc{X}_1,\spc{X













Brifly, we write $\spc{X}_n\GHto \spc{X}_\subinfty$ or $\tau\:\spc{X}_n\GHto \spc{X}_\subinfty$ if we want to spacify the convergence.
In this case the space $\spc{X}_\subinfty$ is called \emph{Gromov--Hausdorff limit}\index{Gromov--Hausdorff limit} of $\spc{X}_n$ via approximations $a_n$, or brifly,
$\spc{X}_n\GHtoh{a_n}\spc{X}_\subinfty$.
We will also write
$$\spc{X}_n\GHto\spc{X}_\subinfty
\ \ \t{or}\ \ 
\spc{X}_\subinfty=\GHlim_{n\to\infty} \spc{X}_n,$$
meaning that there is a sequence of Hausdorff approximations $a_n\:\spc{X}_n\to\spc{X}_\subinfty$.


We say that $\tau???$ defines Gromov--Hausdorff convergence $\spc{X}_n\to\spc{X}_\subinfty$ if
We say that sequence of maps $a_n\:\spc{X}_n\to\spc{X}_\subinfty$ are \emph{Hausdorff approximations}\index{Hausdorff approximations} 
if 
\begin{subthm}{def:GH:appr1}
For any point $x_\subinfty\in \spc{X}_\subinfty$ there is a sequence of points $x_n\in\spc{X}_n$ such that $a_n(x_n)\to x_\subinfty$.
\end{subthm}

\begin{subthm}{def:GH:appr2}
 If for two sequences $x_n, y_n\in\spc{X}_n$, 
the sequences  $\bar x_n=a_n(x_n)$ and $\bar y_n\z=a_n(y_n)$ are bounded in $\spc{X}_\subinfty$ then
$$(\dist{x_n}{y_n})_{\spc{X}_n}-(\dist{\bar x_n}{\bar y_n})_{\spc{X}_\subinfty}\to 0\ \ \t{as}\ \ n\to\infty.$$


















\begin{thm}{Definition}
The subgraph and supergraph of $\kappa$-development with respect to its base is called \emph{$\kappa$-subdevelopment} and correspondingly \emph{$\kappa$-superdevelopment}.

A $\kappa$-development is called \emph{(locally) convex} if it is (locally) convex with respect to its base.
\end{thm}








\begin{thm}{Definition}
Let $\trig{p_1}{p_2}{p_3}$ be a triangle in a metric space.
We say that triangle $\trig{p_1}{p_2}{p_3}$ satisfies \emph{$\Cat{}{\kappa}$ angle comparison} if for any permutation $(i,j,\kay)$ of $(1,2,3)$, we have that $\mangle\hinge{p_i}{p_j}{p_\kay}$ is defined and can not ecxeed $ \angk\kappa{p_i}{p_j}{p_\kay}$.
\end{thm}






Once it is done, one can construct a noncontracting map $\Sigma_p\to \Sigma$ by passing to a partial limit of maps $\xi_i\mapsto \zeta_i$.

For each $\xi_i$, choose $x_i\in \spc{L}$ so that $\dir{p}{x_i}\approx \xi_i$, one can do this so that
$\angk\kappa p{x_i}{x_j}>\mangle(\xi_i,\xi_j)-\eps$ for all pairs $(i,j)$.
For each $x_i$, choose a sequence $x_{i,n}\in \spc{L}_n$ so that $x_{i,n}\to x_i$.

Passing to a subsequence of $\Sigma_{p_n}$, we can assume that $\dir{p_n}{x_{i,n}}$ converges for any $i$.
Set $\zeta_i=\lim_n\dir{p_n}{x_{i,n}}$.
Then 
\begin{align*}
\dist{\zeta_i}{\zeta_j}
&\ge 
\liminf_{n\to\infty}\mangle(\dir{p_n}{x_{i,n}},\dir{p_n}{x_{j,n}})
\ge
\\
&\ge 
\liminf_{n\to\infty}\angk\kappa {p_n}{x_{i,n}}{x_{j,n}}
=
\\
&=
\angk\kappa p{x_i}{x_j}
\ge 
\\
&\ge
\mangle(\xi_i,\xi_j)-\eps
\end{align*}
\qedsf




By definition of strutt (\ref{def:stratts-I}), condition (\ref{SHORT.thm:inverse-function:strut}) holds for $\Omega\z=\oBall(p,r)$ if $r>0$ is sufficiently small.

\parit{(\ref{SHORT.thm:inverse-function:chart}).} 












\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{}$ and $\eps>0$.
Then one can present $\spc{L}$ as a countable union of disjoint??? compact sets $\mathfrak C_i$
such that for any two points $x,y\in \mathfrak C_i$ we have $\GHdist(\Sigma_x,\Sigma_y)<\eps$ and moreover for any $\xi\in\Sigma_x\mathfrak C_i$ we have $\GHdist(\Sigma_\xi\T_x,\Sigma_p)<\eps$.
\end{thm}













Sinse $\dist{}{}$ is bi-Lipshitz equivalent to the canonical metric, given $\bm{x},\bm{x'}, \bm{v}\in\RR^m$, the value 
$$|(\dist{\bm{x}}{\bm{x}{+}\lam\cdot\bm{v}})-(\dist{\bm{x'}}{\bm{x'}{+}\lam\cdot\bm{v}})|$$
stays bounded for arbitrary large $\lam$.
Further, the consdition \ref{SHORT.lem:affine=>isom:speed} implies that
$$\dist{\bm{x}}{\bm{x}{+}\lam\cdot\bm{v}}
=
|\lam|\cdot(\dist{\bm{x'}}{\bm{x}{+}\bm{v}})|$$
for any $\bm{x},\bm{v}\in\RR^m$.



 are unique, the invese map $\bm{f}^{-1}\:\RR^m\to\spc{L}$ is affine.
It follows that if points $\bm{x},\bm{y},\bm{x'},\bm{y'}$ lie on a straight line in $\RR^m$ and $y-x=\lam\cdot(y'-x')$ for some $\lam\in\RR$ then
$$\rho(\bm{x},\bm{y})=|\lam|\cdot\rho(\bm{x'},\bm{y'}).$$

Further, 
given $\bm{x},\bm{x'}, \bm{v}\in\RR^m$,
note that sinse $\bm{f}$ is bi-Lipschitz, the value 
$$\rho(\bm{x},\bm{x}+\lam\cdot\bm{v})-\rho(\bm{x'},\bm{x'}+\lam\cdot\bm{v})$$
stays bounded for arbitrary large $\lam$.
Togeher with ???, it implies that 
$$\rho(\bm{x},\bm{y})=\|\bm{x}-\bm{y}\|$$
for some norm $\|{*}\|$ on $\RR^m$.
Thus the statement follows from ???
\qeds















\section{Metric semitensor}

Let $U$ be a domain in $\RR^m$.
Assume that for each point $\bm{x}\in U$ there is a choice of function $\<{*},{*}\>\:\RR^m\times\RR^m\to \RR$, $(v,w)\mapsto\<v,w\>$ which is positive homgenius in each argument; i.e. $\<\lam\cdot v, w\>=\lam\cdot\<v,w\>=\<v,\lam\cdot w\>$ for any $v,w\in \RR^m$ and any $\lam\ge0$.
Let $\spc{L}\in\CBB{m}{}$.
Such a choice is called metric semitensor on $U$.

Let $\spc{L}\in\CBB{m}{}$ and $\bm{x}=(x^1,x_2,\dots,x^m)$ be a distant chart in $\spc{L}$.
Since $\d_p\bm{x}\:\T_p\to\RR^m$ is a bi-Lipschitz cone-isomorphism,
the scalar product on $\T_p$ induces a metric semitensor on $\Im\bm{x}$.
Using metric semitensor, it is possible to calculate length of Lipschitz curves in $\Dom \bm{x}$.
If $\gamma:[a,b]\to\Dom \bm{x}$ is a Lipschitz curve then 
$$\length\gamma
=
\int\limits_a^b
\sqrt{\<\d_\gamma(t)\bm{x}(\gamma^+(t)),\d_\gamma(t)\bm{x}(\gamma^+(t))\>}\d t.$$
Thus, knowing only metric semitensor, 
it is also possible to restore locally the metric on $\Dom \bm{x}$.
But the constructed metrics for different metric semitensors might coinside locally.
Infact, if two metric semitensors $g$ and $g'$ on domaain $U\i\RR^m$ are such that for any Lipschitz curve $\alpha\:[a,b]\to U$ the values 
$g(\alpha^+(t),\alpha^+(t))
\ae 
g'(\alpha^+(t),\alpha^+(t))$ then the metric induced by $g$ and $g'$ coinside locally.








defined by 
$$\sigma_n=\set{\bm{x}\in\HH}{x_n\ge0\ \t{and}\ x_i=0\ \t{if}\ i\not=0,n}.$$










Given a unit vector $\bm{u}\in \HH$, consider closed set 
$$\mathfrak{C}_{\bm{u}}=\set{(\bm{x},z)\in \check{\spc{L}}}
{z\le\eps\cdot(1+\eps)\cdot \<\bm{u},\bm{x}\>}.$$
Note that each set $\mathfrak{C}_{\bm{u}}$ is totally convex in $\check{\spc{L}}$;
i.e. any geodesic in $\check{\spc{L}}$ with ends in $\mathfrak{C}_{\bm{u}}$ lies completely in $\mathfrak{C}_{\bm{u}}$.
That can be shown by orthogonal projecting $\check{\spc{L}}\backslash \mathfrak{C}_{\bm{u}}$ to the hyperplane
$z\z=\eps\cdot(1+\eps)\cdot \<\bm{u},\bm{x}\>$???.
Further note that each set $\mathfrak{C}_{\bm{u}}$ inersects at most one of $\Omega_n$ 
and for some small $\delta=\delta(\bm{u})>0$, $\oBall(p,\delta)\cap\mathfrak{C}_{\bm{u}}$ is a cone with vertex at $p$ in $\HH$.

In particular, any geodesic $[p q]$ in $\check{\spc{L}}$ coinsides with a geodesic in $\spc{L}$ near $p$ (which is a straight segment in $\HH\times\RR$).
Thus we can treat $\Sigma_p\spc{L}$ and $\Sigma_p\check{\spc{L}}$ as one set, with two angle metrics $\mangle$ and $\check\mangle$.
Further, if two geodesics $[pq]$ and $[pq']$ in $\check{\spc{L}}$ belong one set $\oBall(p,\delta(\bm{u}))\cap\mathfrak{C}_{\bm{u}}$ as above then they are also geodesics in $\spc{L}$ and $\mangle\hinge{p}{q}{q'}=\check\mangle\hinge{p}{q}{q'}$;
i.e. angle metrics $\mangle$ and $\check\mangle$ locally coinside.













Assume $f$ is not continuous at $p$.
Equivalently, $(p,t)\in\partial M$ for some $t<f(p)$.
In other words, $\angk\kappa{(p,f(p))}{(p,t))}{(p,t_0))}=0$.
Thus if $\alpha$ is a radial curve which starts at $(p,t)$ 
then $\alpha(\tau)=(p,t_0)$ for $\tau=f(p)-t_0$.
From ???, it follows that $(p,t_0)\in\partial M$, a contradiction.

Assume $f$ is not lipshitz at $p$.
Equivalenntly, there is a sequence $(p_n,t_n)$, $(q_n,\tau_n)\in\partial M$ such that $$\frac{f(p_n)-f(q_n)}{\dist{p_n}{q_n}}\to\infty.$$

For $x\in K\backslash \partial K$, set $\hat x=(x, f(x))\in \partial M$.
Then we have 
$$\frac{\proj_\RR\hat p_n-\proj_\RR\hat q_n}{\dist{\hat p_n}{\hat q_n}}=1$$
Consider radial curve $\alpha_n$ starting from $q_n$ with respect to $p_n$.
According to ???, $\alpha_n$ belongs to $\partial M$.
Passing to a subsequence, we can assume that $f(p_n)\to t_0$.
According to ???, as $n\to\infty$, 
$$???t_0-\proj_\RR\circ\alpha_n\to 1$$
$\alpha_n$ converges to a verical ray $\alpha(t)=(p,t_0-t)$.
Thus all ray $\alpha$ lies in $\partial M$.\contradiction














\begin{thm}{Lemma}\label{lem:conc+infty}
Let $\spc{X}$ be a $G_\delta$-geodesic space and $f\:\spc{L}\subto\RR$ be a semiconcave subfunction, defined on a connected domain $\Dom f$.
Then if $f(p)=\infty$ for some $p$ then $f\equiv\infty$.
\end{thm}

\parit{Proof.} Conside the set 
$$Q=\set{x\in\Dom f}{f(x)=\infty}.$$
Since $f$ is ???-semicontinuous, the set $Q$ is closed relatively subset in $\Dom f$.
It remains to show that $Q$ is relatively open in $\Dom f$.

Let $x\in Q$ and $\oBall(x,3\cdot r)\i \Dom f$ for some $r>0$.
Given a point $y\in \oBall(x,r)$, 
choose a point $z\in\oBall(x,r)$ such that there are geodeesics $[xz]$ and $[zy]$.
Not that both geodesics $[xz]$ and $[zy]$ lie in $\Dom f$.
Applying concavity of $f$, on geodesics $[xz]$ and $[zy]$ we get $f(z)=\infty$ and subsequently $f(y)=\infty$.
I.e. $f$ takes value $\infty$ on whole $\oBall(x,r)$.\qeds

















%\begin{subthm}{}$f$ is finite on everywhere dense subset of $\Dom f$.
%$f$ is lower semicontinuous; i.e. 
%$f(p)\le \liminf_{x\to p}f(x)$
%for any $p\in\Dom f$.
%\end{subthm}










For any direction $\xi\in\Sigma_p\spc{L}$ there is $\delta>0$ such that the sector described by
$$\Sect_\delta(\xi)
=
\set{x\in \spc{L}}{\mangle(\dir p x,\xi)<\eps\cdot\pi,
\ \dist{p}{x}<\delta}$$
also is a part of $\check{\spc{L}}$ and it is totally convex in both $\spc{L}$ and $\check{\spc{L}}$.
It implies that $\mangle$ and $\check\mangle$ coinside locally.













Note that rigions 
$$\mathfrak{C}_n=\set{(\bm{x},z)\in \check{\spc{L}}}
{z\le\eps\cdot(1+\eps)\cdot x_n}$$
are totally convex in $\check{\spc{L}}$;
i.e. any geodesic in $\check{\spc{L}}$ with ends in $\mathfrak{C}_n$ lies completely in $\mathfrak{C}_n$.
That can be shown by orthogonal projecting $\check{\spc{L}}\backslash \mathfrak{C}_n$ to the hyperplane
$z\z=\eps\cdot(1+\eps)\cdot x_n$.
Further, 
$\mathfrak{C}_n\cap \mathfrak{C}_\kay=p$ for all $n\not=\kay$ and
$\Omega_n\i \mathfrak{C}_n$.

\begin{thm}{Corollary}???DO WE NEED IT HERE???
Let $\CAT_A\ge\kappa$ and $p,q,z\in A$ be such that $z$ lies inside of a geodesic $[p q]$. 
Then geodesic $[p z]$ is uniquely defined.
\end{thm}

\begin{thm}{Corollary} (limit of concave functions is concave)
Let $\CAT_{A_n}\ge\kappa$, $\star_n\in A_n$ be marked points, $\Omega_n\i A_n$ --- sequence of open sets and $f_n:\Omega_n\to \RR$ --- sequence of $\Lip$-Lipschitz $\lambda$-concave functions.
Set $f_\omega:\Omega_\omega\to\RR$ be the $\omega$-limit of $f_n$, then $f_\omega$ is a $\lambda$-concave function.
\end{thm}

\parit{Proof.} Assume it is wrong, then there is a minimizing geodesic $\gamma_\omega:[a,b]\to \Omega_\omega$ such that composition 
$f_\omega\circ\gamma_\omega$ is not $\lambda$-concave.
Then one can choose numbers subinterval $[a',b']\i(a,b)$ such that restriction $f_\omega\circ\gamma_\omega|_{[a',b']}$ is not $\lambda$-concave.
Note that according to ??? there is unique (up to reparametrization) minimizing geodesic connectin $\gamma_\omega(a')$ and $\gamma_\omega(b')$.
Choose sequences $x_n,y_n\in A_n$ such that $x_n\oto x_\omega$ and $y_n\oto y$.
Consider sequence of minimizing geodesics $\geod_{[x_ny_n]}$, then its limit must coinside with $\geod_{[x_\omega y_\omega]}$.
Thus sinse $f_n\circ\geod_{[x_ny_n]}(t)\to f_\omega\circ\geod_{[x_\omega y_\omega]}(t)$ therefore $f_\omega\circ\geod_{[x_\omega y_\omega]}$ is $\lambda$-concave, a contradiction.
\qeds












\section{Tangent spaces of Alexandrov spaces.} 

Note that a general complete length-metric space might have no geodesics???.
In particular the construction in section \ref{angles} might give $\Sigma_p=\emptyset$ and thus, $\T_p$ might consist of single origin $o_p$.
However, for Alexandrov spaces the situation is different.
The following theorem shows that for any pair of points $p$ and $q$ there is a geodesic direction at $p$ which directs to a point arbitrarily close to $q$.

\begin{thm}{Theorem \cite[Th. 27]{plaut:survey}}
Let $\CAT_A\ge\kappa$ then for any point $p\in A$ the set of points which can be joined to $p$ by unique minimizing geodesic is comeagre subset of $A$.
\end{thm}

\begin{thm}{Definition}
Let $\CAT_A\ge???$ and $p\in A$, let us call $q\in A$ \emph{$p$-straight}\index{straight!$*$-straight point} (or $q\in \Str(p)$\index{$\Str(p)$}) if
$$\sup_{r\in A}\tangle_0(q;p r)=\pi.$$
\end{thm}

\begin{thm}{Lemma}
Given $\CAT_A\ge\kappa$???INNER METRIC SPACE???, any $p\in A$ the set of $p$-straight points is comeagre in $A$.
\end{thm}

\parit{Proof.}
Set 
$$\Omega_n=\{q\in A|\exists r\in A: \tangle_0 (q;p r)>\pi-\tfrac1n\}.$$
Clearly $\Omega_n$ is open; 
let us show that it is dense in $A$.
Assume contrary, then there is a point $x\in A$ such that its $B(\eps,x)\cap \Omega_n=\emptyset$ for some $\eps>0$.
Since metric on $A$ is intrinsic, for any $\delta>0$, there exist a point $y\in A$ such that $|x y|<\eps/2+\delta$ and $|p y|<|p q|-\eps/2+\delta$. 
For small enough $\delta$ that implies $\tangle_0 (y;q x)>\pi-\tfrac1n$, i.e. $y\in\Omega_n$, a contradiction.

Since $\Str(p)=\bigcap_{n\in \NN}\Omega_n$, the result follows.
\qed

\parit{Proof of theorem \ref{thm:connect}.}
By ???, it is enough to consider only case $\kappa<0$.
Note that if $\tangle_0(q;pr_n)\to\pi$ then  $\tangle_{\kappa}(q;pr_n)\to\pi$.

We will show that if $q\in A$ is $p$-straight, then there is unique minimizing geodesic connecting $p$ and $q$.

Note that it is enough to show the existence and uniqueness of mid-point $z$ between $p$ and $q$.

First let us show uniqueness. 
Assume $z$ and $z'$ be two mid-points of $p q$, i.e. 
$$|p z|=|z q|=|p z'|=|z' q|=|p q|/2.$$
Choose $r\in A$ so that
$\tangle_{\kappa} (q;p r)>\pi-\eps$ then 
$$\tangle_{\kappa} (q;z r),\tangle_{\kappa} (q;z' r)\ge\tangle_{\kappa} (q;p r)>\pi-\eps.$$
Therefore, from comparison???, $\tangle_{\kappa} (q;z z')\le2\eps$ $\Rightarrow$ $|z z'|<\eps\sinh\tfrac{|p q|}{|\kappa|}$ for any $\eps>0$, hence $z=z'$.

The proof of existence is similar.
Let $z_n\in A$ be a sequence of points such that $|p z_n|,|q z_n|\to|p q|/2$ as $n\to\infty$.
For any $\eps>0$ we can find $r\in A$, so that $\tangle_\kappa (q;p r)>\pi-\eps$. 
From the triangle inequality,
$|r z_n|>|r p|-|p z_n|$ therefore large enough $n$, $\tangle_{\kappa}(q;z_n r)>\pi-2\eps$. 
Therefore $\tangle_{\kappa} (q;z_n z_m)<4\eps$ and thus $|z_n z_m|< 4\eps\sinh\tfrac{|p q|}{|\kappa|}$, for all $n,m>N_\eps$; i.e. $\{z_n\}$ is a Cauchy sequence, and its limit is a mid-point.
\qed













Note that key lemma implies the globalization theorem for compact $A$. 
Indeed, from compactness we have that $A$ is geodesic-metric space. 
Assume $r$ is the maximal radius such that for any $x\in X$ the function $\rho_\kappa\circ\dist_x$ is $\comp_\kappa$-concave in $B(r,x)$.
Clearly $r>0$.
The key lemma gives a contradiction with $r<\varpi$, i.e. for any $x\in X$ the function $\rho_\kappa\circ\dist_x$ is $\comp_\kappa$-concave on $B(\varpi,x)$ or $A\in\Alex(\kappa)$ (see theorem~\ref{thm:conc}).

There are two principle problems with this proof:
\begin{enumerate}
\item In general, $X$ is not compact, so we can not assume that $r>0$,
\item In general, $X$ is not geodesic, therefore we can not apply key lemma.
\end{enumerate}
To deal with the first problem we use lemma on almost minimum (lemma \ref{lem:alm-min}).
The second one is solved by passing from $X$ to its ultra-product $X^\omega$, which is geodesic space and then use that $X\in\Alex(\kappa)$ iff $X^\omega\in\Alex(\kappa)$, see ???.

Ultralimits and ultraproducts are discussed in ???. 
If the reader is unfamiliar with these notions, he can still read the proof assuming that $X$ is locally compact, in this case $X$ is automatically geodesic and $X^\omega=X$.

\parit{Proof of globalization theorem.} The same argument as in the proof of ???, implies that angles between geodesics in $X$ are well defined.

For point $p\in X$, let us denote by $r_p\in (0,\infty]$ the maximal value such that $\rho_\kappa\circ\dist_p$ is $\comp_\kappa$-concave in $B({r_p},\,p)\i X$.
Note that lemma on almost minimum (lemma \ref{lem:alm-min}) can be applied to the function $p\mapsto r_p$.
Indeed, if $p_n\to p$ and $B(r,p)$ forms an Alexandrov's $\kappa$-domain then $\varliminf_{n}r_{p_n}\ge r>0$.

Let us show first that  for any $p\in X$,  $r_p\ge \varpi_\kappa$.
Assume $p\in X$ does not satisfy this condition.
Let us apply lemma on almost minimum (lemma \ref{lem:alm-min}) for $\eps<0.01$. 
We obtain a point $p^*\in X$ such that $r=r_{p^*}\le r_p$ and for any $q\in B\l(\tfrac{r}{\eps},p^*\r)$ we have 
$r_q> (1-\eps)\,r$. 

\smallskip

Assume that $X$ is a geodesic-metric space, then above condition implies that for any hinge $\<x;q y\>$ with $q\in B\l(\tfrac{r}{\eps},p^*\r)$ and $|q x|+|x y|< (1-\eps)\,r$ we have 
$$\mangle\<x;q y\>\ge\tangle_\kappa(x;q y).$$
Applying key lemma \ref{key-lem:globalization} 
for point $p^*$ and $\ell$ slightly bigger than $r$ (we have to assume $\tfrac23\ell\le (1-\eps)r$ 
and $\ell\le\varpi_\kappa$) we get that 
$$\mangle\<x;p q\>\ge\tangle_\kappa(x;p q)$$
for any hinge $\<x;p^* q\>$ such that $|p^*x|+|xq|<\ell$.
Thus $r\ge\ell$, a contradiction.

\smallskip










\begin{thm}{Definition}
Let $X$ be a lenght-metric, an open subset $\Omega\i X$ is called Alexandrov's domain with curvature $\ge \kappa$ (for shortness $\Omega\in\Alex_X(\kappa)$)
if for any quadruple $p,x_1,x_2,x_3\in \Omega$, the following holds:
if all model angles $\tangle_\kappa(p;x_ix_j)$ are well defined then
$$\tangle_\kappa(p;x_1x_2)+\tangle_\kappa(p;x_2x_3)+\tangle_\kappa(p;x_3x_1)\le 2\pi.$$
\end{thm}



The same argument as in theorem~\ref{thm:conc}, shows that \begin{enumerate}\addtocounter{enumi}{2}
\item if $\Omega\in\Alex_X(\kappa)$ then for any $p\in \Omega$, $\rho_\kappa\circ\dist_p$ is $\comp_\kappa$-concave in $\Omega$;
\item if for an open subset $\Omega\i X$, for each $p\in \Omega$, the function $\rho_\kappa\circ\dist_p$ is $\comp_\kappa$-concave in $\Omega$ then for any point $p\in \omega$ there is a neigborhood $\Omega_p\in \Alex_X(\kappa)$
\end{enumerate}

The following theorem states that Alexandrov spaces can be defined locally.










\subsection{Applications} 

\begin{thm}{Toponogov's splitting Theorem}\label{thm:splitting} Let $A$ be an Alexandrov space $\CAT_A\ge0$, and $\gamma:\RR\to A$ be a line (i.e. a unit-speed geodesic which is mimizing on each segment). 
Then there is an isometry $h:A\to \RR\times A'$ where $A'$ is an Alexandrov space with $\CAT_{A'}\ge0$.

Moreover, $h$ can be coosen on such a way that if $\pi_\RR$ denotes the projection $\pi:\RR\times A'\to \RR$, $\pi((t,x))=t$ then $\pi\circ h\circ\gamma(t)=t$ for any $t\in \RR$.
\end{thm}

This theorem was first proved by Pogorelov
%V. A. Toponogov, Riemann spaces with curvature bounded below (Russian), Uspehi Mat. Nauk 14 (1959), no. 1 (85), 87?130. MR0103510
for Riemannian case and then generalized by Milka 
%A. D. Milka, Metric structure of some class of spaces containing straight lines, Ukrain. Geometrical. Sbornik, vyp. 4, 1967, Kharkov, pp. 43-48 (in Russian).
to Alexandrov's spaces (at that time it was no definition of Alexandrov's space, Milka had proved it for metric space with global triangle comparison).  
In case $\dim=2$ this theorem was proved by Cohn-Vossen much??? earlier. 
Although the Milka's proof is elementary, it is not short (see \cite{milka-line} \cite[1.5]{BBI}).
Here we show that using gradient flow one can give a very short proof.

\parit{Proof.} Consider two Buseman's functions $b_+$ and $b_-$ asociated with rays\footnote{A unit-speed geodesic $\gamma:[0,\infty)\to X$, in a metric space $X$, is called a ray if it is minimizing on each bounded segment.} $\gamma:[0,\infty)\to A$ and $\gamma:(-\infty,0]\to A$, i.e.
$$b_\pm(x)=\lim_{t\to\infty}|\gamma(\pm t)\,x|- t.$$
(It converges sinse for any $x$, $|\gamma(\pm t)\,x|- t$ decreases in $t$).
For any $R>0$ and $\eps>0$ there is $T$ such that for $t>T$, the function $\dist_{\gamma(\pm t)}$ is $(-\eps)$-concave in $B_R(\gamma(0))$.
Therefore, both functions $b_\pm$ are concave.

Note that since $\gamma$ is a line, we have $b_+(x)+b_-(x)\ge0$ for any $x\in A$.
On the other hand $f(t)={\dist^2_x(\gamma(t))}$ is $2$-concave; in particular, $f(t)\le t^2+at+b$ for some conatants $a,b\in\RR$. 
Passing to $t\to\pm\infty$, we get $b_+(x)+b_-(x)\le0$ for any $x\in A$.
Hence 
$$b_+(x)+b_-(x)\equiv 0.$$
It follows??? that $|\nabla b_\pm|\equiv 1$, therefore $1$-Lipschitz curve $\alpha$, such that $b_\pm(\alpha(t))=t+\Const$ is a $b_\pm$-gradient curve. 
In particular, a curve $\alpha(t)$ is a $b_\pm$-gradient curve iff the curve $\alpha(-t)$ is a $b_\mp$-gradient curve.
It follows that for any $t>0$, $\GF_{b_+}^t\circ\GF_{b_-}^t=\id_A$.

Set $A'=b_+^{-1}(0)\i A$, it forms an Alexandrov's space since it is a closed convex??? set.
Set
$$\GF^t=\left[\begin{matrix}
\GF_{b_+}^t&\hbox{if}\ t\ge0\\
\GF_{b_-}^t&\hbox{if}\ t<0
               \end{matrix}\right.,$$
it defines an $\RR$-action on $A$.
Consider map $h:A'\times \RR\to A$ defined by $h:(x,t)\mapsto \GF^t(x)$.
It is easy to see that $h$ is onto.
Applying lemma \ref{lem:dist-est}(\ref{two-ends}) for $\GF_{b_+}^t$ and $\GF_{b_-}^t$, we get that $h$ is a short and non-contracting at the same time; therefore $h$ is an isometry.\qeds



Gradient flow gives a simple proof to the following result which generalizes a key
lemma in \cite{liberman}. 
This generalization was first obtained in
\cite[5.3]{perelman-petrunin:extremal}, a simplified proof was given in
\cite[1.1]{petrunin:extremal}.
See sections~\ref{extremal} and~\ref{QG}  for definition of extremal subset and
quasigeodesic. 

\begin{thm}{\bf Generalized Lieberman's Lemma.}\label{lib-lem} Any unit-speed geodesic for the
induced intrinsic metric on an extremal subset is a quasigeodesic in the ambient
Alexandrov's space.
\end{thm}


\parit{Proof.} Let $\gamma:[a,b]\to E$ be a unit-speed minimizing geodesic in an extremal subset
$E\i A$ and $f$ be a $\lambda$-concave function defined in a neighborhood of
$\gamma$.
Assume $f\circ\gamma$ is not $\lambda$-concave, then there is a non-negative
Lipschitz function $\tau$ with support in $(a,b)$ such that
$$\int\limits_a^b\l[(f\circ\gamma)'\tau'+\lambda\tau\r]d s< 0$$
Then as follows from lemma~\ref{lem:grad-variation}, for small $t\ge 0$
$$\gamma_t(s)=\GF^{t\cdot\tau(s)}_f \circ\gamma_0(s)$$
gives a length-contracting homotopy of curves relative to ends and according to
definition~\ref{def:extrim}, it stays in $E$ --- this is a contradiction.\qeds

The fact that gradient flow is stable with respect to collapsing has the
following useful consequence: Let $M_n$ be a collapsing sequence of Riemannian
manifolds with curvature $\ge\kappa$ and $M_n\GHto A$.
For a regular point $p$ let us denote by $F_n(p)$ the \emph{regular fiber}\footnote{see footnote~\ref{reg-fib} on page~\pageref{reg-fib}} over $p$, it is well defined for all large $n$.
Let $f:A\to\RR$ be a $\lambda$-concave function.
If $\alpha(t)$ is an $f$-gradient curve in $A$  which passes only through
regular points, then for any $t_0<t_1$
there is a homotopy equivalence $F_n(\alpha(t_0))\to F_n(\alpha(t_1))$ with
dilation $\approx e^{\lambda(t_1-t_0)}$.

This observation was used in \cite{KPT} to prove some properties of almost
nonnegatively curved manifolds. 
In particular, it gave simplified proofs of
the results in \cite{FY}):

\begin{thm}{\bf Nilpotency theorem.} Let $M$ be a closed almost nonnegatively curved manifold.
Then a finite cover of $M$ is a \emph{nilpotent space},
 i.e. its fundamental group is nilpotent and it acts nilpotently on higher homotopy groups.
\end{thm}

\begin{thm}{\bf Theorem.} Let $M$ be an almost nonnegatively curved
$m$-manifold. Then $\pi_1(M)$ is $\Const(m)$-nilpotent, i.e., $\pi_1(M)$ contains a nilpotent subgroup of
index at most $\Const(m)$.
\end{thm}

Gradient flow also gives an alternative proof of the homotopy lifting theorem~\ref{thm:per-ser}. 
To explain the idea let us start with definition:

Given a topological space $X$, a map $F:X\to A$, a finite sequence of $\lambda$-concave functions $\{f_i\}$ on $A$ and continuous functions $\tau_i:X\to\RR_+$ one can consider a composition of gradient deformations (see \ref{grad-flow})
$$F'(x)=\GF_{f_N}^{\tau_N(x)}\circ\cdots\circ\GF_{f_2}^{\tau_2(x)}\circ\GF_{f_1}^{\tau_1(x)}\circ F(x),\ \ \ F':X\to A,$$
which we also call \textit{gradient deformation} of $F$.

Let us define {\it gradient homotopy} to be a gradient deformation of trivial homotopy 
$$F:[0,1]\times X\to A,\ \ \ F_t(x)=F_0(x)$$
with the functions 
$$\tau_i:[0,1]\times X\to\RR_+\ \ \ \text{such that}\ \ \ \tau_i(0,x)\equiv 0.$$
If $Y\i X$, then to define \emph{gradient homotopy relative to} $Y$ we assume in addition $$\tau_i(t,y)= 0 \ \ \ \text{for any }\ \ \ y\in Y,\ \ t\in[0,1].$$

Then theorem~\ref{thm:per-ser} follows from lemma~\ref{lem:stable-grad-curves} and the following lemma:

\begin{thm}{\bf Lemma \cite{petrunin:grad-hom}.}\label{lem:hom-approx} Let $A$ be an Alexandrov's space without proper extremal subsets and $K$ be a finite simplicial complex. 
Then, given $\eps>0$, for any  homotopy 
$$F_t:K\to A,\ \ t\in [0,1]$$ one can construct an $\eps$-close gradient homotopy 
$$G_t:K\to A$$ such that $G_0\equiv F_0$.
\end{thm}















\subsection{Applications}

One of the main applications of gradient exponent and radial curves is the proof
of existence of quasigeodesics; 
see property~\ref{exist-qg} page~\pageref{exist-qg} and appendix~\ref{constr-qg} for the proof.

An infinite-dimensional generalization of gradient exponent was introduced by Perelman to make the last step in the proof of equality of Hausdorff and topological dimension for Alexandrov's spaces, see \cite[A.4]{perelman-petrunin:qg}.
According to \cite{plaut:dimension} (or
\cite[151]{plaut:survey}), if $\dim_H A\ge m$, then there is a point $p\in A$, the tangent cone of which contains a subcone $W\i T_p$ isometric to Euclidean $m$-space.
Then infinite-dimensional analogs of properties  in section~\ref{sph-hyp-exp} ensure that image $\gexp_p (W)$ has topological dimension $\ge m$ and therefore $\dim A\ge m$.

The following statement has been proven in \cite{perelman:spaces2}, then its
formulation was made more exact in \cite{alexander-bishop:fk}. 
Here we give a simplified proof with the use of a gradient exponent.

\begin{thm}{\bf Theorem.} \label{thm:dist-to-bry} Let $A$ be an Alexandrov space, $\CAT_A\ge\kappa$ and
$\partial A\not=\emptyset$; then the function $f=\sigma_\kappa\circ\dist_{\partial
A}$\footnote{\label{sigma_k}$\sigma_\kappa:\RR\to\RR$ is defined by
$$\sigma_\kappa(x)=\sum_{n=0}^\infty\frac{(-\kappa)^{n}}{ (2n+1)!}x^{2n+1}=
\left[\begin{matrix}
{ \frac{1}{\sqrt \kappa}\sin({x \sqrt \kappa})}&{\hbox{if}\ \kappa>0}\\
            {x}&{\hbox{if}\ \kappa=0}\\
            { \frac{1}{\sqrt{-\kappa}}\sinh({x \sqrt {-\kappa}})}&{\hbox{if}\
\kappa<0}\\
\end{matrix}\right. .$$} is $(-\kappa f)$-concave in $\Omega=A\backslash\partial
A$.\footnote{Note that by definition~\ref{def:with-bry}, $f$ is not semiconcave
in $A$.} 

In particular,
\begin{enumerate}[(i)]
\item if $\kappa=0$, $\dist_{\partial A}$ is concave in $\Omega$;
\item if $\kappa>0$, the level sets $L_x=\dist^{-1}_{\partial A}(x)\i A$, $x>0$
are strictly concave hypersurfaces.
\end{enumerate}
\end{thm}
\begin{wrapfigure}{r}{40mm}
\begin{lpic}[t(0mm),b(10mm),r(0mm),l(0mm)]{pics/dist-to-bry(0.4)}
\lbl[b]{14,144;$\tilde\gamma(0)$}
\lbl[b]{63,158;$\tilde\gamma(\tau)$}
\lbl[lt]{22,134;$\alpha$}
\lbl[b]{18,39;$\tilde\beta$}
\lbl[t]{15,15;$\tilde p$}
\lbl[t]{63,15;$\tilde q$}
\lbl[lb]{75,17;$\partial\Lob{+}\kappa$}
\end{lpic}
\end{wrapfigure}

\noi\textit{Proof.} We have to show that for any unit-speed geodesic $\gamma$, the function 
$f\circ\gamma$ is $(-\kappa f)$-concave; i.e. for any $t_0$,
$$(f\circ\gamma)''(t_0)\le -\kappa f\circ\gamma(t_0)$$
\emph{in a barrier sense}\footnote{For a continuous function $f$, $f''(t_0)\le
c$ \emph{in a barrier sense} means that there is a smooth function $\bar f$ such
that $f\le \bar f$, $f(t_0)=\bar f(t_0)$ and $\bar f''(t_0)\le c$}. Without loss
of generality we can assume $t_0=0$.

Direct calculations show that the statement is true for \label{Lob_k^+} $A=\Lob_\kappa^+$, the
halfspace  of the model space $\Lob_\kappa$.

Let $p\in \partial A$ be a closest point to $\gamma(0)$ and










$\alpha=\angle(\gamma^+(0),\uparrow_{\gamma(0)}^p)$.

Consider the following picture in the model halfspace $\Lob_\kappa^+$: Take a
point $\tilde p\in\partial\Lob_\kappa^+$ and consider the geodesic $\tilde\gamma$ in
$\Lob_\kappa^+$ such that $$|\gamma(0) p|=|\tilde\gamma(0)\tilde
p|=|\tilde\gamma(0)\partial\Lob{+}\kappa|,$$ 
so $\tilde p$ is the closest point to $\tilde\gamma(0)$ on the
boundary\footnote{in case $\kappa>0$ it is possible only if $|\gamma(0) p|\le
\frac{\pi}{2\sqrt\kappa}$, but this is always the case since otherwise any small
variation of $p$ in $\partial A$ decreases distance $|\gamma(0) p|$.} and
$$\angle(\tilde\gamma^+(0),\uparrow_{\tilde\gamma(0)}^{\tilde p})=\alpha.$$
Then it is enough to show that 
$$\dist_{\partial A} \gamma(\tau) \le
\dist_{\partial\Lobs_\kappa^+}\tilde\gamma(\tau)+o(\tau^2).$$
Set 
$$\beta(\tau)=\angle \gamma(0)\, p\, \gamma(\tau)$$ 
and
$$\tilde\beta(\tau)=\angle \tilde\gamma(0)\,\tilde p\, \tilde\gamma(\tau).$$
From the comparison inequalities
$$|p\gamma(\tau)|\le|\tilde p\tilde \gamma(\tau)|$$
and
$$\theta(\tau)=\max\l\{0,\,\tilde\beta(\tau)-\beta(\tau)\r\}=o(\tau).\eqno(*)$$
Note that the tangent cone at $p$ splits: $T_p A=\RR_+\times T_p\partial
A$.\footnote{This follows from the fact that $p$ lies on a shortest path between
two preimages of $\gamma(0)$ in the doubling $\tilde A$ of $A$, see
\cite[7.15]{BGP}.}
Therefore we can represent $v=\log p{\gamma(\tau)}\in \T_p A$ as $v=(s,w)\in
\RR_+\times T_p\partial A$.
Let $\tilde q=\tilde q(\tau)\in\partial\Lob_\kappa$ be the closest point to
$\tilde\gamma(\tau)$, so 
$$\angle(\uparrow_p^{\gamma(\tau)},w)=
\frac\pi2-\beta(\tau)\le \frac\pi2-\tilde\beta(\tau) -\theta(\tau)=
\angle\tilde\gamma(\tau)\tilde p\tilde q+o(\tau).$$
Set $q=\gexp_p\l(\kappa;|\tilde p\tilde
q|\frac{w}{|w|}\r)$.\footnote{\label{qg-grad} 
Alternatively, one can set $q=\gamma(|\tilde p\tilde q|)$, where $\gamma$ is a
quasigeodesic in $\partial A$ starting at $p$ in direction $\frac{w}{|w|}\in
\Sigma_p$ (it exists by second part of property~\ref{exist-qg} on
page~\pageref{exist-qg}).} 
Since gradient curves preserve extremal subsets $q\in \partial A$ (see
property~\ref{grad-in-extr} on page~\pageref{grad-in-extr}).
Clearly $|\tilde p\tilde q|=O(\tau)$, therefore applying the comparison from
section~\ref{sph-hyp-exp} (or Corollary~\ref{cor:angle--} if $\kappa=0$)
together with $(*)$, we get
$$\dist_{\partial A} \gamma(\tau) \le|q \gamma(\tau)|\le|\tilde q
\tilde\gamma(\tau)|+O\l(|\tilde p\tilde q|\cdot\theta(\tau)\r)
=\dist_{\partial\Lobs_\kappa^+}\tilde\gamma(\tau)+o(\tau^2).$$ \qeds





The following corollary implies that the Lipschitz condition in the definition of
convex function~\ref{def:with-bry}-- \ref{def:with-no-bry} can be relaxed to usual continuity.

\begin{thm}{\bf Corollary.}\label{cor:cont-conv} Let $A$ be an Alexandrov space, $\partial A=\emptyset$,
$\lambda\in\RR$ and $\Omega\i A$ be open.

Assume $f:\Omega\to\RR$ is a continuous function such that for any unit-speed geodesic $\gamma$ in $\Omega$ we have that the function
$$t\mapsto f\circ\gamma-\lambda t^2/2$$
is concave; then $f$ is locally Lipschitz.
 
In particular, $f$ is $\lambda$-concave in the sense of
definition~\ref{def:with-bry}.
\end{thm}

\parit{Proof.} Assume $f$ is not Lipschitz at $p\in \Omega$.
Without loss of generality we can assume that $\Omega$ is
convex\footnote{Otherwise, pass to a small convex neighborhood of $p$ which
exists by corollary~\ref{cor:convex-nbhd}.} and
$\lambda<0$\footnote{Otherwise, add a very concave (Lipschitz) function which
exists by theorem~\ref{thm:strictly-concave}}.
Then, since $f$ is continuous, sub-graph
$$X_f=\{(x,y)\in \bar\Omega\times\RR|y\le f(x)\}$$
is closed convex subset of $A\times\RR$, therefore it forms an Alexandrov's
space. 

Since $f$ is not Lipschitz at $p$, there is a sequence of pairs of points
$(p_n,q_n)$ in $A$, such that 
$$p_n,q_n\to p\ \ \ \text{and}\ \ \  \frac{f(p_n)-f(q_n)}{|p_n
q_n|}\to+\infty.$$ 
Consider a sequence of radial curves $\alpha_n$ in $X_f$ which extend  shortest
paths from $(p_n,f(p_n))$ to $(q_n,f(q_n))$.
Since the boundary $\partial X_f\i X_f$ is an extremal subset, we have $\alpha_n(t)\in
\partial X_f$ for all 
$$t\ge \ell_n=|(p_n,f(p_n))(q_n,f(q_n))|=$$
$$=\sqrt{|p_n
q_n|^2+(f(p_n)-f(q_n))^2}.$$ 
Clearly, the function $h:X_f\to\RR$, $h:(x,y)\mapsto y$ is concave.
Therefore, from \ref{lem:monotonic}, there is a sequence $t_n>\ell_n$, so
$\alpha_n(t_n)\to (p,f(p)-1)$.
Therefore, $(p,f(p)-1)\in\partial X_f$ thus $p\in\partial A$, i.e. $\partial A\not=\emptyset$, a
contradiction.
\qeds



\begin{thm}{Corollary} \label{cor:eq-qg}
Let $A$ be an Alexandrov space, $\CAT_A\ge\kappa$, $\dim A=m\ge2$ and $\gamma$ be a unit-speed curve in $A$
which has a convex $\kappa$-developing with respect to any point.
Then $\gamma$ is a quasigeodesic, i.e. for any $\lambda$-concave function $f$,
function $f\circ\gamma$ is $\lambda$-concave.
\end{thm}

\parit{Proof.}  Let us first note that in the proof of theorem~\ref{thm:dist-to-bry} we
used only two properties of curve $\gamma$:
$|\gamma^\pm|=1$ and the convexity of the $\kappa$-development of $\gamma$ with respect
to $p$.

Assume $\kappa=\lambda=0$ then sub-graph of $f$
$$X_f=\{(x,y)\in A\times\RR\ |\ y\le f(x)\}$$ 
is a closed convex subset, therefore it forms an Alexandrov's space.

Applying the above remark, we get that if $\gamma$ is a unit-speed curve in
$X_f\backslash \partial X_f$ with convex $0$-developing with respect to any
point then $\dist_{\partial X_f}\circ\gamma$ is concave.
 Hence, for any $\eps>0$, the function $f_\eps$, which has the level set $\dist_{\partial X_f}^{-1}(\eps)\i \RR\times A$ like the graph, has a concave restriction to any curve $\gamma$ in
$A$ with a convex $0$-developing with respect to any
point in $A\backslash\gamma$. 
Clearly, $f_\eps\to f$ as $\eps\to 0$, hence $f\circ\gamma$ is concave. 

For $\lambda$-concave function the set $X_f$ is no longer convex, but it becomes convex if one changes metric on $A\times\RR$ to \emph{parabolic cone}\footnote{\label{par-cone} i.e. warped-product
$\RR\times_{\exp(\Const t)} A$, which is an Alexandrov's space, see \cite[4.3.3]{BGP}, \cite{alexander-bishop:worps}} and then one can repeat the same arguments.\qeds


\parbf{Remark.} One can also get this corollary from the following lemma:

\begin{thm}{Lemma}\label{f_eps}
Let $A$ be an Alexandrov space, $\CAT_A\ge\kappa$, $\dim A=m$, $\Omega$ be an open subset of $A$ and
 $f:\Omega\to\RR$ be a $\lambda$-concave $\Lip$-Lipschitz function.
Then function
$$f_\eps(y)=\min_{x\in\Omega}\{f(x)+\tfrac1\eps|x y|^2\}$$
is $(\lambda+\delta)$-concave in the domain of definition\footnote{i.e. at the set where the minimum is defined.} for some\footnote{this function $\delta(L,\lambda,\kappa,\eps)$ is achieved for the model space $\Lambda_\kappa$} $\delta=\delta(\Lip,\lambda,\kappa,\eps)$, $\delta\to0$ as $\eps\to 0$.

Moreover, if $m\ge 2$ and $\gamma$ is a unit-speed curve in $A$ with $\kappa$-convex developing with respect to any point then 
$f_\eps\circ\gamma$ is also $(\lambda+\delta)$-concave.
\end{thm}

\parit{Proof.} 
It is analogous to theorem~\ref{thm:dist-to-bry}. 
We only indicate it in the simplest case, $\kappa=\lambda=0$. 
In this case $\delta$ can be taken to be $0$.

Let $\gamma$ be a unit-speed geodesic (or it satisfies the last condition in the lemma). 
It is enough to show that for any $t_0$
$$(f_\eps\circ\gamma)''(t_0)\le0$$
in a barrier sense. 

Let $y=\gamma(t_0)$ and $x\in \Omega$ be a point for which 
$f_\eps(y)=f(x)+\tfrac1\eps|x y|^2$.
The tangent cone $T_x$ splits in direction $\uparrow_y^x$,
i.e. there is an isometry $T_x\to \RR\times \Cone$ such that $\uparrow_x^y\mapsto(1,o)$, where $o\in\Cone$ is its origin.
Let 
$$\log_x\gamma(t)=(a(t),v(t))\in\RR\times \Cone=T_x.$$
Consider vector 
$$w(t)=(a(t)-|x y|,v(t))\in \RR\times \Cone=T_x.$$ 
Clearly $|w(t)|\ge|x\gamma(t)|$.
Set $x(t)=\gexp_y(w(t))$ then lemma~\ref{lem:monotonic} gives an estimate for $f\circ x(t))$ while corollary~\ref{cor:angle--} gives an estimate for $|\gamma(t)x(t)|^2$. Hence the result.
\qeds




Here is yet another illustration for the use of gradient exponents.
At first sight it seems very simple, but the proof is not quite obvious.
In fact, I did not find any proof of this without applying the gradient exponent. 

\begin{thm} {Lytchak's problem}\label{lyt-prob} Let $A$ be an Alexandrov space, $\CAT_A\ge1$, $\dim A=m$. 
Show
that
$$\vol_{m-1}\partial A\le \vol_{m-1}S^{m-1}$$
where $\partial A$ denotes the boundary of $A$ and $S^{m-1}$ the unit $(m-1)$-sphere.
\end{thm}

The problem would have followed from conjecture~\ref{conj:bry} (that boundary of
an Alexandrov's space is an Alexandrov's space), but before this conjecture has been proven, any partial
result is of some interest.
Among other corollaries of
conjecture~\ref{conj:bry}, it is expected that if $\CAT_A\ge1$, $\dim A=m$ then $\partial
A$, equipped with induced intrinsic metric, admits a noncontracting map to
$S^{m-1}$. 
In particular, its intrinsic diameter is at most $\pi$, and perimeter
of any triangle in $\partial A$ is at most $2\pi$. 
This does not follow from the proof below, since in general $\gexp_z(1;\partial
B_{\pi/2}(o_z))\not\i\partial A$, i.e. $\gexp_z(1;\partial B_{\pi/2}(o_z))$
might have some creases left inside of $A$, which might be used as a shortcut for
curves with ends in $\partial A$.

Let us first prepare a proposition:

\begin{thm}{\bf Proposition.}\label{prop:unique-gexp-inverse}
The inverse of the gradient exponential map $\gexp^{-1}_p(\kappa;*)$ is uniquely
defined inside any minimizing geodesic starting at $p$.
\end{thm}

\parit{Proof.} Let $\gamma:[0,t_0]\to A$ be a unit-speed minimizing geodesic,
$\gamma(0)=p$, $\gamma(t_0)=q$.
 From the angle comparison we get that $|\nabla_x\dist_p|\ge-\cos\tilde\angle_\kappa p
x q$. Therefore, for any $\zeta$ we have
$$|p\alpha_\zeta(t)|^+_t\ge -|\alpha^+_\zeta(t)|\cos\tilde\angle_\kappa
p\,\alpha_\zeta(t)\,q\ \ \text{and}\ \ |\alpha_\zeta(t)q|^+_t\ge-|\alpha^+_\zeta(t)|.$$
Therefore, $\tilde\angle_\kappa p\, q\, \alpha_\zeta(t)$ is nondecreasing in $t$, hence the result.
\qeds


\parit{Proof of \ref{lyt-prob}.} 
Let $z\in A$ be the point at maximal distance from $\partial A$, in particular
it realizes maximum of $f=\sigma_1\circ\dist_{\partial
A}=\sin\circ\dist_{\partial A}$.
From theorem~\ref{thm:dist-to-bry}, $f$ is $(-f)$-concave and $f(z)\le 1$.

Note that $A\i \bar B_{\pi/2}(z)$, otherwise if $y\in A$ with $|y z|>\pi/2$, then
since $f$ is $(-f)$-concave and $f(y)\ge 0$, we have $\d
f(\uparrow_z^y)>0$, i.e. $z$ is not a maximum of $f$.

From this it follows that gradient exponent
$$\gexp_z(1;*):(\bar B_{\pi/2}(o_z),\mathfrak s)\to A$$
is a short onto map. 

Moreover,
$$\partial A\i\gexp_z(\partial B_{\pi/2}(o_z)).$$ 
Indeed, $\gexp$ gives a homotopy equivalence $\partial B_{\pi/2}(o_z)\to
A\backslash z$. 
Clearly, $\Sigma_z=\partial (B_{\pi/2}(o_z),\mathfrak s)$ has no boundary, therefore 
$H_{m-1}(\partial A,\ZZ_2)\not=0$, see \cite[lemma 1]{grove-petersen:rad-sphere}. 
Hence for any point $x\in\partial A$, any minimizing geodesic $z x$ must have
a point of the image $\gexp(1;\partial B_{\pi/2}(o))$ but, as it is shown in
proposition~\ref{prop:unique-gexp-inverse}, it can only be its end $x$. 

Now since $$\gexp_z(1;*):(\bar B_{\pi/2}(o_z),\mathfrak s)\to A$$ is short and
$(\partial B_{\pi/2}(o),\mathfrak s)$ is isometric to $\Sigma_z A$ we get
$\vol\partial A\le\vol \Sigma_z A$ and clearly, $\vol \Sigma_z A\le \vol S^{m-1}$.\qeds








\parbf{First-order metric invariants.}
Following \cite[3.D$_+$]{gromov-MS}...

Given an $k$-tuple $(x_1,x_2,\dots,x_k)$ of points in a metric space $X$ consider matrix with enteries $a_{ij}=|x_ix_j|$.
The set of all such matrixes will be denoted by $???K_k(X)$, it will be considered as a subset of $M_k$\index{$M_k$} --- the space of all $k\times k$ matrixes.

\begin{thm}{Lemma}\label{lem:omega-stable}
Let $I_X(R_1,R_2,\dots,R_n)$ denotes the ??? profile of metric space $X$.
Then if $(X_n,\star_n)\oto (X_\omega,\star_\omega)$ then $I_{(X_n,\star_n)}(R_1,R_2,\dots,R_n)\oto I_{(X_\omega,\star_\omega)}(R_1,R_2,\dots,R_n)$.

Assume for a sequence of metric spaces $X_n$ we have $K_k(X_n)\i C$ and $(X_n,\star_n)\oto (X_\omega,\star_\omega)$ then $K_k(X_\omega)\i C$.

Moreover, for $\omega$-product $X^\omega$ of any metric space $X$ we have $K_k(X)\i C$ if and only if $K_k(X^\omega)\i C$.
\end{thm}
\parit{The proof is straightforward.} 
\qeds

\parbf{Comment.} One can generalize this stability statement to so called first-order metric invariants, i.e. ???,  see~\cite[3.D$_+$]{gromov-MS}, 















\parbf{Barrier solutions.}
Let $y(t)$ be a locally Lipschitz real function defined on a convex subset of $I\i\RR$ and $\phi:\RR\to\RR$ be a locally Lipschitz function.
We say that $y$ is a barrier solution for differential inequality 
$$y''\le\phi(y)$$
if for any $t_0\in I$ and any $\eps>0$ there is a smooth function $\bar y(t)$ which satisfy
$$\bar y''\le\phi(\bar y)+\eps$$
in a neighborhood of $t_0$ 
such that
$$\bar y\ge y\ \ \text{and}\ \ \bar y(t_0)= y(t_0).$$



Equivalently, barrier solutions can be understood in any of the following ways (reader is free to choose one) ???MAYBE WE WANT JUST ONE???:
\begin{description}
\item[distributions] for any smooth function $\alpha$ with a compact support in the interior of $I$, we have
$$\int_\RR \alpha''y d t\le \int_\RR\alpha\phi(y) d t.$$
\item[measure] the one-side derivatives of $y$ are well defined and
$$y^+(a)+y^-(b)\le \int_a^b \phi(y)d t.$$
\item[approximations by smooth solutions] there is a sequence of smooth solution of the inequality which converges to $y$. 
\end{description}












Now we are ready to formulate an analog of lemma~\ref{lem:2nd-deriv} for $\comp_\kappa$-concave functions:

\begin{thm}{Lemma}\label{lem:2nd-deriv-comp_k}
Let $X$ be a length-metric space and $\Omega\i X$ be an open subset.

A function $f:\Omega\to \RR$ is $\comp_\kappa$-concave if and only if its $\omega$-extension $f^\omega:\Omega^\omega\to \RR$ satisfy the following property: for any geodesic $\gamma$ in $\Omega^\omega$ the function
$$y(t)= f^\omega\circ\gamma(t)$$ 
is a barrier solution for the following differential inequality
$$y''\le 1-\kappa y.$$
\end{thm}

The proof is obvious???











\begin{enumerate}[(i)]
\item Let $X$ be a complete almost geodesic space and $\Omega\i X$ be an open subset and $f:\Omega\to\RR$ be a locally Lipchitz function. Then 
$$f''\ge 1-\kappa f\ \  (f''\le 1-\kappa f)$$ 
if and only if for any geodesic $\gamma:I\to\Omega$\footnote{$I\in\RR$ is a convex subset} and any $t_0\in I$ there is a solution $\bar f$ of differential equasion $\bar f''(t)=1-\kappa \bar f(t)$ such that $\bar f\le f$ (correspondently $\bar f\ge f$) for all $t\in (t_0-\varpi_\kappa,t_0+\varpi_\kappa)\cap I$ and $\bar f(t_0)=f(t_0)$.

Such a function $\bar f$ is called \emph{barier at $t_0$}\index{barier}.
\end{enumerate}

\begin{thm}{Technical lemma}\label{lem:ensen}
Let $r(t)$ be a positive $1$-Lipschitz real function defined on an open subset of $\RR$, 
then the following conditions are equivalent:
\begin{enumerate}[(i)]
\item $\rho_\kappa\circ r$ is a barrier solution for differential inequality
$$y''\le1-\kappa y.$$
\item for any triple of values $t_1<t_2<t_3$, such that $|t_3-t_1|+r(t_1)+r(t_3)<\varpi_\kappa$ we have
$$\tangle_\kappa\{r(t_1);r(t_2)\, |t_2-t_1|\}
+
\tangle_\kappa\{r(t_3);r(t_2)\, |t_3-t_2|\}\le\pi$$
\end{enumerate}

\end{thm}

\parit{Proof.} 
We show it only for $\kappa=0$, the general case is similar, only formulas become longer.

Set $\phi=\tangle_\kappa\{r(t_1);r(t_2)\, |t_2-t_1|\}$ 
and $\psi=\tangle_\kappa\{r(t_3);r(t_2)\, |t_3-t_2|\}$.
Then
$$\phi+\psi\le \pi\ \  \Leftrightarrow\ \  \cos\phi+\cos\psi\ge 0.$$
Using rule of cosines, we get
$$\frac
{r(t_2)^2-|t_2-t_1|^2-r(t_1)^2}
{2|t_2-t_1|\cdot r(t_2)|}
+\frac
{r(t_3)^2-|t_3-t_1|^2-r(t_1)^2}
{2|t_3-t_2|\cdot r(t_3)|}\ge 0.$$
This inequality is just a funny way to say that
$${r(t)^2-t^2}=2\rho_0\circ r(t)-t^2$$
is a concave function. 
Equivalently, $\rho_0\circ r(t)$ is a barrier solution for
$$y''(t)\le 1.$$\qeds







The next lemma gives more delicate property of $\tangle_\kappa\{a;b,c\}$.

\begin{thm}{Alexandrov's lemma}\label{lem:alex1}
Given real numbers $a,a',b,b',x$, if both of the following expressions are well defined then they have the same sign:
\begin{enumerate}[(1)]
\item $\tangle_\kappa\{x;a,b\}-\tangle_\kappa\{b';a+a',b\}$
\item $\tangle_\kappa\{b;x,a\}+\tangle_\kappa\{b';x,a'\}-\pi$
\end{enumerate}
\end{thm}

\begin{wrapfigure}{r}{35mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]{pics/lem-alex(0.33)}
\lbl[rb]{13,56;$p$}
\lbl[rt]{2,4;$q$}
\lbl[t]{47,2;$r$}
\lbl[lt]{96,4;$s$}
\lbl[b]{24,6;$a$}
\lbl[b]{68,6;$a'$}
\lbl[rt]{5,33;$b$}
\lbl[rt]{30,30;$x$}
\end{lpic}
\end{wrapfigure}

\parit{Proof.}
Consider triangle $\trig p q r=\~\triangle_\kappa\{a,x,b\}$ in $\Lob_\kappa$. 
Take 
a point $s$ on the extension of $[q r]$ behind $r$ so that $|r s|=a'$ (and therefore $|q s|=a+a'$). 

By property \ref{increase}, the following expressions have the same sign:
\begin{enumerate}[(i)]
\item $\tangle_\kappa\{|p s|;a+a',b\}
-\tangle_\kappa\{b';a+a',b\}$;
\item $|p s|-b'$;
\item $\tangle_\kappa\{|p s|;a',x\}-\tangle_\kappa\{b';a',x\}.$
\end{enumerate}
Since $$\tangle_\kappa\{|p s|;a+a',b\}=\mangle\hinge pqs =\mangle\hinge pqr=\tangle_\kappa\{x;a,b\}$$ 
and
$$\mangle\hinge rpq+\mangle\hinge rps=\pi\ \ \text{i.e.}\ \ \tangle_\kappa\{b;x,a\}+\tangle_\kappa\{|p s|;x,a'\}=\pi$$
we get the result.\qeds









Assume $A$ is geodesic consider first case when there is a point $z\in [x y]$ and two geodesics , it is sufficient to consider case when there is a $[xy]$.

Assume that for some $z\in[xy]$ we have $\alpha=\mangle\hinge z p x\not=0,\pi$.
Then, from hinge comparison we have that for any $z_x\in[zx]$,
$\angk1z{z_x}p\le\alpha$ and for any $z_y\in[zy]$,
$\angk1z{z_y}p\le\pi-\alpha$
$$|p\,\geod_{[xy]}(t)|\le 
\l[\begin{matrix}
\side_1\{\alpha;|pz|,t-t_0\}\ \ \ \ \ \,&\text{for}&t\ge t_0\\
\side_1\{\pi-\alpha;|pz|,t_0-t\}&\text{for}&t\le t_0
\end{matrix}\r.
$$








Assume first that $\sup_{z\in A}\{|pz|\}<\pi$, then, according to function comparison (\ref{thm:conc}), function $f_p=\rho_1\circ\dist_p$ satisfies $f_p''\le 1-\kappa f_p$ in whole $A$.
Thus, $y(t)=\rho_1(|p\geod_{[xy]}(t)|)$ 
satisfies $y''\le 1+\kappa y$.

Set $\ell=|xy|$ so $y$ is defined on $[0,\ell]$, clearly $\ell\le\pi$.
Take $t_0$ to be point of maximum of $y$ (and thus $z=\geod_{[xy]}(t_0)$ is the maximum point for $\dist_p$ on $[x y]$) and apply the barier inequality (\ref{y''=<1-ky}(\ref{barier})) for $\theta=0$:
$$y(t)
\le y(t_0)+[1-y(t_0)]\rho_1(t-t_0).$$
Sinse $y(t_0)< 2$, we get 
$y(t)<2-\rho_1(t-t_0)$; thus
$\rho_1(|px|)\le 2-\rho_1(t_0)$, $\rho_1(|py|)\le 2-\rho_1(\ell-t_0)$.
Hence\footnote{Let us remind that $\rho_1(t)=1-\cos t$.} $|px|\le \pi-t_0$ and $|py|\le \pi-\ell+t_0$, therefore 
$$|px|+|py|+|xy|\le 2\pi.$$








If $\max_{z\in [x y]}\{|pz|\}=\pi$, a priori, $y(t)$ does not have to satisfy $y''\le 1-\kappa y$, but we can walk around this problem the following way: fix small $\eps>0$ and choose a finite set of points $\{q_i\}\i B(\eps,p)$ such that for $f=\min_i\dist_{q_i}$ we have $\max_{z\in [x y]}\{f(z)\}<\pi$.
Set $a=\max_{z\in[x y]}\min_i\{|q_iz|\}$ and choose $z\in [x y]$ which maximizes $\min_i\{|q_iz|\}$, set $a=\min_i\{|q_iz|\}$ and repeat the above construction for 

Thus, function $f=\min_i\{f_{q_i}\}$ satisfies 
$f''\le 1 -\kappa f$ in a neigborhood of $[xy]$ and $y(t)=\rho_1(\min_i\{|q_i\geod_{[xy]}(t)\})$ 
satisfies $y''\le 1+\kappa y$.

Repeating arguments above, we get 
$$\min_i\{|q_ix|\}+\min_i\{|q_iy|\}+\ell< 2\pi$$
and passing to the limit $\eps\to0$
$$|px|+|py|+|xy|\le 2\pi.$$



















\begin{thm}{???}
Let $A$ be a complete lenght space, $\CAT_A\ge\kappa$.
Given $\eps>0$, for any $u,v\in T_p$, there is a sequence $w_n\in T_p$ such that for any semiconcave function $f$ defined in a neighborhood of $p$ we have
$$\liminf_{n\to\infty} d_p f(w_n)\ge d_p(u)+d_p(v)$$
$$\lim_{n\to\infty}|w_n|^2= |u|^2+2\<u,v\> +|v|^2.$$
Such a sequence $w_n$ is called almost sum of $u$ and $v$ and denoted $w_n=u\almplus{n} v)$.
\end{thm}

\begin{thm}{???}
Let $A$ be a complete lenght space, $\CAT_A\ge\kappa$.
For any $u,v\in T_p$, there is a sequence $w\in (T_p)^\omega$ such that for any semiconcave function $f$ defined in a neighborhood of $p$ we have
$$(d_p f)^\omega(w)\ge d_p(u)+d_p(v)$$
$$|w|^2= |u|^2+2\<u,v\> +|v|^2.$$
Such a vector $w$ is called sum of $u$ and $v$ and denoted $w=u+v)$.
\end{thm}








The following corrollary we will need later:

\begin{thm}{Corollary}
Given two vectors $v,w\in T_p$, for any $x\in T_p$:
$$\liminf_{n\to\infty}\<u\almplus{n} v,x\>\ge\<u,x\>+\<v,x\>.$$
\end{thm}

\parit{Proof.}
If $x\in T'_p=\Cone(\Sigma'_p)$ then for a point $q$ on a geodesic in direction of $x$ we have $d_pf(v)=-\<x,v\>$ where $f=|x|\dist_q$, a semiconcave function in a neigborhood of $p$.
Thus in this case corollary follows directly from key lemma (???).

Otherwise choose a sequence $x_n\to x$ such that $x_n\in T'_p$, apply the above and pass to the limit.
\qeds










\subsection{How to deal with non proper case}

\begin{thm} {Finite intersection property for balls}\label{finite intersection of balls}
Let $\CAT_X\le \kappa$ and $\Rad X\le\varpi_\kappa/2$.
Assume $\{\bar B_\alpha\}=\{\bar B(x_\alpha,r_\alpha)\}_{\alpha\in A}$ be an arbitrary collection of closed balls in $X$.
Then 
$$\cap_{\alpha\in A}B_\alpha=\emptyset$$
implyes that there is a finite collection 
$\{\alpha_1,\alpha_2,\dots,\alpha_n\}\in A$ 
such that
$$\cap_{i=1}^nB_{\alpha_i}=\emptyset.$$
\end{thm}

\parit{Proof.}
If $\kappa\le 0$ then all balls $\bar B_\alpha$ are closed and convex.
Thus in this case the statement follows directly from Helly's-tipe theorem \ref{thm:helly}.
By rescaling, the reamining case $\kappa>0$ 
can be reduced to $\kappa=1$ to which the rest 
of the proof is devoted.

In this case, let us consider euclidean cone $Y=\Cone(X)$. 
We will use polar coordinates in $Y$,
$(r,x)\in\RR_{\ge0}\times X$. Let us set some notation:
\begin{enumerate}[(i)]
\item Let us denote by $o$ the vertex of $Y$.
\item each point $x\in X$ corresponds to a ray
$r_x(t)$ in $Y$ desribed in coordinates by $(t,x)$, $t\ge 0$.
\item Let us denote by $b_x$ the Busemann function, which corresponds to $r_x$, i.e.
$$b_x(y)=\lim_{t\to\infty}t-|yr_x(t)|.$$
\item Let us denote by $\imath$ the natural embedding $\imath:X\to Y$, 
$\imath(x)=(1,x)$.
\item Set
$$L_\alpha=\{y\in Y|b_{x_\alpha}(y)\ge \cos r_\alpha\ \text{and}\  |oy|\le 1\}.$$
\end{enumerate} 

From ???, it follows that $\CAT_Y\le 0$.
Also, all $L_\alpha$ are bounded convex and closed;
i.e. one can apply \ref{thm:helly} to $\{L_\alpha\}$.
Clearly $\imath(\bar B_\alpha)\i L_\alpha$, thus for any collection
$\{\alpha_1,\alpha_2,\dots,\alpha_n\}\in A$,
$$\cap_{i=1}^n L_{\alpha_i}=\emptyset 
\ \ 
\Longrightarrow
\ \ 
\cap_{i=1}^n \bar B_{\alpha_i}=\emptyset.$$

Let us show that 
$$\cap_\alpha \bar B_\alpha=\emptyset 
\ \ 
\Longrightarrow
\ \ 
\cap_\alpha L_\alpha=\emptyset.$$

Sinse $\kappa=1$, $\varpi_\kappa=\pi$ and thus $\Rad X\le\pi/2$; 
i.e. there is $z\in X$ such that $\bar B(\pi/2,z)=X$. 
For each point $y\in \bar B(1,o)$ consider ray parallel to $r_z$%
\footnote{i.e. the limit of geodesics $[y\, r_z(t)]$ as $t\to\infty$???.}
Let us denote by $y'$ the nesessury unique point on this ray such that $|oy'|=1$.
It is easy to see that if $y\in L_\alpha$ then 
$y'\in \imath(\bar B_\alpha)$.
Thus, if $y_0\in \cap_{\alpha\in A} L_\alpha$ then 
$\imath^{-1}(y_0')\in \cap_{\alpha\in A} \bar B_\alpha$.

Therefore applying \ref{thm:helly} to $\{L_\alpha\}$ we obtain 
the finite intersection property.
\qeds











\begin{thm}{Lemma}
Let $\CAT_A\le \kappa$ and $\Rad A\le \varpi_\kappa/2$, $x_1,x_2,\dots, x_n\in A$ and let $p$ be a point such that for any direction $\xi\in \Sigma_p$ for some $i$ we have $\<\xi,\dir_p^{x_i}\>\le0$.
Then there is a model configuarion 
$\~p,\~x_1,\dots,\~x_n\in\Lob_\kappa^{n}$ and a subset $F\in \{1,2\dots,n\}$ such that 
\begin{enumerate}[(i)]
\item $|\~x_i\~x_j|\le|x_ix_j|$ for all $i,j$
\item $|\~p\~x_i|\le |px_i|$ for all $i$ and $|\~p\~x_i|=|px_i|$ if $i\in F$.
\item \label{conv-cond} $\~p\in \Conv(\{x_i\}_{i\in F})$
\end{enumerate}
\end{thm}

\parit{Proof.} Assume $p,x_1,x_2,\dots, x_n\in A$ be a collection of points which contradicts the statement of theorem. 
Without loss of generality, we can assume that $\{p,x_1,x_2,\dots, x_n\}$ is extremal in the following sense: for fixed numbers $r_1,r_2,\dots,r_n$ 
$p$ is unique point of intersection of $\cap_{i=1}^n\bar B(r_i,x_i)$ and there is no configuration ... such that ...

Sinse the map $\log_p:A\to T_p$ is non-expending for the configuration $x_i'=\log_px_i$, $p'=o_p\in T_p$ we have that $|x_i'p'|_{T_p}=|x_ip|_A$ and $|x_i'x_j'|_{T_p}\le |x_ix_j|_A$.
Clearly $p'$ is also the unique point of intersection of $\cap_{i=1}^n\bar B(r_i,x'_i)\i T_p$.
Thus, sinse $\{p,x_1,x_2,\dots, x_n\}$ is extremal we have $|x_i'x_j'|_{T_p}= |x_ix_j|_A$ for all $i,j\in\{1,2,\dots,n\}$.

Take $v=(v_i)\in \RR^n$ such that $v_i=???$, and consider matrix 
$A=(a_{ij})$, defined by $a_{ij}=\<\dir_p^{x_i},\dir_p^{x_j}\>$.

Note that
$$\<Av,v\>\le 0.$$ 
Indeed...

Let us denote by $\bar A=(\bar a_{ij})$ a non-negatively defined matrix such that $\bar a_{ii}=a_{ii}$ 
and which minimizes the distance $\sum{i>j}|a_{ij}-\bar a_{ij}|^2$.

Note that 
$$\<Av,v\>=0.$$
Indeed...

Sinse $\bar A\ge 0$, there is a linear map $F:\RR^n\to \RR^n$, 
such that for any $x\in \RR^n$ we have 
$$\<Ax,x\>=\<Fx,Fx\>.$$
Sinse $\<Av,v\>=0$ we have $Fv=0$, thus $0=Fv\in \Conv(Fe_1,Fe_2,\dots,Fe_n)$.

First note that if $p=x_i$ for some $i\in\{1,2,\dots,n\}$ then 
one can take model configuration ???.

Assume we have a model configuration for $p$ and $p'$, assume $\hat p\in [pp']$.
Let us show that there is a model configuration for $\hat p$.???

Let us consider a model configuration which satisfies properties ... and has maximal possible  $\sum_{i<j}|\~x_i\~x_j|$.
Assume it does not satisfy \textit{(\ref{conv-cond})}, then it is easy to see that there are positive numbers $\alpha_i$ such that vector $v=\sum\alpha_i\dir_{\~p}{\~x_i}$ in the euclidean space $T_p\Lob_\kappa^{n+1}$ such that $\mangle(v,\dir_{\~p}^{\~x_i})<\pi/2$ for all $i$. 
Let us constuct a vector $w\in T_pA$ 
\qeds









\begin{thm}{Lemma}
Let $\CAT_A\le \kappa$ and 
$x_0,x_1,\dots,x_n\in B(\varpi_\kappa/2,z)\i A$. 
Let $f:\triangle\to A$ be baricentrical simples constructed on
$x_0,x_1,\dots,x_n$ 
then for almost all $s\i\triangle$ 
all directions $\dir_{f(s)}^{x_i}$ 
belong to a copy of Euclidean space, 
isometrically embeded into $T_{f(s)}A$.
\end{thm}

It is likely I solved it modulo some statements:

1. It seems that from Kleiner it follows that for almost all $s\in\triangle$, the point on baricentric simplex $f(s)$ has
$T_{f(s)}f(\triangle)$ to be a copy of Euclidean space isometrically embeded in $T_{f(s)}$. 

2. For any finite set of points $x_i$ of simplex we have that restriction of differential $d_{f(s)}\dist_{x_i}|_{T_{f(s)}f(\triangle)}$ is linear.

3. Assume $\dim T_{f(s)}=\dim\triangle$ for almost all $s$. Take $x_i$ to be vertexes of the baricentrical simplex, from the fact that $d_{f(s)}\dist_{x_i}|_{T_{f(s)}f(\triangle)}$ is linear it should??? follow that for each $i$, the direction $\dir_{f(s)}^{x_i}$ together with $T_{f(s)}f(\triangle)$ lies in a euclidean halphspace which isometrically embeded into $T_{f(s)}$. Using fact that $\sum s_i\dist_{x_i}d\dist_{x_i}=0$.

\begin{thm}{Lemma}
Let $x_0,x_1,\dots,x_n\in \Lob_\kappa^n$ and $y_0,y_1,\dots,y_n\in \Lob_\kappa^n$ be two configurations such that $|x_ix_j|\le|y_iy_j|$ for all $i,j\in \{0,1,\dots,n\}$
Then for any point $p\in \Lob_\kappa^n$ there is a point 
\end{thm}

\begin{thm}{Lemma}
Let $x_0,x_1,\dots,x_n\in B(\varpi_\kappa,z)\i\Lob_\kappa^n$ and $p\in \Conv\{x_0,x_1,\dots,x_n\}$ then for any $q\in \Lob_\kappa^n$ there is $i\in\{0,1,\dots,n\}$ such that
$$|qx_i|\ge |px_i|.$$
\end{thm}















\begin{thm}{Corollary}
If $\CAT_L\le \kappa$, then
\begin{enumerate}
\item if $\kappa\le 0$ then any short map $f:S\to\Lob_\kappa^n$ 
can be extended as a short map $\bar f:L\to\Lob_\kappa^{n}$
\item any short map $f:S\to\Lob_\kappa^n$ 
can be extended as a short map $\bar f:L\to\Lob_\kappa^{n+1}$, where $\Lob_\kappa^n$ is considered as a hyperplane in $\Lob_\kappa^{n+1}$.
\end{enumerate}
\end{thm}

\parit{Proof.}
Let us first prove that for any $p\in L$ and any finite subset $F\in A$ and a short map $f:F\to \Lob_\kappa$, there is a point $\~p\in\Lob_\kappa$ such that
$$|\~p\,f(x)|\le|px|\ \ \text{for any}\ \ x\in F.$$
Assume it is wrong, and $p, x_1,x_2,\dots, x_n\in L$ be a configuration which does not meets this property.
We can assume that this configuration is minimal, i.e. for any for each $i$ there is a point $\~p_i$ such that $|\~p_i\,f(x_j)|\le|px_j|$ for all $j\not=i$.
Let us choose such $\~p_i$ to make distance $|\~p_i\~x_i|$ to be minimal possible.
Clearly $|\~p_i\~x_i|>|px_i|$, morevoer for each $j\not=i$ we have $|\~p_i\~x_j|=|px_j|$ (otherwise the configuration would not be minimal, indeed, do the cosine-trick...).
The point $\~p_i$ must lie in a convex hull of $\{\~x_i\}$.
Clearly $\~p_i\not=\~p_j$, that implies that points $\{\~x_i\}$ form vertexes of nondegenerate simplex...

Further note that simplexes $\<\~x_1\dots \~x_{i-1}\~p_i\~x_{i+1}\dots\~x_n\>$ do not overlap...

Therefore the same is true for spherical simlexes

\begin{thm}{Key Lemma}
Let $\triangle=\Conv(x_0,x_1,\dots,x_n)$ be an $n$-simplex in $\Lob_\kappa^n$ and $\triangle_i=\Conv(x_0,x_1,\dots,x_{i-1},p_i,x_{i+1},\dots,x_n)$, $i\in\{0,1,\dots,n\}$ be a collection of simplexes, with the following properties:
\begin{enumerate}
\item $\triangle_i\i \triangle$;
\item No pair of $\triangle_i$ have a common point inside $\triangle$;
\item $|p_ix_k|=|p_jx_k|$ if $k\not=i,j$;
\end{enumerate}
then the following holds:

If one rotates $\triangle_1$ around fase $\Conv(x_2,x_3,\dots,x_n)$ to make $p_1$ go to $p_0$ and denote by $x_0'$ the image of $x_0$ after rotation then 
$p_0\in \Conv(x_0',x_1,\dots,x_n)$.

More over the same is true if one permutes indexes $\{1,2,\dots,n\}$.
\end{thm}

\parit{Proof.} Induction by $n$.

\parit{Base, $n=2$:} In this case it is enough to show that\footnote{Note that the claim in the case $\kappa\le0$ follows immidetely from the formula which relates sum of angles for hexagone 
$\~p_1\~x_2\~p_3\~x_1\~p_2\~x_3$ and its area:
$$
\mangle\~p_1
-
\mangle\~x_2
+
\mangle\~p_3
-
\mangle\~x_1
+
\mangle\~p_2
-
\mangle\~x_3
=2\pi-\kappa\cdot area.$$} 
$$\mangle\<p_0;x_1,x_2\>
 +\mangle\<p_1;x_2,x_0\>
 +\mangle\<p_2;x_0,x_1\>
>2\pi.\eqno(*)$$

\begin{wrapfigure}{r}{42mm}
\begin{lpic}[t(-5mm),b(5mm),r(0mm),l(0mm)]{pics/4-pnt-kirsz(0.4)}
\lbl[b]{45,36;$\~p_1$}
\lbl[t]{42,63;$\~p_2$}
\lbl[l]{21,50;$\~p_0$}
\lbl[lb]{4,97;$\~x_1$}
\lbl[tr]{9,4;$\~x_2$}
\lbl[b]{104,56;$\~x_0$}
\lbl[l]{54,101;$\~x_0'$}
\end{lpic}
\end{wrapfigure}

Rotate triangle $\<\~p_1\~x_2\~x_0\>$ around $\~x_2$ to make $[\~x_2\~p_1]$ coinside with $[\~x_2\~p_0]$.
Denote by $\~x_0'$ the image of $\~x_0$ after rotating.
Then, we have 
$|\~x_1\~x_0'|<|\~x_1\~x_0|$ and therefore $$\mangle\~p_2>\mangle\<\~p_0;\~x_1\~x_0'\>=$$
$$=\min\{\mangle\~p_1+\mangle\~p_0,\pi -(\mangle\~p_1+\mangle\~p_0)\}.\eqno(**)$$
The same is true if one permutes indexes in this inequality.
If sum of each pair of angles $\mangle\~p_i$ is smaller than $\pi$, then summing these inequalities we get
$$\mangle\~p_0+\mangle\~p_1+\mangle\~p_2>2(\mangle\~p_0+\mangle\~p_1+\mangle\~p_2),$$
a contradiction.
Therefore sum of at least one the pairs is $\ge\pi$ and thus $(**)$ implies $(*)$.

\parit{Step:} Assume it is wrong, then $p_0$ is an extremal point\footnote{A point of a convex body $L$  called extremal if it doe not lie on a segemnt joining two othe points of $L$.} of
$$L=\Conv(p_0,{x_0}',{x_1}\dots{x_n}).$$
Sinse $n>2$, at least $3$ of the segments $[p_0x_0']$, $[p_0x_1]$, ..., $[p_0x_n]$ are ejes of $L$. 
Thus, one of the edjes must be $[p{x_2}]\dots[p{x_n}]$.
We can renumerate them so that it is $[{p_0}{x_2}]$.

Let us intersect the conviguration of $\triangle$ and $\triangle_i$ with a small sphere $S$ centered at $x_2$, then the intersections $\triangle'=S\cap \triangle$ and $\triangle'_i=S\cap \triangle_i$ will have all the properties described in the lemma, but dimension one lower.
Thus $\dir_{x_2}^{p_0}\in \Conv(\dir_{x_2}^{x_0'},\dir_{x_2}^{x_1},\dir_{x_2}^{x_3},\dots,\dir_{x_2}^{x_n})$, but that implies that 

On the other hand if one look at the ... the picture will be exactly the same.
Thus, if Lemma is correct in for $n<m$, it must be correct for $n=m$.

It remains to prove base for induction,
\qeds















Let us denote by $o_L$, $o_U$ the verteses of $L'$ and $U'$ correspondently.
And given $y\in U$, let us denote by $r_y:[0,\infty)$ the ray in $U'$ starting at $o_U$ in direction $y$.

Asssume the contrary, then, as above, 
there if a set $\bar Q\i L$, 
a short map $f:\bar Q\to U$ and  
$p\in L\backslash \bar Q$ such that 
$\cap_{x\in \bar Q}\bar B(|xp|,f(x))=\emptyset$.
Let $\bar Q'\in L'$ be the subcone over $\bar Q\i L$.
One can extend naturally map $f:\bar Q\to U$ to a map $f':\bar Q'\to U'$, so that ray will map to a ray preserving parametrization.
Clearly $f'$ is a short map, thus it can be exteded to a short map $\bar f':L'\to U'$.
Clearly $f'(\bar B(1,o_L)\i \bar B(1,o_U)$.
Thus for any $p\in L\backslash \bar Q$ there is a point $q\in U'$ 
so that $...$.
It only remains to show that infact one can choose $q$ so that $|o_Uq|=1$.
Let us drow a ray from $q$ parallel to ... and denote by $q'$ ...

For each $x\in \bar Q$, consider a ray $r_x:[0,\infty)\to U'$ starting at $o_U$ in direction of $f(x)\in U$.
Let $b_x$ be corresponding Buseman function; i.e.
$$b_x:U'\to\RR,\ \ b_x(z)=\lim_{t\to\infty}(t-|zr_x(t)|).$$
Then consider subset $D(x)\i U'$ described by
$$D(x)=\l\{z\in U'{\big\vert}|oz|\le 1,\ b_x(x)\ge \cos(|px|)\r\}.$$

Note that for any subset $P\in\bar Q$
$$\bigcap_{x\in P} D(x)=\emptyset 
\ \ 
\Longleftrightarrow
\ \ 
\bigcap_{x\in P} \bar B(|xp|,f(x))=\emptyset.$$

The part ($\Rightarrow$) follows sinse for the natural embedding $\imath:U\to U'$ which sends $U$ to the unit sphere in $U'$, we have $\bar B(|xp|,f(x))=\imath^{-1}D(x)$.
 

It is easy to see that if $y\in D(x)$ then so is
$y'$ and thus $\imath^{-1}(y')\in \bar B(|xp|,f(x))$.
Thus, if $y_0\in \cap_{\alpha\in A} L_\alpha$ then 
$\imath^{-1}(y_0')\in \cap_{\alpha\in A} \bar B_\alpha$.

For each $x\in \bar Q$, the set $D(x)$ is convex closed and bounded. 
Thus one can apply Helly's theorem to the collection $\{D(x)\}_{x\in \bar Q}$.

We will use polar coordinates in both of these cones,
$(r,x)\in\RR_{\ge0}\times L$ for $L'$ and 
$(r,x)\in\RR_{\ge0}\times U$ for $U'$.

 
Let us set some notation:
\begin{enumerate}[(i)]
\item Let us denote by $o$ the vertex of $Y$.
\item each point $x\in X$ corresponds to a ray
$r_x(t)$ in $Y$ desribed in coordinates by $(t,x)$, $t\ge 0$.
\item Let us denote by $b_x$ the Busemann function, which corresponds to $r_x$, i.e.
$$b_x(y)=\lim_{t\to\infty}t-|yr_x(t)|.$$
\item Let us denote by $\imath$ the natural embedding $\imath:X\to Y$, 
$\imath(x)=(1,x)$.
\item Set
$$L_\alpha=\{y\in Y|b_{x_\alpha}(y)\ge \cos r_\alpha\ \text{and}\  |oy|\le 1\}.$$
\end{enumerate} 

From ???, it follows that $\CAT_Y\le 0$.
Also, all $L_\alpha$ are bounded convex and closed;
i.e. one can apply \ref{thm:helly} to $\{L_\alpha\}$.
Clearly $\imath(\bar B_\alpha)\i L_\alpha$, thus for any collection
$\{\alpha_1,\alpha_2,\dots,\alpha_n\}\in L$,
$$\cap_{i=1}^n L_{\alpha_i}=\emptyset 
\ \ 
\Longrightarrow
\ \ 
\cap_{i=1}^n \bar B_{\alpha_i}=\emptyset.$$

Let us show that 
$$\cap_\alpha \bar B_\alpha=\emptyset 
\ \ 
\Longrightarrow
\ \ 
\cap_\alpha L_\alpha=\emptyset.$$

Sinse $\kappa=1$, $\varpi_\kappa=\pi$ and thus $\Rad X\le\pi/2$; 
i.e. there is $z\in X$ such that $\bar B(\pi/2,z)=X$. 


Therefore applying \ref{thm:helly} to $\{L_\alpha\}$ we obtain 
the finite intersection property.























For each proper subset $F'\i F$, we have 
$$\mathbf v\in \RR_{\ge0}^{F'}\ \Rightarrow\ \Phi(\mathbf v)\ge0
>\eps|\mathbf v|^2.$$
Thus, there is a quadratic form 
$$\Phi^\flat(\mathbf w)=\sum_{i,j=1}^n a_{ij}w_iw_j$$ such that 
\begin{enumerate}
\item $a_{ii}=1$ for each $i\in F$
\item $a_{ij}\ge \<\dir_p^{x_i},\dir_p^{x_j}\>$ for all $i,j\in F$;
\item $\Phi^\flat(\mathbf w)\ge 0$ for any $\mathbf v\in\RR_{\ge0}^{F}$
\item there is $\mathbf v^\flat\in\RR_{>0}^{F}\ \ \text{such that}\ \ \Phi^\flat(\mathbf w)= 0.$
\end{enumerate}

These conditions imply that $\Phi^\flat(\mathbf v)\ge 0$ for any $\mathbf v\in\RR^{F}$.
Thus there is a linear map $h:\RR^F\to \RR^n$ such that
$$\Phi^\flat(\mathbf v)=|h(\mathbf v)|^2$$













 
Choose $\eps,r>0$ such that for any $q\in B(r,p)$ we have $\angk{\kappa}{q}{a_i}{a_j}>\pi/2+\eps$ for all $i\not=j$.
Clearly, for some fixed $\lambda\in\RR$, all functions $\dist_{a_i}$ are $\lambda$-concave in $B(r,p)$.

Consider $\RR^m$ with basis $\{\mathbf e_i\}$ and set
$$\op{DistMap}:L\to \RR^m,\ \ \op{DistMap}(q)=\sum_{i=1}^m\bigl[|a_iq|-|a_ip|\bigr]\cdot\mathbf e_i.$$
It is enough to construct a $C^{\frac12}$-continuous map $F:\RR^m\to L$ such that 
$$\op{DistMap}\circ F(\mathbf x)=\mathbf x$$ 
for $\mathbf x$ in a small neigborhood of $\mathbf 0\in \RR^m$.


Given $\mathbf x=\sum_{i=1}^mx_i\mathbf e_i$, 
let us define functions
$$f_{\mathbf x}:L\to\RR,\ \ f_{\mathbf x}=\min_{i>0}\{\dist_{a_i}- x_i\}$$
and 
$$g_{\mathbf x}:L\to\RR,\ \ g_{\mathbf x}=\eps\dist_{a_0}+\min\{0,f_{\mathbf x}\}.$$

Clearly, for any $\mathbf x\in\RR^m$, function $g_{\mathbf x}$ is $(1+\eps)\lambda$-concave in $B(r,p)$ and
$$|g_{\mathbf x}(q)-g_{\mathbf y}(q)|\le (1+\eps)\cdot|\mathbf x-\mathbf y|\eqno(*)$$ 
for any $q\in L$.

Let us denote by $\alpha_{\mathbf x}(t)$ the $g_{\mathbf x}$-gradient curve which starts at $p$.
Set 
$$F(\mathbf x)=\alpha_{\mathbf x}(\delta)$$
for $\delta=r/(1+\eps)$.
From $(*)$ and lemma~\ref{lem:fg-dist-est}, $F$ is $C^{\frac12}$-continuous.

We had chousen $g_{\mathbf x}$ so that for any $g_{\mathbf x}$-gradient curve $\alpha_{\mathbf x}$ in $B(r,p)$ the curve $\op{DistMap}\circ\alpha_{\mathbf x}$ in $\RR^m$ aproaches $\mathbf x$.
Namely, note that
\begin{itemize}
\item If $f_{\mathbf x}(q)<0$ (i.e. $|a_iq|<|a_ip|+x_i$ for some $i>0$) then 
$$|\nabla_qf_{\mathbf x}|\ge \min_{i>0} d\dist_{a_i}(\dir_q^{a_0})$$ 
and thus $\nabla_q g_{\mathbf x}>???$.
In particular for any $g_{\mathbf x}$-gradient curve $\alpha(t)$ we have 
$f_{\mathbf x}\circ\alpha(t)<0$ $\Rightarrow$ $(f_{\mathbf x}\circ\alpha)^+(t)>???$.
\item  If $f_{\mathbf x}(q)\ge 0$ then if $|{a_i}q|>|a_ip|+x_i$ for some $i>0$ then $d\dist_{a_i}(\nabla g_{\mathbf x})<???$ and thus for any $g_{\mathbf x}$-gradient curve $\alpha(t)$ we have $\dist_{a_i}\circ\alpha(t)>x_i$ $\Rightarrow$ 
$(\dist_{a_i}\circ\alpha)^+(t)<???$
\end{itemize}

These two inequlaties imply that if one defines $F:\RR^m\to L$ as 
$$F(\mathbf x)=\GF_{g_{\mathbf x}}^\delta(p)$$
then $F$ is a $B(???,\mathbf 0)$

Fix small $\delta>0$ so that $\delta<r/???$.
For each function $f_{\mathbf x}$ consider gradient curve $\alpha_{\mathbf x}:[0,\delta]\to L$ which starts at $p$ and set $f(\mathbf x)=\alpha_{\mathbf x}(\delta)$.

According to lemma~\ref{lem:fg-dist-est}, $f$ is a H\"older continuous with exponent $\tfrac12$. 

Indeed, assume for some $i>0$ we have $|{a_i}\,\alpha_{\mathbf x}(???)|\not=x_i$.
Note that 
\begin{itemize}
\item if 
$|{a_i}\,\alpha_{\mathbf x}(t)|<x_i$ then $|{a_i}\,\alpha_{\mathbf x}(t)|^+>???$
\item  and if $|{a_i}\,\alpha_{\mathbf x}(t)|>x_i$ then $|{a_i}\,\alpha_{\mathbf x}(t)|^+>???$
\end{itemize}
Thus if $|\mathbf x|$ is sufficiently small then $|{a_i}\,\alpha_{\mathbf x}(???)|=x_i$ for all $i>0$.
I.e. $\op{DistMap}\circ f(\mathbf x)=\mathbf x$ if $|\mathbf x|$ is sufficiently small.

Clearly $\op{DistMap}$ is Lipschitz, thus $f$ is a bi-H\"older embedding.

\ 















\begin{thm}{Proposition}\label{top>=m}
Let $L\in\CBB{}{\kappa}$ and $p\in L$.
Assume there is a collection of points $a_0,a_1,a_2,\dots,a_m$ such that 
$$\angk\kappa p{a_i}{a_j}>\pi/2\ \ \text{for all}\ \  i\not=j.$$ 
Then there are maps $f:\triangle^m\to L$ and $g:L\to \triangle^m$ such that 
$$[g\circ f]\not=0\ \ \text{in}\ \  H_m(\triangle^m,\partial\triangle^m).$$
Moreover, both maps $f$ and $g$ can be chousen to be Lipshitz.
\end{thm}

\begin{thm}{Corollary}\label{pack>=m}
Let $L\in\CBB{}{\kappa}$ and $p\in L$.
Assume there is a collection of points $a_0,a_1,a_2,\dots,a_m$ such that 
$$\angk\kappa p{a_i}{a_j}>\pi/2\ \ \text{for all}\ \  i\not=j.$$ 
Then for some $r>0$ there is $\Const>0$ such that 
$$\pack_\eps B(r,p)>\Const\cdot\eps^{-m}$$
\end{thm}


\parit{Proof.} Let us define two maps $F:\RR^n_+\to L$ and $G:L\to \RR^n$,
$$F:(t_1,t_2,\dots,t_n)
\mapsto 
\GF_{\dist_{a_n}}^{t_n}
\circ
\GF_{\dist_{a_{n-1}}}^{t_{n-1}}
\circ\dots\circ
\GF_{\dist_{a_1}}^{t_1}(p)$$
$$G:x
\mapsto
(|a_1x|-|a_1p|,
|a_2x|-|a_2p|,\dots,
|a_nx|-|a_np|).$$

Then from ??? there are $\eps,\delta>0$ such that if 
$$(y_1,y_2,\dots,y_n)=G\circ F(t_1,t_2,\dots,t_n)$$ 
then 
$$t_i=0\ \ \Rightarrow\ \ y_i\le0\ \ \text{and}\ \ \sum t_i=\eps\ \ \Rightarrow\ \ \sum y_i\ge\delta.\eqno(*)$$

Let us denote by $\triangle_\delta^n$ the simplex in $\RR^n$ described by inequlaities
$x_i\ge0$ and $\sum_ix_i\le\delta$.
Let $\op{pr}_\delta:\RR^n\to\triangle_\delta^n$ be the natural projection, for a point of $\mathbf x\in \RR^n$, $\op{pr}_\delta(\mathbf x)$ is the point on $\triangle_\delta^n$ closest to $\mathbf x$.

Thus $(*)$ implies that map $h=\op{pr}_\delta\circ G\circ F:\triangle_\eps^n\to\triangle_\delta^n$ sends each face of $\triangle_\eps^n$ to the correspondent face of $\triangle_\delta^n$.
It is easy to see then that map of pairs $h:(\triangle_\eps^n,\partial\triangle_\eps^n)\to(\triangle_\delta^n,\partial\triangle_\delta^n)$ is homotopic to the linear homeomorphism, thus $[h]\not=0$ in $H_n(\triangle_\delta^n,\partial\triangle_\delta^n)$.

Thus one can take $f(\mathbf x)=F(\tfrac1\eps \mathbf x)$ and $g(x)=\tfrac1\delta\op{pr}_\delta \circ G(x)$.
\qeds

























First we will define different dimension invariants, they come in three groups.
We give them local names, valid for this section only, say ``$\op{TopDim}$'' for topological dimension.
Once we will prove that all of them are equlal (theorem ???), we will denote all of them simply $\dim$.

\parbf{Geometric dimensions.}
Let $L\in\CBB{}{\kappa}$ and $\Omega\i L$ is an open subset.
\begin{itemize}

\item\label{E-dim} 
\item\label{E-dim} \textbf{Kleiner dimension.}
\begin{multline*}\op{KleiDim}(X)=\sup\bigl\{m\in\NN\ |\  \exists\ \text{a sequence of subsets}\\ K_n\i X\ \ 
\text{such that}\ \ \tfrac1n K_n\GHto B^1(1))\bigr\}.
\end{multline*}

\item\label{F-dim} \textbf{Frame dimension.}
\begin{multline*}\op{FrDim}(\Omega)=\sup\bigl\{m\in\NN\ |\ \exists\ p\in\Omega\ \ \text{and}\ \ m+1\ \ \text{directions}\\ 
\{\xi_i\}_{i=0}^m\i\Sigma_pL\ \  
\text{such that}\ \ \mangle(\xi_i,\xi_j)>\pi/2\ \ \text{for all}\ \  i\not=j\bigr\}.
\end{multline*}

Or, equivalently,
\begin{multline*}\op{FrDim}(\Omega)=\sup\bigl\{m\in\NN\ |\ \exists\ p\in\Omega\ \ \text{and}\ \ m+1\ \ \text{points}\\ 
\{x_i\}_{i=0}^m\i \Omega\ \  
\text{such that}\ \ \angk\kappa p{x_i}{x_j}>\pi/2\ \ \text{for all}\ \  i\not=j\bigr\};
\end{multline*}

\end{itemize}




\parbf{Fractal dimensions.} Let $X$ be an arbitrary metric space.
\begin{itemize}
\item \textbf{Lower Minkowski dimension.}
\begin{multline*}
\op{\underline{MinkDim}}(X)=\sup\bigl\{\alpha\in\RR\ |\ \exists\ \Const>0\ \  \text{such that}\\ 
\pack_\eps X\ge\Const\cdot\eps^{-\alpha}\ \ \text{for all}\ \ \eps>0\bigr\};
\end{multline*}
%\item upper Minkowski dimension
%\begin{multline*}
%\op{\overline{MinkDim}}(\Omega)=\inf\bigl\{\alpha\in\RR\ |\ \exists\ \Const\in\RR\ \ \text{such that}\\
%\pack_\eps\Omega\le\Const\cdot(1+\eps^{-\alpha})\ \ \text{for all}\ \ \eps>0\bigr\};$$
%\end{multline*}
\item \textbf{Hausdorff dimension.}
\[\op{HausDim}(X)=\sup\bigl\{\alpha\in\RR\ | h_\alpha(X)>0\bigr\},\]
 where $h_\alpha$ denotes $\alpha$-dimensional Hausdorff measure;
\end{itemize}




\parbf{Topological dimensions.} There are few different notions of topological dimension, including big and small inductive dimensions and Lebegue's covering dimension.
Even for metric spaces, these quantities might differ, but all of them coinside on class of compact metric spaces ??? and monotonic with respect to inclusion on closed subsets. 
Thus according to theorem \ref{thm:dim=dim} all of them coinside on class of CBB-spaces.
\begin{enumerate}
\item Lebegue's dimenison ($\text{Leb-}\!\dim$) is infimum of numbers $n\in \ZZ_{\ge0}$, such that for any given $\eps>0$ there is an open cover $\{\Omega_\alpha\}$ of $X$ such that $\diam\Omega_\alpha<\eps$ and for any point $x\in L$ there are at most $n+1$ elements of cover which contain $x$.
\item Lebegue's covering dimension
\begin{multline*}\op{TopDim}(\Omega)=\sup\{\,m\in\NN\,|\,\forall\eps>0\exists\ \ \text{continuous map}\\  f:\Omega\to P^m\ \ \text{to an}\ \  m\text{-dimensional simplicial complex}\\  P^m\ \  \text{such that}\ \  \diam f^{-1}x\ \ \text{for any}\ \  x\in P^m \}
\end{multline*}
$\sup\bigl\{m\in N\ |$ 
such that there is a compact subset $K\i \Omega$ with topological dimension
$\ge m\bigr\}$;
\item Small inductive dimension. $\op{indDim}X$ defined inductively by setting $\op{indDim}\emptyset=-1$ and $\op{indDim}X\le m$ if $X$ contains a base $\{\Omega_\alpha\}$ such that for each $\alpha$ we have $\op{indDim}\partial\Omega_\alpha\le m-1$.
Finally we say that $\op{indDim}X= m$ is $\op{indDim}X\le m$, but $\op{indDim}X\not\le m-1$.

\item Big inductive dimension. $\op{IndDim}X$ defined inductively by setting $\op{IndDim}\emptyset=-1$ and $\op{IndDim}X\le m$ if for any closed set $C$ and any open $\Omega\supset C$ there is an open set $\Omega'$ such that $\Omega\supset\Omega'\supset C$ and $\op{IndDim}\partial\Omega'\le m-$.
Finally we say that $\op{IndDim}X= m$ is $\op{IndDim}X\le m$, but $\op{indDim}X\not\le m-1$.
\end{enumerate}

Let us introduce two more intermidiate dimension dinvariants:
\begin{multline*}
 \op{HausDim}_K\Omega=\sup\{m\in \NN\,|\,\text{there is a compact subset}\\
K\i \Omega\ \ \text{such that}\ \ \op{HausDim}K\ge m\}
\end{multline*}
and
\begin{multline*}
 \op{HausDim}_K\Omega=\sup\{m\in \NN\,|\,\text{there is a compact subset}\\
K\i \Omega\ \ \text{such that}\ \ \op{TopDim}K\ge m\}.
\end{multline*}

\begin{thm}{Theorem}\label{thm:dim=dim}
Let $L\in\CBB{}{\kappa}$, then for any open $\Omega\i L$ we have
\begin{multline*}
\op{LinDim} L
=
\op{FrDim}\Omega=\\
=
\op{\underline{MinkDim}}\Omega
=
\op{\underline{MinkDim}}_K\Omega=\\
=
\op{HausDim}\Omega
=
\op{HausDim}_K\Omega=\\
=
\op{TopDim}\Omega
=
\op{TopDim}_K\Omega.
\end{multline*}
In particular, non of these quantities depend on choice of $\Omega$.
\end{thm}











Let $L\in\CBB{}{\kappa}$.
Assume $\dim L\ge n$, thus given $\eps>0$ there is a subset $K\in L$ such that $\tfrac1\eps K$ is arbitrary close to unit ball in Euclidean $n$-space $\bar B^n_1(o)\i E^n$. 

Let $h:\bar B^n_1(o)\to \tfrac1\eps K$ be a hausdorff approximation, consider image of the center of ball $p=h(o)$. 
Take a maximal subset $\{x_i\}\i B^n_1(o)$ so that $|x_ix_j|>\eps$ for all $i,j$.
Then according to one can choose a point $p'$ arbitrary close to $p$ so that all vectors $v_i=\log_{p'}x_i$ belong to a Euclidean subcone $E\i T_{p'}$.
Let us show that $\dim E\ge n$.
Indeed, $|v_i|=|p'x_i|\le \tfrac1\delta+|pp'|$ thus we can assume $|v_i|\le \tfrac2\delta$.
From comparison we have that $|v_iv_j|\ge |x_ix_j|+???(\eps)$, thus assuming that ???

Thus we obtain 

\begin{thm}{Claim}
Let $L\in\CBB{}{\kappa}$.
Then $\dim L\ge m$ if and only if there is a point $p\in L$ such that its tangent space $T_pL$ contains a subcone globally isometric to an $n$-dimensional Euclidean space.
\end{thm}

On the other hand, if $T_p$ contains a Euclidean subcone of dimension $n$, one can chose a collection of points $a_0,a_1,\dots,a_m\in L$ so that $\angk{\kappa}p{a_i}{a_j}>\pi/2$.
Then according to ???, for some??? neigborhood $\Omega_p\ni p$ the map $f\:\Omega_p\to\RR^m$,
$f\:x\mapsto(|a_1x|,|a_2x|,\dots,|a_nx|)$ is Lipschits and co-Lipschitz.


















There is a number of different notions of dimension for metric spaces.
In general case, the relation between them is quite complicated.
However, according to the following theorem, for compact metric spaces the main puraly topological definitions give the same value:

\begin{thm}{Theorem} Let $X$ be a compact metric space then the following (possibly infinite) quatities coinside:
\begin{enumerate}
\item\textit{(Lebegue's covering dimension)}\\
$\inf\{n\in \NN\ |$ for any given $\eps>0$ there is an open cover $\{\Omega_\alpha\}$ of $X$ such that $\diam\Omega_\alpha<\eps$ and for any point $x\in L$ there are at most $n+1$ elements of cover which contain $x\}$.
\item Inducive dimension
\item $\sup\{n\in \NN\ |$ for any closed set $C\i X$, any continuous map $C\to S^{n}$ can be extended to a continuous map $X\to S^n\}$.
\end{enumerate}
\end{thm}

We will denote by $\dim X$ the quatitie defined in the last theorem.
Further, one can relate this quantity, to the following metrical definition of dimension:

Moreover, all
\begin{thm}{Theorem}
Let $X$ be a compact metric space, assume $\dim X\ge n$ then
\begin{enumerate}
\item $n\le \inf\{\alpha\in\RR\ |\ h_\alpha(X)=0\}$, where $h_\alpha$ is $\alpha$-dimensional Hausdorff measure.
\item $n\le \inf\{\alpha\in\RR\ |\ \exists\Const>0$ such that $\pack_\eps X>\Const\eps^{-\alpha}\}$.
\end{enumerate}
\end{thm}

Infact, if one take infimum of the quantitye in ???, among all metrics homeomorphic to $X$ then one gets $\dim X$.



For general metric space we define topological dimension to be maximal dimension of its compact subspace.
This convension is not quite standard, but we do it to simplyfy presentation.

There yet other metric notion of dimension.
is supremum of numbers $n\in \ZZ_{\ge0}$, such that there is a sequence of compact subspaces $K_n\i L$ and $\eps_n\to 0$ such that sequence $\tfrac1{\eps_n}K_n$ converges in Gromov--Hausdorff sense to a standard ball in Euclidean $n$-space.

This notion was first introduced in \cite{kleiner}.

It is easy to construct examples which show that for general metric space there is no relation between $\text{G-}\!\dim$ and $\text{L-}\!\dim$, $\text{G-}\!\dim$ and $\text{H-}\!\dim$,
but as we will see further ???.




















\begin{thm}{Theorem}\label{thm:dim-infty}
Let $L\in\CBB{}{\kappa}$, $q\in L$ and $r>0$ and $m\in \NN$.
Then the following statements are equivlent:
\begin{enumerate}[(i)]
\item\label{LinDim}  $\op{LinDim}L\ge m$;
\item\label{LinDim+} The set 

\ \ \ \ $L^{(m)}=\{p\in L\,|$ there is an isometric cone embedding $\EE^m\hookrightarrow T_p\}$, 

\noi is comeagre in $L$;
\item\label{TopDim} There is a bi-H\"older embedding (with exponent $\tfrac12$) 
$$\oBall^m\hookrightarrow \oBall(q,r)\i L;$$
\item\label{pack} There is $\Const>0$ such that 
$$\pack_\eps \oBall(q,r)>\Const\cdot\eps^{-m}$$
for any $\eps>0$.
\end{enumerate}
\end{thm}













\begin{thm}{Lemma}\label{lem:Lip-homeo}
Let $L\in\CBB m\kappa$ and $p\in L$.
Assume there is a collection of points $a_0,a_1,a_2,\dots,a_m$ such that 
$$\angk\kappa p{a_i}{a_j}>\pi/2\ \ \text{for all}\ \  i\not=j.$$ 
Then there is a bi-Lipschitz open embedding 
$$F:\oBall^m(r)\to L,\ \  \text{such that}\ \  F(\mathbf 0)=p.$$
\end{thm}

\parit{Proof.} 
For each $i\in[1..m]$, consider functions $h_i(q)=|a_iq|-|a_ip|$ and define 
$$H:L\to\EE^m,\ \ H(q)=\sum_{i=1}^mh_i(q)\mathbf e_i.$$
Clearly $H$ is a Lipschitz map.

It remains to show that $H$ is bi-Lipschitz in a neigborhood of $p$ and that for a small $r$-neigborhood $\oBall^m(r)$ of 
$\mathbf 0\in\EE^m$ there is an inverse map $F:\oBall^m(r)\to L$ of $H$. 

Assume $H$ is not bi-Lipschitz in any $\oBall(p,r)$;
i.e. for any $r>0$ there is a two sequence of points $x_n, y_n\in B(r,p)$ such that
$$\frac {|H(x_n)-H(y_n)|}{|x_ny_n|}\to 0\ \ \text{as}\ \ n\to\infty.\eqno(*)$$

Given $\eps>0$ one can choose $r>0$, so that 
$\angk\kappa {y_n}{a_i}{x_n}+\angk\kappa {x_n}{a_i}{y_n}>\pi-\eps$ for all $i$.
Without loss of generality, we can assume that $\angk\kappa {x_n}{a_0}{y_n}>\tfrac\pi2-\eps$.
If $i>0$, then from $(*)$ we have
$$\angk\kappa {y_n}{a_i}{x_n}-\angk\kappa {x_n}{a_i}{y_n}\to0\ \ \text{as}\ \ n\to\infty.$$
Therefore, for all $i$ and all large $n$, we have $\angk\kappa {x_n}{a_i}{y_n}>\tfrac\pi2-\eps$.
Fix such $n$ and set $x=x_n$, $y=y_n$.

Apply theorem ??? to get a model configuration $\~x,\~y,\{a_i\}_{i=0}^m$ in  $\Lob_\kappa^m$ such that
thus all directions $\dir_{x'}^{a_i}$ lie on angle $>\tfrac\pi2-\delta$ from $\dir_{x'}^y$.
Therefore it lies in $B(\tfrac\pi2-\delta,-\dir_{x'}^y)$.

It remains to show that $H$ is open.
\qeds




















Further, if for some $q\in L$ and $R>0$, we have 
$$\pack_\eps \oBall(q,R)>\Const\cdot\eps^{-m},$$
then according to \ref{E-comeagre}, we get that set 
\begin{center}
$L^{(m)}=\{p\in L\,|$ there is an isometric cone embedding $\imath:\EE^m\hookrightarrow T_p\}$
\end{center} 
is comeagre in $L$.
Thus, from \textit{(\ref{pack}$^\ge$)}, we get  \textit{(\ref{LinDim+}$^\ge$)}, and therefore \textit{(\ref{LinDim}$^\ge$)}.





If $\op{LinDim}L= m$, then $F$ is open bi-Lipschitz homeomorphism, thus for any small $r>0$ there are $\Const'>\Const>0$ such that 
$$\Const'\cdot\eps^{-m}>\pack_\eps \oBall(p,r)>\Const\cdot\eps^{-m}\eqno(**)$$
Applying \ref{pack-homogeneus} now twice, we get that the $(**)$, with different contants, holds for any other ball $\oBall(q,R)$.
Thus we get \textit{(\ref{LinDim-f}$^=$) $\Rightarrow$ (\ref{pack-f}$^=$)}.

\medskip

\parit{(\ref{LinDim-f})${}+{}$(\ref{pack-f}) $\Rightarrow$ (\ref{LinDim+-f})}
Applying \ref{E-comeagre}, we get that set 
\begin{center}
$L^{(m)}=\{p\in L\,|$ there is an isometric cone embedding $\imath:\EE^m\hookrightarrow T_p\}$
\end{center} 
is comeagre in $L$.
And from \ref{E=T}, we get $\imath(\EE^m)= T_p$ for any $p\in L^{(m)}$.

\parit{(\ref{LinDim-f})${}+{}$(\ref{LinDim+-f}) $\Rightarrow$ (\ref{TopDim-f}).} 
From \textit{(\ref{LinDim+-f})}, there is a point $p\in \oBall(q,r)$ such that $T_p$ is isometric to $\EE^m$.
Thus, from \ref{thm:Hoelder-embedding}, we can find a bi-Lipschitz open embedding 
$$F:\oBall(\ \ F(\mathbf 0,r)\to L)=p$$
Taking sufficiently small $r>0$, we get that $F(\oBall(q,r))\i \oBall(R)$

\parit{(\ref{LinDim-f})${}+{}$(\ref{TopDim-f}) $\Rightarrow$ (\ref{pack-f}).} 
From \textit{(\ref{TopDim-f})}, we have that there is  $\Const>0$ such that
$$\pack_\eps\oBall(q,R)\ge \Const\cdot\eps^{-m}.$$
On the other hand, sinse $\op{LinDim}L= m$, \ref{E-comeagre} implies that there is  $\Const'$ such that
$$\Const'\cdot\eps^{-m}\ge \pack_\eps\oBall(q,R).$$

\parit{(\ref{pack-f}) $\Rightarrow$ (\ref{LinDim-f+}).}
Clearly \ref{E-comeagre} and \textit{(\ref{pack-f})} imply  that $\op{LinDim}\ge m$.
On the other hand 
\qeds



\parit{Proof of \ref{thm:dim-infty}.} This proof is very similar to the proof of theorem~\ref{thm:dim-finite}, but we can only use the first part of theorem~\ref{thm:Hoelder-embedding} and apply an additional trick to treat not separable metric spaces.


\parit{(\ref{LinDim}) $\Leftrightarrow$ (\ref{LinDim+}).}
Assume $\op{LinDim}L=\infty$, thus given $m\in\ZZ_\ge$, there is  a point $p\in L$ which admits an isometric cone embedding 
$\imath:\EE^m\hookrightarrow T_pL$.
Clearly, one can find a collection of points $a_0,a_1,\dots, a_m\in L$ so that $\angk\kappa p{a_i}{a_j}>\pi/2$ for all $i\not=j$.
\qeds













\parit{(\ref{pack-T_p>=p}).} Similarly to \textit{(\ref{pack-p'>=p})}, let $N=\pack_{\eps}\oBall(p,r)$ and 
$$x_1,x_2,\dots, x_N\in\oBall(p,r)\cap L^\bullet(p)\ \ \text{such that}\ \ |x_ix_j|>\eps.$$ 
Set $x'_i=\log_px_i$, clearly $x_i'\in\oBall(o_p,r)\i T_p$.
From comparison there is $\delta=\delta(\kappa,r)>0$ such that 
$|x'_ix'_j|>\delta|x_ix_j|>\delta\eps$; i.e. $\pack_{\eps\delta}\oBall(o_p,r)\ge N$.



















\begin{thm}{Corollary}\label{cor:kir-from-hemisphere}
Let $\kappa>0$, $L$ and $U$ be two length-spaces with $\CAT L\ge \kappa$, $\CAT U\le\kappa$ and $Q\i B(\varpi/2,p)\i L$ for some $p\in L$.
Then any short map $f:Q\to U$ can be extended as a short map to $\bar f:L\to U$.
\end{thm}

\begin{thm}{Corollary}
Let $\kappa>0$, $L$ and $U$ be two length-spaces with $\CAT L\ge \kappa$, $\CAT U\le\kappa$.
Then for arbitrary subset $Q\in L$, any stricly short map $f:Q\to U$ can be extended as a short map 
$\bar f:L\to U$.
\end{thm}



One can easely see that in case $\kappa>0$ some extra condition is nesessury,
Indeed, take $Q$ to be equator in a north hemisphere $S^2_+$ and considers an isometry $f:Q\to S^{1}$, then clearly if can not be exteded to a map $F:S^2_+\to S^1$.
It turns out that in some sense, this is the only obsticle for existance of short extension.
Given a cordinal number $\alpha$, let us denote by $S^\alpha_+$ the unit hemisphere in an $(\alpha+1)$-dimensional Hilbert space and by $S^\alpha_0\i S^\alpha_+$ its equator.

\begin{thm}{Exact Kirszbrun's theorem}
Let $L$ and $U$ be two length-spaces with $\CAT L\ge1$, $\CAT U\le1$ and $Q\i L$ is an arbitrary subset.
Assume that a short map $f:Q\to U$ can NOT be extended as a short map 
$\bar f:L\to U$.

Then for some cordinal number $\alpha$, there is a global isometric embeddings $\imath:S^\alpha_+\hookrightarrow L$ and $\jmath:S^\alpha_0\hookrightarrow U$ such that
\begin{enumerate}
\item $Q\i \imath(S^{\alpha-1}_0)$,
\item $Q$ does not belong to any hemisphere in $\imath(S^{\alpha-1}_0)$.
\item if $\imath(x)\in Q$ $f\circ\imath(x)=\jmath(x)$ 
\item the isometry $\jmath:S^\alpha_0\to U$ can not be extended to an ismetry $\bar\jmath:S^\alpha_+\to U$.
\end{enumerate}
\end{thm}

\parit{Proof.}
Thus there is no point $u\in U$ such that $f(Q)\i B(\tfrac\pi2, u)$.
That follows that there is $\mathbf v=\RR_>^m$ such that
$\sum v_iv_j\cos|y_iy_j|\le 0$
On the other hand, from ??? we have
$\sum w_iw_j\cos|x_ix_j|\ge 0$
for any $\mathbf w=\RR_\ge^m$.
Sinse $|y_iy_j|\le |x_ix_j|$, we have 
$$\sum v_iv_j\cos|x_ix_j|\le \sum v_iv_i\cos|y_iy_j|$$
Thus $$\sum v_iv_j\cos|x_ix_j|=0$$ and from ???, we get that $|x_ix_j|=|y_iy_j|$ for all $i,j$ and the form $\sum w_iw_j\cos|x_ix_j|\ge 0$
for any $\mathbf w=\RR^m$.
In particular, the set $\{x_i\}$ is ismometric to a subset of a sphere which contains its center in the convex hull.

Let us apply Kirszbraun's theorems to the euclidean cones ...
Note that $f(o_{\mathring L})=o_{\mathring U}$
\qeds











\parit{Remark.} The same statement holds for $\kappa>0$, i.e. for spheres of the same radius, if one assumes in addition that all points $\~y_1,\~y_2,\dots,\~y_m$ lie in a hemisphere (this also follow from generalized Kirszbraun's theorem).






















\parit{Proof.} Assume points $p,x,y,q$ apper on geodesic $[pq]$??/
$$|p\ \gexp_{x}(\tfrac1n\cdot v)|\le |px|+\frac{|v|^2}{2n^2|px|}+o(1/n^2).$$
$$|q\ \gexp_{y}(\tfrac1n\cdot v)|\le |px|+\frac{|v|^2}{2n^2|px|}+o(1/n^2).$$
Thus applying ??? we get 
$$\olim_{???}\frac1{\eps^2}(|px_\eps|+|x_\eps y_\eps|+|y_\eps q|-|pq|)\le \frac{|v|^2}{2|px|}-\frac{(|\Pi_{t,t'}(v)|-|v|)^2}{2|t-t'|}+\frac{|\Pi_{x,y}(v)|^2}{2|yq|}$$
\qeds














Consider map
$$\pi_{x,y}:T_x^\perp\to T_y^\perp,\ \ \pi_{x,y}(v)=\l(\log_{y}\circ\gexp_{x}v\r)^\perp.$$

\begin{thm}{Claim} 
For any two points $x,y$ inside $[pq]$, there is a $\Const\in\RR_>$ such that
$$|\pi_{x,y}(v)|\le\Const\cdot|v|\eqno(\star)$$
for any $v\in T^\perp_x$.
Moreover, for any $v\in T_x^\perp$ and $w\in T_y^\perp$ we have
$$|\gexp_{x}v\ \gexp_{y}w|^2\le|xy|^2-{(|\pi_{x,y}(v)|-|v|)^2+|\pi_{x,y}(v)w|^2}.\eqno(\star\star)$$
\end{thm}

Let us define $\Pi_{x,y}:T_x^\perp\to T_y^\perp$
$$\Pi_{x,y}(v)=\olim_{\eps\to0}\frac{\pi_{x,y}(\eps\cdot v)}{\eps};$$
as it follows from $(\star)$, the $\omega$-limit is well define.
According to ???, 
$\Pi_{x,y}:T_x^\perp\to T_y^\perp$ is non contracting, the following inequality will be key part in the proof

\begin{thm}{Second variation formular}
Let $v\in T_x$ and $w\in T_y$ then
$$\olim_{n\to\infty}\l[|\gexp_{x}(\eps\cdot v)\ \gexp_{y}(\eps\cdot w)|-|xy|\r]/\eps^2\le -\frac{(|\Pi_{x,y}(v)|-|v|)^2+|\Pi_{x,y}(v)w|^2}{2|xy|}.$$

In particular, if $w=\Pi_{x,y}(v)$, we have 
$$\olim_{n\to\infty}\l[|\gexp_{x}(\eps\cdot v)\ \gexp_{y}(\eps\cdot w)|-|xy|\r]/\eps^2\le 0.$$
\end{thm}
















$$|\log_{y}\gexp_x(\eps v)\log_{y}\gexp(\eps w)|\ge |vw|\eps+o(\eps).$$
Clearly, 
$$|\l(\log_{y}\gexp_x(\eps v)\r)^\perp\ \l(\log_{y}\gexp(\eps w)\r)^\perp|^2=|\log_{y}\gexp_x(\eps v)\log_{y}\gexp(\eps w)|^2-|\l(\log_{y}\gexp_x(\eps v)\r)^\top\ \l(\log_{y}\gexp(\eps w)\r)^\top|^2.$$

Set $x_v=\gexp_xv$.
From ???, we have
$$|px_v|^2\le |px|^2+{|v|^2},$$
$$|x_vy|^2\le |xy|^2+{|v|^2}.$$
From the ??? comparion, we have
$$|x_vq|^2\le |x_vy|^2+|yq|^2+2|x_vy|\cdot|yq|\cdot\cos\mangle\hinge y{x_v}q.$$
Clearly $\sin\mangle\hinge y{x_v}q=|\pi(v)|/|x_vy|$; therefore
$$|x_vq|^2\le |x_vy|^2+|yq|^2+2|x_vy|\cdot|yq|\cdot\sqrt{1-|\pi(v)|^2/|x_vy|^2}.$$
One can now plug these estimates in the triangle inequlaity
$$|pq|\le|px_v|+|x_vq|$$
and the statement follows.
\qeds

Set $\bar v=\pi_{x,y}$
To understand the proof, it should be enough to look
at the following picture in $T_y$.

In the proof we use only Pythagorean theorem together with properties of gradient exponent.

Set $x_\eps=\gexp_x(\eps v)$ and $y_\eps=\gexp_y(\eps w)$.
Then 
$$|x_\eps y|^2\le|xy|^2+\eps^2|v|^2.$$
Sinse $\mangle\hinge{\pi_{x,y}(v)}{\log_y\gexp_xv}w=\mangle\hinge{\pi_{x,y}(v)}{\log_y\gexp_xv}o=\pi/2$,
$$|\gexp_xv\,\gexp_yw|^2\le
|\log_y\gexp_xv\, w|^2=
|(\log_yx_\eps)^\top|^2+|\pi_{x,y}(v)\, w|^2$$



















\begin{thm}{Proposition}\label{grad-constr}  Given a $\lambda$-concave
function $f$ on an Alexandrov's space $L$ and a point $p\in L$ there is a unique
gradient curve $\alpha: [0,\infty) \to L$ such that $\alpha(0)=p$. 
\end{thm} 

We present a proof from ???.

\parit{Proof.} The uniqueness of gradient curve follows from \ref{lem:dist-est}(\ref{two-equal-ends}).

To prove existance, it is enough to show that for any point $p$ there is a gradient curve $\alpha: [0,\eps) \to L$ for some $\eps>0$ such that $\alpha(0)=p$.

If $|\nabla_pf|=0$ then one can take constant curve $\alpha(t)=p$.
Otherwise, take $\eps=???$, choose small $\delta>0$ and construct a curve $\alpha_\delta:[0,\eps) \to L$, $\alpha(0)=p$ such that one can divide $[0,\eps)$ into countable number of halph open intervals $[\tau_i,\bar\tau_i)$ and for each $i$ we have $\alpha_\delta([\tau_i,\bar\tau_i])$ is a minimizing geodesic, 
$\alpha_\delta(\bar\tau_i)-\alpha_\delta(\tau_i)>|\nabla_{\alpha_\delta(\tau_i)}f|-\delta$ and if $|p_ix|\le|\bar\tau_i-\tau_i|$ then $|\nabla_x f|>|\nabla_{\alpha_\delta(\tau_i)}f|-\delta$.
???

Now, if $L$ is locally compact, we can choose a converging sequence $\alpha_{\delta_n}\to \alpha$.
Otherwise apriori, there might be no such limit, but we allways can pass to the $\omega$-limit in $\omega$-product:
$\alpha_{\delta_n}\oto\alpha:[0,\eps)\to L^\omega$ with $\delta_n\to 0$.

???, $\alpha$ is a $f^\omega$-gradient curve.
Thus, as it proved above it is unique, therefore, for any subsequence of $\alpha_{\delta_n}$ , we have $\alpha_{\delta_n}\oto\alpha$.
Applying \ref{lem:X-X^w}, we get that $\alpha$ lies in $L$.

















\begin{thm}{Theorem}\label{thm:concave}
Let $L\in\CBB{}{\kappa}$ and $f:L\to \RR$ be a
semiconcave function which satisfies differential inequality $f''\le \phi(f)$ for some continuous function $\phi:\RR\to\RR$.

Assume $\bar\alpha(s)$ is an $f$-sloppy curve. 
Then $(f\circ\bar\alpha)''\le\phi(f\circ\bar\alpha)$.
\end{thm}




























In this section we will consider integral curves (see ???) for two equasions:
$$\alpha^+=\nabla f\ \ \text{and}\ \ \alpha^+= \frac{\nabla f}{|\nabla f|},$$
where $f$ is a semiconcave function defined in open domain of $L\in\CBB{}{\kappa}$.

These two types of integral curves are closely related.
Namely, 

\begin{thm}{Proposition}
Let $L\in\CBB{}\kappa$,
$\Omega\i L$ be an open subset,
$f:\Omega\to\RR$ be a semiconcave function 
and $|\nabla_p f|>0$ for any $p\in\Omega$.

Assume $\alpha:I\to\Omega$ be a curve and real function $\tau(t)$ satisfies $\tau^+(t)=|\nabla_{\alpha(\tau(t))} f|$.
Then
$$\alpha^+=\nabla f$$
if and only if 
$$(\alpha\circ\tau)^+= \frac{\nabla f}{|\nabla f|}.$$

\end{thm}

\parit{Proof.}
Note that sinse $\alpha$ is locally Lipschitz, ??? implies that function $\tau\mapsto |\nabla_{\alpha(\tau)} f|$ is ???-semicontinuous.
In particular $t=\int|\nabla_{\alpha(\tau)} f|d\tau$ is well defined and sinse $|\nabla_{\alpha(\tau)} f|>0$, we have that $\tau(t)$ is strictly increasing and locally Lipschitz.



\qeds

if
$$\alpha^+=\nabla f$$
then $\beta(t)=\alpha(\tau(t))$ with $dt=|\nabla_{\alpha(\tau)} f|d\tau$ is a solution for
$$\beta^+=\frac{\nabla f}{|\nabla f|}.$$
And vise versa, if 
$$\beta^+=\frac{\nabla f}{|\nabla f|}$$
then $\alpha(\tau)=\beta(t(\tau))$ with $d\tau=\frac{dt}{|\nabla_{\beta(t)} f|}$  is a solution for
$$\alpha^+=\nabla f.$$

In particular, existance (as well as uniqueness) of integral curves for one equasion implies existance (as well as uniqueness) for the other.

We note that in general, the fields $\nabla f$ and $\frac{\nabla f}{|\nabla f|}$ are not continuous, thus the standard technique of solving such equasions does not work directly, but it turns to be possible???

\begin{thm}{Theorem}
Given a semiconcave function $f:\Omega\to\RR$ and a point $p\in \Omega$ there is a unique integral curves
$\alpha^+=\nabla f$ and $\beta^+=\nabla f/|\nabla f|$ such that $\alpha(0)=\beta(0)=p$... defined on the maxiaml intervals....
\end{thm}




Let $L\in\CBB{}{\kappa}$, 
$\Omega\i L$ be an open subset 
$f:\Omega\to \RR$ be a semiconcave function
and $I$ be an arbitrary real interval. 

We will be interested in Lipschitz curve $\alpha:I\to\Omega$ which satisfy differential equasion
$$\alpha^+=\nabla f;$$
i.e. for anty $t\in I$, $t\not=\sup I$, we have
$$\alpha^+(t)=\nabla_{\alpha(t)}f.$$

Further, we will also consider more complicated equasions as
$$\alpha^+(t)=\phi(t,f,|\nabla f|)\cdot\nabla f,$$
where $\phi(t,f,|\nabla f|)$ is a non-negative continuous real function.
Clearly, the solution of later equasion are given reparametrizations of the solution of the first one. 

For example if 
$$\beta^+=\frac{\nabla f}{|\nabla f|}$$
then defining $d\tau=|\nabla_{\beta(\tau)}f|\d t$ we get that
$\alpha(t)=\beta(\tau(t))$ is a solution for 
$$\alpha^+=\nabla f.$$

\begin{thm}{Definition}\label{def:grad.curve} 
Let $L\in\CBB{}{\kappa}$, 
$\Omega\i L$ be an open subset 
$f:\Omega\to \RR$ be a semiconcave function
and $I$ be an arbitrary real interval. 

A locally Lipschitz curve $\alpha:I\to\Omega$ is called $f$-\emph{gradient curve}\index{gradient!gradient curve} if for any $t\not=\sup I$
$$\alpha^+(t)=\nabla_{\alpha(t)}f.$$
\end{thm}

Note that from definition \ref{def:grad}, it follows 

\begin{thm}{Claim}\label{clm:grad.curve-def2}
Let $L$ be an Alexandrov space, $\Omega\i L$ be an open subset and $f:\Omega\to\RR$ be a semiconcave function.
 
A Lipshitz curve $\alpha(t)$ in $\Omega$ is an $f$-gradient curve if and only if the following is satisfied for almost all $t$
$$(f\circ\alpha)^+(t)=|\alpha^+(t)|^2=|\nabla_{\alpha(t)} f|^2.$$
\end{thm}
























To construct $\imath(v)\in \T^\omega_p$ for $v\in \T_p$, 
take a seqence $v_n\in L$ such that 
$$n\cdot\log_p{v_n}\oto v.\eqno(*)$$ 
View $v_n$ as a point in blowup $nL$. 
Pass to the $\omega$-limits $(n L,p)\oto (\T^\omega_p,o_p)$ and $n L\ni v_n\oto v_\omega\in \T^\omega_p$.
Set $\imath(v)=v_\omega$.

Given two sequences $v_n,v_n'\in L$ satifying $(*)$, 
by the hinge comparison \ref{angle} we have
$$n\cdot|\log_p{v_n}\log_p{v_n'}|\to0\ \ \Longrightarrow\ \ n|v_nv'_n|\to 0.$$
Thus $\olim_n v_n=\olim_n v_n'$; i.e. $\imath(v)$ does not depends on the choice of sequence $v_n$.

Note that if $n\cdot\log_p{v_n}\oto v$ and $n\cdot\log_p{w_n}\oto w$, for some $v,w\in \T_p$ then
$n|v_nw_n|_L\oto |vw|_{\T_p}$.
Indeed, given $\eps>0$, there are points $x,y\in L$ such that $\mangle(v,\dir_p^x),\mangle(w,\dir_p^y)<\eps$.
Sinse $n\cdot\log_p{v_n}\oto v$ and $n\cdot\log_p{w_n}\oto w$, we have that for $\omega$-almost all $n$ we have
$\mangle\hinge{p}{v_n}{x},\mangle\hinge{p}{w_n}{y}<\eps$.
Thus, for $\omega$-almost all $n$, we have













\parit{Proof.}
Clearly $\op{H}_p$ is complete???. 
Thus it is enough to introduce on $\op{H}_p$ a structure of vector space $\dist_o$ induses a Hilbert norm on $\op{H}_p$.
Given vectors $u,v,w$ which satisfy lemma ???, we will write $u+v+w=0$,
together with cone multiplication, it defines 
The later statement boils to the following:
for any $v,u\in \op{H}_p$ there is $w\in \op{H}_p$ such that ...
$$2|u|^2+2|v|^2=|u+v|^2+|u-v|^2.$$
$$|\alpha\cdot v|=|\alpha|\cdot|v|.$$

Let $\op{W}_p\i \T^\omega_p$ be the subset formed by all lines (see ???) which pass through $o_p\in \T^\omega_p$.
According to splitting theorem, $\op{W}_p$ is a Hilbert space and $\op{W}_p\supset \op{H}_p$. 
Therefore it is sufficient to show that $\op{H}_p$ forms a linear subspace of $\op{W}_p$.

First let us show that $v,w\in \op{H}_p$ implies that $z=-v-w\in \op{H}_p$.
Sinse $z\in \op{W}_p\i \T^\omega_p$ $\o$, there is a sequence $z_n\in nL$, such that
$z_n\oto z$ as $nL\oto \T^\o_p$.
Clearly $n|pz_n|\oto|z|$, thus it is enough to show that there is $\zeta\in \Sigma_p$ such that $\dir_p^{z_n}\oto\zeta$.


Something on $-w$???



Assume for beginning that $L$ is geodesic.

Given two vectors $v,v'\in H_p$, we will write $v+v'=0$ if $|w|=|v|$ and $\mangle(v,w)=\pi$.
Note that for any $v\in H_p$, the vector $-v$ is uniquely defined ??? and clearly $-v\in H_p$.

Given $\alpha\in\RR$ and $v\in H_p$, let us define 
$$
\alpha\cdot v
\df
\l[
\begin{matrix}
\alpha\cdot  v&\text{if}&\alpha\ge0\\
(-\alpha)\cdot (-v)&\text{if}&\alpha<0
\end{matrix}
\r.
$$ 
The ``$\cdot$'' on the right denotes the cone-multipliction in $\T_p$.

Now assume $v,w\in H_p$, choose two sequences $v_n, w_n\in L$ such that 
$$n\log_pv_n\to v\ \ \text{and}\ \ n\log_pw_n\to w.$$
Without loss of generality we can assume in addition that $\angk\kappa p{v_n}{w_n}\to\mangle(v,w)$.
Let us define 
$$v+w\df \lim_{n\to\infty}2n\log_pz_n,\eqno(*)$$ 
where $z_n$ is a midpoint of $[v_nw_n]$.
We need to show that the limit in $(*)$ is well defined and does not depend on the choice of sequences $v_n,w_n$.

First note that $n|pz_n|$ converges ...

Thus it is enough to show that $\dir_p^{z_n}$ converges.
Assume contrary, thus there are two subsequences $z_{n_k}$ and $z_{m_k}$ such that $\mangle(\dir_p^{z_{n_k}},\dir_p^{z_{m_k}})>\eps$ for all $k$.

Assume $v'=-v$ and $w'=-w$.
Choose seqences $v_n,v_n',w_n,w_n'\in L$ such that $n\log_pv_n\to v$, $n\log_pv_n'\to v'$, $n\log_pw_n\to w$, $n\log_pw_n'\to w'$.
Note that 

\ 

\ 

Let $v+v'=w+w'=0$.
Set $g=v+w$ if it satisfies the following identities (they are similar to definition of gradient):
\begin{enumerate}
\item $\<g,g\>=\<v',g\>+\<w',g\>$ and
\item $\<g,x\>\ge\<v',x\>+\<w',x\>$.
\end{enumerate}
First note that there is unique $g$ satisfying these properties.

Further, assume $g=v+w$ and $g'=v'+w'$, let us show that $g+g'=0$.
Indeed, for any $x\in T_p$ we have
$$\<g,x\>+\<g',x\>\ge\<v',x\>+\<w',x\>+\<v,x\>+\<w,x\>=0.$$


\qeds





















\begin{thm}{Key Lemma}\label{lem:euclid-subcone}
Assume $E\i \T^\omega_p$ is a subcone isometric to a Euclidean space and $y,x_1,x_2,\dots,x_n\in E$ are such that $y+x_1+\dots+x_n=0$\footnote{this is a sum of vectors in euclidean space}, then
$$x_1,x_2,\dots,x_n\in \T_p\ \ \Rightarrow\ \ y\in \T_p.$$
\end{thm}

\parit{Proof.} If $E\i \T^\omega_p$ is a subcone isometric to a Euclidean space then by ??? $\T^\omega_p$ splits $\T^\omega_p=E\times L$.

It is an exercise in Euclidean geometry to check that
if $z\in \T^\omega_p$ such that $|z x_i|\ge |y x_i|$ 
and $|z|=|y|$ then $z=y_\omega$.
More over, if $(z_n)$ is a sequence of points in $\T^\omega_p$ such that
$$|z_n|\to|y|\ \ \text{and}\ \  \liminf_{n\to\infty}|z_n x_i|\ge |y x_i|\eqno(\sharp)$$ for each $i$, then $z_n\to y$.

Thus, since $\T_p\i \T^\omega_p$ it is enough to show that there is a sequence $z_n\in \T_p$ satisfying $(\sharp)$.

Take sequnces $x_{i,n}\in L$ such that $n\log_p x_{i,n}\to x_i$ for each $i$.
Take a sequnce $y_n\in L$,
$|py_n|\le\Const/n$, such that $y_n\oto y$ as $(nL,p)\oto (\T^\omega_p,o_p)$.
We can choose $y_n\in L^\bullet(p)$, so all $\log_p y_n$ are well defined. 
Clearly,
$$\olim_{n\to\infty}n|\log_p y_n|=|y_\omega|;$$
from angle comparison (???), we have 
$$\olim_{n\to\infty}n|x_{i}\,\log_p y_n|
=
\olim_{n\to\infty}n|\log_p x_{i,n}\,\log_p y_n|
\ge
\olim_{n\to\infty}n |y_n  x_{i,n}|
=
|y x_{i}|.$$
Thus one can choose a subsequence $y_{n_k}$ so that 
$$\lim_{k\to\infty}n_k|\log_p y_{n_k}|=|y|
\ \ \text{and}\ \ 
\lim_{k\to\infty}n_k|\log_p y_{n_k}\, x_{i}|\ge|y x_{i}|.$$
Therefore taking above $z_k=\log_py_{n_k}$, we get that $y=z_k$, an thus $y\in \T_p$.
\qeds


\parit{Proof of \ref{thm:euclid-subcone}.}
First note that since $p\in L^\bullet (x_1,x_2,\dots,x_m)$, for each $\dir^{x_i}_{p}$ there is an opposite direction $\xi_i\in \Sigma_p$; i.e. $\mangle(\dir^{x_i}_{p},\xi_i)=\pi$.
Thus, for each $i$, two rays $(-t)\cdot\dir^{x_i}_{p}$ and $t\cdot\xi_i$ form a line
$$
\gamma(t)
=\l[
\begin{matrix}
(-t)\cdot\dir^{x_i}_{p}&\text{if}&t\le0\\
t\cdot\xi_i&\text{if}&t>0
\end{matrix}\r. .
$$
Sinse $\T^\omega_p\in\CBB{}{0}$ and $\T_p\hookrightarrow \T_p^\omega$, by ???, there is a subsets $L,E\i \T_p^\omega$, $E$ is isometric to a Euclidean space, and $\T^\omega_p=E\oplus L$.
Moreover from the construction, we have construction $E\ni \dir_p^{x_i},\xi_i$ for all $i$.

It only remains to show that $E\i \T_p$, which follows from the key lemma (\ref{lem:euclid-subcone}).\qeds
















\begin{enumerate}

\item The logarithm-map $\log_p:L\to \T_p$ is defined on dence $G_\delta$-set of $L$.
That follows sinse $L$ is almost geodesic (see \ref{thm:connect}).
Moreover, from comparison we have that if $\kappa=0$ then $\log_p:L\to \T_p$ is non-contracting map.
For general $\kappa$, we have that the map ??? is not contracting.
\end{enumerate}














Here is brief description of this section:
\begin{description}
\item[Section \ref{def-grad-curv}] we define gradient of semiconcave function and prove its basic properties;
\item[Section \ref{def-grad-curv}] we define gradient curves, and prove existance and uniqueness;
\item[Section \ref{dist-est}] we prove a couple of important estimates on the distance between ends of radient curves;
\item[Section \ref{grad-lim}] we prove that gradient curves behave nicely when one pass to the limit space.
\item[Section \ref{grad-flow}] we define gradient flow, a flow which moves points along gradient curves andreformulate proved properties of gradient curves in terms of gradient flow.
\item[Section \ref{gexp}] we introduce radial curves and gradient exponenet, these two notion make possible to go optimally in a given direction from a point.
\item[Section \ref{sph-hyp-exp}] we define analogs of radial curves gradient exponent which optimized to general lower curvature bound.
\end{description}














$f''\le 1$, $h=\phi\circ f$ then $$h'=\phi'(f)f',\ \ h''=\phi''(f)(f')^2+\phi'(f)f''=\frac{\phi''(f)}{(\phi'(f))^2}(h')^2+\phi'(f)f''$$.























*****************

First we give an equivalent definition of $f$-gradient curve:

\begin{thm}{Theorem}
Let $L\in \CBB{}\kappa$, 
$\Omega\i L$ be an open subset,
$f:\Omega\to\RR$ be a semiconcave function.

A locally Lipshitz curve $\alpha:[a,b)\to\Omega$ is an $f$-gradient curve if and only if
$$\liminf_{t\to t_0+}\frac{f\circ\alpha(t)-f\circ\alpha(t_0)}{t-t_0}
\ge 
|\nabla_{\alpha(t_0)} f|^2\eqno(*)$$
and
$$
\limsup_{t\to t_0+}\frac{|\alpha(t)\alpha(t)|}{t-t_0}
\le
|\nabla_{\alpha(t_0)} f|\eqno(**)
$$
for almost all $t_0\in [a,b)$.
\end{thm}

\parit{Proof.}
Note that
$$\liminf_{t\to t_0+}\frac{f\circ\alpha(t)-f\circ\alpha(t_0)}{t-t_0}
\ge 
\liminf_{t\to t_0+}\oint\limits_{t_0}^t|\nabla_{\alpha(\tau)}f|^2d\tau
\ge
|\nabla_{\alpha(t_0)}f|^2,
$$
the first inequality follows from $(*)$ and the second from upper??? semicontinuity of function $x\mapsto|\nabla_xf|$.
Thus inequality $(*)$ holds for all $t_0\in[a,b)$.
\qeds
























\section{Value estimates}




*****************

In this section we give estimates for function $f\circ\alpha(t)$, where $\alpha$ is an $f$-gradient curve.

The following theorem is a direct generalization of the following simple fact:
\begin{center}
\textit{If $f$ is concave then so is $f\circ\alpha(t)$}.
\end{center}
We give a comparison formulation;
in princple, we could write one formula ??? instead, but algebra explains nothing.

\begin{thm}{Theorem}
Let $L\in\CBB{}{\kappa}$, $\lambda,\mu\in\RR$. Assume
\begin{enumerate}[(i)]
\item $f:L\to\RR$ satisfies $f''+\mu f\le \lambda$ and $\alpha:[0,a)\to L$ be an $f$-gradient curve,
\item $\~f:\RR\to\RR$ satisfies  $\~f''+\mu \~f=\lambda$ and $\~\alpha:[0,a)\to\RR$ be an $\~f$-gradient curve, with $\~\alpha(0)=0$
\item $f\circ\alpha(0)=\~f(0)$ and $|\nabla_{\alpha(0)}f|\le\~f'(0)$.
\end{enumerate}
Then for any $t\ge0$ we have
$$f\circ\alpha(t)\le\~f\circ\~\alpha(t)\ \ \t{and}\ \  |\nabla_{\alpha(t)}f|\le\~f'\circ\~\alpha(t).$$
\end{thm}

\begin{thm}{Corollary}
Let $L\in\CBB{}{\kappa}$ and $f:L\to \RR$ be a
semiconcave function and $\alpha(t)$ be an $f$-gradient curve.

Then function
$t\mapsto |\nabla_{\alpha(t)}f|$
is right-continuous, i.e. for any $t_0$ we have
$$\lim_{t\to t_0+} |\nabla_{\alpha(t)}f|=|\nabla_{\alpha(t_0)}f|.$$
\end{thm}

Given a curve $\gamma:[a,b]\to L$, let us define its action $A(\gamma)=\int_a^b\l|\gamma^+(t)\r|^2\d t.$
$$A(\gamma)=\int_a^b\l|\gamma^+(t)\r|^2\d t.$$

\parit{Proof.} Assume $\mu=\lambda=0$, thus $f$ is concave and $\~f$ is linear.
Let $p=\alpha(t_0)$, $q=\alpha(t_0+\eps)$, $h(t)=f\circ\geod_{[pq]}$.
Clearly $h'(0)\le|\nabla_pf|$ and $h$ is concave,
thus 
\begin{multline*}
f\circ\alpha(t)\le
f\circ\alpha(0)+|\nabla_pf|\cdot|pq|
\le
\\
\le
f\circ\alpha(0)+|\nabla_pf|\cdot\length(\alpha|_{[t_0,t]})=f\circ\alpha(0)+|\nabla_pf|\cdot\int\limits_{t_0}^t|\nabla_{\alpha(\tau)}f|\d\tau.
\end{multline*}



For $t>t_0$,
$$(f\circ\hat\alpha)^+(t_0)=|\nabla_{\hat\alpha(t_0)}f|^2
\ge
\l[d_{\alpha(t_0)}f\l(\uparrow_{\alpha(t_0)}^{\alpha(t)}\r)\r]^2
\ge
$$
$$
\ge\l[\frac{f(\alpha(t))-f(\alpha(t_0))}
{|\alpha(t)\alpha(t_0)|}\r]^2
.$$
Take $\lambda_+=\max\{0,\lambda\}$, since $s-s_0\ge|\hat\alpha(s)\,\hat\alpha(s_0)|$, we
have 
$$(f\circ\hat\alpha)^+(s_0)\ge
\frac{f(\hat\alpha(s))-f(\hat\alpha(s_0))}{s-s_0}-\frac{\lambda_+}2(s-s_0)$$
Thus $f\circ\hat\alpha$ is $\lambda_+$-concave.

That finishes the proof for $\lambda\ge 0$; for $\lambda<0$ we get only that $f\circ\hat\alpha$ is $0$-concave.

Note that $|\hat\alpha(s)\,\hat\alpha(s_0)|=s-s_0-o(s-s_0)$, thus
$$(f\circ\hat\alpha)^+(s_0)\ge
\frac{f(\hat\alpha(s))-f(\hat\alpha(s_0))}{s-s_0} -\frac\lambda2(s-s_0)+o(s-s_0).$$
This property plus $0$-concavity implies that $f\circ\hat\alpha$ is  $\lambda$-concave.\qeds  


 
In this section, we will give an estimate for value of a f

Let $L\in \CBB{}\kappa$, $\Omega\i L$ be an open subset and $f:\Omega\to\RR$ be a semiconcave function.
We will call \emph{$f$-gradient-like curve} an integral curve $\alpha$ for the following equasion
$$\alpha^+=\frac{\nabla f}{|\nabla f|},$$
see ??? for definition of integral curve.

In this section we will prove a number of properties of gradient curves, but its existance for given initial data will be proved only in section ???.

\begin{thm}{Theorem} \label{thm:concave}
Let $L\in\CBB{}{\kappa}$, 
$\Omega\i L$ is an open subset,
$f:\Omega\to \RR$ be a
$\lambda$-concave function. 

Assume $\hat\alpha(t)$ is an $f$-gradient-like curve then $f\circ\hat\alpha$ is $\lambda$-concave.
\end{thm} 


\begin{thm}{Corollary}
Let $L\in\CBB{}{\kappa}$ and $f:L\to \RR$ be a
semiconcave function and $\alpha(t)$ be an $f$-gradient-like curve then function
$t\mapsto |\nabla_{\alpha(t)}f|$
is right-continuous, i.e. for any $t\in I$ we have
$$\lim_{\eps\to0} |\nabla_{\alpha(t+\eps)}f|=|\nabla_{\alpha(t)}f|.$$
\end{thm}

\parit{Proof.}
Sinse $\alpha$ is $f$-gradient-like, from \ref{thm:concave} we have that $f\circ\alpha$ is semiconcave.
The statement follows since $(f\circ\alpha)^+(t)=|\nabla_{\alpha(t)}f|$
\qeds

\begin{thm}{Corollary}\label{thm:concave-comparison}
Let $L\in\CBB{}{\kappa}$, 
$\Omega\i L$ is an open subset,
$f:\Omega\to \RR$ be a
semiconcave function which satisfies a differential inequality
$f''\le\phi(f)$ for some locally Lipschitz function $\phi:\RR\to\RR$.

Let $\alpha(t)$ be an $f$-gradient curve.

Let $\~f:\RR\to\RR$ be a solution for differential equasion $\~f''\le\phi(\~f)$ and $\~\alpha(t)$ is an $\~f$-gradient curve which satisfies $\~f\circ\~\alpha(0)=f\circ\alpha(0)$ and $|\nabla_{\~\alpha(0)}\~f|\le |\nabla_{\alpha(0)}f|$.

Then for all $t\ge 0$ we have 
$$\~f\circ\~\alpha(t)\ge f\circ\alpha(t)\ \ \text{and}\ \ |\nabla_{\~\alpha(t)}\~f|\le |\nabla_{\alpha(t)}f|$$
\end{thm}



\parit{Proof of \ref{thm:concave}.} For $s>s_0$,
$$(f\circ\hat\alpha)^+(s_0)=|\nabla_{\hat\alpha(s_0)}f|
\ge
d_{\hat\alpha(s_0)}f\l(\uparrow_{\hat\alpha(s_0)}^{\hat\alpha(s)}\r)
\ge$$
$$
\ge\frac{f(\hat\alpha(s))-f(\hat\alpha(s_0))
}{|\hat\alpha(s)\,\hat\alpha(s_0)|}
-
\frac\lambda2|\hat\alpha(s)\,\hat\alpha(s_0)|.$$
Take $\lambda_+=\max\{0,\lambda\}$, since $s-s_0\ge|\hat\alpha(s)\,\hat\alpha(s_0)|$, we
have 
$$(f\circ\hat\alpha)^+(s_0)\ge
\frac{f(\hat\alpha(s))-f(\hat\alpha(s_0))}{s-s_0}-\frac{\lambda_+}2(s-s_0)$$
Thus $f\circ\hat\alpha$ is $\lambda_+$-concave.

That finishes the proof for $\lambda\ge 0$; for $\lambda<0$ we get only that $f\circ\hat\alpha$ is $0$-concave.

Note that $|\hat\alpha(s)\,\hat\alpha(s_0)|=s-s_0-o(s-s_0)$, thus
$$(f\circ\hat\alpha)^+(s_0)\ge
\frac{f(\hat\alpha(s))-f(\hat\alpha(s_0))}{s-s_0} -\frac\lambda2(s-s_0)+o(s-s_0).$$
This property plus $0$-concavity implies that $f\circ\hat\alpha$ is  $\lambda$-concave.\qeds  

\begin{thm}{Proposition}
Let $L\in\CBB{}\kappa$,
$\Omega\i L$ be an open subset,
$f:\Omega\to\RR$ be a semiconcave function 
and $|\nabla_p f|>0$ for any $p\in\Omega$.

Assume $\alpha:I\to\Omega$ be a curve and real function $\tau(t)$ satisfies $\tau^+(t)=|\nabla_{\alpha(\tau(t))} f|$.
Then $\alpha$ is an $f$-gradient curve
if and only if 
$(\alpha\circ\tau)$ is an $f$-gradient-like curve.
\end{thm}

\parit{Proof.}
Note that sinse $\alpha$ is locally Lipschitz, ??? implies that function $\tau\mapsto |\nabla_{\alpha(\tau)} f|$ is ???-semicontinuous.
In particular $t=\int|\nabla_{\alpha(\tau)} f|d\tau$ is well defined and sinse $|\nabla_{\alpha(\tau)} f|>0$, we have that $\tau(t)$ is strictly increasing and locally Lipschitz.
\qeds





















Consider product space $\SS^4\times \EE^2$ equiped wit isometric $\SS^1$-action with exactly two fixed points $v$ and $w$ on $\SS^4\times 0$.
...
Let $L=\SS^4\times \EE^2/\SS^1$ and $\pi:\SS^4\times \EE^2\to L$ be the natural identifiction map.
Clearly $L$ is 5-dimensional, non-compact space, and according to ???, $L$ has curvature $\ge0$.

The image $\pi(\SS^4\times 0)$ is homeomorphic to $\SS^3$ and it forms a convex strict deformational retruct in $L$.
Thus, $\pi(\SS^4\times 0)$ is the soul of $L$.

The space $L$ has exactly two topological singularities at $\pi(v)$ and $\pi(w)$.
Thus it can not be presented as fiber bundle over $S^2$.












\begin{thm}{Corollary}\label{cor:alm-max} 
Let $L\in\CBB{}{\kappa}$ and $f:L\subto\RR$ be semiconcave.

If $|\nabla_pf|>0$ 
then $\xi_{\max}=\tfrac1{|\nabla_p f|}\!\cdot\!\nabla_p f$ is the unique maximum direction for the restriction $\d_p f|_{\Sigma_p}$.
\end{thm}

\parit{Proof.} Note that according to definition of gradient,
$$\d_p f(\xi_{\max})=\tfrac1{|\nabla_p f|}\d_p f(\nabla_p f)=|\nabla_p f|.$$
Assume $\d_p f(\xi)\ge |\nabla_p f|$ for some $\xi\in\Sigma_p$, then
$$|\nabla_p f|
\le
\d_p f(\xi)
\le
\<\xi,\nabla_p f\>
=
|\nabla_p f|\cos\angle(\xi,\xi_{\max}).
$$
I.e. $\cos\angle(\xi,\xi_{\max})=1$ and thus $\xi=\xi_{\max}$.
\qeds


















The next statement roughly states that inequality $\d_pf(v)\le\<\nabla_pf,v\>$ can be extended to whole $\T^\o_p$.
In order to do that we need to define the scalar product $\<w,v\>$ for $w\in \T_p$ and $v\in\T^\o_p$ on a way that it would ageree with the standard definition for $w,v\in \T_p$.
Thus let us define
$$\<w,v\>
\df
\lim_{t\to\infty}|w\ t{\cdot}v|-|t{\cdot}v|.$$
Note that from triangle inequality, the function $t\mapsto|w\ t{\cdot}v|-|t{\cdot}v|$ is nonincreasing, thus this limit is well defined.
Note also that $\<w,v\>=|v|b(w)$, where $b$ is Busemann function for ray $t\mapsto \tfrac t{|v|}{\cdot}v$.

\begin{thm}{Corollary}\label{cor:d-omega=<d}
Let $L\in\CBB{}{\kappa}$, 
$f:L\subto\RR$ be semiconcave 
and $p\in\Dom f$. 

Then for any $x\in \T^\o_p$ we have
$${d^\o_pf(x)}\le\<\nabla_pf,x\>.$$

\end{thm}

\parit{Proof.} ???
Choose $x_n\in L$ so that $n{\blow}x_n\oto x\in\T^\o_p$.
We can assume in addition that $x_n\in L^\bullet(p)$, so $\log_px_n$ is well defined.

From ???, we have 
$$f(x_n)-f(p)
\le 
d_p(\log_px_n)+o(|px_n|)
\le
\<\nabla_p f,\log_px_n\>+o(|px_n|)\le |\nabla_p f|\cdot|x_n|\cos\mangle(\nabla_p f,\log_px_n)$$
Thus 
$$d^\o_p(x)=\olim_{n\to\infty} n\l[f(x_n)-f(p)\r] \le |\nabla_p f|\cdot|x|.$$
\qeds


\parit{Proof of lemma~\ref{cor:d-omega=<d}.}
Apply lemma~\ref{lem:gradcon} to $f_n\oto d^\o_pf$, where $f_n: n\blow L\to\RR$ defined by $f_n(n\blow x)=n\l[f(x)-f(p)\r]$.
We get%
\footnote{infact it is easy to see that $|\nabla_{o_p}(d^\o_pf)|\le |\nabla_{p}f|$} 
that $|\nabla_{o_p}(d^\o_pf)|\le |\nabla_{p}f|$.
In particular, 
$$\sup_{\xi\in\Sigma_{o_p}\T^\o_p}d_{o_p}(d^\o_pf)\le |\nabla_{p}f|.$$
Sinse $d^\o_pf$ is concave, the result follows.














We can assume that $\mangle(u,v)\not=0,\pi$; othrwise the result follows from existance of opposite vectors.

Note that according to the splitting theorem (\ref{thm:splitting}), there is an isometric splitting
$$\T^\o_p=E(u,v)\oplus P(u,v),$$
where 
$$P(u,v)=\{\,x\in\T^\o_p\mid\mangle\hinge{o_p}xu=\mangle\hinge{o_p}xv=\pi/2\,\}$$ 
and $E(u,v)\i \T^\o_p$ is a subcone isometric to a Euclidean plane containing $u$ and $v$.
Thus there is $w\in E(u,v)$ such that $u+v+w=0$; this sum is a sum of vectors in $E(u,v)$.
Therefore for any $x\in \T^\o_p$ we have
$$\<u,x\>+\<v,x\>+\<w,x\>=0.$$
In particular, 
$$\<w,w\>=-\<u,w\>-\<v,w\>=\<u,u\>+2\<u,v\>+\<v,v\>.$$

Now according to \ref{cor:anti-sum}, there is unique vector $\hat w\in \T_p$ such that
$$\<u,x\>+\<v,x\>+\<\hat w,x\>\ge 0\ \ \t{for any}\ x\in\T^\o_p \ \t{and}\ \ \<u,\hat w\>+\<v,\hat w\>+\<\hat w,\hat w\>=0$$
Thus
$$\<w,\hat w\>\ge\<w,w\>\ \ \t{and}\ \ \<w,\hat w\>=\<\hat w,\hat w\>;$$
therefore 
$w = \hat w\in \T_p$.

Applying the above construction for pair $u'=-u$ and $v'=-v$, we get a vector $w'$ such that for any $x\in \T^\o_p$ we have
$$\<u',x\>+\<v',x\>+\<w',x\>=0.$$
In particular 
$$\<w',w\>=-\<w,w\>=-<w',w'>;$$
Therefore $\mangle(w,w')=\pi$ and thus $w\in \Lin_p$. 
































\section{Distance estimate and uniqueness}



\begin{thm}{Distance estimate \#1}
Let $L\in\CBB{}{\kappa}$, $f:L\to \RR$ be a $\lambda$-concave function and $a,b\in L$.

Consider comparison picture in $\EE^2$:
a function $\~f:\EE^2\to\RR$, which satisfies $\~f''=\lambda$ and two points $\~a,\~b\in\EE^2$ such that $|\~a\~b|=|ab|$ and $|\nabla_{\~a}\~f|=|\nabla_{a}f|$.

Let 
\begin{itemize}
\item $\alpha:[0,\infty)\to L$ be $f$-gradient curves starting at $a$ and
\item $\~\alpha:[0,\infty)\to \EE^2$ be $\~f$-gradient curves starting at $\~a$.
\end{itemize}

Then for any $t\ge 0$, we have
$$|b\,\alpha(t)|\le|\~b\,\~\alpha(t)|.$$
\end{thm}







\begin{thm}{Lemma (one function different ends)} \label{lem:dist-est}
Let $L\in\CBB{}{\kappa}$, $f:L\to \RR$ be a $\lambda$-concave function  and
$\alpha,\beta:[0,\infty)\to L$ be two $f$-gradient curves with $\alpha(0)=p$,
$\beta(0)=q$. 

\begin{wrapfigure}{r}{20mm}
\begin{lpic}[t(0mm),b(10mm),r(0mm),l(0mm)]{pics/alpha-curve(0.4)}
\lbl[tr]{0,52;$p$}
\lbl[tr]{26,2;$q$}
\lbl[br]{19,63;$\alpha(t)$}
\lbl[tl]{41,19;$\beta$}
\end{lpic}
\end{wrapfigure}

Then 
\begin{enumerate}[(i)]
\item\label{two-equal-ends} for any $t\ge0$,
$$|\alpha(t)\beta(t)|\le e^{\lambda t}|p q|$$
\item \label{one-end} for any $t\ge0$,
$$|\alpha(t)q|^2\le|p q|^2+ 
\l\{2f(p)-2f(q)+\lambda|p q|^2\r\}\cdot\theta_\lambda(t)
+|\nabla_p f|^2\cdot\theta^2_\lambda(t),$$
where 
$$\theta_\lambda(t)=\int_0^t e^{\lambda \under t}d \under t=
\l[
\begin{matrix}
t &\text{if}&\lambda=0\\
\frac{e^{\lambda t}-1}\lambda&\text{if}&\lambda\not=0
\end{matrix}
\r.
$$
 
\item \label{two-ends} if $t_p\ge t_q\ge 0$ then

$|\alpha(t_p)\beta(t_q)|^2
\le e^{2\lambda t_q}
\bigl[|p q|^2+ 
 $

$\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\l\{2f(p)-2f(q)+\lambda|p
q|^2\r\}\cdot\theta_\lambda(t_p-t_q)+$

$\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +|\nabla_p f|^2
\cdot\theta^2_\lambda(t_p-t_q)\bigr].$
\end{enumerate}
\end{thm}



This lemma can also be reformulated in a geometer-friendly way:

\bigskip


\begin{thm}{Lemma}
Let $L\in\CBB{}{\kappa}$, $f:L\to \RR$ be a $\lambda$-concave function  and
$\alpha,\beta:[0,\infty)\to L$ be two $f$-gradient curves with $\alpha(0)=a$,
$\beta(0)=b$. 

Assume that points $\~ a, \~ b\in \EE^2$ and a function $\~ f:\EE^2\to \RR$ satisfy the
following:
\begin{enumerate}[$\diamond$]
\item $\~f''\equiv \lambda$\footnote{i.e. if $\lambda=0$, $\~ f$ is a linear function, otherwise $\~ f=\frac\lambda2\dist^2_{o}+\Const$ for some $o\in \EE^2$.} 
\item $|\~ a\~ b|=|a b|,\ \ |\nabla_{\~ a} \~ f|=|\nabla_a f|,$
\item $\~ f(\~ b)-\~ f(\~ a)=f(b)-f(a)$
\end{enumerate}
Let $\~\alpha(t)$ and $\~\beta(t)$ be 
$\~ f$-gradient curves in $\EE^2$ with
$\~ \alpha(0)=\~ a$, $\~ \beta(0)=\~ b$.
Then,
\begin{enumerate}[(i)]
\item $|\alpha(t)b|\le |\~\alpha(t)\~ b|$ for any $t>0$.
\item $|\alpha(t)\beta(t)|\le|\~\alpha(t)\~\beta(t)|$ for any $t>0$.
\item if $t_a\ge t_b$ then $|\alpha(t_a)\beta(t_b)|\le
|\~\alpha(t_a)\~\beta(t_b)|$
\end{enumerate}
\end{thm}

\parit{Proof.} Assume first that $L$ is geodesic.
\parit{(\ref{one-end}).} Note that according to lemma~\ref{lem:concave}, for all $t\ge 0$ we have
$$\~f\circ\~\alpha(t)\ge f\circ\alpha(t).$$
???


\parit{Proof.} Assume first that $L$ is geodesic.

\parit{(\ref{one-end}).}
If $\lambda=0$, from lemma~\ref{lem:concave} it follows
that\footnote{For $\lambda\not=0$ it will be $$f\circ\alpha(t)-f\circ\alpha(0)
\le \l|\nabla_{\hat\alpha(0)}f\r|^2\cdot [\theta_\lambda(t)+\lambda
\theta_\lambda^2(t)/2].$$}
$$f\circ\alpha(t)-f\circ\alpha(0)
\le \l|\nabla_{\hat\alpha(0)}f\r|^2\cdot t.$$
Therefore from lemma~\ref{lem:grad}, setting $\ell=\ell(t)=|q\alpha(t)|$, we
get\footnote{For $\lambda\not=0$ it will be
$$\l({\ell^2}/2\r)'-\lambda\ell^2/2\le f(p)-f(q)+
\l|\nabla_{p}f\r|^2\cdot[\theta_\lambda(t)+\lambda \theta_\lambda^2(t)/2].$$}
$$\l({\ell^2}/2\r)'\le f(p)-f(q)+ \l|\nabla_{p}f\r|^2\cdot t,$$
hence the result.

\parit{(\ref{two-equal-ends})} follows from the second inequality in
lemma~\ref{lem:grad}; 

\parit{(\ref{two-ends})} follows from (\ref{two-equal-ends}) and (\ref{one-end}).

\medskip

Finally, if $L$ is not geodesic pass to its $\o$-product $L^\o$ and repeat the above proof for $\o$-extension of $f$.
Note??? that $f$-gradient curves which are also $f^\o$-gradient curves in $L^\o$. 
\qeds

\begin{thm}{Lemma (two functions one end)}\label{lem:fg-dist-est}
Let $L\in\CBB{}{\kappa}$, $f,g:L\to \RR$ be a $\lambda$-concave function  and
$\alpha,\beta:[0,\infty)\to L$ be correspondently two $f$ and $g$-gradient curves with $\alpha(0)=p$,
$\beta(0)=p$.
Assume $|f(x)-g(x)|\le\eps$ for any $x\in L$ then 
$$|\alpha(t)\beta(t)|^2
\le \eps\frac{e^{t\lambda}-1}\lambda$$
\end{thm}

\parit{Proof.} From the first variation ???
$$|\alpha(t)\beta(t)|^+\le -\<\dir_{\alpha(t)}^{\beta(t)},\nabla_{\alpha(t)}f\>-\<\dir_{\beta(t)}^{\alpha(t)},\nabla_{\beta(t)}g\>.$$
Applying ???, we get 
$$|\alpha(t)\beta(t)|^+\le\lambda|\alpha(t)\beta(t)|+2\eps/|\alpha(t)\beta(t)|.$$
Thus
$$|\alpha(t)\beta(t)|
\le
\sqrt{\frac{
e^{\frac{t\lambda}\eps}-1}
{2\eps\lambda}}$$
\qeds




\section{The rest}




\begin{thm}{Theorem???}
Let $L\in\CBB{}{\kappa}$, $\lambda\in\RR$. Assume
\begin{enumerate}[(i)]
\item $f:L\to\RR$ satisfies $f''\le \lambda$ and $\alpha:[0,a)\to L$ be an $f$-gradient curve,
\item $\~f:\RR\to\RR$ satisfies  $\~f''=\lambda$ and $\~\alpha:[0,a)\to\RR$ be an $\~f$-gradient curve, with $\~\alpha(0)=0$
\item $f\circ\alpha(0)=\~f(0)$ and $|\nabla_{\alpha(0)}f|\le\~f'(0)$.
\end{enumerate}
Then for any $t\ge0$ we have
$$f\circ\alpha(t)\le\~f\circ\~\alpha(t)\ \ \t{and}\ \  |\nabla_{\alpha(t)}f|\le\~f'\circ\~\alpha(t).$$
\end{thm}

\parit{Proof.}???\qeds


\begin{thm}{Theorem???}
Let $L\in\CBB{}{\kappa}$, $\Omega\i L$ be an open subset and $f:\Omega:\to\RR$ be a semiconcave function.

A curve $\alpha$ in $L$ is $f$-gradient 
if and only if 
$\alpha$ is an $f^\o$-gradient as a curve in $L^\o\supset L$.
\end{thm}

\parit{Proof.}???\qeds







\begin{thm}{WRONG theorem}
Let $L\in\CBB{}{\kappa}$, 
$f:L\to \RR$ be a function satisfying differential inequality $f''\le \mu-\kappa f$ for some $\mu,\kappa\in\RR$.

Let $\~f:\Lob_\kappa\to\RR$ be a function which satisfies $\~f''= \mu-\kappa \~f$.

Assume $a,b\in L$ and $\~a,\~b\in \Lob_\kappa$ be two pairs of points such that:
$$f(a)=\~f(\~a),\ \ f(b)=\~f(\~b)\ \ |\nabla_af|=|\nabla_{\~a}\~f|\ \ \text{and}\ \ |ab|=|\~a\~b|.$$

Let $\alpha,\beta:[0,\infty)\to L$ be two $f$-gradient curves starting at $a$ and $b$ correspondently.
Similarly, let
$\~\alpha,\~\beta:[0,\infty)\to \Lob_\kappa$ be two $\~f$-gradient curves starting at $\~a$ and $\~b$ correspondently.
Then for all $t\ge\tau\ge 0$ we have 
$$|\alpha(t)\beta(\tau)|_{L}\le |\~\alpha(t)\~\beta(\tau)|_{\Lobs_\kappa}$$
\end{thm}

\parit{Proof.}???\qeds


























Note that for any cone $K$ with vertex $o$
there is canonical isometry $T_oK\to K$.
Thus the isometric embeddng $\imath:\T_pL\to\T^\o_pL$ (see ???) 
induces an embedding 
$$\T_pL=\T_{o_p}(\T_p L)\hookrightarrow\T_{o_p}(\T^\o_p L).$$

\begin{thm}{Corollary}
Let $L\in\CBB{}{\kappa}$, 
$f:L\subto\RR$ be semiconcave 
and $p\in\Dom f$.

Then 
$\nabla_{o_p}d^\o_pf=\nabla_pf$.
\end{thm}

\parit{Proof.}
Define $f_n:n\blow L\to\RR$ as in definition of $\d^\o_pf$; 
i.e. $f_n(n{\blow}x)=n\l[f(x)-f(p)\r]$ and $f_n\oto \d^\o_pf:\T^\o_p\to\RR$.
Clearly $|\nabla_{n{\blow}p}f_n|=|\nabla_{p}f|$. 
Therefore, according to \ref{lem:gradcon}, $|\nabla_{o_p}d^\o_pf|\le|\nabla_{p}f|$.
On the other hand since $d_pf=d^\o_pf|_{\T_pL}$ we have $|\nabla_{o_p}d^\o_pf|\ge|\nabla_{p}f|$.

Finally 
\begin{multline*}
|\nabla_{o_p}d^\o_pf|\cdot|\nabla_{p}f|\cos\mangle(\nabla_{o_p}d^\o_pf,\nabla_{p}f)=\\
=\<\nabla_{o_p}d^\o_pf,\nabla_{p}f\>\ge d^\o_p(\nabla_{p}f)=d_p(\nabla_{p}f)=|\nabla_{p}f|^2.
\end{multline*}
Thus $\mangle(\nabla_{o_p}d^\o_pf,\nabla_{p}f)=0$ and $\nabla_{o_p}d^\o_pf=\nabla_{p}f$.
\qeds


















\begin{thm}{Lemma???} 
\label{lem:grad}
Let $L\in\CBB{}{\kappa}$, 
$f:L\subto\RR$ satisfies $f''+\mu f\le \lambda$ 
and $[pq]\i \Dom f$.
Then
$$\<\dir_p^q,\nabla_p f\>\ge
{\l({f(q)}-{f(p)\cs_\mu\ell}-\lambda\rho_\mu\ell\r)}/{\sn_\mu\ell},$$
where $\ell=|p q|$. 
\end{thm}



























\section{Gradient curves: Passage to limit}

The next lemma states that gradient curves behave nicely with convergence of spaces; 
i.e. a limit of gradient curves is a gradient curve for the limit function.

\begin{thm}{Passage to limit} \label{lem:stable-grad-curves}
Assume
\begin{enumerate}[(i)]
\item $L_n\in\CBB{}{\kappa}$ and $L_n \oto L_\o$;
\item $p_n\in L_n$ and $p_n\oto p_\o\in L_\o$;
\item $f_n\:L_n\subto \RR$ and $f_\o\:L_\o\subto \RR$ are locally Lipschitz and $\lambda$-concave and $f_n\oto f_\o$;
\item $\alpha_n\: [0,t_{\max}) \to \Dom f_n$ are  $f_n$-gradient curves with $\alpha_n(0)=p_n$ and\\
 $\alpha_\o: [0,t_{\max}) \to \Dom f_\o$ is\ \  $f_\o$-gradient curve \ with $\alpha_\o(0)=p_\o$.
\end{enumerate}
Then for any $t\in[0,t_{\max})$ we have $\alpha_n(t)\oto\alpha_\o(t)$ as $n\to\infty$.
\end{thm}

\parit{Proof.} 
Note that we may assume that $|\nabla_pf_n|>\delta>0$; 
otherwise consider instead the  sequence $\grave{L}_n=L_n\times\RR$ with $\grave{f}_n(q\times x)=f_n(q)+x$.

Let $\hat\alpha_n(s)$ denote the reparametrization of $\alpha_n(t)$ 
by arc length.
According to \ref{lem:grad--grad-like},\ \  $\hat\alpha_n^+=\tfrac1{|\nabla f_n|}\cdot\nabla f_n$.

Set $\hat\alpha_\o(s)=\olim_n\hat\alpha_n$.
Clearly, $\hat\alpha_\o$ is a $1$-Lipschitz curve in $L^\o$.
Hence, by Lemma \ref{lem:gradcon}
$$\bigl.f\circ\hat\alpha_\o\bigr|_{s_0}^s
=
\olim_{n\to\infty}\bigl.f_n\circ\hat\alpha_n\bigr|_{s_0}^s
=
\olim_{n\to\infty}\int\limits_{s_0}^s|\nabla_{\hat\alpha_n(\under s)} f_n|\d\under s
\ge
\int\limits_{s_0}^s|\nabla_{\hat\alpha_\o(\under s)} f_\o|\d \under s
$$
Therefore, from semicontinuity of $x\mapsto|\nabla_xf|$ (\ref{cor:gradlim}),
$$\liminf_{s\to s_0+}\frac{f\circ\hat\alpha(s)-f\circ\hat\alpha(s_0)}{s-s_0}
\ge 
\liminf_{s\to s_0+}\oint\limits_{s_0}^s|\nabla_{\hat\alpha_\o(\under s)} f_\o|\d \under s
\ge 
|\nabla_{\hat\alpha(s_0)} f|.$$
Thus, according to \ref{thm:grad-like-2nd-def}, $\hat\alpha^+=\tfrac1{|\nabla f_\o|}\cdot\nabla f_\o$.

Define reparametrizations $\varsigma_n$ and $\varsigma_\o$ of $\hat\alpha_n$ and $\hat\alpha_\o$ as in \ref{lem:grad--grad-like}; i.e.
$$
\varsigma_n^{-1} (s)=\int\limits_0^{s}\frac1{(f_n\circ\hat\alpha_n)'(\under s) }d\under s\ \ \t{and}\ \ \varsigma_\o^{-1}(s)=\int\limits_0^{s}\frac1{(f_\o\circ\hat\alpha_\o)'(\under s) }d\under s.
$$
So $\alpha_n=\hat\alpha_n\circ\varsigma_n$ and $\alpha_\o=\hat\alpha_\o\circ\varsigma_\o$ are gradient curves.

According to \ref{lem:grad--grad-like}, all $f_n\circ\hat\alpha_n$ and $f_\o\circ\hat\alpha_\o$ are $\lambda$-concave.
Thus, sinse $f_n\circ\hat\alpha_n\oto f_\o\circ\hat\alpha_\o$, we have $\varsigma_n\oto\varsigma_\o$.
Therefore $\alpha_n\to\alpha_\o$.
\qeds


\section{Gradient flow}\label{grad-flow}

At bottom, gradient flow is just convinient notation for points on one gradient curve.
 
Let $L\in\CBB{}\kappa$ and $f:L\subto \RR$ be locally Lipschitz and semiconcave.
Set $\GF^t_f(p)=\alpha_p(t)$, where $\alpha_p:[0,t_{\max})$ be the $f$-gradient curve which
starts at $p$ (i.e.~$\alpha_p(0)=p$).

Thus $\GF_f:\RR_\ge\times L\subto L$.
Clearly
$$ \GF^{t+\tau}_f=\GF^t_f\circ\GF^\tau_f;$$
i.e., in scientific lagnuage, $\GF_f$ is an action of semigroup $(\RR_\ge,+)$ on $L$ (if it is definted for all positive time).

\begin{thm}{Theorem}
Let $l\in\CBB{}\kappa$ and $f:L\subto \RR$ be semiconcave then $\GF_f:\RR_\ge\times L\subto L$ is locally Lipschtz.

Moreover, 
\end{thm}


Next we reformulate some properties of gradient curves in term of radiet flow.

\begin{enumerate}
\item $\GF^t_f$ is locally Lipschitz (in the domain of definition). 
Moreover, if $f$ is $\lambda$-concave then it is $e^{\lambda t}$-Lipschitz.

This follows from lemma~\ref{lem:dist-est}(\ref{two-equal-ends}).

\item Gradient flow is stable under Gromov--Hausdorff convergence, namely:

If $L_n\in\CBB{n}{\kappa}$ and  $L_n\GHto L$, $f_n:L_n\to\RR$ is a sequence of
$\lambda$-concave functions which converges to $f:L\to \RR$ then
$\GF_{f_n}^t:L_n\to L_n$ converges pointwise to $\GF_f^t:L\to L$.

This follows  from lemma~\ref{lem:stable-grad-curves}.

\item\label{grad-onto} For any $x\in L$ and all sufficiently small $t\ge0$, there is $y\in L$ so that 
$\GF_f^t(y)=x$.

For spaces without boundary this follows from 
\cite[lemma 1]{grove-petersen:rad-sphere}.
For spaces with boundary one should consider its doubling.
\end{enumerate}

Gradient flow can be used to deform a mapping with target in $L$. 
For example, if $X$ is a metric space, then given a Lipschitz map $F:X\to L$ and
a positive Lipschitz function $\tau:X\to \RR_+$ one can consider the map $F'$ called
\emph{gradient deformation} of $F$ which is defined by
$$F'(x)=\GF_f^{\tau(x)}\circ F(x),\ \ \ F':X\to L.$$

From lemma~\ref{lem:dist-est} it is easy to see that the \emph{dilation}\footnote{i.e. its optimal Lipschitz constant.}
of $F'$
can be estimated in terms of $\lambda$, $\sup_x\tau(x)$, dilation of $F$ and the
Lipschitz constants of $f$ and $\tau$.

Here is an optimal estimate for the length element of a curve which follows from
lemma~\ref{lem:dist-est}:

\begin{thm}{Lemma} \label{lem:grad-variation} Let $L\in\CBB{}{\kappa}$, $\gamma_0(s)$ be a curve in $L$ parametrized by arc-length, $f:L\to\RR$ be
a $\lambda$-concave function, and $\tau(s)$ be a non-negative Lipschitz
function. 
Consider the curve 
$$\gamma_1(s)=\GF^{\tau(s)}_f \circ\gamma_0(s).$$ 
If $\sigma=\sigma(s)$ is its
arc-length parameter then
$$\d\sigma^2\le e^{2\lambda\tau}\l[\d
s^2+2\d(f\circ\gamma_0)\d\tau+|\nabla_{\gamma_0(s)}f|^2\d\tau^2\r]$$
\end{thm}























\begin{thm}{Claim}
For any $t\ge 0$ we have
$|\alpha_1(t)\,\alpha_2(0)|_L\le |\~\alpha_1(t)\,\~\alpha_2(0)|_{\Lobs_\kappa}.$
\end{thm}

Indeed, set $\ell(t)=|p\,\alpha_i(t)|$ and $\~\ell(t)=|\~p\~\alpha_i(t)|$.
$\ell^+(t)\le\ell(t)$ and $\~\ell^+(t)\le\~\ell(t)$

Indeed, 
$$(f\circ\alpha_i)^+(t)=d_{\alpha(t)}f(\nabla_{\alpha(t)}f)=|\nabla_{\alpha(t)}f|^2\le\sn_\kappa^2(|p\alpha(t)|);$$
$$(\~f\circ\~\alpha_i)^+(t)=d_{\~\alpha(t)}f(\nabla_{\~\alpha(t)}\~f)=|\nabla_{\~\alpha(t)}\~f|^2=\sn_\kappa^2(|\~p\~\alpha(t)|);$$

Thus according to ??? for any $t\ge 0$
$$|\alpha_1(t)\alpha_2(t)|\le e^t|\alpha_1(0)\alpha_2(0)|.$$
Direct calulations show that 
$$|\~\alpha_1(t)\~\alpha_2(t)|= e^t|\~\alpha_1(0)\~\alpha_2(0)|.$$
Thus we get the result in partial case $t_1=t_2$.

Without loss of generality, we can assume that $t_1\ge t_2$.
We will prove two inequalities:
$$|\alpha_1(t_1-t_2)\,\alpha_2(0)|\le |\~\alpha_1(t_1-t_2)\,\~\alpha_2(0)|$$
and 
$$|\alpha_1(t_1)\,\alpha_2(t_2)|\le e^{t_2}|\alpha_1(t_1-t_2)\,\alpha_2(0)|.$$






















The proof will follow from ??? claims:

\begin{thm}{Claim} For any $t\ge 0$, we have
$|p\alpha_1(t)|\le |\~p\~\alpha_1(t)|$.
\end{thm}

\parit{Proof.}
Let $x\not=p$     be a point in $L$ 
and $\~x\not=\~p$ be a point in $\Lob_\kappa$.
Note that
$|\nabla_{\~x}\dist_{\~p}|=1$ for any $\~x\in\Lob_\kappa$ and 
$|\nabla_x\dist_p|\le1$       for any $x\in L$
(the later follow from ???).
Thus, $|\nabla_xf|\le \sn_\kappa(|px|)$ and $|\nabla_{\~x}f|= \sn_\kappa(|\~p\~x|)$.

Set $r(t)=|p\alpha_1(t)|$, and $\~r(t)=|\~p\~\alpha_1(t)|$, 
Then 
$$r^+(t)\le \sn_\kappa(r(t))\ \ \t{and}\ \ \~r^+(t)= \sn_\kappa(\~r(t))$$
Since $r(0)=|p\alpha_1(0)|=|\~p\~\alpha_1(t)|=\~r(0)$, we get $r(t)\le \~r(t)$ for any $t\ge 0$.\qeds
























The formulation of the following estimate is a bit tecnical.
But it is just straigth-forward generalization of its simplest case: 
\textit{assume $\sigma$ is a $0$-radial curve w.r.t. $p$ and $f$ is a concave function then
the function $s\mapsto\frac{f(\sigma(s))-f(p)}{s}$ is nonincreasing.}

\begin{thm}{Lemma} \label{lem:monotonic}
Let $L\in \CBB{}\kappa$ $\nu\le 0$ and $f:L\to\RR$ is a locally Lipschitz function such that $f''+\nu f\le 1$.
Assume $\sigma:[r,\infty)\to L$ be a $\nu$-radial curve w.r.t. $p$.

Let $\phi_{s}:\RR_\ge\to\RR$ be a one parameter family of smooth functions defined by 
$\phi_s(0)=f(p)$, 
$\phi_s(s)=f\circ\alpha(s)$ 
and $\phi''+\nu\phi=1$.
Then for any fixed $t$ the function $s\mapsto\phi_s(t)$ is nonincreasing.
\end{thm}

\parit{Proof.}
Remind that since $d_q\dist_p(v)=-\sup\<\xi,v\>$ where $\xi$ runs all directions from $q$ to $p$ in $L^\o$.
Thus, for any $v\in \T_q$, there is $\xi\in ???$ such that 
$$\<\nabla_q\dist_p,v\>+\<\xi,v\>\ge0.$$

\qeds

********************************

We give construction separetely in three cases $\kappa=\{-1,0,1\}$ the rest can be obtained by resaling.

Assume $L\in\CBB{}{0}$ and $p,q\in L$.
Set $r=|pq|$ and $f=\dist_p^2/2$.
Consider $f$-gradient curve $\alpha_q:[0,\infty)\to L$ with $\alpha_q(0)=q$.

Define $\tau:[r,\infty)\to[0,\infty)$ by 
$$\tau(s)=e^{s}-e^r.$$
and set $\rho(s)=\alpha\circ\tau(s)$.
The following claim roughly says that curve $\rho(t)$ doing its best to remind extension of geodesic $[pq]$ behind $q$.


*********************
\begin{thm}{Lemma} \label{lem:monotonic}
Let $L\in \CBB{}\kappa$,  $f:L\to\RR$ be a $\lambda$-concave function $\lambda\ge 0$.
Consider a radial curve $\alpha$ with respect to $p$.
Let $\phi_{s}(t)$ to be a function defined by 
$\phi_s(0)=f(p)$, 
$\phi_s(s)=f\circ\alpha(s)$ and $\phi''=\lambda$.
Then for any fixed $t$ the function $s\mapsto\phi_s(t)$ is decreasing.

then for any $p\in L$ and any $0$-radieal curve with respect to $p$, we have
$$f\circ\gexp_p(t\cdot\xi)\le f(p)+t\cdot\d_p f(\xi)+t^2\cdot\lambda/2.$$
Moreover, the function
$$\vartheta(t)=\{f\circ\gexp_p(t\cdot\xi)-f(p)-t^2\cdot\lambda/2\}/t$$
is non-increasing.
\end{thm}


\begin{thm}{Lemma} \label{lem:monotonic}
Let $A\in \Alex$,  $f:A\to\RR$ be a $\lambda$-concave function $\lambda\ge 0$ then for any $p\in A$ and $\xi\in \Sigma_p$
$$f\circ\gexp_p(t\cdot\xi)\le f(p)+t\cdot\d_p f(\xi)+t^2\cdot\lambda/2.$$
Moreover, the function
$$\vartheta(t)=\{f\circ\gexp_p(t\cdot\xi)-f(p)-t^2\cdot\lambda/2\}/t$$
is non-increasing.
\end{thm}

In particular, applying this lemma for $f=\dist_q^2/2$ we get

\begin{thm}{\bf Corollary.} \label{cor:angle--}
If $A\in\Alex(0)$ then for any $p,q,\in A$ and
$\xi\in \Sigma_p$,
$$\tilde\angle_0(t,|\gexp_p(t\xi)q|,|p q|)$$ 
is non-increasing in $t$.\footnote{$\tilde\angle_\kappa(a,b,c)$ denotes angle
opposite to $b$ in a triangle with sides $a,b,c$ in $\Lob_\kappa$.} In
particular,
$$\tilde\angle_{0}(t,|\gexp_p(t\xi)\,q|,|p q|) \le\angle(\xi,\uparrow_p^q).$$
\end{thm}

In \ref{sph-hyp-exp} you can find a version of this corollary for arbitrary lower curvature bound.

\parit{Proof of lemma~\ref{lem:monotonic}.} 
Recall that $\nabla_q\dist_p$ is polar to the set $\Uparrow_q^p\i T_q$ (see
example~(\ref{polar}) on page~\pageref{polar}). 
In particular, from inequality $(**)$ on page~\pageref{**-polar-inq},
$$\d_q f(\nabla_q\dist_p) 
+\inf_{\zeta\in\Uparrow_q^p}\{\d_q f(\zeta)\}
\le 0$$

On the other hand, since $f$ is $\lambda$-concave,
$$\d_q f(\zeta)\ge \frac{f(p)-f(q)-\lambda|p q|^2/2}{|p q|}\ \ \text{for any}\
\ \zeta\in \Uparrow_q^p,$$
therefore
$$\d_q f(\nabla_q\dist_p)
\le
\frac{f(q)-f(p)+\lambda|p q|^2/2}{|p q|}.$$

Set $\alpha_\xi(t)=\gexp(t\cdot\xi)$, $q=\alpha_\xi(t_0)$, then 
$\alpha^+_\xi(t_0)=\tfrac{|p q|}{t}\nabla_{q}\dist_p$ as in $(\diamond)$. 
Therefore,
$$(f\circ\alpha_\xi)^+(t_0)=
\d_q f(\alpha^+_\xi(t_0))\le$$
$$\le
\frac{|p q|}{t_0}\l[\frac{f(q)-f(p)+\lambda|p q|^2/2}{|p q|}\r]
=
\frac{f(q)-f(p)+\lambda|p q|^2/2}{t_0}\le$$
since $|p q|\le t_0$ and $\lambda\ge 0$,
$$\le \frac{f(q)-f(p)+\lambda t^2_0/2}{t_0}
=\frac{f(\alpha_\xi(t_0))-f(p)+\lambda t^2_0/2}{t_0}.$$
Substituting this inequality in the expression for derivative of $\vartheta$,
$$\vartheta^+(t_0)=\frac{(f\circ\alpha_\xi)^+(t)}{t_0}
-\frac{f\circ\gexp_p(t_0\cdot\xi)- f(p)}{t_0^2}-\lambda /2,$$ we get
$\vartheta^+\le 0$, i.e. $\vartheta$ is non-increasing. 

Clearly, $\vartheta(0)=\d_p f(\xi)$ and so the first statement follows.\qeds

*********************

A map $m:\T_p\to L$ is called gradient exponent at $p$ if for any vector $v\in \T_p$

*********************


























*************
\begin{multline*}
 \sinh r\cdot\cosh R\cdot\frac{\partial^+\ell}{\partial r}
+
\sinh s\cdot\cosh S\cdot\frac{\partial^+\ell}{\partial s}
\le
\\
\le
\frac{\cosh\ell\cosh R\cosh r-{\cosh S}\cosh r}{\sinh\ell}
+
\frac{\cosh\ell\cosh S\cosh s-{\cosh R}\cosh s}{\sinh\ell}
=
\\
=
\sinh r\cdot\cosh R\cdot\frac{\cosh\ell\cosh r-\cosh s}{\sinh r\cdot\sinh\ell}
+
\sinh s\cdot\cosh S\cdot\frac{\cosh\ell\cosh s-\cosh r}{\sinh s\cdot\sinh\ell}
\end{multline*}
*************
$$\cos\gamma=\frac{\cosh a \cosh b-\cosh c}{\sinh a\sinh b} $$





\begin{thm}{Theorem} Let $\kappa\le 0$, $L\in\CBB{}{\kappa}$.
Assume
\begin{enumerate}[(i)]
\item $\ p\in L\ $ and $  f=\md_\kappa\circ\dist_{  p}$;
\item $\~p\in\Lob_\kappa$            and $\~f=\md_\kappa\circ\dist_{\~p}$;
\item $  \alpha_1,  \alpha_2:[0,\infty)\to           L$ be two $  f$-gradient curves;
\item $\~\alpha_1,\~\alpha_2:[0,\infty)\to \Lob_\kappa$ be two $\~f$-gradient curves such that
\subitem $|\~p\,\~\alpha_i(0)|_{\Lobs_\kappa}=|p\,\alpha_i(0)|_L$ 
and $|\~\alpha_1(0)\~\alpha_2(0)|_{\Lobs_\kappa}=|\alpha_1(0)\alpha_2(0)|_L$ 
\end{enumerate}
Then for any $t_1,t_2\ge 0$ we have 
$$|\alpha_1(t_1)\,\alpha_2(t_2)|_L\le |\~\alpha_1(t_1)\,\~\alpha_2(t_2)|_{\Lobs_\kappa}.$$
\end{thm}

If $L$ has positive curvature, we can use above result for $\kappa=0$
and it is enough for most applications.
However, the following is an analog of above theorem optimized for $\kappa>0$.
It has more restrictions and formula more complicated.
In principle one could formulate both theorems as one, taking $f=\phi_\kappa\circ\dist_p$, where 
$$\phi_\kappa(t)=
\l[
\begin{aligned}
\md_\kappa (t)& &\t{if}\ \ \kappa&\le 0\\
\tfrac1\kappa\ln(\cs_\kappa (t))& &\t{if}\ \ \kappa&> 0
\end{aligned}
\r.
$$
Note however, that the map $(\kappa,t)\mapsto \phi_\kappa(t)$ is continuous but not analiytic 
and culculations in the proofs of these two cases are very different.

\begin{thm}{Theorem} Let $\kappa> 0$, $L\in\CBB{}{\kappa}$.
Assume
\begin{enumerate}[(i)]
\item $\ p\in L\ $                   and $  f=-\tfrac1\kappa\ln\circ\cs_\kappa\circ\dist_{  p}$;
\item $\~p\in\Lob_\kappa$            and $\~f=-\tfrac1\kappa\ln\circ\cs_\kappa\circ\dist_{\~p}$;
\item $  \alpha_1,  \alpha_2:[0,\infty)\to           L$ be two $  f$-gradient curves such that
\subitem $|p\alpha_i(0)|<\varpi_\kappa/2$
\item $\~\alpha_1,\~\alpha_2:[0,\infty)\to \Lob_\kappa$ be two $\~f$-gradient curves such that
\subitem $|\~p\~\alpha_i(0)|=|p\alpha_i(0)|$ and $|\~\alpha_1(0)\~\alpha_2(0)|=|\alpha_1(0)\alpha_2(0)|$ 
\end{enumerate}
Then for any $t_1,t_2\ge 0$ we have 
$$|\alpha_1(t_1)\,\alpha_2(t_2)|_L\le |\~\alpha_1(t_1)\,\~\alpha_2(t_2)|_{\Lobs_\kappa}.$$
\end{thm}

The proof is a strightforward calculation based on ???.

\parit{Proof.} 
Set
\begin{align*}
r_i(t)&=|p\alpha_i(t)|&\~r_i(t)&=|\~p\~\alpha_i(t)|,\\
\ell(t_1,t_2)&=|\alpha_1(t_1)\alpha_2(t_2)|,&\phi(t_1,t_2)&=\tangle_\kappa\{\ell(t_1,t_2),\~r_1(t_1),\~r_2(t_2)\}.
\end{align*}
The statement of the theorem easely follow from the following claim

\begin{thm}{Claim}
$$\frac{\partial\phi(t_1,0)}{\partial t_1}\le 0, \ \ \frac{\partial\phi(0,t_2)}{\partial t_2}\le 0$$
$$\frac{\partial\phi}{\partial t_1}+\frac{\partial\phi}{\partial t_2}\le 0$$
\end{thm}


\parit{Proof.} 
Set
\begin{align*}
r_i(t)&=|p\alpha_i(t)|&\~r_i(t)&=|\~p\~\alpha_i(t)|.
\end{align*}
It is straightforward to check that $\~r_i^+=\sn_\kappa\~r_i$.
On the other hand 
$$r_i^+\le |\nabla_{\alpha_i(t)}f|=|\nabla_{\alpha_i(t)}\dist_p|\sn_\kappa r_i\le \sn_\kappa r_i.$$
Thus, for any $t\ge0$ we have 
$$r_i(t)\le \~r_i(t).\eqno(*)$$


\begin{thm}{Claim}
For $i\in\{1,2\}$ and any $q\in L$, the function 
$$\phi(t)= \tangle_\kappa\{|\alpha_i(t)q|;|pq|,\~r_i(t)\}$$
is nonincreasing.
\end{thm}

\parit{Proof.}
Set $\ell(t)=|\alpha_i(t)q|$.
Since $f''+\kappa f\le 1$, from \ref{lem:grad-lip}, we have
\begin{align*}
\ell^{+}
&=
-\<\dir_{\alpha_i(t)}^q,\nabla_{\alpha_i(t)}f\>
\le
\\
&\le\frac{\md_\kappa\ell+{\md_\kappa r_i\cdot\cs_\kappa\ell}-\md_\kappa |pq|}{\sn_\kappa\ell}\le
\\
\intertext{Since $\kappa\le0$, we have $\cs_\kappa\ell,\sn_\kappa\ell\ge0$. Thus, from $(*)$}
&\le
\frac{\md_\kappa\ell+{\md_\kappa \~r_i\cdot\cs_\kappa\ell}-\md_\kappa |pq|}{\sn_\kappa\ell}.
\end{align*}
Together with $\~r_i^+=\sn_\kappa\~r_i$, the later inequality is equivalet to $\phi^+(t)\le 0$
\qeds

\parbf{Comment}

$$\alpha^+=\frac{\tan |p\alpha(t)|}{\tan t}\nabla_{\alpha(t)}\dist_p$$

$$\ell^{+} \le\frac{{\cos\ell}+\cos b/\cos a}{\sin\ell}$$

$$\alpha^+=\frac{\tanh |p\alpha(t)|}{\tanh t}\nabla_{\alpha(t)}\dist_p$$

$$\ell^{+} \le\frac{{\cosh\ell}-\cosh b/\cosh a}{\sinh\ell}$$


\begin{thm}{Claim}
The function 
$$t\mapsto \tangle_\kappa\{|\alpha_1(t)\alpha_2(t)|;\~r_1(t)|,|\~r_2(t)|\}$$
is nonincreasing.
\end{thm}
\parit{Proof.}
Set $\ell(t)=|\alpha_1(t)\,\alpha_2(t)|$.
\begin{align*}
\ell^{+}(t)
&=
-\<\dir_{\alpha_1(t)}^{\alpha_2(t)},\nabla_{\alpha_1(t)}f\>-\<\dir_{\alpha_2(t)}^{\alpha_1(t)},\nabla_{\alpha_2(t)}f\>
\le
\\
&\le
\frac{2\md_\kappa\ell+[\md_\kappa r_1+\md_\kappa r_2]\cdot[\cs_\kappa\ell-1]}{\sn_\kappa\ell}
\le
\\
\intertext{Since $\kappa\le0$, we have $\cs_\kappa\ell-1,\sn_\kappa\ell\ge0$. Thus, from $(*)$}
&
\le
\frac{2\md_\kappa\ell+[\md_\kappa \~r_1+\md_\kappa \~r_2]\cdot[\cs_\kappa\ell-1]}{\sn_\kappa\ell}.
\end{align*}
Together with $\~r_i^+=\sn_\kappa\~r_i$, the later inequality is equivalet to
$$\frac{\d^+}{\d t} \tangle_\kappa\{\ell(t);\~r_1(t),\~r_2(t)\}\le 0.\eqno\qed$$
Finally let us put these claims together.
Without loss of generality, we can assume that $t_1\ge t_2$.
From ???, we get 
$$|\alpha_1(t_1-t_2)\,\alpha_2(0)|_L\le |\~\alpha_1(t_1-t_2)\,\~\alpha_2(0)|_{\Lobs_\kappa}.$$
Then applyinf ???, we get
$$|\alpha_1(t_1)\,\alpha_2(t_2)|_L\le |\~\alpha_1(t_1)\,\~\alpha_2(t_2)|_{\Lobs_\kappa}.\eqno\qed$$






\begin{thm}
{Gradient homothety} 
Let $L\in\CBB{}{\kappa}$ and $p,q\in L$  such that $|pq|=\ell<\varpi_\kappa/2$
then for any  $t\in[\ell,\varpi_\kappa/2)$ 
there is a point $q_t\\in L$ such that for any $x\in \oBall(p,\varpi_\kappa/2)$ we have 
$$\tangle_\kappa\{\,|q_tx|;\,|px|,\,t\,\}\le \angk\kappa pqx.$$
\end{thm}

Note that if there is point $q'\in L$ such that 
$|pq'|=t$ and $q\in [pq']$ then $q'$ from ???comparison, for any $x\in L$ we have
$$\tangle_\kappa\{\,|q'x|;\,|px|,\,t\,\}=\angk\kappa p{q'}x\le \angk\kappa pqx.$$
Thus one can take $q_t=q'$.










Note that equasion $(\textrm{rad})_\nu$ can be also rewritten as
$$\sigma^+(s)=\frac{1}{\tg_\nu s\cdot\cs_\nu|p\sigma(s)|}\cdot\nabla_{\sigma(s)}(\md_\nu\circ\dist_p).\eqno(\textrm{rad}')_\nu$$





















\parit{Case $\kappa=1$.}
$$f=-\cos(\dist_p),\ \  \t{clearly}\ \ f''+f\le 0 \eqno(A_+)$$

$$\rho^+(r)=\frac1{\tan r\cdot\cos R}\cdot\nabla_{\rho(r)} f
\ \ \t{and}\ \ 
\sigma^+(s)=\frac1{\tan s\cdot\cos S}\cdot\nabla_{\sigma(s)} f.\eqno(B_+)$$

$$\begin{aligned}
\frac{\partial^+\ell}{\partial r}
&=
-\frac{1}{\tan r\cdot\cos R}\<\nabla_{\rho(r)} f,\dir_{\rho(r)}^{\sigma(s)}\>
\le
\\
&\le
\frac{1}{\tan r\cdot\cos R}\cdot\frac{\cos S-\cos R\cos\ell}{\sin\ell}
=
\\
&=
\frac{\frac{\cos S}{\cos R}-\cos\ell}{\tan r\cdot\sin\ell}.
\end{aligned}\eqno(C_+)$$

$$\begin{aligned}
\frac{\partial^+\ell}{\partial r}(r,s_{\min})
&\le 
\frac{\frac{\cos s_{\min}}{\cos r}-\cos\ell}{\tan r\cdot\sin\ell}
=
\\
&=\frac{{\cos s_{\min}}-\cos\ell\cos r}{\sin r\cdot\sin\ell}=
\\
&=\cos\tangle_1\{s_{\min};r,\ell\},   
  \end{aligned}\eqno(D_+)$$

$$\begin{aligned}
&\sin r\cdot\cos R\cdot\frac{\partial^+\ell}{\partial r}
+
\sin s\cdot\cos S\cdot\frac{\partial^+\ell}{\partial s}\le
\\
&\le\frac{{\cos S}\cos r-\cos\ell\cos R\cos r}{\sin\ell}
+\frac{{\cos R}\cos s-\cos\ell\cos S\cos s}{\sin\ell}=
\\
&=\sin r\cdot\cos R\cdot\frac{\cos s-\cos\ell\cos r}{\sin r\cdot\sin\ell}
+\sin s\cdot\cos S\cdot\frac{\cos r-\cos\ell\cos s}{\sin s\cdot\sin\ell}
=
\\
&=\sin r\cdot\cos R\cdot\cos\tangle_1\{r;s,\ell\}
+\sin s\cdot\cos S\cdot\cos\tangle_1\{s;r,\ell\}
\end{aligned}
\eqno(E_+)$$


\parit{Case $\kappa=-1$.}
$$f=\cosh(\dist_p),\ \  \t{clearly}\ \ f''-f\le 0\eqno(A_-)$$

$$\rho^+(r)=\frac1{\tanh r\cdot\cosh R}\cdot\nabla_{\rho(r)} f
\ \ \t{and}\ \ 
\sigma^+(s)=\frac1{\tanh s\cdot\cosh S}\cdot\nabla_{\sigma(s)} f.\eqno(B_-)$$

$$\begin{aligned}
\frac{\partial^+\ell}{\partial r}
&=
-\frac{1}{\tanh r\cdot\cosh R}\<\nabla_{\rho(r)} f,\dir_{\rho(r)}^{\sigma(s)}\>
\le
\\
&\le
\frac{1}{\cosh R\cdot\tanh r}\cdot\frac{\cosh S-\cosh R\cosh\ell}{\sinh\ell}
=
\\
&\le
\frac{\cosh\ell-\frac{\cosh S}{\cosh R}}{\tanh r\cdot\sinh\ell}.
\end{aligned}
\eqno(C_{-})$$

$$\begin{aligned}
\frac{\partial^+\ell}{\partial r}(r,s_{\min})
&\le 
\frac{\cosh\ell-\frac{\cosh s_{\min}}{\cosh r}}{\tanh r\cdot\sinh\ell}
=\frac{\cosh\ell\cosh r-{\cosh s_{\min}}}{\sinh r\cdot\sinh\ell}=
\\
&=\cos\tangle_{-1}\{s_{\min};r,\ell\},   
  \end{aligned}\eqno(D_-)$$

$$\begin{aligned}
\sinh r\cdot\cosh R\cdot\frac{\partial^+\ell}{\partial r}
+
\sinh s\cdot\cosh S\cdot\frac{\partial^+\ell}{\partial s}&\le
\\
\le\frac{\cosh\ell\cosh R\cos r-\cosh S\cosh r}{\sinh\ell}
&+\frac{\cosh\ell\cosh S\cos s-\cosh R\cosh s}{\sinh\ell}=
\\
=\sinh r\cdot\cosh R\cdot\frac{\cosh\ell\cosh r-\cosh s}{\sinh r\cdot\sinh\ell}
&+\sinh s\cdot\cosh S\cdot\frac{\cosh\ell\cosh s-\cosh r}{\sinh s\cdot\sinh\ell}
=
\\
=
\sinh r\cdot\cosh R\cdot\cos\tangle_{-1}\{r;s,\ell\}
&+
\sinh s\cdot\cosh S\cdot\cos\tangle_{-1}\{s;r,\ell\}.
\end{aligned}
\eqno(E_-)$$
























We prove inequalities $(*)_\ell$ and $(**)_\ell$ separetely for $\kappa=0$ and $\kappa\not=0$.
The arguments are almost identical, only formulars $(A$--$E)$ are different.

\parit{Case $\kappa=0$.} Set 
$$f=\tfrac12{\dist^2_p},\eqno(A_0)$$ 
clearly $f$ is $1$-concave.
Then
$$\rho^+(r)=\tfrac1r\cdot\nabla_{\rho(r)} f\ \ \t{and}\ \ \sigma^+(s)=\tfrac1s\cdot\nabla_{\sigma(s)} f.\eqno(B_0)$$
Thus from \ref{lem:grad-lip}, we have
$$\frac{\partial^+\ell}{\partial r}
=
-\tfrac1r\<\nabla_{\rho(r)} f,\dir_{\rho(r)}^{\sigma(s)}\>
\le\frac{{\ell^2}+{R^2}-{S^2}}{2\ell r}.\eqno(C_0)$$
Since $R(r)\le r$ and $S(s_{\min})=s_{\min}$, we get 
$$
\begin{aligned}
\frac{\partial^+\ell}{\partial r}(r,s_{\min})
&\le
\frac{{\ell^2}+r^2-s_{\min}^2}{2\ell r}
=\\
&=
\cos\tangle_0\{s_{\min};r,\ell\},
\end{aligned}
\eqno(D_0)
$$
which is the first inequality in $(*)_\ell$ for $\kappa=0$.
By switching places of $\rho$ and $\sigma$ we obtain the second inequality in $(*)_\ell$.
Further, summing together $(C_0)$ with its mirrow-inequality for $\frac{\partial^+\ell}{\partial s}$, we get
$$r\frac{\partial^+\ell}{\partial r}+s\frac{\partial^+\ell}{\partial s}\le \ell\eqno(E_0)$$
which is $(**)_\ell$ for $\kappa=0$.














\parit{(\ref{LinDim+}) $\Rightarrow$ (\ref{pack}).} 
Further, 
as in {(\ref{LinDim+})$\Rightarrow$(\ref{LinDim})},
from \ref{thm:Hoelder-embedding}, we get that for all $r>0$ there is $r'>0$ such %that $G(\oBall(p,r))\supset \oBall(r')\i \EE^m$.
Thus, sinse $G$ is Lipschitz we get
$$\pack_\eps \oBall(p,r)>\Const\cdot\eps^{-m}$$
and sinse $\oBall(p,r)\i \oBall(q,R)$,
$$\pack_\eps \oBall(q,R)>\Const\cdot\eps^{-m}$$
for any $\eps>0$.



















\qeds


Let $f_0,f_1,\dots,f_n:X\to\RR$ be a collection of $1$-convex functions.
The sum
$\mathbf{f}=\sum_{i=0}^n f_i\mathbf{e}_i$, 
defines a map
$\mathbf{f}:X\to\RR^n$.


The baricentric map acociated to $\mathbf{f}$ is the map $\sigma_{\mathbf{f}}:\Delta^n\to X$ which is defined the following way
$$\sigma_{\mathbf{f}}(\mathbf{x})=\op{argmin}\sum_{i=0}^n x_if_i.$$

\begin{thm}{Claim}
The baricentric map $\sigma_{\mathbf{f}}$ is locally Lipschitz...
\end{thm}


\begin{thm}{Theorem}
Let $\mathbf{f}=(f_0,f_1,\dots,f_n):X\to\RR^n$ be a map such that each coordinaste function is $1$-conevex.
Then its baricentric map is locally Lipschitz.
\end{thm}



\begin{thm}{Lemma}\label{lem:conv-map}
Assume $X$ is complete almost geodesic metric space and $f_1,f_2,\dots,f_n:X\subto\RR$ be a collection of $1$-convex functions.
Let $\Delta^n$ denotes standerd simplex ...
Then the submap $\sigma_{\mathbf{f}}(\mathbf{\alpha})=\op{argmin}\sum_i^n\alpha_if_i$ 
is Lipshcitz and 
Assume $q\in \Dom f_i$ and $f_i(q)=0$ for each $i\in[1..n]$ and $\max\{f_i(x)\}\ge 0$ for $x$ in a neigborhood of $q$.
Then there are non-negative numbers $a_1,a_2,\cdot,a_n$ such that $q$ is a local minimum point for
$h=\sum_{i=1}^n a_nf_n$.
\end{thm}

\parit{Proof.}???FORMULAS ARE ALL WRONG???















\section{Smoothing trick.}\label{smooth}
Here we present a trick which is very useful for doing local analysis in
Alexandrov's spaces, it was introduced in \cite[section 5]{otsu-shioya}.

Consider function
$$\widetilde\dist_p=\oint\limits_{\oBall(p,\eps)}\dist_x\d x.$$
In this notation, we do not specify $\eps$, 
allways assuming it to be very small.
It is easy to see that $\widetilde\dist_p$ is semiconcave.

Note that 
$$\d_y\widetilde\dist_p=\oint\limits_{\oBall(p,\eps)}d_y\dist_x\d x.$$
If $y\in L$ is regular, i.e. $\T_y$ is isometric to
Euclidean space, then for almost all $x\in \oBall(p,\eps)$ the differential $d_y\dist_x:\T_y\to\RR$ is
a linear function.
Therefore $\widetilde\dist_p$ is differentiable at every regular point, i.e.
$$\d_y\widetilde\dist_p:\T_y\to\RR$$
is a linear function for any regular $y\in L$.

The same trick can be applied to any simple function
$$f(x)=\Theta(\dist_{q_1}^2,\dist_{q_2}^2,\dots,\dist_{q_N}^2).$$
This way we obtain function
$$\tilde f(x)=
\oint_{\oBall(q_1,\eps)\times \oBall(q_2,\eps)\times\cdots\times \oBall(q_N,\eps)}
\Theta(\dist_{x_1}^2,\dist_{x_2}^2,\dots,\dist_{x_N}^2)d x_1d x_2\cdots d x_N,$$
which is differentiable at every regular point, i.e. if $\T_y$ is isometric to
the Euclidean space then 
$$\d_y\tilde f:\T_y\to\RR$$
is a linear function.



















Clearly $\hat\alpha_\o$ is $1$-Lipschitz.
From (\ref{alm-grad}) and \ref{lem:gradcon}, we get $(f^\o\circ\hat\alpha_\o)^+(\varsigma)\ge|\nabla_{\hat\alpha_\o(\varsigma)}f^\o|$.
Therefore, according to \ref{thm:grad-like-2nd-def}, $\hat\alpha_\o:[0,\eps)\to L^\o$  is an $f^\o$-gradient-like curve.

The second part of lemma will not be used in this section;
it follows from existance of gradient-like curves.
Assume that for some fixed $\eps>0$ all functions $f_n$ are $\lambda$-concave in $\oBall(x_n,\eps)$.
Assume further that $|\nabla_{z_n}f_n|>s\ge 0$ for any $z_n\in \oBall(x_n,\eps)$.
Consider sequence of $f_n$-gradient-like curves $\hat\alpha_n:[0,\eps)\to L_n$

\textit{If for some $s\ge 0$ and $\eps>0$, we have $|\nabla_{z_n}f_n|>s$ for any $z_n\in \oBall(x_n,\eps)$ and $\o$-almost all $n$, 
then $|\nabla_{x_\o} f_\o|\ge s$.}
Let us remind that 
$$|\nabla_{z_n}f_n|=\max\{0,\sup_{\xi\in\Sigma_{z_n}}\{d_{z_n}f_n(\xi)\}\},$$
(see ???).
Thus, for any $1$-Lipschtz curve $\alpha_n:[0,t_{\max}]\to \oBall(x_n,\eps)$ we have
$$f_n{\circ}\alpha_n(t_{\max})-f_n{\circ}\alpha_n(0)\le???\le st_{\max}.$$
Note that any $1$-Lipschtz curve $\alpha_\o:[0,t_{\max}]\to \oBall(x_\o,\tfrac\eps2)$ 
can be presented as a $\o$-limit of a seqence of $1$-Lipschtz $\alpha_n:[0,t_{\max}]\to \oBall(x_n,\eps)$.
Thus,
$$f_\o{\circ}\alpha_\o(t_{\max})-f_\o{\circ}\alpha_\o(0)\le st_{\max}.$$
for any $1$-Lipschitz curve $\alpha_\o:[0,t_{\max}]\to \oBall(x_\o,\tfrac\eps2)$.
In particular, $|d_{x_\o}f_\o|\le s$ and thus $|\nabla_{x_\o}f_\o|\le s$.




























Let us apply definition for a point $p\in L^\bullet(\beta(t_0))$ near $\beta(t_0)$; 
so, according to \ref{thm:almost.geod}, there is unique geodesic $[{\beta(t_0)}p]$.
Thus, direction $\dir{\beta(t_0)}p$ is uniquely defined and $d_{\beta(t_0)}\dist_p(v)=-\<\dir{\beta(t_0)}p,v\>$ for any $v\in \T_p$.

Since for $y=\md_\varkappa\circ\dist_p\circ\beta$ we have $y''+\varkappa y\le 1$,
the function $\dist_p\circ\beta$ is semiconcave in a neigborhood of $t_0$.
Thus the value $(\dist_p\circ\beta)^+(t_0)$ is well defined.

Assume the limit 
$$\beta^+(t_0)=\lim_{t\to t_0+}\frac{\log_{\beta(t_0)}\beta(t)}{t-t_0}$$ 
is not defined,
take its two distinct partial limits $v,w\in\T_{\beta(t_0)}$.
Then for any $p\in L^\bullet(\beta(t_0))$ we have $\<\xi,v\>=\<\xi,w\>$, where  
$\xi=\dir{\beta(t_0)}{\,p}$.
Choosing one of $\xi\approx \tfrac{v}{|v|}$ or $\xi\approx \tfrac{w}{|w|}$ leads to a contradiction.



















These inequalities have sense in arbitrary metric space,
Given a ???-continuous subfunction $f:X\subto\RR$ we say that it satisfies
$$f''\le \phi(f,(f')^2)$$
if for any geodesic $\gamma$ in $\op{Dom}f\i X$ we have
$$(f\circ\gamma)''\le \phi(f\circ\gamma,((f\circ\gamma)')^2).$$

On the same way one can define generalized convexity.
Given a ???-continuous subfunction $f:X\subto\RR$ we say that it satisfies
$$f''\ge \phi(f,(f')^2)$$
if for any geodesic $\gamma$ in $\op{Dom}f$ we have
$$(f\circ\gamma)''\ge \phi(f\circ\gamma,((f\circ\gamma)')^2).$$










\parbf{Integral curves.}
Let $X$ be a metric space and $\Omega\i X$ be an open subset.
By a \emph{vector field}\index{vector field} in $\Omega$ we will understand a choice $v_p\in \T_pX$ for each $p\in \Omega$ such that the function $p\mapsto|v_p|$ is locally bounded (no continuity of the field is requred).

Given a vector vield $v$ in $\Omega$ one can consider its integral curves.
Namely for a real interval $I$, a Lipschitz curve $\alpha:I\to\Omega$ is called \emph{integral curve}\index{integral curve} for $v$ if for any $t\in I$, $t\not=\sup I$, the vector $\alpha^+(t)\in \T_{\alpha(t)}$ is well defined and
$$\alpha^+(t)=v_{\alpha(t)}.$$
For shortness, the above condition we will write as 
$$\alpha^+=v.$$

Given a vector vield, an integral curve might not exist, and even if exist it might be not unique.



























\section{Convexity of real functions.}

A real function $y:(t_{\min},t_{\max})\to\RR$ will be called


Given two functions $y,\phi:(t_{\min},t_{\max})\to\RR$, we will write
$$y''\ge \phi\ \ (\t{correspondently}\ \ y''\le \phi)$$
if for any $\eps>0$ and $t_0\in(t_{\min},t_{\max})$ there is an subinterval $t_0\in(a,b)\i (t_{\min},t_{\max})$
such that the function
$$y-\tfrac{\phi(t_0)}2t^2$$
is convex (correspondently concave) in $(a,b)$. 

We will need to consider generalized solutions of equasions 
$$y''\ge 1-\kappa y\ \  \t{and}\ \  y''\le 1-\kappa y$$
for $y:(t_{\min},t_{\max})\to\RR$.
The classes of these solution will play a very important role in comparison for curvature $\le\kappa$ and $\ge\kappa$.


As a main fefinition we take the following

Thus, it is important to understand these two classes of  solutions on real interval. 
Note that general solution for equasion
$$y''=1-\kappa y$$ 
 can be written as
$$\Const+\l[1-\kappa \cdot \Const\r]\md_\kappa(t-t_0).$$

The next theorem translates this property to langage closed to usual convexity: 













In any case, it is only reasonable to such definition for the spaces where we have semiconcave functions, but not all
functions are semiconcave;
Alexandrov's spaces seem to be the perfect choice.













\begin{thm}{Definition} Let $L\in\CBB m\kappa$, a curve $\gamma:(t_{\min},t_{\max})\to L$ be a curve.
If  if there is $\varkappa\in\RR$ such that $\gamma$ is a $\varkappa$-quasigeodesic then it is called \emph{quasigeodesic}.
\end{thm}















\parit{Proof.}
To prove that quasigeodesic $\gamma$ is $1$-Lipschitz at some $t=t_0$,
it is enough to apply the definition for $f=\dist_{\gamma(t_0)}^2$ and use the fact
that in any Alexandrov's space $\dist_p^2$ is $(2+O(r^2))$-concave in
$\oBall(p,r)$.
The lower bound is more complicated, see theorem~\ref{thm:unit-speed}.
\qeds


















\begin{thm}{Theorem}
Let $L\in\CBB m\kappa$ and $\gamma:(t_{\min},t_{\max})\to L$ be a quasigeodesic.
For any $t\in (t_{\min},t_{\max})$ the right and left tangent vectors $\gamma^+$,
$\gamma^-$ are uniquely defined unit vectors.
\end{thm}

\parit{Proof.}
Take a partial limits $\xi^\pm\in \T_{\gamma(t_0)}$ for
$$\frac{\log_{\gamma(t_0)}\gamma(t_0\pm\tau)}{\tau},\ \ \text{as}\ \ 
\tau\to0+$$
It exists since quasigeodesics are $1$-Lipschitz (see \ref{thm:qg-unit-speed}).
For any semiconcave function $f$,  $(f\circ\gamma)^\pm$ are well defined,
therefore 
$$(f\circ\gamma)^\pm(t_0)=d_{\gamma(t_0)}f(\xi^\pm).$$
Taking $f=\dist_q^2$ for different $q\in L$, one can see that $\xi^\pm$ is
defined uniquely by this identity, and therefore $\gamma^\pm(t_0)=\xi^\pm$.

WHY UNIT
\qeds



















Next theorem in particular shows that pointwise limit of quasigeodesics is a quasigeodesic.

\begin{thm}{Passage to the limit}\label{thm:limit-qg}
Let $L_n\in\CBB m\kappa$ be a non-collapsing sequence and $L_n\GHto L$.

Assume $\gamma_n:(t_{\min},t_{\max})\to L_n$ is a sequence of quasigeodesic and $\gamma:(t_{\min},t_{\max})\to L$ is its pointwise limit.
Then $\gamma$ is a quasigeodesic.
\end{thm}


\parit{Proof.} REWRITE COMPLETELY
As it follows from lemma~\ref{lem:lifting}, the statement in the
definition is correct for any $\lambda$-concave function $f$ which has
controlled convexity type $(\lambda,\kappa)$.
I.e. $\gamma$ satisfies the property~\ref{propr:weak-qg}. 
In particular, the $\kappa$-developing of $\gamma$ with respect to any point $p\in L$ is convex, and as it is noted in remark~\ref{rmk:stronger-unit-speed}, $\gamma$ is a
unit-speed curve.
Therefore, from corollary~\ref{cor:eq-qg} we get that it is a quasigeodesic.
\qeds












\parbf{Remarks.}
The first part of theorem holds for general metric space.
The same conclusion holds for $\kappa'$-convex curves in a $\CBB m\kappa$-space (i.e. no need to assume that $\kappa'=\kappa$).
The proof of both statements is the same as below.






\begin{thm}{Theorem}
Let $L\in\CBB{}\kappa$ and $f:L\subto\RR$ is semiconcave then for any $p\in\Dom f$,
$$\sup_{x\in \T^\o_p\backslash \{o_p\}}\frac{\d_p^\o f(x)}{|o_px|}=\sup_{x\in\T_p\backslash \{o_p\}}\frac{\d_pf(x)}{|o_px|}.$$ 
\end{thm}

















Indeed sinse $\map$ is,  non-contracting and norm-preserving, we have 
$$|v^+|=|v^-|=|\beta^\pm(t_0)|$$
and
$$\mangle(v_+,v_-)\ge \mangle(\beta^+(t_0),\beta^-(t_0))=\pi\ \ \Longrightarrow\ \ \mangle(v_+,v_-)=\pi.$$ I.e. $v_+\updownarrows v_-$.

Similartly, $|w_+|=|w_-|=\olim|\beta_n^\pm(t_0)|$ and 
$\mangle(w_+,w_-)=\angk 0{o}{w_+}{w_-}=\olim_{n\to\infty}\angk 0{o_{p_n}}{\beta_n^+(t_0)}{\beta_n^-(t_0)}$

It is easy to see that the later is equivalent??? to the fact that identity
$$\<x,w_\pm\>=\<x,v_\pm\>$$
holds for $x$ in a subset of positive volume in $\mathrm{K}_\o$ (see exercise~\ref{ex:v=w}).
Since $\dim \T_p=\dim\mathrm{K}_\o$ and $\map:\T_p=\mathrm{K}_\o$ is non-contracting,
the later follows from the claim~\ref{clm:<x,v>=<x,w>}.










Note that if one removes word ``mirrow'' from this definition then it would make no difference for spaces with no boundary (see definition of mirrow-concave function~\ref{def:mirrow-conc}).
At the same time the definition will have sense for any metric space (not only for finite dimensional $\CBB{}{}$-space).
However, \emph{boundary} and therefore \emph{$\lambda$-mirrow-concave functions} are defined only for finite dimensional $\CBB{}{}$-spaces.

Next propositon shows that quasigeodesics $\CBB m\kappa$-space is a partial case of $\kappa$-convex curves.
In particular all properties of convex curves hold for quasigeodesics. 

\begin{thm}{Theorem}\label{thm:qg=k-qg}
Let $L\in\CBB m\kappa$
then the class of $\kappa$-quasigeodeics in $L$ coinsides with class of quasigeodesics in $L$.
\end{thm}

\begin{thm}{Corollary}
Let $L\in\CBB m\kappa$ and $\varkappa<\kappa$
then the class of $\kappa$-quasigeodeics in $L$ coinsides with class of $\varkappa$-quasigeodesics in $L$.
\end{thm}

\parit{Proof.}
From \ref{cor:CAT>k-sence}, we have $\CBB{}\kappa\supset\CBB{}\varkappa$.
Thus the statement follows from theorem~\ref{thm:qg=k-qg}.
\qeds












The second definition is more abstract,
we define class quasigeodesics as ``double dual'' to class of geodesics.

\begin{thm}{Definition}
Let $L\in\CBB m{}$, a curve $\gamma$ in $L$ is called quasigeodesic if for any $\lambda\in\RR$ and any  $\lambda$-mirrow-concave subfunction $f:L\subto\RR$ the comosition $f\circ\gamma$ is $\lambda$-concave.
\end{thm}
















\section{Polar vectors}

\begin{thm}{Definition}\label{defn:polar}
Two vectors $u,v\in T_p$ are called \emph{polar} if for any vector $x\in T_p$ we
have 
$$\<u,x\>+\<v,x\>\ge0.$$
More generally, a vector $u\in T_p$ is called polar to a set of vectors
$\mathcal{V}\i T_p$ if 
$$\<u,x\>+\sup_{v\in \mathcal{V}}\<v,x\>\ge0.$$
\end{thm}

Note that if $u,v\in T_p$
are polar to each other then \label{*-polar-inq}
$$\d_p f(u)+\d_p f(v)\le 0.\eqno(*)$$
Indeed, if $s$ is a supporting vector then
$$\d_p f(u)+\d_p f(v)\le-\<s,u\>-\<s,v\>\le 0.$$
Similarly, if $u$ is polar to a set $\mathcal{V}$ then \label{**-polar-inq}
$$\d_p f(u)+\inf_{v\in \mathcal{V}}\d_p f(v)\le 0.\eqno(**)$$

\noi{\it Examples of pairs of polar vectors.}
\begin{enumerate}[(i)]
\item If two vectors $u,v\in T_p$ are \emph{antipodal}, i.e. $|u|=|v|$ and $\angle u o_p v=\pi$ then they are polar to each other. 

In general, if $|u|=|v|$ then they are polar if and only if for any $x\in T_p$
we have $\angle u o_p x+\angle x o_p v\le\pi$.

\item \label{polar} If $\uparrow_q^p$ is uniquely defined then $\uparrow_q^p$ is
polar to $\nabla_q\dist_p$. 

More generally, if $\Uparrow_p^q\i \Sigma_p$ denotes the set of all directions from $p$
to $q$ then $\nabla_q\dist_p$ is polar to the set $\Uparrow_q^p$. 
\end{enumerate}
Both statement follow from the identity 
$$d_q(v)=\min_{\xi\in \Uparrow_q^p}-\<\xi,v\>$$
and the definition of gradient (see \ref{def:grad}).

Given a vector $v\in T_p$, applying above property~(\ref{polar}) to the function
$\dist_v:T_p\to\RR$ we get that $\nabla_o f_v$ is polar to $\uparrow_o^v$.
Since there is a natural isometry $T_o T_p\to T_p$ we have

\begin{thm}{Lemma}\label{lem:polar} Given any vector $v\in T_p$ there is a
polar vector $v^*\in T_p$. 
Moreover, one can assume that $|v^*|\le |v|$
\end{thm}

In \ref{lem:milka} using quasigeodesics we will show that in fact one can assume
$|v^*|=|v|$












Now assume that $\gamma$ is not unit-speed.

Thus, according to ???, 



From the claim, we have that $\gamma_\infty$ is a probation curve.
On the other hand 



From function comparison (\ref{thm:conc}), the function $f=\md_\varkappa\circ\dist_p$ satisfies differential inequality $f''+\varkappa f\le 1$.
Applying the definition locally, 
we get that if $\gamma$ is a quasigeodesic in $L$ then for any $p\in L$ the function $f_\gamma=\md_\kappa\circ\dist_p\circ\gamma$ saticfies $f_\gamma''+\varkappa f_\gamma\le 1$; i.e. $\gamma$ is a $\varkappa$-convex curve.
Thus it remains to show that quasigeodesic are unit-speed curves.

\begin{thm}{Lemma}
\label{thm:unit-speed} Any quasigeodesic in $\CBB{}{}$-space is a unit-speed curve. 
\end{thm}



























For any $v,w\in \cBall(o_p,\tfrac{\varpi_\kappa}2)$,
$$|\gexp_{p;\kappa}v\,\gexp_{p;\kappa}w|\le\side_\kappa\hinge{o_p}v w.$$
In other words, if one equips set $\mathcal{T}_{p;\kappa}=\cBall(o_p,\tfrac{\varpi_\kappa}2)\i \T_p$ with metric $\rho_\kappa(v,w)=\side_\kappa\hinge{o_p}v w$, then 
$$\gexp_{p;\kappa}:\mathcal{T}_{p;\kappa}\to L$$ 
is a short map.



If $q\in\cBall(p,\tfrac{\varpi_\kappa}2)$ and $\xi=\dir p q$ then taking $x_n\in[p q]$ it follows that $\sigma_\xi(|p q|)=q$.

Thus we can define a map 
$\gexp_p((\xi,t))=\sigma_\xi(t)$.
According to \ref{rad-comp} the map $\gexp_p\:\Sigma_p\times_{\sn_\kappa} I_\kappa\to L$ is short map 
and from above for any $q\in\cBall(p,\tfrac{\varpi_\kappa}2)$ then $\gexp_p((\dir p q,|p q|))=q$.
Consider a sequence of points $q_n\to p$ such that $\dir p q\to\xi$.
Then the sequence of radial curves 

from radial comparison (\ref{rad-comp}), 
it follows that for any direction $\xi\in \Sigma_p$ there is a curve $\alpha_\xi:(0,\varpi_\kappa)\to L$ such that for any $t_0\in (0,\varpi_\kappa)$ the restrictio

To describe gradient exponent in full generality, 
we need to make a sutable generalization of tangent space.

Let $L\in\CBB{}{\kappa}$,
$p\in L$, set
$\Tan_\kappa(p)=\Sigma_p\times_{\sn_\kappa} I_\kappa$, where 
$$I_\kappa=
\l[
\begin{aligned}
&[0,\infty)&\text{if}\ \ &\kappa\le0\\
&[0,\tfrac{\varpi_\kappa}2]&\text{if}\ \ &\kappa>0\\
\end{aligned}
\r.$$

Clearly, $\Tan_0(p)\iso\T_p$.
Given $\xi\in\Sigma_p$ and $r\in I_\kappa$, we will denote by $r\cdot\xi$ the correspondent element of $\Tan_\kappa(p)$.


The following theorem follows easily from radial comparison (\ref{rad-comp}).


\begin{thm}{Gradient exponent}\label{gexp}
Let $L\in\CBB{}{\kappa}$,
$p\in L$ 
and 
$$I_\kappa=
\l[
\begin{aligned}
&[0,\infty)&\text{if}\ \ &\kappa\le0\\
&[0,\tfrac{\varpi_\kappa}2]&\text{if}\ \ &\kappa>0\\
\end{aligned}
\r.$$
Then there is a short map%
\footnote{In most of the cases $\kappa$ will be lower bound for curvature of $L$, thus we can omit this in the notation} 
$$\gexp_{p}=\gexp_{p;\kappa}\:\Sigma_p\times_{\sn_\kappa} I_\kappa\to L$$
such that for any $q\in\cBall(p,\tfrac{\varpi_\kappa}2)$ then $\gexp_p((\dir p q,|p q|))=q$.
\end{thm}

\parit{Proof.}
Given $\xi\in \Sigma_p$,
concider a sequence of points $x_n\in L$ so that $\dir p{x_n}\to \xi\in\Sigma_p$.
Let $r_n=|p x_n|$ and $\sigma_n\:[r_n,\tfrac{\varpi_\kappa}2)\to L$ be the radial curve w.r.t. $p$ initiated at $x_n$.
Directly from radial comparison (\ref{rad-comp}), 
we have that $\sigma_n\:[r_n,\tfrac{\varpi_\kappa}2)\to L$ 
converge to a curve $\sigma_\xi\:(0,\tfrac{\varpi_\kappa}2)\to L$ 
and this limit is independent from the choice of the sequence $x_n$.
The domain of $\sigma_\xi$ can be extended continuously by $\sigma_\xi(0)=p$ 
and  if $\kappa>0$ to $\sigma_\xi(\tfrac{\varpi_\kappa}2)$.
Thus we can think that $\sigma_\xi$ is defined on $I_\kappa$.

If $q\in\cBall(p,\tfrac{\varpi_\kappa}2)$ and $\xi=\dir p q$ then taking $x_n\in[p q]$ it follows that $\sigma_\xi(|p q|)=q$.

Thus we can define a map 
$\gexp_p((\xi,t))=\sigma_\xi(t)$.
According to \ref{rad-comp} the map $\gexp_p\:\Sigma_p\times_{\sn_\kappa} I_\kappa\to L$ is short map 
and from above for any $q\in\cBall(p,\tfrac{\varpi_\kappa}2)$ then $\gexp_p((\dir p q,|p q|))=q$.\qeds












\medskip

Set $v_\pm=\mathring\map(\beta^\pm(t_0))$ and $w_\pm=\olim\beta_n^\pm(t_0)$; $v_\pm,w_\pm\in\mathrm{K}_\o$.
It is sufficient to show that $v_\pm=w_\pm$.

Note that 
$$\beta^+(t_0)\updownarrows\beta^-(t_0)\ \Rightarrow\ v_+\updownarrows v_-,$$ 
and 
$$\beta_n^+(t_0)\updownarrows\beta_n^-(t_0)\ \ \Rightarrow\ \ w_+\updownarrows w_-.$$
Thus, according ???, there is splitting $\mathrm{K}_\o=E\oplus E^\perp$, where $E\i \mathrm{K}_\o$ is a subcone isometric to a Euclidean space and $v_\pm,w_\pm\in E$.
If $w_+\not=v_+$ then equality
$$\<w_+,x\>=\<v_+,x\>$$
holds only on the subcone $\mathrm{K}_\o'=E'\oplus E^\perp\i\mathrm{K}_\o$, where $E'$ is a hyperplane in $E$.
Clearly $\dim \mathrm{K}_\o'=m-1$. 
But according to the claim~\ref{clm:<x,v>=<x,w>}, $\mathring\map(\T_p)\i\mathrm{K}_\o'$, which is impossible since $\map$ is non-contracting (see ???).

\begin{thm}{Claim}\label{clm:<x,v>=<x,w>}
For any $x\in \T_p$, we have
$$\<\mathring\map(x),w_+\>=-\<\mathring\map(x),w_-\>=\pm\<\mathring\map(x),v_\pm\>.$$
\end{thm}









First assume in addition that
$$\beta^+(t_n)\updownarrows \beta^-(t_n)\ \ \t{for each}\ \ n.\eqno(*)$$ 

















Now if $t_n$ does not satisfy $(*)$, 
applying \ref{thm:velocity}, we can find a sequence $t'_n$ so that $t'_n>t_n$, $\beta^+(t'_n)\updownarrows \beta^-(t_n')$ and $t'_n\to0$; from the above we can assume in addition that $\bigl||\beta^\pm(t'_n)|-|\beta^+(t_n)|\bigr|\to0$.
Thus applying above argument again for $t'_n\to 0+$ we get that
$$|\beta^+(0)|=\lim_{n\to\infty}|\beta^\pm(t'_n)|=\lim_{n\to\infty}|\beta^+(t_n)|.\eqno\qed$$










$m>1$%
\footnote{This condition is needed mostly to ensure that the set
$L\backslash\beta$ is everywhere dense.
Note that due to theorem ???, 1-dimensional $\CBB{}{}$-spaces are quite simple.}, 













Here we introduce \emph{mirror-semiconcave functions} --- a subclass of semiconcave  functions.
The definition is using notion of boundary of $\CBB{}{}$-space and therefore works only if dimension is finite.


\begin{thm}{Definition}\label{def:mirrow-conc}
Let $L\in\CBB m\kappa$ with non-emply boundary.
Let us denote by $\breve  L$ its doubling (see ???), 
and by $\proj:\breve L\to L$ the natural projection map.

A subfunction $f:L\subto\RR$ is called mirror-semiconcave if 
the subfunction $\breve f=f\circ\proj$ is semiconcave.

If $L$ has no boundary then, by definition, any semiconcave subfunction is mirror-semiconcave.
\end{thm}

For example, it is easy to see that $f=\dist^2_p$ as well as all simple functions are mirrow-semiconcave and distance function to the boundary $\dist_{\partial L}$, which is semiconcave by ??? but is not mirrow-semiconcave.










For general curve, its right and left tangent vector at $t_0$ might be undefined. 
If both $\alpha^\pm(t_0)$ are defined and $|\alpha^+(t_0)|=|\alpha^-(t_0)|$ then clearly 
$$\speed_\alpha(t_0)=|\alpha^\pm(t_0)|.$$










\section{Doubling and glueing theorems}

Let $L\in\CBB{m}\kappa$, $\partial L\not=\epmtyset$.
By doubling of $L$ we mean a metric space $\breve{L}$ obtained from two compies of $L$ glued along their boundary.
Namely, ...

\begin{thm}{Theorem}
Let $L\in\CBB{m}\kappa$, $\partial L\not=\epmtyset$ then $\breve{L}\in \CBB{m}\kappa$.

\end{thm}
 

\begin{thm}
Let $L_1,L_2\in\CBB{m}{\kappa}$, $E_1\i L_1$ and $E_2\i L_2$ be two extremal subsets of codimension $1$.
Assume there is path-isometric homeomorphism $\imath:E_1\to E_2$ then the glued space
$L=L_1\cap_{x\sim\imath x}L_2\in \CBB m\kappa$.

Moreover, for any $p\in ???$, we have $\T_p=$
\end{thm}

\parbf{Remark.}
Note that conjecture ???, if true could be used to simplify the proof of theorem ???.
Indeed, in this case sinse $\partial L_1\in \CBB m\kappa$ that  













\parbf{Comment for AKP.}
{\small I have a more natural definiton, but I can not work with it so far.

{\it Let $f:L\to\RR$ be a DC-function;
 $p\in L$ is called regular point of $f$ if there is a representaion $f=a-b$, where $a,b$ are concave such that $d_pa(\nabla_pb)<0$ and $d_pb(\nabla_pa)<0$.
Otherwise, $p$ is a critical point of $f$.

Let $F:L\to\RR^m$ be a DC-map. 
We say that $p\in L$ is a regular point of $F$ if it is a regular point of $\ell\circ F$ for any nontrivial linear function $\ell:\RR^m\to\RR$.}}











In case $\kappa=0$, there is a splitting $\T_x=\T_x^\perp\oplus\T_x^\top$, where ...
clearly $\~p, \~q\in o\times\T_x^\top $

Moreover, if $\kappa\le0$ then there is a line $\ell$ in $\mathcal{T}_{x;\kappa}$ passing through $\~p$, $o_x$ and $\~q$ and the space $\mathcal{T}_{x;\kappa}$ admits a wrap 

there are isometries of $\mathcal{T}_{x;\kappa}$  $\T_{\~p}\iso\T_{\~q}\iso\T_{o_x}\mathcal{T}_{x;\kappa}\iso\T_xL$.
Note also that the space $\mathcal{T}_{x;\kappa}$ does not depend on the choice the inside-point $x$ of $[pq]$.
Note further, $\~p$ as well as $\~q$ are vertexes of $\mathcal{T}_{x;\kappa}$;
in other words, there are isometries $\Cone_\kappa\Sigma_x\to \mathcal{T}_{x;\kappa}$ which sends vertex of $\kappa$-cone to $\~p$ or $\~q$.
In particular both $\exp_{\~p}$ and $\exp_{\~q}$ both well defined on $\cBall(o,\varpi_\kappa)$. 

In the easiest case is $\kappa=0$, we have $\mathcal{T}_{x;\kappa}\iso \T_x$.
Thus the property ??? is equivalent to the fact that $\T_x$ splits in the subcone tangent and normal to $[pq]$.
















\parbf{Comment for AKP.}
{\small It is possible to brake this theorem in two (simple+hard), so that simple can be used if dimension is finite and the hard only nesessury if dimension in $\infty$.

If so, the reader who is does not care about infinite dimensional case would have easier live.
On the other hand the proof of hard theorem will need to repeat the proof of simple one (thus all together it will be twice longer).

Also, maybe we will need to move most of this theorem somewhere else, to tight maps...}
















 
Note that since quasigeodesic is a $\kappa$-convex curve, it is $1$-Lipschitz (???),
its velocity vectors $\gamma^\pm(t_0)$ are well defined and for almost all $t_0$ we have $\gamma^+(t_0)\updownarrows\gamma^-(t_0)$.

Thus if $\gamma$ is not unit-speed, then there is $t_0\in(t_{\min},t_{\max})$ such that $\gamma^+(t_0)\updownarrows\gamma^-(t_0)$ and $|\gamma^+(t_0)|=|\gamma^-(t_0)|<1$.
Set $p=\gamma(t_0)$ and consider a sequence of blowups $(n*L,p)\GHto(\T_p,o_p)$.
Consider sequence of curves $\gamma_n(s)=n*\gamma(t_0+\tfrac s n)$, clearly it converges to curve
$$\gamma_\infty(s)=\l[
\begin{aligned}
s&\cdot\gamma^+(t_0)&\t{if}& &s&\ge0\\
(-s)&\cdot\gamma^-(t_0)&\t{if}& &s&\le0
\end{aligned}
\r.
.$$
Since $\gamma^+(t_0)\updownarrows\gamma^-(t_0)$, we have that $\gamma_\infty(\tfrac t{|\gamma^\pm(t_0)|})$ forms a line in $\T_p$.
Thus there is a splitting $\T_p=\RR\times(?)^\perp$, where $(?)^\perp\in\CBB{m-1}0$ is a subcone of $\T_p$.

\parit{Remark.} Note that we do not know yet that limit of quasigeodesic is a quasigeodesic.
Otherwise we would get a contradiction since $\gamma_\infty$ is not a quasigeodesic.
Indeed, the function $f(x)=-\tfrac{|x|^2}{2}$ is $(-1)$-concave, but $f\circ\gamma_\infty(s)=-\tfrac{|\gamma^\pm(t_0)|^2}{2}s^2$
is not $(-1)$-concave.














\begin{thm}{Property}\label{propr:weak-qg}
For any function $f$ on $L$ with controlled concavity type $(\lambda,\kappa)$ we
have that $f\circ\gamma$ is $\lambda$-concave.
\end{thm}

If $\gamma$  is a quasigeodesic in $L$ with $\gamma(0)=p$, then the curves
$\gamma(t/\lam)$ are quasigeodesics in $\lam L$. 
Therefore, as $\lam\to\infty$, the limit curve
$$\gamma_\infty(t)=\left[\begin{matrix}
|t|\cdot\gamma^+(0)&\text{if}\ \  t\ge0\\
|t|\cdot\gamma^-(0)&\text{if}\ \  t<0\\
          \end{matrix}\right.$$
in $\T_p$ has the above property.
By a construction similar\footnote{Setting $v=\gamma^\pm(0)\in \T_p$ and
$w=2\gamma^\pm(0)$, this function can be presented as a sum
$$f=A(\phi_{r,c}\circ\dist_{o}+\phi_{r,c}\circ\dist_w)+B\sum_i\phi_{r',c'}
\circ\dist_{q_i},$$
for appropriately chosen positive reals 
$A,\ B,\ r,\ r',\ c,\ c'$ and a collection of points $q_i$ such that,
$\mangle \hinge p o {q_i}=\angk 0 p o {q_i}=\pi/2$, $|p q_i|=r$ .} 
to theorem~\ref{thm:strictly-concave}, for any $\eps>0$ there is a function $f$ of controlled
concavity type $(-2+\eps,-\eps)$ on a neighborhood of $\gamma^\pm\in \T_p$ such that
$$f(t\cdot\gamma^\pm)=-(t-1)^2+o((t-1)^2).$$
Applying the property above we get $|\gamma^\pm(0)|\ge 1$. \qeds


















Consider wrap product $L_\lambda=\RR\times_\phi L$ for $\phi(x)=\exp(\lambda x)$.
According to ???, $L_\lambda\in \CBB ?????$.
It is straight forward to check that subgraph 
$$K_f=\{\,(x,p)\in L_\lambda \mid x\le f(p)\,\}$$ 
forms a closed convex subset of $L_\lambda$.

Assume $L$ has no boundary and $f:L\subto\RR$ be a $\lambda$-concave.

consider wrap prosduct for function $f(t)=e^\lambda t$ $\RR\times_{\exp(\lambda t)}$
Consider the following family of subfunctions 
$$f_\eps=...$$
Note that for any $\lambda'>\lambda$, for all sufficiently small $\eps>0$, 
the functions $f_\eps$ are $\lambda'$-concave.
Clearly $f_\eps\to f$ as $\eps\to 0$.
Therefore it is sufficent to show that $f_\eps\circ\gamma$ is $\lambda'$-concave for ???.











First consider the case $\gamma^\pm(0)=o_p$.
Then $\gamma_\infty(s)\equiv o_p$.
Consider a subfunction $f:\T_p\subto\RR$ of controlled concavity type $(-1,0)$ at $o_p$, which has a local maximum at $o_p$;
it exists due to ???.
The liftings $f_n:n*L\to\RR$ of $f$ will also have controlled convexiity type at $n*p=\gamma_n(0)$.
Thus we have $(f_n\circ\gamma_n)''\le -1$.
Passing to the limit  we get $(f\circ\gamma_\infty)''\le -1$, in particular $f\circ\gamma_\infty(s)$ can not be constant around $0$.\contradiction

Thus, the remaining case is $0<|\gamma^\pm(0)|<1$.
Set $\xi=\gamma^+(0)/|\gamma^+(0)|$.
In this case $\T_p$ slits in derection of $\xi$
or equivalently $\gamma^\pm,\xi\in\Lin_p$
or yet equivalently, $\xi$ can be multiplied by any real number.






















\section{???Subgradient}

\begin{thm}{Subgradient}
Let $f:\Omega\to \RR$ be a semiconcave function.

The subgradient of $f$ at $p\in\Omega$ is a subset 
$$\partial^-_p f\i\{v\in \T_p \mid d_pf(x)\le-\<v,x\> \ \ \text{for any}\ \ x\in \T_p.\}.$$

The supergradient of $f$ at $p\in\Omega$ is a subset 
$$\partial^+_p f\i\{v\in \T_p \mid d_pf(x)\le\<v,x\> \ \ \text{for any}\ \ x\in \T_p.\}.$$
In particular $\nabla_p f\in \partial_p^+f$.
\end{thm}

\begin{thm}{Theorem}
Let $L\in\CBB m\kappa$, $\Omega\i L$ be an open subset and $f:\Omega\to \RR$ be a semiconcave function, then for any $p\in\Omega$, $\partial_p f$ forms a convex subset.

Moreover, if $p\not\in\partial L$ then $\partial_p f$ is not empty.
\end{thm}

\parit{Proof.} Convexity of $\partial_p f$ follows from concavity of the function $\ell_u:x\to -\<u,x\>$ on $\T_p$.
Indeed, let $v,w\in \T_p$ and $z\in [vw]$.
Let $\nu=|vz|/|vw|$, then from concavity of $\ell_x$, 
we have that for any $x\in \T_p$ we have 
$$-\<x,z\>\ge-\nu\<x,w\>-(1-\nu)\<x,v\>.$$
Thus if $v,w\in\partial_p f$, i.e. $-\<x,w\>,-\<x,v\>\ge d_pf(x)$, we have
$$-\<x,z\>\ge-\nu\<x,w\>-(1-\nu)\<x,v\>\ge d_pf(x).$$
I.e. $z\in \partial_p f$.

We will show $\partial_p f\not=\emptyset$ by induction on $m$.
The base $m=1$ is trivial.

Consider a minimum point  $\xi\in \Sigma_p$ of the function $\phi=\d_p f|_{\Sigma_p}$. 
Since $p\not\in\partial L$, we have $\partial\Sigma_p=\emptyset$, in particular $\xi$ is an interior point of $\Sigma_p$.
The function $\phi$ is semiconcave; 
moreover it satisfies??? $\phi''\le \phi$.
Thus, by induction hypothesis, $\partial_{\xi}\phi\not=\emptyset$, 
hence $\partial_{\xi}\phi=o_{\xi}\in \T_{\xi}\Sigma_p$.
Therefore 
$$\phi(\eta)\le \phi(\xi)\cdot|\xi\ \eta|_{\Sigma_p}$$
for any $\eta\in\Sigma_p$; in particular $\phi(\xi)\le 0$.
Equivalently,
$$d_pf(x)\le \l[-\d_p f(\xi)\r]\<\xi,x\>$$
for any $x\in \T_p$.
Hence 
$$s=\l[-\d_p f(\xi)\r]\cdot\xi\in \partial_p f.$$
\qeds


\begin{thm}{Lemma}
Let $f_n\to f$ and $p_n\to p$.
Let $v_n\in\partial^+_{p_n}f_n$ and $\alpha_n(t)=\gexp_{p_n}(t\cdot v_n)$.
Assume $\alpha_n\to \alpha$ then $\alpha(t)=\gexp_p(t\cdot v)$ for some $v\in \T_p$ and
$v\in\partial^+_pf$. 
\end{thm}

\parit{Proof.}
Consider sequence of curves $\beta_n(t)$ such that $\beta_n(t)=\gamma_n(|v_n|t)$ and $\gamma_n(t)$ is a quasigeodesic with initial data $\gamma(0)=p_n$, $\gamma^+(0)=v_n/|v_n|$.

Pass to a coneverging subseqence $\gamma_n\to \gamma$ and set $v=\gamma^+(0)$.
Then 
\qeds



\begin{thm}{Regular point}
Let $p\in\Omega \subseteq L$ and $f_0,f_1,\dots,f_m:\Omega\to\RR$ be concave functions.
We say that $p$ is a regular point of collection $\{f_i\}_{i=0}^m$ if 

1. $v\in\partial_pf_i$ and  $w\in\partial_pf_j$ implies $\mangle(v,w)>\tfrac\pi2$ for all $0\le i<j\le m$.

2. for any $v\in\partial_pf_i$, we have $\<w,\nabla_p f_j\>>0$ for all $i\not=j$ in $[0..m]$.

3. $\d_pf_i(\nabla_pf_j)<0$ for all $i\not=j$ in $[0..m]$.

4. $\<\nabla_pf_i,\nabla_pf_j\><0$ for all $i\not=j$ in $[0..m]$.

5. $\d_pf_i(v)>0$ for any $v\in\partial_pf_j$ for all $i\not=j$ in $[0..m]$.

6. $\d_pf_i(v)<0$ for any $v\in\partial_p^+f_j$ for all $i\not=j$ in $[0..m]$.

7. $\exists v\in\partial_p^+f_j$ such that  $\d_pf_i(v)<0$ for all $i\not=j$ in $[0..m]$.

8. For any $i$ there is a direction $\xi_i$ such that $d_pf_i(\xi_i)>0$ and for any direction $\xi_i^*$ polar to $\xi_i$
$d_pf_j(\xi_i^*)>0$.

\ 

$4 \Rightarrow 3$, 

$2 \Rightarrow 3$

$5\Rightarrow 7$ 

$7\Rightarrow 3$ ???
\end{thm}

\begin{thm}{Definition}
Let $p\in\Omega \subseteq L$ and $f,g:\Omega\to\RR$ be concave functions.
We say that $p$ is a strained by $f$ and $g$ if 
\begin{enumerate}[(i)]
\item $\d_p f(v)>0$ for any $v \in\partial_p g$ and
\item $\d_p g(w)>0$ for any $w\in\partial_p f$.
\end{enumerate}
\end{thm}


\begin{thm}{Theorem}
Let $L_n\GHtoh{a_n} L$, $p_n\oto p\in L$,
$f_{n},g_n:\oBall(p_n,R)\to\RR$ be two sequences of $\lambda$-concave functions such that 
$f_{n}\to f$ and
$g_n\to g$,
$f,g: \oBall(p,R)\to \RR$.
Assume that $p$ is a strained by $f$ and $g$,
then for all large $n$, point $p_n$ is a is strained by $f_n$ and $g_n$.
\end{thm}

\parit{Proof.}
Assume contrary.
I.e. after passing to a subsequence off $n$, 
there is a sequence of vectors $v_n\in\partial_p g_n\i \T_{p_n}L_n$ 
such that $d_{p_n}f_n(v_n)\le 0$ for all large $n$.

\ 

Let us shoot a quasigeodesic $\gamma_n(t)$, $\gamma_n(0)=p_n$, $\gamma_n^+(0)=v_n/|v_n|$.
Pass to a partial limits $\gamma_n\to \gamma$ and $|v_n|\to \ell$ for one subsequence of $n$.
Set $v=\ell\cdot\gamma^+$, so $|v|=\ell$.

Note that $v\in\partial^+_pg$.
Indeed, sinse $v_n\in\partial^+_{p_n}$, we have 
$$-|v_n|(\dist_{x_n}\circ\gamma_n)^+(0)=\<v_n,\dir{p_n}{x_n}\>\ge d_{p_n}g_n(\dir{p_n}{x_n}).$$
For any sequence $x_n\in L_n$ such that $x_n\to x\not=p$, we have
$$\liminf_{n\to\infty} d_{p_n}g_n(\dir{p_n}{x_n})\ge d_{p}g(\dir{p}{x}),\ \  \limsup_{n\to\infty} (\dist_{x_n}\circ\gamma_n)^+(0)\ge (\dist_{x}\circ\gamma)^+(0)$$
Therefore, 
$$-|v|(\dist_{x}\circ\gamma)^+(0)=\<v,\dir{p}{x}\>\ge d_{p}g(\dir{p}{x}).$$
Sinse geodesic directions are dense in $\Sigma_p$, we get
$$\<v,w\>\ge d_{p}g(w)$$
for any $w\in \T_p$
\qeds

\begin{thm}{Corollary}
The set of regular point of collection $\{f_i\}_{i=0}^m$ is open.
\end{thm}

\begin{thm}{Lemma}
Let $p$ be a regular point of collection $\{f_i\}_{i=0}^m$.
Then 
$$\d_pf_i(\nabla_pf_j)<0$$ 
for any $i\not=j$.
\end{thm}









Indeed, according to ???, all interior points of grodesic $[pq]$ have isometric space of directions.
Thus if $\partial\Sigma_z\not=\emptyset$ for an interior point $z$ on $[pq]$, 
then $\partial\Sigma_{z'}\not=\emptyset$ for any other interior point $z'$ on $[pq]$.
Sinse boundary is closed (???), that implies $[pq]\i \partial L$. 















{\small \parbf{Comment for AKP}
We might need an exteded definitinon, maybe the following generality is sufficient: a subfunction $f:X\subto(-\infty,\infty]$ 
is semiconvex if the above conditions hold and $f<\infty$ on a $G_\delta$ dence subset of $\Dom f$???
\medskip

One can consider more general inequalities:
given a locally Lipschits $\phi:\RR\times\RR_\ge\to\RR$ consider generalized solutions for differential inequalites 
$$f''\le \phi(f,(f')^2)\ \ \t{and}\ \ f''\ge \phi(f,(f')^2).$$}



\begin{thm}{Definitions}
Similarly, we write $$f''\le \phi(f,|f'|)$$
if $$(-f)''\ge \phi(-f,|f'|)$$
\end{thm}

\begin{thm}{Definitions}
\label{def:concave}
Let $X$ be a metric space and $f:X\subto\RR$ be a lower semicontinuous subfunction.
\begin{enumerate}[(1)]
\item For $\lambda\in\RR$, we say that $f$ is \emph{$\lambda$-convex}%
\footnote{Various authors define the class of $\lambda$-concave function differently. It may correspond to $\pm\lambda$-concave or $\pm\tfrac\lambda2$-concave function in our definition.}%
(for shortness $f''\ge \lambda$) 
if for any geodesic $\gamma\i \Dom f$ the function 
$t\mapsto f\circ\gamma(t)-\tfrac\lambda2 t^2$
is convex.

\item For $\lambda_0\in\RR$ and $p\in\Dom f$, we say that $f$ is \emph{$\lambda_0$-convex  at $p$} (for shortness $f''(p)\ge \lambda_0$)
if for any $\lambda<\lambda_0$ there is a neigborhood $\Omega_p\ni p$ such that restriction $f|_{\Omega_p}$ is $\lambda$-convex.

\item $f$ is called  \emph{semiconvex}%
\index{semiconvex}%
\index{convex!semiconvex}
\index{semiconcave}%
\index{concave!semiconcave}%
if  for any $p\in\Dom f$ there is $\lambda\in\RR$ such that $f''(p)\ge \lambda$.

\item
G function $\phi:\Dom f\to\RR$ we write $f''\ge \phi$ ($f''\le \phi$) if $f''(p)\ge \phi(p)$ (correspondently $f''(p)\le \phi(p)$)for any $p\in\Dom f$. 
\end{enumerate}
\end{thm}













Note that according to Alexandrov's lemma,
monotonicity of curve $\alpha$ with respect to $t_0$ is equivalent to the each of the following conditions
$$\tangle_\kappa\{|p\alpha(t_1)|;|p\alpha(t_0)|,t_1-t_0\}
\ge
\tangle_\kappa\{|p\alpha(t_2)|;|p\alpha(t_0)|,t_2-t_0\},$$
$$\tangle_\kappa\{|p\alpha(t_0)|;|p\alpha(t_1)|,t_1-t_0\}
+
\tangle_\kappa\{|p\alpha(t_2)|;|p\alpha(t_1)|,t_2-t_1\}\le\pi,$$
$$\tangle_\kappa\{|p\alpha(t_1)|;|p\alpha(t_2)|,t_2-t_1\}
\ge
\tangle_\kappa\{|p\alpha(t_0)|;|p\alpha(t_2)|,t_2-t_0\},$$
for $t_0<t_1<t_2$.

For $i=1$ and 2, 
set $\phi_i=\lim_{t\to b+}\tangle_\kappa\{|p\alpha_i(t)|;|p\alpha_i(b)|,t-b\}$.
Clearly, $\cos\phi_i=-d_{\alpha_i(b)}\dist_p\l(\alpha_i^+(b)\r)$.
Sinse $\alpha_1(b)=\alpha_2(b)$ and $\alpha_1^+(b)=\alpha_2^+(b)$, we have $\phi_1=\phi_2$.
Set $\phi=\phi_1=\phi_2$.

Since $\alpha_2$ is $\kappa$-monotonic, we have that
$$\phi\ge\tangle_\kappa\{|p\,\alpha_2(t)|;|p\,\alpha_2(b)|,t-b\}$$ 
for all $t>b$.
Since $\alpha_1$ is $\kappa$-monotonic, we have that
$$\phi+\tangle_\kappa\{|p\,\alpha_1(a)|;|p\,\alpha_1(b)|,b-a\}\le\pi.$$
Therefore
$$\tangle_\kappa\{|p\,\alpha_2(t)|;|p\,\alpha_2(b)|,t-b\}+\tangle_\kappa\{|p\,\alpha_1(a)|;|p\,\alpha_1(b)|,b-a\}\le\pi$$
for all $t>b$.














Set $q=\alpha_1(b)=\alpha_2(b)$ and $z=\alpha_1^+(b)=\alpha_2^+(b)\in\T_q$.
Clearly,
$$\phi
\df
\arccos(-d_q\dist_p(z))
=
\lim_{t\to b+}\tangle_\kappa\{|p\,\alpha_i(t)|;|p\,\alpha_i(b)|,t-b\}$$ 
for both $i=1$ and $2$.
From monotonicity of $\alpha_1$ it follows that
$$\phi+\tangle_\kappa\{|p\alpha_1(a)|;|p\alpha_1(b)|,b-a\}\le\pi.$$

\begin{wrapfigure}{r}{30mm}
\begin{lpic}[t(-5mm),b(0mm),r(0mm),l(0mm)]{pics/alex-lem+(0.3)}
\lbl[rb]{84,80;$v'$}
\lbl[lb]{94,80;$v$}
\lbl[tr]{44,50;$w'$}
\lbl[lb]{57,65;$w$}
\lbl[b]{50,112;$x$}
\lbl[tr]{25,140;$z$}
\lbl[tl]{77,140;$y$}
\end{lpic}
\end{wrapfigure}
\noi Thus the statement follows from the followng corollary of Alexandrov's lemma (\ref{lem:alex}), 
which we leave as an exercise for you.\qeds

\begin{thm}{Exercise}
For any $\kappa\le 0$\footnote{This condition is needed only to make sure that angles in the conclusion are well defined.}
 and positive $x$, $y$, $z$, $v$, $w$, $v'$, $w'$ such that
\begin{itemize}
\item $v\le v'$;
\item $\tangle_\kappa\{w;v,x\}\ge\tangle_\kappa\{w';v',x\}$;
\item $\tangle_\kappa\{z;y,x\}+\tangle_\kappa\{w;v,x\}\le \pi$.
\end{itemize}
we have
$$\tangle_\kappa\{w;z,y+v\}\ge \tangle_\kappa\{w';z,y+v'\}.$$
\end{thm}









\begin{thm}{Definition}REWRITE FOR NEW CONCAVE
A curve $\beta:[0,\infty)\to L$ is called \emph{convex} if for any
$\lambda$-concave function $f$, $\lambda\ge 0$, we have that function $$t\mapsto
f\circ\beta(t)-\lambda t^2/2$$
is concave. 
\end{thm}


\noi{\bf Properties of convex curves.} 
Convex curves have the following properties; the proofs are either trivial or the
same as for quasigeodesics:

\begin{enumerate}
\item\label{conv-mono} A curve is convex if and only if it is monotonic with
respect to any value of parameter.
\item\label{conv-lip} Convex curves are $1$-Lipschitz.
\item\label{conv-tang} Convex curves have uniquely defined right and left
tangent vectors.
\item\label{limit-convex} A limit of convex curves is convex and the natural parameter converges to the natural parmeter of the limit curves (the proof the last statement is based on the same idea as theorem~\ref{thm:unit-speed}).
\end{enumerate}

The next is a construction similar to \ref{ext-mono} which gives a new convex
curve out of two. 
It will be used in the next section to construct \emph{pre-quasigeodesics}.






















\section{Existance of quasigeodesics\\ at regular points}\label{step3-1}


We will construct quasigeodesics in an $m$-dimensional Alexandrov's space, assuming
we already have such a construction in all dimensions $<m$. 
This construction is much easier for the case of an Alexandrov's space with only
\textit{$\delta$-strained points}; in this case we construct a sequence of special $\kappa$-pre-quasigeodesics only by
extending/chopping procedures (see below) and then pass to the limit.
In a general Alexandrov's space we argue by contradiction, we assume that $\Omega$ is a maximal
open set such that for any initial data one can construct a $\kappa$-pre-quasigeodesic with zero {\it entropy} on
$\Omega$
(it will be called $\Omega$-quasigeodesic), 
and arrive at a contradiction with the assumption
$\Omega\not=L$.





The following extention and chopping procedures are essential in the construction:

\begin{thm}{Extention procedure}\label{extension} Given a $\kappa$-pre-quasigeodesic
$\gamma:[0,t_{\max})\to L$ we can extend it as a $\kappa$-pre-quasigeodesic
$\gamma:[0,\infty)\to L$ so that 
$$\mu_\gamma(\{t_{\max}\})=0.$$
\end{thm}
\parit{Proof.} 
Let us set $\gamma(t_{\max})$ to be the limit of $\gamma(t)$ as $t\to t_{\max}$
(it exists since $\kappa$-pre-quasigeodesics are Lipschitz).

From Milka's lemma~\ref{lem:milka}, we can construct a vector 
$\gamma^+(t_{\max})$ which is polar to $\gamma^-(t_{\max})$
and such that
$|\gamma^+(t_{\max})|=|\gamma^-(t_{\max})|$.
Then extend $\gamma$ by a $\kappa$-pre-quasigeodesic in the direction $\gamma^+(t_{\max})$. 
By \ref{ext-pqg}, we get
$$\mu_\gamma\{t_{\max}\}=\ln|\gamma^+(t_{\max})|-\ln|\gamma^-(t_{\max}
)|=0.$$\qeds

\begin{thm}{Milka's lemma}
\label{lem:milka}
For any unit vector $\xi\in \Sigma_p$ there is a polar unit vector $\xi^*$, i.e.
$\xi^*\in \Sigma_p$ such that 
$$\<\xi,v\>+\<\xi^*,v\>\ge 0$$
for any $v\in \T_p$.
\end{thm}

The proof is taken from \cite{milka:poly1}. That is the only instance where we use
existence of quasigeodesics in lower dimensional spaces.

\parit{Proof.} Since $\Sigma_p\in\CBB{m-1}1$, given
$\xi\in \Sigma_p$ we can construct a quasigeodesic $\gamma$ in $\Sigma_p$ which starts at $\xi$.
Set $\xi^*=\gamma(\pi)$;
the comparison inequality~\ref{thm:defs.of.k-convex.curve}(\ref{k-convex-angle})$'$ implies 
$$|\xi\,\eta|_{\Sigma_q}+|\eta\,\xi^*|_{\Sigma_q}
=
\mangle(\xi,\eta)+\mangle(\eta,\xi^*)\leq\pi\ \ \text{for all}\ \  \eta\in \Sigma_p,$$ 
which is
equivalent to the statement that $\xi$ and $\xi^*$ are polar in $\T_p$.\qeds



\begin{thm}{Chopping procedure}\label{chopping} Given a $\kappa$-pre-quasigeodesic
$\gamma:[0,\infty)\to L$, for any $t\ge 0$ and $\eps>0$ there is $\bar t>t$ such
that 
$$\mu_\gamma\l((t,\bar t)\r) <\eps[\theta+\bar t-t],\ \ \bar t-t<\eps,\ \ \theta<\eps,$$
where 
$$\vartheta=\vartheta(t,\bar t) =
\mangle\l(\gamma^+(t),\log{\gamma(t)}{\gamma(\bar t)}\r).$$
\end{thm}
%\begin{floatingfigure}[l]{80mm}
\begin{lpic}{pics/angle(0.2)}
\lbl[t]{8,8;$\gamma(t)$}
\lbl[t]{245,8;$\gamma(\bar t)$}
\lbl[l]{33,21;$\vartheta$}
\lbl[b]{130,55;$\gamma$}
\end{lpic}
%\end{floatingfigure} 

\parit{Proof.} For all sufficiently small $\tau>0$ we have $$\theta(t,t+\tau)<\eps$$
and from $\kappa$-convexity of $\gamma^t$ it follows that 
$$\mu\l((t,t+\tau/3)\r) <C\theta^2(t,t+\tau).$$
The following exercise completes the proof.\qeds

\begin{thm}{Exercise}
Let the functions $h,g:\RR_+\to \RR_+$ be such that $\lim_{s\to0} g(s)=0$ and for any sufficiently small
$s$, we have
$h(s/3)\le g^2(s),\ s\le g(s)$.
Show that for any $\varepsilon>0$ there is  $s>0$ such that
$$h(s)< 10 g^2(s)\ \hbox{and}\ g(s)\le\varepsilon.$$
\end{thm}

\noi{\bf Construction in the $\mathbf\delta$-strained case.}
From the extension procedure, it is sufficient to construct a quasigeodesic
$\gamma:[0,T)\to L$ with any given initial data $\gamma^+(0)=\xi\in \Sigma_p$ for some
positive $T=T(p)$. 

\parit{The plan:} Given $\eps>0$, we first construct a $\kappa$-pre-quasigeodesic
$$\gamma_\eps:[0,T)\to L,\ \ \  \gamma_\eps^+(0)=\xi$$ 
such that one can present $[0,T)$ as  a countable union of disjoint
half-open intervals
$[a_i,\bar a_i)$ with the following property ($\theta$ is defined in the chopping procedure~\ref{chopping}):
$$\mu\l([a_i,\bar a_i)\r) <\eps\theta(a_i,\bar a_i),\ \ \bar a_i-a_i<\eps,\ \
\theta(a_i,\bar a_i)<\eps.\eqno(\star)$$
Then we show that the entropies $\mu_{\gamma_\eps}([0,T))\to 0$ as $\eps\to0$
and passing to a partial limit of $\gamma_\eps$ as $\eps\to0$ we get a
quasigeodesic.

\parit{Existence of $\gamma_\eps$:} Assume that we already can construct
$\gamma_\eps$ on an interval $[0,t_{\max})$, $t_{\max}<T$ and cannot construct it
any further, then applying the extension procedure~\ref{extension} for
$\gamma_\eps:[0,t_{\max})\to L$ and then chopping it (\ref{chopping}) starting
from $t_{\max}$, we get a longer curve with the desired property.\contradiction

\parit{Vanishing entropy:} From $(\star)$ we have that 
$$\mu_{\gamma_\eps}([0,T))<\eps\l[T+\sum_i\theta(a_i,\bar a_i)\r].$$
Therefore, to show that $\mu_{\gamma_\eps}([0,T))\to 0$, it only remains to show
that $\sum_i\theta(a_i,\bar a_i)$ is bounded above by a constant independent
of $\eps$.

That will be the only instance, where we apply that  $p$ is $\delta$-strained for a small
enough $\delta$.

It is easy to see that there is $\eps=\eps(\delta)\to0$ as $\delta\to0$ and
$T=T(p)>0$ such that there is a finite collection of points $\{q_k\}$ which
satisfy the following property: for any $x\in \oBall(p,T)$ and $\xi\in \Sigma_x$ there is
$q_k$ such that
$\mangle (\xi,\dir x{q_k})<\eps$.
Moreover, we can assume $\dist_{q_k}$ is $\lambda$-concave in $\oBall(p,T)$ for some
$\lambda>0$.

Note that for any $\kappa$-convex curve $\gamma:[0,T)\to \oBall(p,T)\i L$, the measures
$\chi_k$ on $[0,T)$, defined by
$$\chi_k((a,b))=(\dist_{q_k}\circ\gamma)^-(b)-(\dist_{q_k}
\circ\gamma)^+(a)+\lambda(b-a),$$
are positive and their total mass is bounded by $\lambda T+2$ (this follows from the
fact that $\dist_{q_k}$ is $\lambda$-concave and $1$-Lipschitz).

Let $x\in \oBall(p,T)$, and $\delta$ be small enough. 
Then for any two directions
$\xi,\nu\in \Sigma_x$ there is $q_k$ which satisfies the following property:
$$\frac1{10}\mangle(\xi,\nu)\le \d_x\dist_{q_k}(\xi)-\d_x\dist_{q_k}(\nu)\ \ \
\text{and}\ \ \ \d_x\dist_{q_k}(\nu)\ge0. \eqno(*)$$
Substituting in this inequality $$\xi=\gamma^+(a_i)/|\gamma^+(a_i)|,\ \ \
\nu=\dir{\gamma(a_i)}{\gamma(\bar a_i)},$$ 
and applying lemma~\ref{lem:angle-d}, we get 
$$\theta(a_i,\bar a_i)=\mangle(\xi,\nu)\le 10\sum_n\chi_k([a_i,\bar a_i)).$$
Therefore 
$$\sum_i\theta(a_i,\bar a_i)\le 10N(\lambda T+2),$$
where $N$ is the number of points in the collection $\{q_k\}$.\qeds


\begin{thm}{Lemma} \label{lem:angle-d} Let $L\in\CBB m \kappa$, $\gamma:[0,t]\to L$ be a $\kappa$-convex curve $|\gamma^+(0)|=1$ and $f$ be a $\lambda$-concave function, $\lambda\ge0$.
Set $p=\gamma(0)$, $q=\gamma(t)$, \
$\xi=(\gamma)^+(0)$ and $\nu=\dir p q$. 
Then
$$\d_p f(\xi)-\d_p f(\nu)\le
(f\circ\gamma)^+(0)-(f\circ\gamma)^-(t)+\lambda t,$$ 
provided that $\d_p f(\nu)\ge 0$.
\end{thm}

%\begin{floatingfigure}[l]{80mm}
\begin{lpic}{pics/a35(0.4)}
\lbl[tr]{0,0;$p$}
\lbl[t]{121,-1;$q$}
\lbl[rb]{21,16;$\xi$}
\lbl[t]{25,-1;$\nu$}
\lbl[b]{70,22;$\gamma$}
\end{lpic}
%\end{floatingfigure} 

\parit{Proof.} Clearly, 
$$f(q)\leq f(p)+\d_p f(\nu)|p q|+\lambda|p q|^2/2\le
f(p)+\d_p f(\nu)t+\lambda t^2/2.$$ 
On the other hand, 
$$f(p)\le f(q)-(f\circ\gamma)^-(t)t+\lambda t^2/2.$$ 
Clearly, $\d_p f(\xi)= (f\circ\gamma)^+(0)$, whence the result.
\qeds










\section{Existance of quasigeodesics\\ at singular points}\label{step3-2}


Instead we generalize inequality $(*)$.


\begin{thm}{\boldmath The ${(*)}$ inequality} \label{inq:di-inq}
Let $L\in\CBB m \kappa$ and $\mathfrak C\i L$ be a closed subset.
Let $p\in \mathfrak C$ be a point with  $\delta$-maximal $\vol_{m-1} \Sigma_p$, i.e.
$$\delta+\vol_{m-1} \Sigma_p>\inf_{x\in\mathfrak C} \vol_{m-1} \Sigma_p.$$ 
Then, if $\delta$ is small enough, there is a finite set of points $\{q_i\}$ and
$\eps>0$, such that for any $x\in\mathfrak C\cap \cBall(p,\eps)$ and any pair of directions $\xi\in \Sigma_x\mathfrak C$\footnote{$\Sigma_x\mathfrak C$ is defined on page~\pageref{U_pX}.} and $\nu\in
\Sigma_x$
$$\frac{1}{10}\mangle_x(\xi,\nu)\le \d_x\dist_{q_i}(\xi)-\d_x\dist_{q_i}(\nu)\ \ \
\text{and}\ \ \ \d_x\dist_{q_i}(\nu)\ge0.$$
holds for one of $q_i$. 
\end{thm}

\parit{Proof.} We can choose $\eps>0$ so small that for any $x\in \cBall(p,\eps)$, 
$\Sigma_x$ is almost bigger than $\Sigma_p$.
I.e. for small $\delta>0$ there is a map $f:\Sigma_p\to \Sigma_x$ such that $|f(x)f(y)|>|x y|-\delta$. 

Since $\vol_{m-1} \Sigma_p$ is almost maximal we get that for any 
$x\in  \mathfrak C\cap \cBall(p,\eps)$, $\Sigma_x$ is almost isometric to $\Sigma_p$.
In particular, if one takes a set $\{q_i\}$ so that directions $\dir p {q_i}$
form a sufficiently dense set in $\Sigma_p$ and 
$\mangle\hinge p{q_i}{q_j}\approx\angk\kappa p{q_i}{q_j}$, 
then directions $\dir x{q_i}$ will form a sufficiently dense set in
$\Sigma_x$ for all $x\in\mathfrak C\cap \cBall(p,\eps)$.

Note that for any $x\in  \mathfrak C\cap \cBall(p,\eps)$ and $\xi\in
\Sigma_x\mathfrak C$,  there is an almost isometry $\Sigma_x\to \SS(\Sigma_\xi \Sigma_x)$ such
that $\xi$ goes%
\footnote{Otherwise, taking a point $y\in \mathfrak C$, close to $x$ in direction
$\xi$ we would get that $\vol_{m-1}\Sigma_y$ is essentially bigger than
$\vol_{m-1}\Sigma_x$, which is impossible since both are almost equal to
$\vol_{m-1}\Sigma_p$.} 
to north pole of the spherical suspension 
$\SS(\Sigma_\xi \Sigma_x)\iso\Sigma_\xi\T_x$.

Using these two properties, we can find $q_i$ so that 
$\dir\xi\nu\approx\dir \xi{\dir x{q_i}}$ in $\Sigma_\nu \Sigma_x$ and
$\mangle(\xi,\dir x{q_i})>\tfrac\pi2$, hence the statement follows.\qeds



Now we are ready to finish construction in the general case. 
Let us define a subtype
of $\kappa$-pre-quasigeodesics:

\begin{thm}{Definition}
Let $L\in \CBB m \kappa$ and $\Omega\i L$ be an open subset. 
A $\kappa$-pre-quasigeodesic $\gamma:[0,T)\to L$ is called $\Omega$-quasigeodesic if  its
entropy vanishes on $\Omega$, i.e. 
$$\mu_\gamma(\gamma^{-1}(\Omega))=0.$$

\end{thm}

From property~\ref{lim-entropy} on page~\pageref{lim-entropy}, it follows that
the limit of $\Omega$-quasigeodesics is a $\Omega$-quasigeodesic. 
Moreover, if for any initial data we can construct an
$\Omega$-quasigeodesic and an $\Omega'$-quasigeodesic, then it is possible to construct an
$\Omega\cup \Omega'$-quasigeodesic for any initial data; for $\Upsilon\Subset\Omega\cup \Omega'$, $\Upsilon$-quasigeodesic can be constructed by joining together
pieces of $\Omega$ and $\Omega'$-quasigeodesics and $\Omega\cup \Omega'$-quasigeodesic can be constructed as a limit of $\Upsilon_n$-quasigeodesics as $\Upsilon_n\to \Omega\cup \Omega'$.

Let us denote by $\Omega$ the maximal open set such that for any initial data
one can construct an $\Omega$-quasigeodesic. 
We have to show then that $\Omega=L$. 

Let $\mathfrak C=L\backslash \Omega$, and let $p\in \mathfrak C$ be the point
with almost maximal $\vol_{m-1} \Sigma_p$. 
We will arrive to a contradiction by constructing  a $\oBall(p,\eps)\cup\Omega$-quasigeodesic for any initial data. 

Choose a finite set of points $q_i$ as in \ref{inq:di-inq}.
Given $\eps>0$, it is enough to construct an $\Omega$-quasigeodesic
$\gamma_\eps:[0,T)\to L$, for some fixed $T>0$ with the given initial data $x\in
\cBall(p,\eps)$, $\xi\in \Sigma_x$, such that the entropies
$\mu_{\gamma_\eps}((0,T))\to 0$ as $\eps\to0$.
 
The $\Omega$-quasigeodesic $\gamma_\eps$ which we are going to construct will
have the following property: one can present $[0,T)$ as a countable union of disjoint
half-open intervals $[a_i,\bar a_i)$ such that 
$$\text{if}\ \ \
\frac{\gamma^+(a_i)}{|\gamma^+(a_i)|}\in \Sigma_{\gamma(a_i)}\mathfrak C \ \ \
\text{then}\ \ \   \mu_\gamma[a_i,\bar a_i)\le \eps\theta(a_i,\bar a_i)$$ 
and
$$\text{if}\ \ \ \frac{\gamma^+(a_i)}{|\gamma^+(a_i)|}\not\in
\Sigma_{\gamma(a_i)}\mathfrak C\ \ \ \text{then}\ \ \ \mu_\gamma[a_i,\bar a_i)=0$$

Existence of $\gamma_\eps$ is being proved the same way as in the $\delta$-strained case,
with the use of one additional observation:
if $$\frac{\gamma^+(t_{\max})}{|\gamma^+(t_{\max})|}\not\in
\Sigma_{\gamma(a_i)}\mathfrak C$$ then any $\Omega$-quasigeodesic in this direction
has zero entropy for a short time.

Then, just as in the $\delta$-strained case, applying
inequality~\ref{inq:di-inq} we get that $\mu_{\gamma_{\eps}}(0,T)\to0$ as
$\eps\to 0$. 
Therefore, passing to a partial limit $\gamma_\eps\to\gamma$ gives a
$\oBall(p,\eps)\cup\Omega$-quasigeodesic $\gamma:[0,T)\to L$ for any initial data in
$\oBall(p,\eps)$.\qeds












\begin{thm}{Claim}
Let $\Omega_1, \Omega_2\i L$ be two open subsets.
Assume for any initial data $x\in L$ and $\xi\in\Sigma_x$, there is an $\Omega_1$-pre-quasigeodesic $\gamma_1$ and $\Omega_2$-pre-quasigeodesic $\gamma_2$ with
$\gamma_1(0)=\gamma_2(0)=x$ and $\gamma_1^+(0)=\gamma_2^+(0)=\xi$.

Then for any initial data $x\in L$ and $\xi\in\Sigma_x$ there is an $\Omega_1\cup\Omega_2$-pre-quasigeodesic $\gamma$ with
$\gamma(0)=x$ and $\gamma^+(0)=\xi$.
\end{thm}

\parit{Proof.}
Let $\Upsilon\Subset\Omega_1\cup \Omega_2$ be an open subset;
i.e. closure of $\Upsilon$ lies in $\Omega_1\cup \Omega_2$.
Then, for any initial data $x\in L$ and $\xi\in\Sigma_x$,
one can construct an $\Upsilon$-pre-quasigeodesic by joining together
pieces of $\Omega_1$ and $\Omega_2$-quasigeodesics.
Namely, for any initial data $x$???
 and $\Omega\cup \Omega'$-quasigeodesic can be constructed as a limit of $\Upsilon_n$-quasigeodesics as $\Upsilon_n\to \Omega\cup \Omega'$.

Thus, there is maximal open set $\Omega$ such that for any initial data
one can construct an $\Omega$-quasigeodesic. 
We have to show then that $\Omega=L$. 

Let us first prepare some auxiliary statements.





















Since $\beta_\xi$ is $\kappa$-convex, its right tangent vector is well defined??? and
$|\beta^+_\xi(0)|\le 1$.
On the other hand, since $\beta_{\xi,\eps}$ are $\kappa$-monotonic with respect to $0$.
Thus, according to ???, for any $p\in L^\bullet (x)$,
we have 
\begin{align*}
-\<\beta^+_\xi(0),\dir x{p}\>
&=
d_x\dist_p(\beta^+_{\xi}(0))
=
\\
&=
(\dist_p\circ\beta_{\xi})^+(0)
\le
\\
&\le???
\limsup_{\eps\to0+}(\dist_p\circ\beta_{\xi,\eps})^+(0)
=
\\
&=
d_x \dist_p(\xi).
\end{align*}
Choosing $p$, such that $\mangle(\dir xp,\xi)<\eps$ we get 
$\<\beta^+_\xi(0),\dir x{p}\>  >
 1-\eps$.
Thus, $\<\beta^+_\xi(0),\xi\>\ge 1$. 
Therefore, $|\beta^+_\xi(0)|\le 1$ implies that $\beta^+(0)=\xi$.







Instead we generalize inequality $(*)$.



Now we are ready to finish construction in the general case. 
Let us define a subtype
of pre-quasigeodesics:

\begin{thm}{Definition}
Let $L\in \CBB m \kappa$ and $\Omega\i L$ be an open subset. 
A pre-quasigeodesic $\gamma:[0,T)\to L$ is called $\Omega$-quasigeodesic if  its
entropy vanishes on $\Omega$, i.e. 
$$\mu_\gamma(\gamma^{-1}(\Omega))=0.$$

\end{thm}

From property~\ref{lim-entropy} on page~\pageref{lim-entropy}, it follows that
the limit of $\Omega$-quasigeodesics is a $\Omega$-quasigeodesic. 
Moreover, if for any initial data we can construct an
$\Omega$-quasigeodesic and an $\Omega'$-quasigeodesic, then it is possible to construct an
$\Omega\cup \Omega'$-quasigeodesic for any initial data; for $\Upsilon\Subset\Omega\cup \Omega'$, $\Upsilon$-quasigeodesic can be constructed by joining together
pieces of $\Omega$ and $\Omega'$-quasigeodesics and $\Omega\cup \Omega'$-quasigeodesic can be constructed as a limit of $\Upsilon_n$-quasigeodesics as $\Upsilon_n\to \Omega\cup \Omega'$.

Let us denote by $\Omega$ the maximal open set such that for any initial data
one can construct an $\Omega$-quasigeodesic. 
We have to show then that $\Omega=L$. 























Let $\mathfrak C=L\backslash \Omega$, and let $p\in \mathfrak C$ be the point
with almost maximal $\vol_{m-1} \Sigma_p$. 
We will arrive to a contradiction by constructing  a $\oBall(p,\eps)\cup\Omega$-quasigeodesic for any initial data. 

Choose a finite set of points $q_i$ as in \ref{inq:di-inq}.
Given $\eps>0$, it is enough to construct an $\Omega$-quasigeodesic
$\gamma_\eps:[0,r)\to L$, for some fixed $r>0$ with the given initial data $x\in
\cBall(p,\eps)$, $\xi\in \Sigma_x$, such that the entropies
$\mu_{\gamma_\eps}((0,r))\to 0$ as $\eps\to0$.
 
The $\Omega$-quasigeodesic $\gamma_\eps$ which we are going to construct will
have the following property: one can present $[0,r)$ as a countable union of disjoint
half-open intervals $[a_i,\bar a_i)$ such that 
$$\text{if}\ \ \
\frac{\gamma^+(a_i)}{|\gamma^+(a_i)|}\in \Sigma_{\gamma(a_i)}\mathfrak C \ \ \
\text{then}\ \ \   \mu_\gamma[a_i,\bar a_i)\le \eps\theta(a_i,\bar a_i)$$ 
and
$$\text{if}\ \ \ \frac{\gamma^+(a_i)}{|\gamma^+(a_i)|}\not\in
\Sigma_{\gamma(a_i)}\mathfrak C\ \ \ \text{then}\ \ \ \mu_\gamma[a_i,\bar a_i)=0$$

Existence of $\gamma_\eps$ is being proved the same way as in the $\delta$-strained case,
with the use of one additional observation:
if $$\frac{\gamma^+(t_{\max})}{|\gamma^+(t_{\max})|}\not\in
\Sigma_{\gamma(a_i)}\mathfrak C$$ then any $\Omega$-quasigeodesic in this direction
has zero entropy for a short time.

Then, just as in the $\delta$-strained case, applying
inequality~\ref{inq:di-inq} we get that $\mu_{\gamma_{\eps}}(0,r)\to0$ as
$\eps\to 0$. 
Therefore, passing to a partial limit $\gamma_\eps\to\gamma$ gives a
$\oBall(p,\eps)\cup\Omega$-quasigeodesic $\gamma:[0,r)\to L$ for any initial data in
$\oBall(p,\eps)$.\qeds

















$L$, we define its right and left tangent vector at $t_0$, $\alpha^\pm(t_0)$\index{${*}^+$} the following way:
$$???\alpha^\pm(t_0)
=
\lim_{t\to t_0\pm}\frac{\log{\alpha(t_0)}{\alpha(t)}}{|t-t_0|},
\ \ 
\alpha^\pm(t)\in \T_{\alpha(t)}.$$
In particular, $\dir pq=\geod_{[pq]}^+(0)$ and $\dir qp=\geod_{[pq]}^-(|pq|)$.























There is a point $p\in \mathfrak C$ and $r>0$ such that 
$$\Sigma_p+\delta>\Sigma_x\ \ \t{for any}\ \ x\in\cBall(p,2r)\cap \mathfrak C\eqno(*)$$ 
Indeed, according to ???, for any $p\in L$ there is $r>0$ such that $\Sigma_x+\delta>\Sigma_p$ for any $x\in\cBall(p,2r)$.
Thus if $(*)$ is not satisfied for any $r>0$ and $p\in \mathfrak C$, we can find a sequence of points $p_n\in \mathfrak C$ such that $|p_np_{n+1}|\le $



























Let show first that for any $\delta>0$ there is a $r>0$ and a point $p\in \mathfrak C$ such that for any $x\in\cBall(p,2r)\cap \mathfrak C$,
$\T_x$ is $\delta$-spliting in any direction $\xi\in\Sigma_x\mathfrak C$.

Take $p\in\mathfrak C$ to be a point with almost maximal  


...

Set $N=\pack_\delta\Sigma_p$;
choose a collection of $N$ points $Q=\{q_1,q_2,\dots,q_N\}$ such that $\angk\kappa p{q_i}{q_j}>\delta$ for all $i\not=j$.
Passing to a smaller value of $r$ if nesessury,
we can assume that for any point $x\in\cBall(p,2r)\cap\mathfrak C$, 
we still have $\angk\kappa x {q_i} {q_j}>\delta$.
Thus, for any choice of directions $\zeta_i\in \Dir_x^{q_i}$ we have $\mangle(\zeta_i,\zeta_j)>\delta$.
Moreover since $\pack_\delta\Sigma_x\le N$ the collection $\{\zeta_i\}_{i=1}^N$ forms a $\delta$-net in $\Sigma_x$.
In particular, $\diam\Dir_x^{q_i}<\delta$.




Choose $p\in\mathfrak C$ such that $\pack_\delta\Sigma_p$ takes the maximal possible value in $\mathfrak C$. 
Set $N=\pack_\delta\Sigma_p$,
choose a collection of $N$ points $Q=\{q_1,q_2,\dots,q_N\}$ such that $\angk\kappa p{q_i}{q_j}>\delta$ for all $i\not=j$.
One can choose $r>0$ so small that for any point $x\in\cBall(p,2r)\cap\mathfrak C$, 
we still have $\angk\kappa x {q_i} {q_j}>\delta$.
Thus, for any choice of directions $\zeta_i\in \Dir_x^{q_i}$ we have $\mangle(\zeta_i,\zeta_j)>\delta$.
Moreover since $\pack_\delta\Sigma_x\le N$ the collection $\{\zeta_i\}_{i=1}^N$ forms a $\delta$-net in $\Sigma_x$.
In particular, $\diam\Dir_x^{q_i}<\delta$.

It follows that for any direction $\bar\nu\in \Sigma_x$  there is a point $q_i$ from $Q$ such that $\Dir_x^{q_i}\i \cBall(\bar\nu,2\delta)$, where $\bar\nu$ as above.

\ 


First let us show that for any $\xi\in \Sigma_x\mathfrak C$ 
and $\nu\in\Sigma_x$ there is $\zeta\in \Sigma_x$ such that 
$$
(1-\eps)\mangle(\xi,\nu)
\le \mangle(\xi,\zeta)-\mangle(\nu,\zeta)\ \ \
\text{and}\ \ \ \mangle(\nu,\zeta)\ge\tfrac\pi2.$$

Sinse $\xi\in\Sigma_p\mathfrak C\i \T_p$, there is a sequence of points $x_n\in \mathfrak C$ such that for some real sequence $\lam_n\to\infty$, we get $\lam_n*x_n\to \xi$, as $\lam_n*L\GHtoh{}\T_p$.
According to Gromov's compactness theorem,
without loss of generality, 
we can assume that $\Sigma_{x_n}\GHto \Sigma$.
Applying ???, we get $\Sigma\ge \Sigma_\xi\T_x$.

Clearly $\Sigma_\xi\T_p\iso\SS(\Sigma_\xi\Sigma_x)=\Cone_1\Sigma_\xi\Sigma_x$.


We can choose $ r>0$ so small that for any $x\in \cBall(p, r)$, 
$\Sigma_x$ is almost bigger than $\Sigma_p$.
I.e. for small $\delta>0$ there is a map $f:\Sigma_p\to \Sigma_x$ such that $|f(x)f(y)|>|x y|-\delta$. 

Since $\vol_{m-1} \Sigma_p$ is almost maximal we get that for any 
$x\in  \mathfrak C\cap \cBall(p, r)$, $\Sigma_x$ is almost isometric to $\Sigma_p$.
In particular, if one takes a set $\{q_i\}$ so that directions $\dir p {q_i}$
form a sufficiently dense set in $\Sigma_p$ and 
$\mangle\hinge p{q_i}{q_j}\approx\angk\kappa p{q_i}{q_j}$, 
then directions $\dir x{q_i}$ will form a sufficiently dense set in
$\Sigma_x$ for all $x\in\mathfrak C\cap \cBall(p, r)$.

Note that for any $x\in  \mathfrak C\cap \cBall(p, r)$ and $\xi\in
\Sigma_x\mathfrak C$,  there is an almost isometry $\Sigma_x\to \SS(\Sigma_\xi \Sigma_x)$ such
that $\xi$ goes%
\footnote{Otherwise, taking a point $y\in \mathfrak C$, close to $x$ in direction
$\xi$ we would get that $\vol_{m-1}\Sigma_y$ is essentially bigger than
$\vol_{m-1}\Sigma_x$, which is impossible since both are almost equal to
$\vol_{m-1}\Sigma_p$.} 
to north pole of the spherical suspension 
$\SS(\Sigma_\xi \Sigma_x)\iso\Sigma_\xi\T_x$.

Using these two properties, we can find $q_i$ so that 
$\dir\xi\nu\approx\dir \xi{\dir x{q_i}}$ in $\Sigma_\nu \Sigma_x$ and
$\mangle(\xi,\dir x{q_i})>\tfrac\pi2$, hence the statement follows.

Note that 
$\Sigma_\xi\T_x\iso\SS(\Sigma_\xi\Sigma_x)$.
Further, as $\lam*L\GHtoh{???}\T_x$,
the point $\xi\in \T_x$ can be obtainted as a limit of a sequence $\lam_n*x_n$ for $x_n\in\mathfrak C$.
Passing to a subsequence, we can assume that $\Sigma_{x_n}\GHtoh{} \Sigma$ and applying ??? we get $\Sigma\ge \Sigma_\xi\T_x$.
Thus $\pack_\delta\Sigma_\xi\T_x\le N_p$

For each $q\in Q$, 
choose $\dot q=\dir xq$ 
and $\ddot q=\dir \xi {\dot q}\in \Sigma_\xi\Sigma_x$

\qeds


\begin{thm}{Lemma}
Let $L\in\CBB m \kappa$ and $\mathfrak C\i L$ be a closed subset.
Let $p\in \mathfrak C$ be a point with  $\delta$-maximal $\vol_{m-1} \Sigma_p$, i.e.
$$\delta+\vol_{m-1} \Sigma_p>\inf_{x\in\mathfrak C} \vol_{m-1} \Sigma_p.$$ 
Then, if $\delta$ is small enough, there is a finite set of points $\{q_i\}$ and
$ r>0$, such that for any $x\in\mathfrak C\cap \cBall(p, r)$ and any pair of directions $\xi\in \Sigma_x\mathfrak C$\footnote{$\Sigma_x\mathfrak C$ is defined on page~\pageref{U_pX}.} and $\nu\in
\Sigma_x$
$$\frac{1}{10}\mangle_x(\xi,\nu)\le \d_x\dist_{q_i}(\xi)-\d_x\dist_{q_i}(\nu)\ \ \
\text{and}\ \ \ \d_x\dist_{q_i}(\nu)\ge0.$$
holds for one of $q_i$. 
\end{thm}

\parit{Proof.} We can choose $ r>0$ so small that for any $x\in \cBall(p, r)$, 
$\Sigma_x$ is almost bigger than $\Sigma_p$.
I.e. for small $\delta>0$ there is a map $f:\Sigma_p\to \Sigma_x$ such that $|f(x)f(y)|>|x y|-\delta$. 

Since $\vol_{m-1} \Sigma_p$ is almost maximal we get that for any 
$x\in  \mathfrak C\cap \cBall(p, r)$, $\Sigma_x$ is almost isometric to $\Sigma_p$.
In particular, if one takes a set $\{q_i\}$ so that directions $\dir p {q_i}$
form a sufficiently dense set in $\Sigma_p$ and 
$\mangle\hinge p{q_i}{q_j}\approx\angk\kappa p{q_i}{q_j}$, 
then directions $\dir x{q_i}$ will form a sufficiently dense set in
$\Sigma_x$ for all $x\in\mathfrak C\cap \cBall(p, r)$.

Note that for any $x\in  \mathfrak C\cap \cBall(p, r)$ and $\xi\in
\Sigma_x\mathfrak C$,  there is an almost isometry $\Sigma_x\to \SS(\Sigma_\xi \Sigma_x)$ such
that $\xi$ goes%
\footnote{Otherwise, taking a point $y\in \mathfrak C$, close to $x$ in direction
$\xi$ we would get that $\vol_{m-1}\Sigma_y$ is essentially bigger than
$\vol_{m-1}\Sigma_x$, which is impossible since both are almost equal to
$\vol_{m-1}\Sigma_p$.} 
to north pole of the spherical suspension 
$\SS(\Sigma_\xi \Sigma_x)\iso\Sigma_\xi\T_x$.

Using these two properties, we can find $q_i$ so that 
$\dir\xi\nu\approx\dir \xi{\dir x{q_i}}$ in $\Sigma_\nu \Sigma_x$ and
$\mangle(\xi,\dir x{q_i})>\tfrac\pi2$, hence the statement follows.






















.

Note that from ???,
for any $\delta>0$ there is $\delta'=\delta'(\delta)>0$ such that
$$\vol\Sigma_x+\delta'>\vol\Sigma_\xi\T_x$$
implies that $\T_x$ splits in direction $\xi$.

Take $p$ in $\mathfrak C$ with almost maximal volume of space of directions ---
say, if $s=\sup_{x\in \mathfrak C}\vol\Sigma_x$ then
$\vol\Sigma_p>s-\tfrac{\delta'}2$.

From \ref{cor:simicont-Sigma},
there is $r>0$ such that 
$\vol\Sigma_x\ge s-\delta'$ for any $x\in\oBall(p,2r)$.
Thus, for arbitrary $x\in\mathfrak C\cap \oBall(p,r)$, we have $s-\delta'<\vol\Sigma_x\le s$.
Thus, from the second part of \ref{cor:simicont-Sigma}, 
for any $\xi\in\Sigma_x\mathfrak C$ we have
$\vol \Sigma_\xi\T_x\le s$.

Therefore for any $x\in\mathfrak C\cap \oBall(p,r)$
\begin{enumerate}[(i)]
\item $|\Sigma_p-\Sigma_x|<\delta$ and
\item $\T_x$ is $\delta$-spliting in any direction $\xi\in\Sigma_x\mathfrak C$.
\end{enumerate}
























Note that for any $\kappa$-convex curve $\gamma:[0,r)\to \oBall(p,r)\i L$, the measures
$\chi_k$ on $[0,r)$, defined by
$$\chi_k(a,b)=(\dist_{q_k}\circ\gamma)^-(b)-(\dist_{q_k}
\circ\gamma)^+(a)+\lambda(b-a),$$
are positive and their total mass is bounded by $\lambda r+2$ (this follows from the
fact that $\dist_{q_k}$ is $\lambda$-concave and $1$-Lipschitz).

Let $x\in \oBall(p,r)$, and $\delta$ be small enough. 
Then for any two directions
$\xi,\nu\in \Sigma_x$ there is $q_k$ which satisfies the following property:
$$\frac1{10}\mangle(\xi,\nu)\le \d_x\dist_{q_k}(\xi)-\d_x\dist_{q_k}(\nu)\ \ \
\text{and}\ \ \ \d_x\dist_{q_k}(\nu)\ge0. \eqno(*)$$
Substituting in this inequality $$\xi=\gamma^+(a_i)/|\gamma^+(a_i)|,\ \ \
\nu=\dir{\gamma(a_i)}{\gamma(\bar a_i)},$$ 
and applying lemma~\ref{lem:angle-d}, we get 
$$\theta(a_i,\bar a_i)=\mangle(\xi,\nu)\le 10\sum_n\chi_k([a_i,\bar a_i)).$$
Therefore 
$$\sum_i\theta(a_i,\bar a_i)\le 10N(\lambda r+2),$$
where $N$ is the number of points in the collection $\{q_k\}$.














\begin{thm}{Claim}
For any $x\in L$ there is $\tau_x>0$ such that for any $\xi\in \Sigma_x$ there is a $\oBall(p,r)\cup\Omega$-pre-quasigeodesic $\gamma:[0,\tau_x)\to L$ with $\gamma^+(0)=\xi$.
\end{thm}

We will  construct an $\Omega\cap\oBall(p,r)$-pre-quasigeodesic for any initial data.
This contradicts maximality of $\Omega$. 

Note that it is sufficient to construct a quasigeodesic $\gamma:[0, r)\to L$ with  $\gamma^+(0)=\xi$ for any $x\in\oBall(p,r)\cap\mathfrak C$ and $\xi\in \Sigma_x$. 
Indeed, it would imply that for any $x\in L$ there is $\tau_x>0$ such that for any $\xi\in \Sigma_x$ there is a $\oBall(p,r)\cup\Omega$-pre-quasigeodesic $\gamma:[0,\tau_x)\to L$ with $\gamma^+(0)=\xi$.
Then we can join these pices into an infinite $\oBall(p,r)\cup\Omega$-pre-quasigeodesic (the same argument as on page \pageref{transfinite-extension-page}).




















The next is a construction similar to \ref{ext-mono};
it gives a new $\kappa$-convex
curve out of two. 
It will be used in the next section to construct \emph{pre-quasigeodesics}.

???UNITE WITH \ref{ext-mono}???

\begin{thm}{Convex extention}\label{ext-conv}
Let $\kappa\le 0$, $L\in\CBB m \kappa$, $\beta_1:[a,\infty)\to L$ and $\beta_2:[b,\infty)\to L$ be two
$\kappa$-convex curves. 
Assume $$a\le b,\ \ \beta_1(b)=\beta_2(b)\ \ \text{and}\ \ 
\beta^+_1(b)=\beta^+_2(b)$$ 
then its joint
$$\gamma:[a,\infty)\to L,\ \ \gamma(t)=\l[
\begin{matrix}
\beta_1(t)&\text{if}&t\le b\\
\beta_2(t)&\text{if}&t\ge b
\end{matrix}\right.$$
is a $\kappa$-convex curve.
\end{thm}

\parit{Proof.} Follows immidetely from \ref{ext-mono} and \ref{thm:defs.of.k-convex.curve}(\ref{k-convex-mono}).










For $z\in L$ and $\zeta\in\Sigma_z$,
we will say that $\T_z$ is \emph{$\eps$-splitting} 
in direction $\zeta\in\Sigma_z$
if $d_{GH}(\Sigma_z,\Sigma_\zeta\T_z)<\eps$.
Note that if $\eps$ is sufficiently small...



















\begin{thm}{Lemma} \label{lem:angle-d} Let $L\in\CBB m \kappa$, $\gamma:[0,t]\to L$ be a $\kappa$-convex curve $|\gamma^+(0)|=1$ and $f$ be a $\lambda$-concave function, $\lambda\ge0$.
Set $p=\gamma(0)$, $q=\gamma(t)$, \
$\xi=\gamma^+(0)$ and $\nu=\dir p q$. 
Then
$$\d_p f(\xi)-\d_p f(\nu)\le
(f\circ\gamma)^+(0)-(f\circ\gamma)^-(t)+\lambda t,$$ 
provided that $\d_p f(\nu)\ge 0$.
\end{thm}

%\begin{floatingfigure}[l]{80mm}
\begin{lpic}{pics/a35(0.4)}
\lbl[tr]{0,0;$p$}
\lbl[t]{121,-1;$q$}
\lbl[rb]{21,16;$\xi$}
\lbl[t]{25,-1;$\nu$}
\lbl[b]{70,22;$\gamma$}
\end{lpic}
%\end{floatingfigure} 














Note that form \ref{lim-entropy}, it follows that limit of $\Omega$-pre-quasigeodesics is a $\Omega$-pre-quasigeodesic;
more precicely:

\begin{thm}{Limit procedure}
Let $\Omega\i L$ be an open subset.
Let $\gamma_n\:[0,T)\to L$ be a sequnce of $\Omega$-pre-quasigeodesics.
Assume $\gamma_n(t)\to\gamma(t)$ for each $t\in [0,T)$, 
then $\gamma$ is an $\Omega$-pre-quasigeodesic.
\end{thm}













Let $\II$ be a real interval,
$L\in\CBB{}{}$ 
and $\alpha:\II\to L$ be a curve.
We say that $v\in\T_{\alpha(t_0)}$ is a rigth tangent vector of $\alpha$ at $t_0\in\II$ (for shortness $v=\alpha^+(t_0)$)
if 
$$|v|=\lim_{t\to t_0+}\frac{|\alpha(t_0)\alpha(t)|}{|t_0-t|}$$
and, if $v\not=o$,
$$\lim_{t\to t_0+}\dotang(v,\gamma(t))=0.$$
Analogousely, we define left tangent vector:
$v=\alpha^-(t_0)$
iff
$|v|=\lim_{t\to t_0-}\frac{|\alpha(t_0)\alpha(t)|}{|t_0-t|}$
and, if $v\not=o$,
$\lim_{t\to t_0-}\dotang(v,\gamma(t))=0$.











$$-\<v,x\>=\lim_{t\to t_0\pm}\tfrac1{2|t_0-t|}d_{\alpha(t_0)}\dist_{\alpha(t)}^2.$$



















\begin{thm}{Corollary}\label{extension} Given an $\Omega$-pre-quasigeodesic
$\gamma:[0,t_{\max})\to L$ we can extend it as a $\Omega$-pre-quasigeodesic
$\gamma:[0,\infty)\to L$ so that $\mu_\gamma\{t_{\max}\}=0$.
\end{thm}

\parit{Proof.} 
Let us set $\gamma(t_{\max})$ to be the limit of $\gamma(t)$ as $t\to t_{\max}$
(it exists since pre-quasigeodesics are Lipschitz).

From Milka's lemma~\ref{lem:milka}, we can construct a vector 
$v^*$ which is polar to $\gamma^-(t_{\max})$
and such that
$|v^*|=|\gamma^-(t_{\max})|$.
Then extend $\gamma$ by an $\Omega$-pre-quasigeodesic $\gamma_1\:[t_{\max},\infty)\to L$ such that $\gamma_1^+(t_{\max})=v^*$. 
By \ref{ext-pqg}, we get
$$\mu_\gamma\{t_{\max}\}=\ln|\gamma^+(t_{\max})|-\ln|\gamma^-(t_{\max}
)|=0.$$\qedsf














\begin{thm}{Proposition}\label{zero-entropy}
Let $\kappa\le 0$, $L\in\CBB m\kappa$ 
a pre-quasigeodesic $\gamma$ in $L$ is a quasigeodesic if and only if its entropy vanish.

Clearly, any $L$-pre-quasigeodesic in $L$ is a quasigeodesic.
\end{thm}


















\begin{align*}
 \mangle(\xi_i,\nu_i)
&<2\l[\mangle(\dir{x_i}q,\xi_i)-\mangle(\dir{x_i}q,\nu_i)\r]<
\\
&<10\cdot[\cos\mangle(\dir{x_i}q,\nu_i)-\cos\mangle(\dir{x_i}q,\xi_i)]
<
\\
&<10\cdot[\cos\tangle_\kappa(\gamma|_{a_i}^{b_i},q)+\tfrac1{|\gamma^-(a)|}\<\dir{x_i}q,\gamma^-(a)\>]
\le
\\
&\le
10\cdot[\cos\tangle_\kappa(\gamma|_{a_i}^{b_i},q)+\tfrac1{|\gamma^-(a)|}\<\dir{x_i}q,\gamma^-(a)\>]
\end{align*}


\begin{align*}
 \mangle(\xi_i,\nu_i)
&<
10\cdot\l[\d_{x_i}\dist_q(\nu_i)-\d_{x_i}\dist_q(\xi_i)\r]
\le
\\
&\le 
\tfrac{10}{|\gamma^+(a_i)|}
[f_q^+(a_i)-f_q^-(b_i)+\lambda(b_i-a_i)]\le
\\
&\le 
20\cdot
[f_q^+(a_i)-f_q^-(b_i)+\lambda(b_i-a_i)],
\end{align*}
where $f_q=\dist_q\circ\gamma(t)$;
the seond inequality follows from \ref{lem:angle-d} and the third sinse??? $|\gamma(a_i)|>\tfrac12$.
Clearly,
$$\chi_q(a,b)=f_q^-(b)-f_q^+(a)+\lambda(b-a)$$
defines a non-negatvie positive measure $\chi_q$ on interval $(0,\tfrac r2)$.
Since $f_q$ is $1$-Lipschitz, we get $\chi_q(0,\tfrac r2)\le 2+\lambda r$.
Thus,
$$\sum\mangle(\xi_i,\nu_i)\le 20\sum_{q\in Q}\chi_q(0,\tfrac r2)\le 20N(2+\lambda r),$$














\begin{wrapfigure}{r}{45mm}
\begin{lpic}[t(3mm),b(3mm),r(0mm),l(0mm)]{pics/rotation(0.3)}
\lbl[rb]{21,13;$\gamma(t)$}
\lbl[rt]{122,10;$\gamma(\bar t)$}
\lbl[lb]{40,15;$\vartheta$}
\end{lpic}
\end{wrapfigure}

\label{def:deflection}
Let $L\in\CBB{m}\kappa$, $\II$ be a closed real interval and 
$\gamma:\II\to L$ be a pre-quasigeodesic.
The \emph{deflection angle}\index{deflection angle} $\theta$ of subintrval $(\,t,\bar t\,)\i\II$ is defined as
$$\theta(t,\bar t)\df\mangle(\gamma^+(t),\dir{\gamma(t)}{\,\gamma(\bar t)}).$$

Similarly, for $q\in L\backslash\gamma$,  
\emph{deflection angle to point}\index{deflection angle to point} $q$ of subintrval $(\,t,\bar t\,)\i\II$ is defined as
$$\theta_q(t,\bar t)
\df
\max\{0,
\mangle(\gamma^+(t),\dir{\gamma(t)}q)
-
\mangle(\dir{\gamma(t)}{\,\gamma(\bar t)},\dir{\gamma(t)}{\,q}).$$

The deflection angles depens on the choice of geodesic $[{\gamma(t)}{\,\gamma(\bar t)}]$, and $[{\gamma(t)}\,q]$ but we assume that we made such choice once for all.








???PICTURE???

\begin{thm}{Lemma}\label{lem:angle-d}
Let $L\in\CBB m \kappa$, 
$q\in L$
and $\gamma:[0,t_{\max}]\to L$ be a $\kappa$-convex curve
and $[a,b]\i [0,t_{\max}]$ be a subinterval.

Set 
$x=\gamma(a)$, 
$y=\gamma(b)$,
$\xi=\gamma^+(0)$, 
$\nu=\dir x y$ 
and
$f=\dist_p\circ\gamma$.
Assume $\dist_q$ is $\lambda$-concave in $\oBall(x,r)$ for some $r>t$ and $\mangle(\nu,\dir x q)>\tfrac\pi2$.
Then
$$\cos\mangle(\nu,\dir x q)-\cos\mangle(\xi,\dir x q)\le
\tfrac1{|\gamma^-(a)|???}[\<\gamma^+(a),\dir x q\>-\<\gamma^-(b),\dir y q\>+\lambda t].$$

\end{thm}

\parit{Proof.} Clearly, 
\begin{align*}
f(y)-f(x)&\le -|x y|\cdot\cos\mangle(\nu,\dir x q)+\tfrac\lambda2|x y|^2
\\
&\le-t\cdot\cos\mangle(\nu,\dir x q)+\tfrac\lambda2t^2.
\\
\intertext{On the other hand, }
f(x)-f(y)
&\le 
-f^-(t)\cdot t+\tfrac\lambda2t^2.
\end{align*}
Clearly, $-\cos\mangle(\xi,\dir x q)\ge f^+(0)\ge -f^-(0)$, whence the result.
\qeds










\begin{subthm}{} if for some open subset $\Omega\i L$ all $\gamma_n$ are $\Omega$-pre-quasigeodesics then so is $\gamma$.
\end{subthm}






















Let us show that $\beta_{\xi}^+(0)=\xi$.
Note  that $\beta_{\xi}^+(0)$ is well defined and $|\beta_{\xi}^+(0)|\le1$ (see \ref{thm:k-conc=lip}).
Sinse $\xi=\beta_{\xi;\eps}^+(0)$ for any geodesic $[x p]$, we have 
$$\limsup_{t\to t_0+}\tangle_\kappa(\beta_{\xi;\eps}|_0^t,p)
\le
\mangle(\xi,\dir x p).$$
Since, $\beta_{\xi;\eps}$ is $\kappa$-monotonic, we have that
$\tangle_\kappa(\beta_{\xi;\eps}|_0^t,p)\le \mangle(\xi,\dir x p)$
 and hence $\tangle_\kappa(\beta_{\xi}|_0^t,p)\le \mangle(\xi,\dir x p)$,
 for any $t>0$.
In other words, 
$$\<\beta_{\xi}^+(0),\dir x p\>\ge \cos\mangle(\xi,\dir x p).$$
Applying it for $\dir x p\approx \xi$, it implies $\beta_{\xi}^+(0)=\xi$.








The existnace of quasigeodesics was proved by Perelman around 1992.
Here we present a simplified proof similar to \cite{perelman-petrunin:qg} and \cite{petrunin:survey} which is
based on the gradient flow technique.
The proof is long; it takes two sections.
There is yet a version of this theorem for extremal sets, see \ref{thm:exist-qg-ext}. 


















Quasigeodesics will be constructed in three steps. 
In each step, we construct better curves from a given type of curves
by an extending-and-chopping procedure and passing to a limit.
\begin{description}
\item Step 1 --- this section: $\kappa$-monotonic curves $\rightsquigarrow$ $\kappa$-convex curves.
\item Step 2 --- this section: $\kappa$-convex curves $\rightsquigarrow$ pre-quasigeodesics.
\item Step 3 --- next section: pre-quasigeodesics $\rightsquigarrow$ quasigeodesics.
\end{description}

Most of the section will be taken by the proof of the following statement.











\begin{thm}{Key lemma}\label{lem:big-lem}
Let  $L\in\CBB m{}$, then for any point $x\in L$, and any direction $\xi\in \Sigma_x$
there is a quasigeodesic $\gamma\:[0,\infty)\to L$ such that $\gamma^+(0)=\xi$.
\end{thm}

First, let us show how existance of quasigeodesics (\ref{thm:exist-qg}) follows from the key lemma.

\parit{Proof of \ref{thm:exist-qg}.}
Applying \ref{lem:big-lem},
we can construct a quasigeodesics $\gamma\:[0,\infty)\to L$ with $\gamma^+(0)=\xi$.
And for any $\eps>0$, we can construct a quasigeodesic $\gamma_\eps\:[0,\infty)\to L$ with $\gamma^+_\eps(0)=\gamma^-(\eps)$.
The joint 
$$\bar\gamma_\eps(t)=\l[
\begin{matrix}
\gamma(t)&\text{if}&t\ge \eps\\
\gamma_\eps(\eps-t)&\text{if}&t\le \eps
\end{matrix}\right.$$
forms a quasigeodesic $\bar\gamma_\eps\:\RR\to L$.
Set $\bar\gamma$ to be a partial limit of $\bar\gamma_\eps$ as $\eps\to 0$.
Clearly $\bar\gamma(t)$ coinsides with $\gamma(t)$ for $t\ge 0$;
in particular $\bar\gamma^+=\xi$.
From \ref{cor:lim-qg}, $\bar\gamma$ is a quasigeodesic.
\qeds













\parit{Trasfinite extension.} 
Several times in the proof we will use the following construction, which we will call \emph{trasfinite extension}.
Assume at each point $x\in L$ and at each $v\in \T_x$ we have $r_v>0$ and a distinguished pre-quasigeodesic $\gamma_v\:[0,r_v)\to L$;
the choice of these pre-quasigeodesics will be called \emph{local extensions}.
Then for any initaial data, $x\in L$ and $v\in\T_x$ with $|v|\le 1$ one can construct a pre-quasigeodesic $\gamma\:[0,\infty)$ such that interval $[0,\infty)$ admits a decomposition into counted number of closed-open intevals $[a_i,b_i)$ with the following properties
\begin{enumerate}[(i)] 
\item $|\gamma^+(a_i)|=|\gamma^-(a_i)|$ if $a_i>0$
\item if $v_i=\gamma^+(a_i)$ then $b_i=a_i+r_{v_i}$ and $\gamma(a_i+t)=\gamma_{v_i}(t)$.
\end{enumerate}

The construction is straightforward.
Assume that we have constructed
$\gamma$ on an interval $[0,a)$ and cannot extend it
any further. 
Set $\gamma(a)=\lim_{t\to a-}\gamma(t)$; this limit is well defined since $\kappa$-convex curves are $1$-Lipshitz, see ???.
Applying Milka's lemma (\ref{lem:milka}), we can find a vector $v\in\T_p$ which is polar to $\gamma^-_\eps(a)$ and such that $|v|=|\gamma^-_\eps(a)|$.
Then joining $\gamma$ with $\gamma_v$, we get a longer prequasigeodesic with desired properties.

\smallskip















Now we are ready to construct an infinite $\Omega\cup\oBall(p,\tfrac r6)$-pre-quasigeodesic for any initial data.
Thus arrive to a contrudiction with maximality of $\Omega$.
This constuction almost the same as constuctions on page \pageref{transfinite-extension-page} and page \pageref{transfinite-extension-2-page}.
Let $[0,a]$ be the maximal closed interval 
such that there is a $\oBall(p,\tfrac r6)\cup\Omega$-pre-quasigeodesic $\gamma\:[0,a]\to L$ with initial data $\gamma^+(0)=\xi\in\Sigma_x$ (it exists since convex curves are $1$-Lipshitz).
Apply Milka's lemma to construct a vector $v$ polar to $\gamma^-(a)$.
\begin{itemize}
\item if $\gamma(a)\in\cBall(p,\tfrac r6)\backslash\Omega$ then according th claim~\ref{clm:qg-main} there is a quasigeodesic segment with initial data $\gamma_1^+(0)=v/|v|$.
Let us extend $\gamma$ behind $a$ as $\gamma(a+\tau)=\gamma_1({|v|}\cdot\tau))$.
\item if $\gamma(a)\not\in\cBall(p,\tfrac r6)\backslash\Omega$
then exted $\gamma$ behind $a$ by $\Omega$-pre-quasigeodesic.
Note that a segment $(a,b)$ any $\Omega$-pre-quasigeodesic starting from $\gamma(a)$ is also a $\oBall(p,\tfrac r6)\cup\Omega$-pre-quasigeodesic
\end{itemize}
In both cases, we get a longer $\oBall(p,\tfrac r6)\cup\Omega$-pre-quasigeodesic $\gamma\:[0,b]\to L$; a contradiction.\qeds










\footnote{We do not use it in the proof, but one can say \emph{the} maximal open set.
Indeed, it is easy to show that if for two open subsets $\Omega_1$ and $\Omega_2$ there are $\Omega_i$-pre-quasigeodesic for any initial data then,  the same is true for $\Omega_1\cup\Omega_2$-pre-quasigeodesic.}















Set $\mathfrak C=L\backslash \Omega$;
it is closed set. 
To prove \ref{clm:loc-exist-qg}, we will arrive to a contradiction with assumbtion that $\mathfrak C\not=\emptyset$.























Note that to prove \ref{thm:exist-qg} it is sufficient to prove only lacal existance:

\begin{thm}{Local existance}\label{clm:loc-exist-qg} For any $x\in L$ there is $r>0$ such that for any direction $\xi\in\Sigma_x$ there is a quasigeodesic $\gamma_\xi\:[0,r]\to L$ with $\gamma^+(0)=\xi$.
\end{thm}

Indeed, assume local existance holds, then for any $x\in L$ and $\xi\in\Sigma_x$ there is a quasigeodesic $\gamma$ with $\gamma^+(0)=\xi$ which is defined on a maximal interval $\II\ni 0$.
The intrval $\II$ is closed --- since any quasigeodesic is $1$-Lipschitz.
Assume $a\in \II$ be a boundary value;
without loss of generality we can assume that $a$ is the maximum of $\II$.
Applying Milka's lemma (\ref{lem:milka}), we can find a direction $\zeta\in \Sigma_{\gamma(a)}$ such that $\zeta$ is polar to $\gamma^-(a)$. 
From local existance, there is a quasigeodesic $\gamma_\zeta\:[0,r]\to L$ with $\gamma^+(0)=\zeta$.
Extend $\gamma$ behind $a$ as $\gamma(a+t)=\gamma_\zeta(t)$, according to extension procedure and ??? it is a quasigoedesic.
Thus $\II$ is not maximal. \contradiction
























Assume it is not possible, let $[0,a]$ be a maximal interval such that there is a $\Omega_\eps$-pre-quasigeodesic $\gamma_\eps\:[0,a]\to L$ with $\gamma^+(0)=\xi$.
Applying Milka's lemma, we can find a vector $w$ which is polar to $\gamma^-(a)$ and such that $|w|=|\gamma^-(a)|$. In case $|w|=0$, set $\gamma(t)=\gamma(a)$ for all $t\ge a$.
If $\gamma(a)\in\Omega$ then we can find a quasigeodesic $\bar\gamma\:[0,r]\to L$ with $\bar\gamma^+(0)=w/|w|$ and then extend $\gamma$ behind $a$ as $\gamma(a+t)=\bar\gamma(|w|\cdot t)$.
According to ??? the extended $\gamma$ is still $\Omega_\eps$-pre-quasigeodeisic;
thus $[0,a]$ is not a maximal interval. \contradiction

In the remaining case, $\gamma(a)\not\in\Omega$, according to ???,
we can find a pre-quasigeodesic $\bar\gamma\:[0,\eps]\to L$ with $\bar\gamma^+(0)=w$.
Then extend $\gamma$ behind $a$ as $\gamma(a+t)=\bar\gamma(t)$, clearly $\gamma_{[a,a+\eps]}\i L\backslash\Omega_\eps$.
Therefore the exteded $\gamma$ is an $\Omega_\eps$-pre-quasigeodeisic, 
which again contradicts maximality of $[0,a]$. 

Now take a converging sequence $\gamma_{\eps_n}\to\gamma$ as $\eps_n\to0+$.
According to ??? $\gamma^+(0)=\xi$ and from ??? $\gamma$ is $\Omega$-pre-quasigeodesic.

Finally, to prove the last statement note that $L$-pre-quasigeodesic $\gamma\:[0,\infty)\to L$ with $|\gamma^+(0)|=1$ is a quasigeodesic.
Applying the same argument as before in opposite direction, w???
We constructe $\gamma$ only on $[0,\infty)$ but the sam construction as above can be used in opposite direction.
Thus we can get a quasigeodesic $\gamma\:\RR\to L$.\qeds


















As it follows from ???, in a space $L\in \CBB m\kappa$ with $\partial L=\emptyset$ the class of funny quasigeodesics coinsides with the class of quasigeodesics.
For spaces with boundary it is not the case. 
In particular, ...




We have just finished the proof existance for the case, 
where all points of $L$ are $\delta$-strained. 
From this proof it follows that if we denote by $\Omega_\delta$ the subset of all
$\delta$-strained points of $L$ (which is an open everywhere dense set, see
\cite[5.9]{BGP}), then for any initial data one can construct a pre-quasigeodesic
$\gamma$ such that $\mu_\gamma(\gamma^{-1}(\Omega_\delta))=0$.
Assume $L$ has no boundary; set $\mathfrak C=L\backslash
\Omega_\delta$. 
In this case it seems unlikely that we hit $\mathfrak C$ by shooting a pre-quasigeodesic in a generic direction.
If we could prove that it almost never happens, then we obtain existence of
quasigeodesics in all directions as the limits of quasigeodesics in generic directions
(see \ref{cor:lim-qg}) and passing to doubling in case $\partial L\not=\emptyset$.
Unfortunately, we do not have any tools so far to prove such a thing\footnote{It
might be possible if we would have an analog of the Liouvile theorem for
``pre-quasigeodesic flow''}. 


















\section{Tangent space}

Let $K$ be a cone, $K=\Cone \Sigma$.
Let $X$ be a complete metric space.
A one parameter family of maps 
$\map_t\:X\to X$, $t\in\RR_>$ is called dilations on $X$ if
$\map_{t_1t_2}=\map_{t_1}\circ\map_{t_2}$,
$|\map_t(x)\,\map_t(y)|=t|xy|$ and ???.

A complete metric space with distinguished family of dilations is called cone. 
Given a cone with dilation $\map_t$, 
we definte short notation $t\cdot x=\map_t(x)$.
Clearly for a cone $K$,
there is unique point $o\in K$ such that $t\cdot o=o$ for any $t\in \RR$.
The point $o$ will be called zero-vector of $K$ and will be allways denoted by $o$.

Let $X$ be a metric space and $p\in X$.
A cone $K=\Cone\Sigma$ is called tangent cone of $X$ at $p$ if there is a map $\map\:X\to K$
such that $t*X\GHtoh{\map^t} K$, where $\map^t(t*x)\df t\cdot\map(x)$.

















$f_s\circ\gamma(t)=f_s(y_t)\le ???$
Clearly 
$$\beta_t
>\frac{|t|\sin\alpha}{|xy|+O(|xy|^2)}+o(t)
=(1+O(s^2))\frac{|t|\sin\alpha}{|xy|}+o(t).$$

From above,  $\ddir x y\in\Lin_x$, in particular $\T_x$ splits in direction of $\ddir x y$.
Thus there is a vector $v_t\in\T_p$ such that $|v_t|=|t|$, 


so we can subtract $\ddir x y$ from any vector in $\T_p$.
Set $v_t=\ddir x{\gamma(t)}-\ddir x y$ and $x_t=\gexp_x v_t$.
Sinse $d_xf(v)=\tfrac1s\<\ddir xy,v\>$, from ???, we have
$$f(x_t)\le f(x)+\<\ddir x y,v_t\>t+\tfrac\lambda2t^2.$$
On the other hand, sinse $\dist^2_x$ is $(1+O(r^2))$-concave in $\oBall(x,r)$, we have
$|x\gamma(\tau)|^2\le ???$
and \ref{eq:lamb-conc} follows.

























Note that 
$$|x_\tau y_\tau|\le |xy|+O(s)\cdot \tau^2+o(\tau^2)$$

Clearly 
$$|xy_\tau|=|xy|-\tau\cos\alpha+o(\tau).$$ 
Moreover, from  ???
$$|xy_\tau|<|xy|-\tau\cos\alpha+\tfrac\lambda2 \tau^2.$$
Since ???, 
$$\beta_\tau>\frac{\tau\sin\alpha}{\sn_\kappa|xy|}+o(t).$$


Consider a convex quadrangle $\~x_\tau\~x\~y\~y_\tau$ in $\Lob{}\kappa$
such that $|\~x\~x_\tau|=|\~y\~y_\tau|=\tau$, $|\~x\~y|=|xy|$, $\mangle\hinge {\~x}{\~x_\tau}{\~y}=\pi-\alpha$ and $\mangle\hinge {\~y}{\~y_\tau}{\~x}=\alpha$.
Set $\~\beta_\tau=\mangle\hinge {\~x} {\~y} {\~y_\tau}$.
From \ref{k-convex-angle}$'\!$, $|xy_\tau|\le|\~x\~y_\tau|$.
Since ???, $\beta_\tau>\~\beta_\tau+o(\tau)$. 
Therefore, ???,
$$|x_\tau y_\tau|
\le
|\~x_\tau\~y_\tau|+o(\tau^2)
=|xy|+\tau^2\cdot O(|xy|)+o(\tau^2),
\eqlbl{eq:lamb-conc-2}$$
the $O(|xy|)$-term can be ignored if $\kappa\ge 0$.























\parbf{Angles???.} 
Let $X$ be a metric space and $x,y,z\in X$ and
$x\not=z$.
If for some $\phi\in[0,\pi]$, we have 
$$\dist_z\circ\geod_{[x y]}(t)=|xy|+t\cdot\cos\phi+o(t),$$
then value $\phi$ is called angle from $[x y]$ to $z$;
for shortness $\phi=\dotang_x([x y],z)$. $\phi=\dotang_{[x y]}^{\ z}$

If for some $\phi\in[0,\pi]$, we have
$$|\geod_{[x y]}(t)\,\geod_{[x z]}(\tau)|^2=t^2+\tau^2+2t\tau\cos\phi+o(t\tau)$$
for two geodesics $[x y]$ and $[x z]$,
then $\phi$ is called angle between $[x y]$ and $[x z]$;
for shortness $\phi=\mangle([xy],[xz])$.
The pair of geodesic $([xy],[xz])$ which start at one point is called hinge,
for such pair we will use a short notetion $\hinge x y z$, so we may write $\mangle\hinge x y z$ for $\mangle([xy],[xz])$.















Let $L\in\CBB{m}{\kappa}$ and $K\in L$ is a compact convex subset.
A submap $\mathbf f\:L\to\RR^{\kay}$, $\mathbf f(x)=\sum_i f_i(x)\mathbf e_i$
is called relief map of $K$ if the following conditions hold:
\begin{enumerate}
\item $K\i \Dom \mathbf f$,
\item there is $\lambda<0$ such that each $f_i$ is a simple function with controlled concavity type $(\lambda,\kappa)$.
\item the collection of subfunctions $f_i$ is tight...
\end{enumerate}



 Here we introduce \emph{sketch} --- a notion which is very much related to the chart in Riemannian geometry.

Let $L\in\CBB{m}{}$, and $\mathbf f\: L\subto\RR^\kay$ is a submap and $K\i \Dom f$ is a compact convex set.
The pair $(K, \mathbf f)$ is called \emph{sketch} in $L$ if the following conditions hold:

\begin{enumerate}
\item $\mathbf f$ is tight; i.e. ???
\item $\mathbf f=\sum f_i\mathbf e_i$ and each $f_i$ is a simple function of concavity type ???
\item 
\end{enumerate}


Assume $L\in \CBB m\kappa$, $\Omega\i L$ be an interior of compact convex set and $f_0,f_1,\dots f_\kay$ be a collection of strongly concave $\bar\Omega$ and $\mathbf f\:L\subto \RR^\kay$, $\mathbf f(x)=\sum f_i(x)\mathbf e_i$.
Each of the functions $f_i$ is a simple function with controlled concavity $(\lambda,\kappa)$



















The inequality in the definition follows from inequality ???
on page \pageref{**-polar-inq} and a subsequent to it example~(\ref{polar}).

This example can be made slightly more general.
Let $f_0,f_1,...,f_\kay$ be a collection of simple functions
$$f_i=\Theta_i(\dist_{a_{1,i}}^2,\dist_{a_{2,i}}^2,\dots, \dist_{a_{n_i,i}}^2)$$
and the sets of points $K_i=\{a_{k,i}\}$ satisfy the following inequality
$$\angk\kappa p x y>\tfrac\pi2\ \ \text{for any}\ \  x\in K_i,\ \  y\in K_j,\ \ i\not=j.$$
Then the map
$x\mapsto(f_0(x),f_1(x),...,f_\kay(x))$
is tight in a neighborhood of $p$.
 We will call such a map a \emph{simple tight map}.

Yet further generalization is given in the property~\ref{lip+} below.

The maps described in this example have an important property, they are liftable
and their lifts are tight. 
Namely, given a converging sequence $L_n\GHto L$, $L_n\in\CBB m\kappa$ and a
simple tight map $\mathbf{f}\:L\to \RR^{\kay+1}$ around $p\in L$, the construction in
section~\ref{adm} gives simple tight maps $\mathbf{f}_n\:L_n\to \RR^\kay$ for large $n$, $\mathbf{f}_n\to \mathbf{f}$.

I was unable to prove that tightness is a stable property in a sense
formulated in the question below.
It is not really important for the theory since all maps which appear naturally 
are simple (or, in the worst case they are as in the generalization and
as in the property \ref{lip+}).
However, for the beauty of the theory it would be nice to have a positive answer to
the following question.

\begin{thm}{Question} Assume $L_n\GHto L$, $L_n\in\CBB{m}{\kappa}$,
$f,g\:L\to \RR$ is a tight collection around $p$ and $f_n,g_n\:L_n\to\RR$, $f_n\to
f$, $g_n\to g$ are two sequences of $\lambda$-concave
functions and $L_n\ni p_n\to p\in L$. 
Is it true that for all large $n$, the collection $f_n,g_n$ must be
tight around $p_n$?

If not, can one modify the definition of tightness so that
\begin{subthm}{}
it would be stable in the above sense,
\end{subthm}

\begin{subthm}{} the definition would make sense for all semiconcave functions
\end{subthm}

\begin{subthm}{} the maps described in the main example above are tight?\end{subthm}
\end{thm}










\begin{thm}{Main example} If $L\in\CBB m\kappa$ and
$a_0,a_1,\dots,a_\kay,p\in L$ such that 
$$\angk\kappa p{a_i}{a_j}>\tfrac\pi2\ \ \text{for all}\ \  i\not=j$$ 
then the map
$x\mapsto (|a_0x|,|a_1x|,\dots,|a_\kay x|)$ is tight in a neighborhood of
$p$.
\end{thm}














???Further, a barycentric simplex $\sigma_\mathbf{f}$ (if it is well defined) will be called \emph{degenrate}\index{barycentric simplex!degenrate} if $\sigma_\mathbf{f}(\Delta^\kay)=\sigma_\mathbf{f}(\partial\Delta^\kay)$ and otherwise \emph{nondegenerate}\index{barycentric simplex!nondegenrate}.
The set $\sigma_\mathbf{f}(\Delta^\kay)\backslash\sigma_\mathbf{f}(\partial\Delta^\kay)$ will be called Kliener's $\mathbf{f}$-manifold; clearly, it is nonempty if and only if the simplex is nondegenerate.???















Since $f''+\chi f\le \lambda$, we have
\begin{align*}
{f(q)}&=f\circ\geod_{[p q]}(\ell)\\
&\le(f\circ\geod_{[p q]})^+(0)\,{\sn_\chi\ell}+f(p)\cs_\chi\ell+\lambda\md_\chi\ell
\end{align*}




















Further, we will denote by $ID(\spc{X})$ the class of all integrals of functions in $D(\spc{X})$;
i.e. $f\in ID(\spc{X})$ if there is a non-negative Lipschitz fuction $\rho\:\spc{X}\to\RR$ such that 
$$f(x)=\int\limits_\spc{X}\rho\dist x\,\d_x\vol\eqlbl{eq:adm*}$$
The representation \ref{eq:adm*} is called canonical represention of $f$, in principle one function $f\:\spc{L}\to \RR$ might have few canonical representation.
The support of measure $\mu$ is called foothold of $f$ and denoted by $\Foot f$.

If measure $\mu$ above is regular, i.e. there is a ... functon $\mu=...$ then function $f$ is called ... and the class of these functions is denoted by $R(\spc{X})$.

Further consider the following ... classes of functions $\RR^n\to\RR$:
$S$ --- the smooth functions, $C$ --- semiconcave functions which are nondecreasing in each argument...



Further, we will need to close the above $D$, $M$ and $R$ classes of functions using $S$- and $C$-functions:




















A complete metric space $\spc{X}$ is called \emph{length space}\index{length space} if any two points $x,y\in \spc{X}$ can be joined by curve of length arbitrary close to $\dist{x}{y}$.
More presicely, for any $\eps>0$ two point $x,y\in \spc{X}$ there is a path $\alpha\:[0,1]\to\spc{X}$  such that $x=\alpha(0)$, $y=\alpha(1)$ and $\length\alpha<\dist{x}{y}+\eps$.

We will be mostly interested in complete metric spaces, such that the distance between a pair of points can be realized as an infimum of lengths of curves connecting this pair.

Let $\spc{X}$ be a metric space, given two points $x,y\in \spc{X}$, we say that $z\in \spc{X}$ is an $\eps$-midpoint for $x$ and $y$ if $\dist{x}{z},\dist{z}{y}<\tfrac12(\dist{x}{y})+\eps$.
If for any $\eps>0$ and any two points $x,y\in \spc{X}$ there is an $\eps$-midpoint for $x$ and $y$,
we say that $\spc{X}$ satisfies \emph{almost midpoint property}\index{almost midpoint property}.
A complete metric space which satisfies almost midpoint property will be called \emph{length space}.

It is straight forward to check that if $\spc{X}$ is a length space, then for any $\eps>0$ and any two points $x,y\in \spc{X}$ can be connected by a curve with length $<\dist{x}{y}+\eps$.









For a finite collection of points 
$p_1,p_2,\dots,p_\kay\in\spc{L}$ 
set
$\dist{[p_1,p_2,\dots,p_\kay]}{}\:x\to(\dist{p_1}{x},\dist{p_2}{x},\dots,\dist{p_\kay}{x})$ 


be a finite collection of points and $F\:\RR^\kay\to\RR$.
A mindful function
$\hmy f\:\spc{L}\to\RR$ with $\Mind(\hmy f)=((\dist{p_1}{},))$
Let us denote by 

and $F\:\RR^n\to\RR$.
A function $f\:\spc{L}\to\RR$ with detour
$$f=F(\dist{p_1}{},\dist{p_2}{},\dots,\dist{p_n}{})$$ is called multidistant function.
Formally we will treat the function $f$ as a function with detour $f=F\circ\phi$ where $\phi\:\spc{L}\to\RR$ deined as $\phi(x)=(\dist{p_1}{x},\dist{p_2}{x},\dots\dist{p_n}{x})$ defined below.

Note that $\d_xf=\d_{\phi(x)}F\circ\d_x\phi$.
Thus the differential of function with detour also admits a natural detour 
















Let $X$ be arbitrary set
$\phi\:X\to V$ and $F\:V\to\RR$ be two maps.
The pair $f=(\phi,F)$ is called a detour function on $X$ troug $V$,
the composition $\underline f=F\circ\phi\:X\to\RR$ is called underling function of $f$.

Given a detour function $\Theta\:\RR^\kay\to\RR$, 
and $\kay$ detour functions $f_1,f_2,\dots, f_\kay$, $f_i=(\phi_i,F_i)$,
set $\Theta\circ f$ to be a 
One can extend ariphmetic operations to the detour functions the following way:
assume $f=(\phi,F)$ and $g=(\psi,G)$ be two detour functions, $\phi\:X\to V$ and $\psi\:X\to W$,
set 

A function $f\:\spc{X}\to\RR$ together with a decomposition $f=F\circ \underline f$, $D\:\spc{X}\to\RR^n$ and $F\:\RR^n\to\RR$  will be called \emph{detour functionon}.

Given detour functions $f=F\circ \underline f$, $g=G\circ \underline g$, $h=H\circ \underline h$ on $\spc{X}$ we will write $h=f+g$ if
we write 
$f+g=H\circ(\underline f,\underline g)$, where $H\:(x,y)\mapsto F(x)+G(y)$.


MP,
MD,

Let us define scalar product of a special class of homogeneus concave functions on tangent space.

Let $\spc{L}\in\CBB{}{}$ and $p\in \spc{L}$ and $v,w\in\T_p$.
Consider two functions $\phi,\psi\:\T_p\to\RR$,
$\phi(x)=-\<v,x\>$ and $\psi(x)=-\<w,x\>$ and set
$\<\phi,\psi\>=\<v,w\>$.

Further, to wider class of functions on $\T_p$ using the following identities

$$\<\min\{\phi_1,\phi_2\},\psi\>=\max\{\<\phi_1,\psi\>,\<\phi_2,\psi\>\}$$
$$\<\phi_1+\phi_2,\psi\>=\<\phi_1,\psi\>+\<\phi_2,\psi\>$$










\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{m}{}$, 
$[pq]$ be a geodesic in $\spc{L}$
and $X\i \T_p$ be the connected component of $\gexp_p^{-1}q$ which contains $\ddir{p}{q}$.

Assume $X$ is bounded then $X\supset \Log_pq$.
\end{thm}

\parit{Proof.}
Assume contrary.
Choose $y\in \Log_pq\backslash X$.
For sufficiently small neigborhood $\oBall(q,\eps)$, 
there is a connected component $X'$ of preimage $\gexp_p^{-1}(\oBall(q,\eps))$
such that $X'\supset X$ and $X'\not\ni y$. 
Let $\bar X'$ be the closure of $X'$.
Note that $\gexp$ gives a map of pairs $(\bar X',\Fr X')\to (\cBall(q,\eps),\Fr \cBall(q,\eps))$.
Note further that according to ???, $H_m(\bar X',\Fr X',\ZZ_2)$ and $H_m(\cBall(q,\eps),\Fr \cBall(q,\eps),\ZZ_2)$ are nontrivial.
Let $q'=???$; according to ???, $x'=\gexp_p^{-1}(q')$ is uniquely defined and clearly $x'\in X'$.
Combaining all above, we get that $\gexp_p(\bar X')=\cBall(q,\eps)$.
\qeds

































\begin{thm}{Lemma on obtuce angle}
Let $\eps>0$,
$\spc{L}\in\CBB{}{\kappa}$ 
and points $p,x,y\in\spc{L}$ be such that 
$\angk{\kappa}xyp,\angk{\kappa}yxp<\tfrac\pi2+\eps$.
Then there is a point $p'\in\spc{L}$ such that 
$\dist{p}{p'}<???$
and there are two 
\end{thm}


Given two points $x,y\in \spc{L}$ 
the set 
$Bis(x,y)
=
\{\,p\in\spc{L}
\mid
\dist{x}{p}=\dist{y}{p}\,\}$
is called bisector for $x$ any $y$.

Assume $p\in Bis(x,y)$ then for any $R>\dist{p}{x}=\dist{p}{y}$ there is a radial curve $\sigma\:[r,R]\to$
consider function $\dist{\{x,y\}}{}=\min\{\dist{x}{},\dist{y}{}\}$.
Given $R\le \varpi_\kappa$,
denote by $X_R(x,y)$ the set of points $p\in\spc{L}$,
 such that there are two radial curves $\sigma_1,\sigma_2\:[r,R]\to\spc{L}$ such that 

According to ???, there is a map $\sn_\kappa R*\SS^{m-1}\to\spc{L}$ such that...
Thus, if for any $i\in[1..\kay]$ we have $|\dist{p_i}{x}-\dist{p_i}{y}|\le\eps(\dist{x}{y})$
then $\pack_{\delta'}\SS^{m-1}>\kay$. 
 
and $R>0$, let us denote by $M_R(x,y)$ the set of points
such that there is a   its \emph{radial $R$-bisector} as the set of points $p\in \spc{L}$ such that there is a $\kappa$-radial curve.

\begin{thm}{Lemma}
Let $\spc{L}\in \CBB{m}{\kappa}$,
$K\i \spc{L}$ be a compact set
and $f\:\spc{L}\subto\RR$ is a semiconcave subfunction.
Assume that for some $t\ge0$, the  gradient flow $\GF_f^t$ is well defined for all points in $K$, then 
$$\Fr\GF^t_fK\i\GF_f^t\Fr K.$$

\end{thm}




\begin{thm}{Theorem on bisector}
Let $\kappa\le 0$,
$\spc{L}\in \CBB{m}{\kappa}$, 
$x,y\in \spc{L}$,
$\tfrac12(\dist{x}{y})>r>0$ 
and $f=\tfrac12\min\{(\dist{x}{})^2,(\dist{y}{})^2\}$.

Assume $\dist{x}{p}=\dist{y}{p}$ then $p\in\GF_f^t\Fr\oBall(x,r)\cap\GF_f^t\Fr\oBall(y,r)$ 
for any $t\ge \ln\tfrac{\dist{x}{p}}r$.

Moreover, if $|\dist{x}{p}-\dist{y}{p}|\le\eps(\dist{x}{y})$ then there is point $p'\in\GF_f^t\Fr\oBall(x,r)\cap\GF_f^t\Fr\oBall(y,r)$ such that $\dist{p}{p'}<???$
\end{thm}













\parit{Proof.}
Fix small $\eps>0$ and $r<\tfrac{\dist{p}{q}}2$.
Consider function $f=\tfrac12\min\{(\dist{p}{})^2,(\dist{q}{})^2\}$.
Clearly, $f$ is $???$-concave in $\oBall(p,R+2\eps)$.
Set $t=\ln\tfrac{R+\eps}r$ and $P=\GF_f^t\cBall(p,r)$.
Note that the map $\GF_f^t$ is a ???-Lipschitz in $\cBall(p,r)$.
According to ???, $\Fr P\i  \GF_f^t\Fr\cBall(p,r)$.

Consider set
$$S(r,p)=\Fr_\spc{L}\cBall(p,r).$$
Note that $\GF_f^t \l[S(r,p)\r]\supset X$.
Indeed from ???,
$\GF^{t}_f(S(r,p))$ separates $p$ and $q$ in $\spc{L}$.
Thus, for any point $x\in X$ and any choice of geodesics $[px]$ and $[qx]$, 
the set $\GF_f^t \l[S(r,p)\r]$ contains at least one point on $[px]\cup[qx]$.
Since $|px|=|qx|\le R<R+\eps$, we get that for any point $x'\not=x$ on $[px]\cup[qx]$ the preimage$(\GF^{t}_f)^{-1}(x')$ is uniquely detemined and it lies in $\oBall(p,r)\cup\oBall(q,r)$.
Thus $x$ is the only point on $[px]\cup[qx]$ which can lie in $\GF_f^t \l[S(r,p)\r]$.

It remains to show the following:

\begin{clm}{Claim}
There is a ???-Lipschitz map $\map\:\SS^{m-1}\to \cBall(p,r)$ such that $\map(\SS^{m-1})\supset S(r,p)$
\end{clm}

Indeed, once it is proved, the composition $\GF^t_f\circ\map$ will satisfy all requrements in the theorem.

\parit{Proof of the claim.}
If $\T_p\iso\EE^m$, one could take $\map(u)=\gexp_p(r\cdot u)$.

Otherwise, choose a sequence of regular points $p_n\to p$ and set $\map$ to be partial limit of the maps $u\mapsto \gexp_{p_n}(r\cdot u)$.
\qeds

\begin{thm}{Theorem on almost bisector}
Let $\kappa\le 0$ and $\spc{L}\in \CBB{m}{\kappa}$.
Then for any two distinct points $p,q\in \spc{L}$ the set 
$$X_{R,\eps}=
\{\,
x\in\oBall(p,R)
\mid
|\dist{p}{x}-\dist{q}{x}|\le\eps\dist{p}{q}
\,\}$$
lies in an image of $\SS^{m-1}\times [0,\eps]$ under a $???$-Lipschitz map.
\end{thm}

\begin{thm}{Theorem}
Let $\kappa\le 0$ and $\spc{L}\in \CBB{m}{\kappa}$.
Then for any two distinct points $p,q\in \spc{L}$ the set 
$$X_\eps=\{\,x\in\oBall(p,R) \mid |\dist{p}{x}-\dist{q}{x}|\le\eps(\dist{p}{q})\,\}$$
lies in the image of short map with sourse space $Z=\cBall^{m-1}(2R,p)\times[0,???\eps]$
\end{thm}


The following proposition is similar to \ref{prop:unique-gexp-inverse}.

\begin{thm}{Proposition}
Let $\spc{L}\in\CBB{m}{}$, $p\in\spc{L}$ and $f=(\dist{p}{})^2$.
Then for any point $x\in \spc{L}$ such geodesic $[px]$ is extandable behind $x$ the invece
$(\GF_f^t)^{-1}(x)$ is uniquely defined.
\end{thm}

\parit{Proof.} Let $\gamma\:[0,t_0]\to \spc{L}$ be a unit-speed minimizing geodesic,
$\gamma(0)=p$, $\gamma(t_0)=q$.
From the angle comparison we get that $|\nabla_x\dist{p}{}|\ge-\cos\angk\kappa x p q$. 
Therefore, for any $\zeta$ we have
$$[\dist{p}{\alpha_\zeta(t)}]^+_t
\ge
-|\alpha^+_\zeta(t)|\cos\angk\kappa{\alpha_\zeta(t)}p q\ \ \text{and}\ \ [\dist{\alpha_\zeta(t)}{q}]^+_t\ge-|\alpha^+_\zeta(t)|.$$
Therefore, $\angk\kappa q {\alpha_\zeta(t)}p $ is nondecreasing in $t$, hence the result.
\qeds

\begin{thm}{Lemma}
Let $\kappa\le 0$, $\spc{L}\in\CBB{m}{\kappa}$, $p\in \spc{L}$ then 
 
\end{thm}



\begin{clm}{Claim}
Assume $p,q\in\spc{L}$ and $P,Q\i \spc{L}$ are as above.
Further, assume $|\dist{p}{x}-\dist{q}{x}|<\eps(\dist{p}{q})$ for some $x\in\spc{L}$.
Then 
$$\dist{P}{x},\dist{Q}{x}\le ???(\eps,\dist{p}{x}).$$

\end{clm}

\parit{Proof.}
Without loss of generality, we can assume that $\dist{p}{x}\le\dist{q}{x}$.
Then $x\in P$, thus it only remains to show that $\dist{Q}{x}\le ???(\eps,\dist{p}{x})$.

Choose a point $y\in [px]$ such that $\dist{p}{y}=\dist{q}{y}$.
Let $\alpha(t)$ be $f$-gradient curve which starting at $y$.
Clearly, $\alpha(t)\i Q$ for all $t\ge0$.
Choosing $t=???$, we get 
$\dist{Q}x\le\dist{\alpha(t)}{x}\le ???$
and the result follows.
\qeds


Let $z$ be the given point. 
Without loss of generality, we can assume that $\Omega=\oBall(z,R)$


















Further, let us extend this definition to the class of simple functions.
A fucntion $f\:\spc{L}\to\RR$ is called simple if there is  a smooth function $F\:\RR^\kay\to\RR$ which is not increasing in each argument and a finite collection of points $p_1,p_2,\dots,p_\kay\in\spc{X}$ and  such that 
$$f=F(\dist{p_1}{},\dist{p_2}{},\dots,\dist{p_\kay}{}).$$
The right-hand expression is called \emph{canonical form} of $f$ and the set $\{p_i\}_{i=1}^\kay$is called \emph{foot-set} of $f$, for shortness $\{p_i\}_{i=1}^\kay=\Foot f$.
One function may have a number of different canonical forms with different foot-sets, but we always assume that such choice is fixed --- formally speaking, a simple function is a pair of functions
$$\spc{X}\buildrel D \over \to\RR^\kay\buildrel F \over\to\RR,$$
where
$$D:x\mapsto(\dist{p_1}{x},\dist{p_2}{x},\dots,\dist{p_\kay}{x})\in\RR^\kay.$$

Given two simple functions $g=G(\dist{q_1}{},\dist{q_2}{},\dots,\dist{q_n}{})$ and $f=F(\dist{p_1}{},\dist{p_2}{},\dots,\dist{p_\kay}{})$,
 set
$$\<\d_x f,\d_x g\>
\df
\sum_{i,j}[\partial_iF\cdot\partial_jG]\<\d_x \dist{p_i}{},\d_x\dist{q_i}{}\>$$

It is easy to see that if $\spc{L}\in\CBB{}{}$ then any A-function $f\:\spc{L}\to\RR$ is semiconcave in $\spc{L}\backslash \Foot f$.

From theorem ???,
it follows that if $x\not\in \Foot f$ then 
$$\d_x f(v)=\sum_{i=1}^\kay \partial_i\Theta\d_x\dist{p_i}{}$$




 if there is a collection of smooth non-decreasing functions $\phi_i\:\RR\to\RR$ and collection of points $p_i\in\spc{X}$
such that
$$f=\sum_{i=1}^\kay\phi_i\circ\dist{p_i}{}.$$
The right hand expression is called 


\emph{distance functions} on $\spc{X}$, i.e. $f\in D(\spc{X})$ if and only if there is a point $p\in \spc{X}$ such that $f=\dist{p}{}$.

Let $\spc{L}\in\CBB m{}$ a function $f\:\spc{L}\to \RR$ is called basic Otsu function if there is a nondecresing smooth function $\phi\:\RR\to\RR$ and absolutely continuous measure $\mu$ on $\spc{L}$ such that
$$f(x)=\int\phi(\dist{p}{x})\,\d_p\mu.$$
A finite sum of basic Otsu functions is called Otsu function.
The class of Otsu functions on $\spc{L}$ will be denoted by $\op{OD}\spc{L}$.

\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{}{}$ and $f\in \op{OD}\spc{L}$.
Then $f$ is semiconcave and for any point $p\in \spc{L}$ there is an absolutely continuous measure $\nu$ on $\T_p$ such that $$\d_pf(v)=-\int\limits_{\T_p}\<w,v\>\,\d_w\nu.$$
\end{thm}




---

Here we will introduce few classes of functions on a metric space with extra data.
Each of these classes is ``constructed'' from distance function in two steps and extra data tells exactly the way it was constructed.

\parbf{Base functions.}
Let $\spc{X}$ be a metric space, we will denote by $\op{D}(\spc{X},\RR)$ 
the class of \emph{distance functions} on $\spc{X}$;
i.e. $f\in \op{D}(\spc{X},\RR)$ 
if and only if there is a point $p\in \spc{X}$ such that $f=\dist{p}{}$;
in this case we will write the \emph{foot-set} of $f$ as $\Foot f\df\{p\}$.

Assume $\vol$ be a destingushed Borel measure on $\spc{X}$ which is positive on any open subset.
A function $f\:\spc{X}\to\RR$ is called smoothed distance function if there is a point $p\in \spc{X}$ and $\eps>0$ such that 
$$f=\oint\limits_{\oBall(p,\eps)}\dist{x}{}\,\d_x\vol$$;
in this case we will write the \emph{foot-set} of $f$ as $\Foot f\df\{p\}$ and $\eps$ is called error of $f$, $\eps=\err f$.
The class of all smoothed functions with error $\le \eps$ will be denoted $\op{S}_\eps(\spc{X},\RR)$

Assume function $h$ admits a representation 
$$h= \Theta(f_1,f_2,\dots, f_n),$$
where $\Theta\in S$ and $f_i\in D(\spc{X})$,
then we say that $h\in SD(\spc{X})$.
Analogouesly we define classes $SM(\spc{X})$, $SR(\spc{X})$, $CD(\spc{X})$, $CM(\spc{X})$, $CR(\spc{X})$.
In all the cases in addition to actual function on $\spc{X}$ we have extra data, which we call canonical representaion of function...


For given class of functions $F$ on a metric space $\spc{X}$ we will call $SF$ the class of functions which can be presented as 
$$h= \Theta(f_1,f_2,\dots, f_n)$$

\begin{thm}{Definition} Let $\spc{L}\in \CBB{m}{}$, a function $f\:\spc{L}\to \RR$ is called
\emph{constructive} if there is a finite set of points $\{q_i\}_{i=1}^N$ in $\spc{L}$ and a
semiconcave function $\Theta\:\RR^N\to\RR$ which is non-decreasing in each
argument such that
$$f= \Theta(\dist{q_1}{},\dist{q_2}{},\dots,\dist{q_N}{})$$

The set $\{q_i\}_{i=1}^N$ is called  foothold of $f$ and denoted by $\Foot f$.
\end{thm}

It is easy to see that elementary functions are semiconcave in $\spc{L}\backslash \Foot f$.
Class of simple functions is
closed under taking the minimum, summation, multiplication by a positive constant as
well as multiplication by positive simple functions.



Let $\spc{L}\in\CBB{}{}$, a function $f\:\spc{L}\to\RR$ is called elementary if there is a non-decreasing function 



This is a short technical section.
Here we introduce \emph{simple functions}, a subclass of semiconcave
functions which on one hand includes all functions we need and in addition is
liftable; i.e. for any such function one can construct a nearby function on a
nearby space with ``similar'' properties.

Our definition of simple function is a modification of two different definitions of so called ``admissible functions'' given in
\cite[3.2]{perelman:morse} and \cite[5.1]{kapovitch:stability}. 


It is straightforward to check that simple functions are semiconcave. Class of simple functions is
closed under summation, multiplication by a positive constant\footnote{as
well as multiplication by positive simple functions} and taking the minimum.

In addition this class is liftable; i.e. given a converging sequence of
Alexandrov's spaces $\spc{L}_n\GHto \spc{L}$ and a simple function $f\:\spc{L}\to\RR$ there is a
way to construct a sequence of functions $f_n\:\spc{L}_n\to\RR$ such that $f_n\to f$.
Namely, for each $q_i$ take a sequence $\spc{L}_n\ni q_{i,n}\to q_i\in \spc{L}$ and consider
function $f_n\:\spc{L}_n\to\RR$ defined by
$$f_n=\Theta((\dist{q_{1,n}}{})^2,(\dist{q_{2,n}}{})^2,\dots,(\dist{q_{N,n}}{})^2).$$











Assume $\dist{\bm{p}}{}$ is a bi-Lipschiz embedding in $\Omega=(\dist{\bm{p}}{})^{-1}\Dom F\i \spc{L}$.



Moreover, one can estimate the upper bound of $\hmy{f}''$ in a neigborhood of point $x$ through the following data: $\dist{x}{p_i}$, $\dist{p_i}{p_j}$ and $F$.

\begin{thm}{Lemma}
Let $\spc{L}\in \CBB{m}{}$, $\Omega\i\spc{L}$ open set
then for any $q\in \spc{L}$ there is a neighborhood $\Upsilon\ni q$, $\eps>0$ and an array of poins $\bm{p}\in\Omega^\kay$ such that 
for any $x\in \Upsilon$ and any $v\in \T_x$ we have 
$$|\d_x\dist{\bm{p}}{}(v)|>\eps|v|.$$
\end{thm}

\parit{Proof.}
Without loss of generality, we can assume that $\Omega$ is bounded.
Fix $\eps>0$, let $\kay=\pack_\eps\Omega$.
Choose $\bm{p}=(p_1,p_2,\dots,p_\kay)\in\Omega^\kay$ so that $\dist{p_i}{p_j}>\eps$ for all $i\not=j$.

\begin{clm}{Claim}
For any $q\in\spc{L}$ there is a positive constant and all sufficiently small $\eps>0$, 
the restriction $\dist{\bm{p}}{}|_{\oBall(q,\eps)}$ is a bi-Lipshitz embedding in $\RR^\kay$.
\end{clm}

\begin{clm}{Claim}
For any $q\in\spc{L}$ and all sufficiently small $\eps>0$, 
the restriction $\dist{\bm{p}}{}|_{\oBall(q,\eps)}$ is a bi-Lipshitz embedding in $\RR^\kay$.
\end{clm}
\qeds























Let $\bm{\phi}=(\phi_1,\phi_2,\dots,\phi_\kay)$ be an array of smooth real functions $\phi_i\:\RR\to\RR$ and $F\:\RR^\kay\subto\RR$ be a smooth subfunction.
Consider subfunction $\hmy{f}=F\circ\bm{\phi}$ then clearly
$$\hmy{f}''(x)
=
\Hess_{\bm{\phi}(x)}F(\bm{\phi}',\bm{\phi}')
+
\d_{\bm{\phi}(x)}F(\bm{\phi}'').$$ 
Thus if all $\phi_i$ are locally Lipshitz and semiconcave in $\Dom{\hmy{f}}$ and 
$F$ is semiconvex and increasing in each argument then $\hmy{f}$ is semiconcave.

Moreover, if all we know that $F$ is $\Lambda$-concave for some $\Lambda\le 0$, $\phi_i''(x)\le\lambda_i$ for $\lambda_i\ge 0$ and $\Lip_i$ is an upper bound for $\partial_iF$ then 
$$\hmy{f}''(x)
\le
\Lambda\delta
+
\sum_{i=1}^\kay\Lip_i\lambda_i,$$

These two claims have sense for general semiconcave functions $\phi_i$ and $F$. and 
 

\begin{thm}{Lemma}
Let $\spc{L}\in \CBB{}{}$,
$\bm{\phi}=(\phi_1,\phi_2,\dots,\phi_\kay)\:\spc{L}\to\RR^\kay$
be an array of semiconcave functions and $F\:\RR^\kay\subto\RR$ be a semiconcave subfunction which is increasing in each argument.
Then $\hmy{f}=F\circ\bm{\phi}$ is semiconcave.

Moreover, if $F''(\bm{\phi}(q))\le \Lambda$ and $\Lip$ is an upper bound for partial derivatives $\partial_iF$ then
$$\hmy{f}''(q)\le ???,$$
where 
$$\delta=\liminf_{x,y\to q}\frac{\dist{x}{y}}{|\bm{\phi}(x)-\bm{\phi}(y)|}.$$

\end{thm}

\parit{Proof.} 
It is sufficinet to prove only the 
second part of theoorem. 
Indeed, given a point $q\in \Dom \hmy{f}=\bm{\phi}^{-1}(\Dom F)$, 
one can restrict $F$ to a subdomain containing $\bm{\phi}(q)\in\RR^\kay$ to make it $\Lip$-Lipschitz and $\lambda$-concave for some real numbers $\Lip$ and $\lambda$.
In particular, $\Lip$ will become an apper bound for $\partial_iF$.

Let us introduce a partial order $\preccurlyeq$ on $\RR^\kay$; 
$\bm{v}\preccurlyeq\bm{w}$ if $v_i\le w_i$ for all $i\in[1..\kay]$,
where $\bm{v}=(v_1,v_2,\dots,v_\kay)$ and $\bm{w}=(w_1,w_2,\dots,w_\kay)\in\RR^\kay$.
Clearly $\bm{v}\preccurlyeq\bm{w}$ implies $F(\bm{v})\le F(\bm{w})$.

Fix small $\eps>0$.
Note that $F$ can be restricted to a subdomain containing $\dist{\bm{p}}{q}\in\RR^\kay$ so that $F$ will become Lipschitz (it follows from ???)
and each of the functions $\md_\kappa\circ\dist{p_i}{}$ is $(\cs_\kappa(\dist{p_i}{q})-\eps)$-concave in $\Dom\hmy{f}$.
In particular, if $[xy]$ is a geodesic in $\Dom\hmy{f}$ and $\ell=\dist{x}{y}$
then
$$\phi_i\circ\geod_{[xy]}(t)
\ge 
\tfrac{\ell-t}{\ell}\phi_i(x)
+
\tfrac{t}{\ell}\phi_i(y)
-
\tfrac12t(t-\ell)\cdot\lambda_i.$$
Equivalently,
$$\bm{\phi}\circ\geod_{[xy]}(t)
\succcurlyeq
\tfrac{\ell-t}{\ell}\bm{\phi}(x)
+
\tfrac{t}{\ell}\bm{\phi}(y)
-
\tfrac12t(t-\ell)\cdot\bm{\lambda},$$
where $\bm{\lambda}=(\lambda_1,\lambda_2,\dots,\lambda_\kay)\in\RR^\kay$.

Let $\Lip_i$ be an upper bound for $\partial_iF$.
Then
\begin{align*}
F\circ\bm{\phi}\circ\geod_{[xy]}(t)
&\ge
F(\tfrac{\ell-t}{\ell}\bm{\phi}(x)
+
\tfrac{t}{\ell}\bm{\phi}(y)
-
\tfrac12t(t-\ell)\cdot\bm{\lambda})
\ge
\\
&
\ge F(\tfrac{\ell-t}{\ell}\bm{\phi}(x)
+
\tfrac{t}{\ell}\bm{\phi}(y))
-
\tfrac12\l(\sum_{i=1}^{\kay}\Lip_i\lambda_i\r) t(t-\ell)
\ge
\\
&\ge
\tfrac1\ell[(\ell-t)F\circ\bm{\phi}(x)
+
tF\circ\bm{\phi}(y)]
-
(\lambda\frac{|\bm{\phi}(x)-\bm{\phi}(y)|}{\ell}+\kay\Lip\tfrac\lambda2) t(t-\ell)
\end{align*}


Since $F$ is increasing in each argument and $\Lip$-Lipschitz, we get


\qeds























\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{}{}$ and 
$\hmy{f}=F\circ\dist{\bm{p}}{}$,
where $\bm{p}=(p_1,p_2,\dots,p_\kay)\in\spc{L}^\kay$ is a point array
and $F\:\RR^\kay\subto\RR$ is a semiconcave subfunction which is increasing in each argument.
Then
$\hmy{f}\:\spc{L}\subto\RR$ is semiconcave in $\Dom\hmy{f}\backslash\{p_i\}_{i=1}^\kay$.

Moreover, 
if $F$ is $\lambda$-concave 
and $\Lip$ is an upper bound for $\partial_i F$
then
$$\hmy{f}''\le ???,$$
\end{thm}

\parit{Proof.} 
It is sufficinet to prove only the 
second part of theoorem. 
Indeed, given a point $q\in \Dom \hmy{f}$, 
one can restrict $F$ to a subdomain containing $\dist{\bm{p}}{q}\in\RR^\kay$ to make it $\Lip$-Lipschitz and $\lambda$-concave for some real numbers $\Lip$ and $\lambda$.
In particular, $\Lip$ will bcome an apper bound for $\partial_iF$.

Let us introduce a partial order $\preccurlyeq$ on $\RR^\kay$; 
$\bm{v}\preccurlyeq\bm{w}$ if $v_i\le w_i$ for all $i\in[1..\kay]$,
where $\bm{v}=(v_1,v_2,\dots,v_\kay)$ and $\bm{w}=(w_1,w_2,\dots,w_\kay)\in\RR^\kay$.
Clearly $\bm{v}\preccurlyeq\bm{w}$ implies $F(\bm{v})\le F(\bm{w})$.

Let $q\in\Dom \hmy{f}=(\dist{\bm{p}}{})^{-1}\Dom F$ and $q\not=p_i$ for each $i\in[1..\kay]$.


Fix small $\eps>0$.
Note that $F$ can be restricted to a subdomain containing $\dist{\bm{p}}{q}\in\RR^\kay$ so that $F$ will become Lipschitz (it follows from ???)
and each of the functions $\md_\kappa\circ\dist{p_i}{}$ is $(\cs_\kappa(\dist{p_i}{q})-\eps)$-concave in $\Dom\hmy{f}$.
In particular, if $[xy]$ is a geodesic in $\Dom\hmy{f}$ and $\ell=\dist{x}{y}$
then
$$\dist{p_i}{\geod_{[xy]}(t)}
\ge 
\tfrac{\ell-t}{\ell}(\dist{p_i}{x})
+
\tfrac{t}{\ell}(\dist{p_i}{y})
-
\tfrac12t(t-\ell)\cdot\lambda_i.$$
Equivalently,
if one defines 
$$\dist{\bm{p}}{\geod_{[xy]}(t)}
\succcurlyeq
\tfrac{\ell-t}{\ell}(\dist{\bm{p}}{x})
+
\tfrac{t}{\ell}(\dist{\bm{p}}{y})
-
\tfrac12t(t-\ell)\cdot\bm{\lambda},$$
where $\bm{\lambda}=(\lambda_1,\lambda_2,\dots,\lambda_\kay)\in\RR^\kay$.

Let $\Lip$ be an upper bound for $\partial_iF$.
Then
\begin{align*}
F\circ\dist{\bm{p}}{}\circ\geod_{[xy]}(t)
&\ge
F(\tfrac{\ell-t}{\ell}(\dist{\bm{p}}{x})
+
\tfrac{t}{\ell}(\dist{\bm{p}}{y})
-
\tfrac12t(t-\ell)\cdot\bm{\lambda})
\ge
\\
&
\ge F(\tfrac{\ell-t}{\ell}(\dist{\bm{p}}{x})
+
\tfrac{t}{\ell}(\dist{\bm{p}}{y}))
-
\tfrac12\Lip\l(\sum_{i=1}^{\kay}\lambda_i\r) t(t-\ell)
\ge
\\
&\ge
\tfrac1\ell[(\ell-t)F(\dist{\bm{p}}{x})
+
tF(\dist{\bm{p}}{y})]
-
(???+\kay\Lip\tfrac\lambda2) t(t-\ell)
\end{align*}


Since $F$ is increasing in each argument and $\Lip$-Lipschitz, we get


\qeds








First, let us construct a point array $\bm{p}=(p_1,p_2,\dots,p_\kay)$ such  that  $\dist{\bm{p}}{}|_\Omega$ is a bi-Lipschitz immersion;
i.e. there is $\eps>0$ such that \ref{eq:bilip} holds for any $x,y\in\Omega$ such that $\dist{x}{y}\le\eps$.








As ususal, we use bold font to denote an array%
\footnote{i.e. a finite sequnce}
of objects of the same type --- points, functions and so on.
For example, we may denote by $\bm{p}$ an array of points in a space $\spc{L}$;
i.e. $\bm{p}\in\spc{L}^\kay$ for some $\kay\in\ZZ_\ge$.














supdifferentials











$(\alpha_1,\alpha_2,\dots,\alpha_\kay)$ and $(\beta_1,\beta_2,\dots,\beta_n)$ such that 
$$\Phi(\bm{x})\le \sum\alpha_ix_i$$
for any $\bm{x}=(x_1,x_2,\dots,x_\kay)\in\RR^\kay$ and
$$\Psi(\bm{y})\le \sum\beta_iy_i$$
for any $\bm{y}=(y_1,y_2,\dots,y_\kay)\in\RR^\kay$



First let us define scalr product of two distance functions from points $p,q\in \spc{L}$ at $x\in \spc{L}$ the following way
$$\<\d_x\dist{p}{},\d_x\dist{q}{}\>
\df
\cos\inf\{\,\mangle(\xi,\zeta)\mid\xi\in\Dir_x^p,\zeta\in\Dir_x^q\,\}.$$
Futher, if  $\hmy{f}, \hmy{g}\in\MD(\spc{L},\RR)$, 
$\hmy{f}
\can
F\circ\dist{\bm{p}}{}$,
$\hmy{g}\can G\circ\dist{\bm{q}}{}$, 
$F$ and $G$ are smooth subfunctions then set
$$\<\d_x \hmy{f},\d_x \hmy{g}\>
\df
\sum_{i,j}[\partial_iF\cdot\partial_jG]\<\d_x \dist{p_i}{},\d_x\dist{q_i}{}\>$$
Finally, in case of general semiconcave $F$ and $G$ increasing in each argument, let us define $\<\d_x \hmy{f},\d_x \hmy{g}\>$ as an supremum of  are semiconcave, but not smooth we define 
$$
\sum_{i,j}[\partial_i\bar F\cdot\partial_j\bar G]\<\d_x \dist{p_i}{},\d_x\dist{q_i}{}\>$$
for all smooth supportsing functions $\bar F$ at $\dist{\bm{p}}{x}$ and $\bar G$ at $\dist{\bm{q}}{x}$.














Clearly??? $\spc{X}_n\GHto \spc{X}$ if and only if there is a sequence of positive numbers $\eps_n\to 0$ such that
$\spc{X}\le \spc{X}_n+\eps_n$ and $\spc{X}_n\le \spc{X}+\eps_n$ for each $n$.

Let $\spc{X}$ and $\{\spc{X}_n\}_{n=1}^\infty$ be metric spaces.
A sequence of maps $a_n\: \spc{X}\to \spc{X}_n$ is called \emph{approximating}, 
if for any compact subset $K\i \spc{X}$ and any $\eps>0$ we have
$$|\dist{a_n(x)}{a_n(y)}-\dist{x}{y}|<\eps$$
for any $x,y\in K$.














let us construct a set $\GB(R;x,y)\i \spc{L}$, called \emph{gradient $R$-bisector}\index{gradient bisector} for $x$ and $y$.
Set $f\z=\min\{\dist{x}{},\dist{y}{}\}$.
We say that a point $p\in\spc{L}$ lies on $\GB(R;x,y)$ 
if there is a point $q\in\spc{L}$ such that $\dist{x}{q}=\dist{y}{q}$
and $f$-radial curve $\sigma\:[s_{min},\infty)\to\spc{L}$ such that $p=\sigma(s)$ for some $s\le R$
and $\dist{x}{\sigma(s_{\min})}=\dist{y}{\sigma(s_{\min})}$.





















\parbf{Remark for AKP.} Can one make the following proof better?

\parit{The second part.}
The proof of the second part of lemma almost coinsides with step 1 in the proof of existance of gradient curves (\ref{thm:exist-grad-curv}).

Assume for some $s\ge 0$ and $\eps>0$, we have $|\nabla_{z_n}f_n|>s$ for any $z_n\in \oBall(x_n,\eps)$ and $\o$-almost all $n$,
then the second part of lemma would follow if $|\nabla_{x_\o} f_\o|\ge s$.

Applying open-close argument, for $\o$-almost all $n$ one can construct a unit-speed curve $\hat\alpha_n\:[0,\eps] \to \spc{L}_n$ starting at $x_n$, with a partition of $[0,\eps)$ into countable number of half-open intervals $[\varsigma_i,\bar\varsigma_i)$ 
so that for each $i$ we have 
\begin{enumerate}[(i)]
\item the restriction $\hat\alpha_n|_{[\varsigma_i,\bar\varsigma_i]}$ is a geodesic and $\bar\varsigma_i-\varsigma_i<\tfrac1n$.
\item 
$f_n\circ\hat\alpha_n(\bar\varsigma_i)-f_n\circ\hat\alpha_n(\varsigma_i)
>s(\bar\varsigma_i-\varsigma_i)$
\end{enumerate}

Set $\hat\alpha_\o=\olim_{n}\hat\alpha_{n}$, 
it is a $1$-Lipschitz curve in $\spc{L}_\o$ starting at $x_\o\in \spc{L}_\o$.
Clearly, 
$$f_\o\circ\hat\alpha_\o(t)-f_\o\circ\hat\alpha_\o(0)\ge st$$ 
for any $t\in[0,\eps)$.
Thus 
$$\sup_{\xi\in\Sigma_{x_\o}}\d_{x_\o}f_\o(\xi)\ge s$$
and therefore $|\nabla_{x_\o}f_\o|\ge s$.















\section{???Passage to the limit}

The next lemma states that gradient curves behave
nicely with Gromov--Hausdorff convergence, i.e. a limit of gradient curves is a
gradient curve for the limit function.



\parit{Proof.}
Let $\hat\alpha_n(s)$ denote the reparametrization of $\alpha_n(t)$ 
by arc length.
Since all $\hat\alpha_n$ are $1$-Lipschitz, 
 we can choose a partial limit, say $\hat\alpha(s)$ in $\spc{L}$.
Note
that we may assume that $f$ has no critical points and so
$\d(f\circ\hat\alpha)\not=0$. 
Otherwise consider instead the  sequence
$\spc{L}'_n=\spc{L}_n\times\RR$ with $f'_n(a\times x)=f_n(a)+x$.

Clearly, $\hat\alpha$ is also 1-Lipschitz and hence, by Lemma \ref{lem:gradcon},
$$\lim_{n\to\infty}f_n\circ\hat\alpha_n|_a^b=
\lim_{n\to\infty}\int\limits_a^b|\nabla_{\hat\alpha_n(s)} f_n|\d s\ge $$
$$\ge\int\limits_a^b|\nabla_{\hat\alpha(s)} f|\d s\ge 
\int\limits_a^b \d_{\hat\alpha(s)} f(\hat\alpha^+(s))\d s=
f\circ\hat\alpha|_a^b,$$
where $\hat\alpha^+(s)$ denotes any partial limit of
$\log_{\hat\alpha(s)}\hat\alpha(s+\eps)/\eps$, $\eps\to0+$.

On the other hand, since $\hat\alpha_n\to\hat\alpha$ and $f_n\to f$ we have
$f_n\circ\hat\alpha_n|_a^b \to f\circ\hat\alpha|_a^b$, 
i.e. equality holds in both of these inequalities. 
Hence 
$$|\nabla_{\hat\alpha(s)} f|= \lim_{n\to\infty} |\nabla_{\hat\alpha_n(s)} f_n|,\
\ \ 
|\hat\alpha^+(s)|= 1\ \ \ \text{a.e.}$$
and the directions of $\hat\alpha^+(s)$ and  $\nabla_{\hat\alpha(s)} f$ 
coincide almost everywhere.

This implies that $\hat\alpha(s)$ is a gradient curve reparametrized by 
arc length. 
It only remains to show that the original 
parameter $t_n(s)$ of $\alpha_n$ converges to the original 
parameter $t(s)$ of $\alpha$.

Notice that $|\nabla_{\hat\alpha_n(s)} f_n|\,\d t_n=\d s$ or 
$\d t_n/\d s=\d s/\d(f_n\circ\hat\alpha_n)$. 
Likewise, $\d t/\d s=\d s/\d(f\circ\hat\alpha)$. 
Then the convergence $t_n\to t$ follows from the $\lambda$-concavity of 
$f_n\circ\hat\alpha_n$ (see Lemma~\ref{lem:concave}) 
and the convergence $f_n\circ\hat\alpha_n\to f\circ\hat\alpha.$
\qeds









\section{Controlled concavity; first example}

Althogh Alexandrov spaces are rich of semiconcave functions, the construction of strictly concave function is not obvious.
The constuction of strictly concave function in a neigbourhood of given point was done in~\cite[3.6]{perelman:morse}.

In this section we repeat this construction and in the next we give a general rule for constructing such function which can be easey addapted for someone's needs.

\begin{thm}{Theorem}
\label{thm:strictly-concave}
Let $\spc{L}\in\CBB m \kappa$. 

For any point $p\in \spc{L}$ there is a strictly concave function $f$ defined in an
open neighborhood of $p$.

Moreover, given $v\in \T_p$, the differential, $\d_p f(x)$, can be chosen
arbitrarily close to $x\mapsto -\<v,x\>$
\end{thm}

The idea in the proof is essentially the same idea as in \ref{lem:->|gamma'|}.

\begin{wrapfigure}{r}{25mm}
\begin{lpic}{pics/strictly-concave(0.1)}
\lbl[tr]{125,05;$q$}
\lbl[br]{32,166;$\gamma(t)$}
\lbl[l]{44,159;$\alpha(t)$}
\end{lpic}
\end{wrapfigure}

\parit{Proof.} 
Consider the real function 
$$\phi_{r,c}(x)=(x-r)- c{(x-r)^2}/r,$$
so we have 
$$\phi_{r,c}(r)=0,\ \ \phi_{r,c}'(r)=1\ \ \phi_{r,c}''(r)=- {2c}/{r}.$$ 

Let $\gamma$ be a unit-speed geodesic, fix a point $q$ and set 
$$\alpha(t)=\mangle(\gamma^+(t),\dir{\gamma(t)}{q}).$$
If $r>0$ is sufficiently small and $\dist{q}{\gamma(t)}$ is sufficiently close to
$r$, then direct calculations show that
$$(\phi_{r,c}\circ\dist{q}{}\circ\gamma)''(t)\le \frac{3-c\cos^2\alpha(t)}{r}.$$

Now, assume $\{q_i\}$, $i=\{1,..,N\}$ is a finite set of points such that $\dist{p}{q_i}=r$ for any $i$. 
For $x\in \spc{L}$ and $\xi_x\in \Sigma_x$, set $\alpha_i(\xi_x)=\mangle(\xi_x,\dir p{q_i})$. 
Assume we have a collection $\{q_i\}$ such
that for any $x\in \oBall(p,\eps)$ and $\xi_x\in \Sigma_x$ we have  $\max_i\{|\alpha_i(\xi_x)-\tfrac\pi2|\}\ge\eps>0$. 
Then  taking in the above inequality $c>3N/\cos^2\eps$, we get that the function
$$f=\sum_i \phi_{r,c}\circ\dist{q_i}{}$$
is strictly concave in $\oBall(p,{\eps'})$ for some positive $\eps'<\eps$.

To construct the needed collection $\{q_i\}$, note that for small $r>0$ one can
construct $N_\delta\ge \Const/\delta^{(m-1)}$ points $\{q_i\}$ such that $\dist{p}{q_i}=r$
and $\angk \kappa p{q_i}{q_j}>\delta$ (here $\Const=\Const(\Sigma_p)>0$).
On the other hand, the set of directions which is orthogonal to a given direction
is smaller than $\SS^{m-2}$ and therefore contains at most
$\Const(m)/\delta^{(m-2)}$ directions with angles at least $\delta$. 
Therefore, for small enough $\delta>0$, $\{q_i\}$ forms the needed collection.

If $r$ is small enough, points $q_i$ can be chosen so that all directions
$\dir p{q_i}$ will be $\eps$-close to a given direction $\xi$ and
therefore the second property follows.
\qeds

Note that in the theorem~\ref{thm:strictly-concave} (as well as in
theorem~\ref{exist-control}), the function $f$ can be chosen to have maximum value $0$ at $p$,
$f(p)=0$ and with $\d_p f(x)$ arbitrary close to $-|x|$.
It can be constructed by taking the minimum of the functions in these theorems. 

In particular it follows that

\begin{thm}{Claim}\label{cor:convex-nbhd}
For any point of an Alexandrov's space there is an arbitrary small closed convex
neighborhood.
\end{thm}

By rescaling and passing to the limit one can even estimate the size of the convex
hull in an Alexandrov's space in terms of the volume of a ball containing it:

\begin{thm}{Lemma on strictly concave convex hulls \cite[4.3]{perelman-petrunin:extremal}}
For any $v>0$, $r>0$ and $\kappa\in \RR$, $m\in\NN$ there is $\eps>0$ such that,
if $\spc{L}\in\CBB m \kappa$ and $\vol \oBall(p,{r})\ge v$ then for any set $\spc{X}\i\oBall(p,{r})$  $\rho<\eps r$, 
$$\diam\l(\Conv \spc{X}\r)\le \diam \spc{X}/\eps.$$

In particular, if $\spc{L}$ is compact then there is $\Const\in \RR$ such that for
any subset $\spc{X}\i \spc{L}$
$$\diam \l(\Conv \spc{X} \r)\le \Const\cdot\diam \spc{X}.$$
\end{thm}





\section{Controlled concavity; general definition.} 
The above construction can be generalized and optimized in many ways to fit
particular needs. 
Here we introduce such variation which is general enough to work in most applications.

Let $\spc{L}$ be an Alexandrov's space and $f\:\spc{L}\to \RR$,
$$f=\Theta((\dist{q_1}{})^2,(\dist{q_2}{})^2,\dots,(\dist{q_N}{})^2)$$ be a \emph{simple
function} (see section~\ref{adm}).
If $\spc{L}$ is $m$-dimensional, we say that such a function $f$ has \emph{controlled
concavity of type} $(\lambda,\kappa)$ at $p\in \spc{L}$, if for any $\eps>0$ there is
$\delta>0$, such that for any collection of points $\{\~ p,\~ q_i\}$ in
the \emph{model $m$-space}\footnote{i.e. a simply connected $m$-manifold with
constant curvature $\kappa$.} $\Lob{m}{\kappa-\delta}$  satisfying 
$$\dist{\~ q_i}{\~ q_j}> \dist{q_i}{q_j}-\delta
\ \ \text{and}\ \  
\bigl|\dist{\~p}{\~q_i}-\dist{p}{q_i}\bigr|<\delta \ \ \text{for all}\ \ i,j,$$ 
we have that the function 
$\~ f\:\Lob{m}{\kappa-\delta}\to \RR$ defined by 
$$\~ f
=\Theta((\dist{\~q_1}{})^2,(\dist{\~ q_2}{})^2,\dots,(\dist{\~q_n}{})^2)$$
is $(\lambda-\eps)$-concave in a small neighborhood of $\~p$.

The following lemma states that the conrolled concavity is stronger than the usual
concavity.

\parbf{Examples.} Let $\spc{L}\in\CBB m \kappa$, $N>\pack_\eps\SS^{m-2}$, $p,q_1,q_2,\dots,q_N\in \spc{L}$ and $r\in\RR_>$ are such that 
$\dist{p}{q_i}=r$, 
$\angk\kappa p{q_i}{q_j}>\eps$ for all $i\not=j$.
Consider the real function 
$$\phi_{r,c}(x)=(x-r)- c{(x-r)^2}/r,$$
so we have 
$$\phi_{r,c}(r)=0,\ \ \phi_{r,c}'(r)=1\ \ \phi_{r,c}''(r)=- {2c}/{r}.$$ 
Then for large enough constannt $c$ the function
$$f=\sum_i \phi_{r,c}\circ\dist{q_i}{}$$
is of controlled type ??? at $p$.

Let $\spc{L}\in\CBB m \kappa$, $N>\pack_\eps\SS^{m-3}$, $p,a_1,a_2,q_1,q_2,\dots,q_N\in \spc{L}$ are such that $p$ is a midpoint of $[a_1a_2]$, 
$\angk\kappa p{a_i}{q_j}>\tfrac{\pi}{2}-\eps$ for all $i\in[1..2]$, $j\in[1..N]$
and
$\angk\kappa p{q_i}{q_j}>10\eps$ for all $i\not=j$ in $[1..N]$ and $\phi_{r,c}$ as above.
Then 
$$f=\phi_{???}\circ\dist{a_1}{}+\phi_{???}\circ\dist{a_2}{}+\sum_i \phi_{r,c}\circ\dist{q_i}{}$$
is of controlled type ??? at $p$.





\begin{thm}{Lemma} \label{contr-concave}
Let $\spc{L}\in\CBB m \kappa$.

If a simple function 
$$f=\Theta((\dist{q_1}{})^2,(\dist{q_2}{})^2,..,(\dist{q_N}{})^2),\ \ f\:\spc{L}\to\RR$$ 
has a conrolled concavity type $(\lambda,\kappa)$ at each point $p\in \Omega$, then
$f$ is $\lambda$-concave in $\Omega$. 
\end{thm}

The proof is just a direct calculation similar to that in the proof
of~\ref{thm:strictly-concave}. 
Note also, that the function constructed in the proof of
theorem~\ref{thm:strictly-concave} has controlled concavity.
In fact from the
same proof follows:

\begin{thm}{Existence} \label{exist-control}
Let $\spc{L}\in\CBB m \kappa$, $p\in \spc{L}$, $\lambda,\kappa\in\RR$.
Then there is a function $f$ of controlled concavity $(\lambda,\kappa)$
at $p$.

Moreover, given non-zero vector $v\in \T_p$, 
the function $f$ can be chosen so that its differential $\d_p f(x)$ will be arbitrary close to $x\mapsto -\<v,x\>$.
\end{thm}

\begin{thm}{Function on product}
Let $\spc{L}\iso \spc{L}'\times \RR\in\CBB{m+1}{0}$.
Then for any point $p=(p',0)\in \spc{L}$ there is a function $f\:\spc{L}\to\RR$ such that
\begin{enumerate}
\item $f$ has controlled concavity type $(-1, 0)$ at $p$;
\item $f(p',t)=-\tfrac12t^2+o(t^2)$.
\end{enumerate}
\end{thm}

Consider an arbitrary function $f'\sum\phi\dist{r_i}{}$ as in ???.
The function 

Since functions with a conrolled concavity are simple they admit liftings, and
from the definition it is clear that these liftings also have controlled
concavity of the same type, i.e. 

\begin{thm}{Concavity of lifting} \label{lem:lifting}
Let $\spc{L}\in\CBB m \kappa$.

Assume a simple function 
$$f\:\spc{L}\to \RR,\ \ f=\Theta((\dist{q_1}{})^2,(\dist{q_2}{})^2,\dots,(\dist{q_N}{})^2)$$
has controlled concavity type $(\lambda,\kappa)$ at $p$.

Let $\spc{L}_n\in\CBB m \kappa$ be a non-collapsing sequence,
$\spc{L}_n\GHto \spc{L}$  
and $\{p_n\},\{q_{i,n}\}\in \spc{L}_n$ be sequences of points such that $p_n\to p\in \spc{L}$ and  $q_{i,n}\to q_i\in \spc{L}$
for each $i$.

Then for all large $n$, the liftings of $f$,
$$f_n\:\spc{L}_n\to \RR,\ \
f_n=\Theta((\dist{q_{1,n}}{})^2,(\dist{q_{2,n}}{})^2,\dots,(\dist{q_{N,n}}{})^2)$$
have controlled concavity type $(\lambda,\kappa)$ at $p_n$. 
\end{thm}

In other words, if  $f\:\Omega\i \spc{L}\to \RR$ has controlled concavity type $(\lambda,\kappa)$ at each $p\in \Omega$ then
there is a sequence of functions $f_n\:\Omega_n\i \spc{L}_n\to\RR$ of controlled concavity type $(\lambda,\kappa)$.
sense).

\parbf{Examples.}
Let $\spc{L}\iso\EE^n\times \spc{L}'$, $\spc{L}'\in\CBB{m}{\kappa}$ then for any point $p\in \spc{L}$ there is a subfunction $f\:\spc{L}\subto\RR$, $p\in\Dom f$ of controlled concavity type $(-1,n+m)$ such that the restriction to any $\EE^n\times x$ is ???



\begin{thm}{Lemma}\label{lem:exist-CCT} 
There is a subfunction $f\:\T_p\subto\RR$ of controlled concavity type $(-1,0)$ with maximum at $o_p$.
Moreover, $f$ can be chosen so that
$$f(v)=-\tfrac12|v|^2+o(|v|^2)$$
for $v\in\Lin_p$.
\end{thm}

\def\lin{\mathop{\rm lin}\nolimits}
\parit{Proof.}
For a vector $v\in\T_p$, let us denote by $\lin v$ its orthogonal projection to $\Lin_p$.
Choose a fuction $\phi$ as in ???
\qeds











Here we present a trick which is very useful for doing local analysis in
Alexandrov's spaces, it was introduced in \cite[section 5]{otsu-shioya}.

Let $\mu$ be a regular probabiliy measure on $\spc{L}$;
i.e. $\int_\spc{L}\mu=1$ and $\mu=f\,\d x$ for some ??? function $f\:\spc{L}\to\RR$.

Set 
$$\dist \mu(y)=\sqrt{\int\limits_\spc{L}(\dist{y}{x})^2\cdot\mu(x)}.$$
Note that $\dist \mu(y)$ coinsides with Wassershtein distance between $\mu$ and $\delta$-measure at $y$.
The function $\dist \mu(y)$ has many important properties of distance function and in certain respect it is better.
It is semiconcave in $\spc{L}$....








Now let us give a constructive definition to the class of functions which will play role of smooth functions for $\CBB{}{}$-spaces.
A functionf $f\:\spc{L}\to \RR$ will be called Otsu function if there is a smooth function $\Phi\:\RR^n\to\RR$ and a collection of $n$ probability measures $\mu_1,\mu_2,\dots,\mu_n$ such that $f=\Phi(\dist {\mu_1},\dist {\mu_2},\dots,\dist {\mu_n})$. 

It is clear that the class of Otsu functions is closed with respect to ariphmetic operations, ...

If $f$ is an Otsu function then differential $\d_pf$ is well defined and linear at each regular point.
More over, for any point $p\in \spc{L}$ the restriction $\d_pf|_{\Lin_p}$ is a linear function.

Let $\bm{f}=\sum_if_i\bm{e}_i$ be a map such that each $f_i$ is an Otsu function.
We say that $\bm{f}$ is regular at $p\in \spc{L}$ if there is a neigborhood $\Omega\ni p$ such that at any regular point $q\in \Omega$ we have $\det(\<\nabla_q f_i,\nabla_q f_j\>)>0$.














\parit{Proof of theorem~\ref{thm:tight-map}.}
Let $\gamma\:[0,s]\to \spc{L}$ be a minimal unit-speed geodesic connecting $x,y\in \Dom\bm{f}$, so $s=\dist{x}{y}$.
Consider a straight segment $\bar\gamma$ connecting $\bm{f}(x)$ and $\bm{f}(y)$: 
$$\bar\gamma\:[0,s]\to\RR^{\kay+1},\ \  \bar\gamma(t)=\bm{f}(x)+\tfrac
t s\l[\bm{f}(y)-\bm{f}(x)\r].$$
Each function $f_i\circ\gamma$ is concave, therefore all coordinates of 
$$\bm{f}\circ\gamma(t)-\bar\gamma(t)$$ 
are non-negative.
This implies that the Minkowski sum\footnote{equivalently 
$Q=\{(x_0,x_1,\dots,x_\kay)\in\RR^{\kay+1}|\exists(y_0,y_1,\dots,y_\kay)\in
\Im\bm{f}\forall i\  x_i\le y_i\}$.} 
$$Q=\Im\bm{f}+(\RR_-)^{\kay+1}$$ 
is a convex set.

Let $x_0\in \Dom\bm{f}$ be a critical point of $\bm{f}$. 
Since $\min_i\d_{x_0}f_i\le 0$, at least one of coordinates
of $\bm{f}(x)$ is smaller than the corresponding coordinate of $\bm{f}(x_0)$ for any $x\in\Dom\bm{f}$.
In particular, $\bm{f}$ sends its critical point to the boundary of $Q$.

Consider map 
$$G\:\RR^{\kay+1}\to \spc{L}, \ \ G\:(y_0,y_1,\dots,y_\kay)\mapsto
\argmax\{\min_i\{f_i-y_i\}\}$$
where \label{argmax}$\argmax\{f\}$ denotes a maximum point of $f$.
The function $\min_i\{f_i-y_i\}$ is strictly concave; 
therefore
$\argmax\{\min_i\{f_i-y_i\}\}$ is uniquely defined and $G$ is continuous in the
domain of definition.\footnote{We do not need it, but clearly
$$G(y_0,y_1,\dots,y_\kay)=G(y_0+h,y_1+h,\dots,y_\kay+h)$$ for any $h\in \RR$.} 
The image of $G$ coincides with the set of critical points of $\bm{f}$ and moreover $G\circ
\bm{f}|_M=\id_M$. 
Therefore $\bm{f}|_M$ is a homeomorphism\footnote{In general, $G$ is not Lipschitz
(even on $\bm{f}(M)$); even in the case when all functions $f_i$ are $(-1)$-concave it is only
possible to prove that $G$ is H\"older continuous of class $C^{\frac12}$. (In
fact the statement in \cite{perelman:spaces2}, page 20, lines 23--25 is wrong
but the proposition 3.5 is still OK.)}.\qeds










\begin{thm}{Main theorem}\label{thm:tight-map}
Let $\spc{L}\in\CBB{m}{\kappa}$,
$$\bm{f}\:\spc{L}\subto \RR^{\kay+1},\ \ \bm{f}\:x\mapsto(f_0(x),f_1(x),\dots,f_\kay(x))$$ 
be a tight array and $\Dom\bm{f}\i \spc{L}$ be the interior of a compact convex subset.
Assume all $f_i$ are strictly concave.
Then 
\begin{subthm}{}the set of critical points of $\bm{f}$ forms an $\kay$-submanifold $M$ 
\end{subthm}

\begin{subthm}{}  $\bm{f}\:M\to\RR^{\kay+1}$ is an embedding. 
\end{subthm}

\begin{subthm}{}$\bm{f}(M)\i \RR^{\kay+1}$ is a convex hypersurface which lies in the boundary of
$\Up\Im\bm{f}$. 
In fact, $\bm{f}(M)=\Im\bm{f}\cap \partial \Im\bm{f}$.
\end{subthm}
\end{thm}


Applications.}
\label{app-tight} 

One series of applications of tight maps is Morse theory 
for Alexandrov's spaces, it is based on the
main theorem~\ref{thm:tight-map}. 
It includes Morse lemma (property~\ref{morse} page~\pageref{morse}) and

\begin{itemize}

\item{\it Local structure theorem \cite{perelman:morse}.}
Any small spherical neighborhood of a point in an Alexandrov's space is homeomorphic to a cone over its boundary.

\item{\it Stability theorem \cite{perelman:spaces2}.} 
For any compact $\spc{L}\in \CBB m\kappa$ there is $\eps>0$ such that if $\spc{L}'\in \CBB m\kappa$ is $\eps$-close to $\spc{L}$ then $\spc{L}$ and $\spc{L}'$ are homeomorphic.

\end{itemize}










Here is yet another, completely Riemannian application. This statement has been
proven by Perelman, a sketch of its proof is included in an appendix to
\cite{petrunin:PL}.
The proof is based on the following observation: if $\Omega$ is an open subset of a Riemannian manifold and  $\bm{f}\:\Omega\to\RR^{\kay+1}$ is a strongly concave tight array, then its level sets $\bm{f}^{-1}(x)$ inherit the lower curvature bound. 
\begin{itemize}
\item \emph{Continuity of the integral of scalar curvature.} 
Given  a compact Riemannian manifold $M$, let us define $\mathcal F(M)=\int_M\Sc$. 
Then $\mathcal F$ is continuous on the space of Riemannian
$m$-dimensional manifolds with uniform lower curvature and upper diameter
bounds.\footnote{In fact $\mathcal F$ is also bounded on the set of Riemannian
$m$-dimensional manifolds with uniform lower curvature, this is proved in
\cite{petrunin:scalar} by a similar method.}
\end{itemize}














Let $\spc{L}\in\CBB{m}{}$, a point $p\in \spc{L}$ is called \emph{regular}\index{regular point} if its tangent cone $\T_p$ is isometric to Euclidean $m$-space;
otherwise $p$ is called \emph{singular}\index{singular point}.
For singular point $p$, one can charatarize how far it is from being regular.
One of the main characteristic is its linear rank, 
$???lin_p\spc{L}=\dim\Lin_p$.
Yet an other characteristicis is rough rank $\rank_p\spc{L}=\pack_{\pi/2}\Sigma_p-1$.
Clearly $???lin_p\le \rank_p$.















One can also choose an array of points
Let $\xi\in \Sigma_p$ be a direction such that $\d_pf_i(\xi)>0$ for each $f_i$.
Appling theorem~\ref{thm:strictly-concave}, we obtain a function $g$, 
such that $\d_pg$ is arbitrary close to $x\mapsto -\<\xi,x\>$.
Indeed, one can take $g=\dist{p}{}$, where $p$ as in the property~\ref{open-reg}.
Then we have 
$$\d_x g(v)=-\max_{\xi\in\Dir_x^p}\<\xi,v\>$$
and therefore
$$\d_x g(\nabla_x f_i)
=
-\max_{\xi\in\Dir_x^p}\<\xi,\nabla_x f_i\>
\le
-\max_{\xi\in\Dir_x^p} \d_x f(\xi)
\le
-\eps.$$
On the other hand, from ???, we have
$$\d_x f_i(\nabla_x g)+\min_{\xi\in\Dir_x^p} \d_x f_i(\xi)\le 0.$$
The last statement follows from the construction in
theorem~\ref{thm:strictly-concave}. 
























\section{Tight function arrays}


\begin{thm}{Definition}\label{def:tight} 
Let $\spc{L}\in \CBB{m}{\kappa}$.
An array of multidistant subfunctions $\bm{\hmy{f}}=(\hmy{f}_0,\hmy{f}_1,\dots,\hmy{f}_\kay)\:\spc{L}\subto\RR^{\kay+1}$ 
is called \emph{tight} at $p\in\Dom \bm{\hmy{f}}$ if 
$$\<\d_p\hmy{f}_i,\d_p\hmy{f}_j\><0$$
for all $i\not=j$.

A point $x\in\Dom \bm{f}$ is called a \emph{critical point} of array $\bm{\hmy{f}}$ if $\min_i\d_x \hmy{f}_i\le
0$; 
otherwise the point $x$ is called \emph{regular}.
\end{thm}

Let us start with elementary properties of critical and regular points of a tight array.


 




\begin{thm}{Corollary}\label{cor:conv-chart}
In the assumptions of theorem ???, if in addition $m=\kay$ then
$M=\Dom\bm{f}$, $\Im\bm{f}$ is a convex hypersurface in $\RR^{m+1}$ and $\bm{f}$ is a locally bi-Lipschitz embedding of $\Dom \bm{f}$. 
Moreover, each projection of $\bm{f}$ to a coordinate hyperplane is a locally
bi-Lipschitz homeomorphism.
\end{thm}








Let us list some properties of tight arrays with sketches of proofs:
\begin{enumerate}

\item\label{lip+} 
Let $\bm{f}\:\spc{L}\subto\RR^{n+1}$ is tight. 
Then there is $\eps>0$ such that for any $\eps$-Lipschitz semiconcave submap $\bm{h}\:\spc{L}\subto\RR^{n+1}$, the sum 
$\bm{f}+\bm{h}$ is also tight.

\item\label{co_Lipschitz} A tight array is open and even \emph{co-Lipschitz}\footnote{A map $F\: \spc{X}\to \spc{Y}$ between
metric spaces is called $\Lip$-co-Lipschitz in $\Omega\i \spc{X}$ if for any ball $\oBall(x,r)\i
\Omega$ we have $F(\oBall(x,r))\supset \oBall(F(x,r/\Lip))$ in $\spc{Y}$} in a neighborhood of
any regular point.

This follows from lemma~\ref{lem:tight-dir}.

\item \label{open-reg}
The set of regular points of a tight array is open. 

Indeed, let $x\in\Dom \bm{f}$ be a regular point of tight array $\bm{f}=(f_0,f_1,\dots,f_\kay)$. 
Take real $\lambda$ so that all $f_i$ are $\lambda$-concave in a neighborhood of
$x$.
Take a point $p$ sufficiently close to $x$ such that $\d_x f_i(\dir x p)>0$
and moreover $f_i(p)-f_i(x)>\tfrac\lambda2(\dist{x}{p})^2$ for each $i$.
Then, from $\lambda$-concavity of $f_i$, there is a small neighborhood
$\Omega_x\ni x$ such that for any $y\in\Omega_x$ and $i$ we have $\d_y
f_i(\dir y p)\ge\eps$
for some fixed $\eps>0$.

\item Let $\spc{L}\in\CBB{m}\kappa$ and $\bm{f}\:\spc{L}\subto\RR^{\kay+1}$ be tight then $\kay\le\dim \spc{L}$.

Follows from the properties~\ref{minus-funct} and \ref{co_Lipschitz}.
\end{enumerate}

The following lemma is an analog of lemmas 
\cite[2.3]{perelman:morse} and \cite[2.2]{perelman:DC}.

\begin{thm}{Lemma}\label{lem:tight-dir} Let $x$ be a regular point of a tight
array $$\bm{f}=(f_0,f_1,\dots,f_\kay).$$
Then there is $\eps>0$ and a neighborhood $\Omega_x\ni x$ such that for any
$y\in \Omega_x$ and $i\in\{0,1,\dots,\kay\}$ there is a unit vector $w_i\in \Sigma_x$
such that $\d_x f_i(w_i)\ge\eps$ and $\d_x f_j(w_i)=0$ for all $j\not=i$. 

Moreover, if $E\i \spc{L}$ is an extremal subset and $y\in E$ then $w_i$ can be
chosen in $\Sigma_y E$.

\end{thm}

\parit{Proof.} Take $p$ as in the property \ref{open-reg} page~\pageref{open-reg}.
Then we can find a neighborhood $\Omega_x\ni x$ and $\eps>0$ so that for any
$y\in \Omega_x$
\begin{enumerate}[(i)]
\item $\d_y f_i(\dir y p)>\eps$ for each $i$;
\item $-\d_y f_i(\nabla_y f_j)>\eps.$ for all $i\not=j$.
\end{enumerate}

Note that if $\alpha(t)$ is an $f_i$-gradient curve in $\Omega_x$ then 
$$(f_i\circ\alpha)^+>0
\ \ \text{and}\ \ 
(f_j\circ\alpha)^+\le -\eps
\ \ \text{for any}\ \ 
j\not=i.$$
Applying  lemma~\ref{lem:stable-grad-curves} for
$(\lam \spc{L},y)\GHto \T_y$, $\lam[f_i-f_i(y)]\to \d_y f_i$, we get the same inequalities for 
$\d_y f_i$-gradient curves on $\T_y$, i.e. if $\beta(t)$ is an $\d_y
f_i$-gradient curve in $\T_y$ then 
$$(\d_y f_i\circ\beta)^+>0\ \ \text{and}\ \ (\d_y f_j\circ\beta)^+\le-\eps\ \
\text{for any}\ \ j\not=i.$$
Moreover, $\d_y f_i(v)>0$
implies $\<\nabla_v\d_y f_i,\dir {v}o\><0$, therefore in this case $|\beta(t)|^+>0$.

Take $w_0\in \T_y$ to be a maximum point for $\d_y f_0$ on the set 
$$\{v\in \T_y|f_i(v)\ge0, |v|\le 1\}.$$
Then
$$\d_y f_0(w_0)\ge \d_y f_0(\dir y p)>\eps.$$
Assume for some $j\not=0$ we have $f_j(w_0)>0$.
Then 
$$\min_{i\not=j} \{\d_{w_0}\d_y f_i,\d_{w_0}\nu\}\le 0,$$
where the function $\nu$ is defined by $\nu\:v\mapsto -|v|$; this is a concave function
on $\T_y$.
Therefore, if $\beta_j(t)$ is a $\d_y f_j$-gradient curve with an end\footnote{it does exist by property \ref{grad-onto} on page
\pageref{grad-onto}} point at
$w_0$, then moving along $\beta_j$ from $w_0$ backwards decreases only
$\d_y f_j$,  and increases the other $\d_y f_i$ and $\nu$ in the first order.\contradiction

To prove the last statement it is enough to show that $w_0\in \T_y E$, which follows since $\T_y E\i \T_y$ is an extremal subset (see property~\ref{ext-tangent} on page~\pageref{ext-tangent}).  \qeds









\section{Distance-diagonal map}

In this section we introduce Distance-diagonal maps (DD-maps) --- an close analog of ``almost regular maps'' used in \cite[11.7]{BGP}. 
Then we prove for them an analog of inverse function theorem.

This theorem works in $\CBB{}{}$-spaces of arbitrary dimension; 
the reader interested mainly in spaces of finite Hausdorff dimension can skip it.
The proof of analogous result in finite dimensional case is much simpler, see ???.
One of the main application of this theorem is existnce of embedding of a $\oBall^m$ in a $\CBB{}{}$-space with infinite Hausdorff dimension, see \ref{TopDim};
in turn it proves that Lebegue's covering dimension of such space must be infinite (\ref{dim=dim}).
The later statement admits a simpler proof based on exercise~???. 

\begin{thm}{Definitions}
We will consider $\RR^{m+1}$ with standard basis $\{\bm{e}_i\}$. 
By $\WW^m$ we will denote the \emph{diagonal hyperplane} in $\RR^{m+1}$; i.e. the hyperplane defined by 
$$\WW^m=\l\{\bm{x}=\sum_{i=0}^mx_i\bm{e}_i\in\RR^{m+1}\,\l|\,\sum_{i=0}^mx_i=0\r.\r\}.$$
%Given $\bm{x}\in\RR^{m+1}$ we will denote by $\bar{\bm{x}}$ its orthogonal projection to $\WW^m$; i.e. $\bar{\bm{x}}=\sum_i (x_i-\bar x){\bm{e}}_i$, where $\bar x=\tfrac1{m+1}\sum_ix_i$.
Set $\proj\:\RR^{m+1}\to\WW^m$ to be the orthogonal projection to $\WW^m$.

\smallskip

Let $\spc{L}\in\CBB{}{\kappa}$ and $p\in \spc{L}$.
We say that $a_0,a_1,\dots,a_m\in \spc{L}$ is a \emph{array of strainers} at $p$ if $\angk{\kappa}p{a_i}{a_j}>\tfrac\pi2$ for all pairs $i\not=j$ from $[0,..,m]$.

\smallskip

Given an array $\bm{a}=(a_0,a_1,\dots,a_\kay)$ of points in $\spc{L}$, consider map 
${\bm{w}}\:\spc{L}\to\WW^m$
$${\bm{w}}=\proj\circ\dist{\bm{a}}{}.$$
This will be called \emph{DD-map}\index{DD-map} 
for $(a_i)_{i=0}^n$.
If $\{a_i\}$ forms a array of strainers at $p\in \spc{L}$, then the DD-map ${\bm{w}}$ is called \emph{regular at}\index{regular!regular DD-map} $p$.
\end{thm}

\begin{thm}{Right-inverse function theorem}\label{thm:inverse-function}
Let $\spc{L}\in\CBB{}\kappa$,
${\bm{w}}\:\spc{L}\to \WW^m$ be a DD-map regular at $p\in \spc{L}$.
Then there is a $C^{\frac12}$-continuos submap $F\:\WW^m\subto \spc{L}$ 
such that $F\circ{\bm{w}}(p)=p$ and ${\bm{w}}\circ F\:\WW^m\subto\WW^m$ is the identity on $\Dom F$.

In particular, $F$ is a $C^{\frac12}$-embedding of $\Dom F\i \WW^m$ in $\spc{L}$.

Moreover, submap $F$ can be chosen on such a way that there is a Lipschitz submap $F'\:\oBall^m\subto \spc{L}$ such that $\Im F\i \Im F'$. 
\end{thm}

The conclusion of this theorem holds for bigger classes of ``regular maps'', see also question~\ref{q:regular}.
We stick to this formulation since
it is sufficient for all the applications.
As a corollary we obtain the following:

\begin{thm}{Open map theorem}\label{thm:open-map}
Let $\spc{L}\in\CBB{}\kappa$ and ${\bm{w}}\:\spc{L}\to \WW^m$ be a DD-map regular at $p$.
Then the map ${\bm{w}}$ is open in a neigborhood of $p$.
\end{thm}

This corollary will be used to show that $m$-dimensional Husdorff measure on an $\CBB{m}{}$-space does not vanish (see ???); 
which is the first step in the measure theory on finite dimensional $\CBB{}{}$-spaces.

\parit{Proof.}
Note that if a DD-map is regular at $p$ then it is regular at any point $q$ of a small neighborhood $\Omega$ of $p$.
Thus, applying right-inverse function theorem for all $q\in \Omega$ we get that restriction ${\bm{w}}|_{\Omega}$ is open.
\qeds


\parit{Proof of \ref{thm:inverse-function}.} 
Let ${\bm{w}}$ be DD-map for $a_0,a_1,\dots,a_m$, so $\{a_i\}$ forms an array of strainers at $p$.

Set $h_i=\dist{a_i}-\dist{a_i}{p}$.
Fix $\eps,r,\lambda>0$ such that 
\begin{enumerate}[(i)]
\item Each $h_i$ is $\lambda$-concave in $\oBall(p,r)$.
\item $\angk{\kappa}{q}{a_i}{a_j}>\tfrac\pi2+\eps$ for any $q\in \oBall(p,r)$ and $i\not=j$.
\end{enumerate}


Given $\bm{x}\in \WW^m$, $\bm{x}=\sum_{i=0}^m x_i\bm{e}_i$, consider  function 
$f_{\bm{x}}\:\spc{L}\to \RR$ defined as
$$f_{\bm{x}}(q)=\min_{i=[0..m]}\{h_i(q)-x_i\}.$$
Note that $f_{\bm{x}}$ is $\lambda$-concave in $\oBall(p,r)$.
Denote by $\alpha_{\bm{x}}(t)$ the $f_{\bm{x}}$-gradient curve which starts at $p$.

\begin{thm}{Claim}
If $|\bm{x}|<\tfrac{\eps r}{4}$ and $t= \tfrac{2}\eps|\bm{x}|$ then 
${\bm{w}}\circ\alpha_{\bm{x}}(t)={\bm{w}}(p)+\bm{x}$.
\end{thm}

\parit{Proof of the claim.}
First note that for any $q\in \oBall(p,r)$, we have
\begin{enumerate}[(i)]
\item%\label{111} 
$\d_q h_i(\nabla_q f_{\bm{x}})<-\frac\eps2$\ \ if\ \  $f_{\bm{x}}(q)<h_i(q)-x_i$\  and
\item
%\label{222} 
$\d_qh_i(\nabla_q f_{\bm{x}})\ge 0$\ \  if\ \  $f_{\bm{x}}(q)=h_i(q)-x_i$.
\end{enumerate}

To prove (\ref{111}), note that $f_{\bm{x}}(q)<h_i(q)-x_i$ implies $\d_qf_{\bm{x}}\ge\min_{j\not=i} \d_qh_j$.
If $\spc{L}$ is geodesic, then
\begin{multline*}
d_q{h_i}(\nabla_q f_{\bm{x}})
\le
-\<\dir q{a_i},\nabla_q f_{\bm{x}}\>
\le
-\d_qf_{\bm{x}}(\dir q{a_i})
\le
\\
\le
\max_{j\not=i}\{\cos\angk{\kappa}q{a_i}{a_j}\}
<
-\sin\eps<-\tfrac\eps2. 
\end{multline*}
If $\spc{L}$ is not geodesic, we can not assume existance of $[q{a_i}]$. 
In this case, we perform the above estimate in $\o$-product of $\spc{L}$, which is a geodesic (see \ref{cor:ulara-geod}).

To prove (\ref{222}), note that  if $f_{\bm{x}}(q)=h_i(q)-x_i$ then $\d_q f_{\bm{x}}\le \d_q h_i$ and thus
$$\d_q h_i(\nabla_q f_{\bm{x}})
\ge 
\d_qf_{\bm{x}}(\nabla_q f_{\bm{x}})\ge 0.$$


Now we are ready to prove the claim. 
Since $h_i$ are $1$-Lipscitz, we have $|\nabla_q f_{\bm{x}}|\le 1$, thus $\alpha_{\bm{x}}(t)\in \oBall(p,\tfrac r2)$ for any $t<\tfrac r2$.
Set 
$$a(t)=\min_{i\in[0..m]}\{h_i\circ\alpha_{\bm{x}}(t)-x_i\}
\ \ \t{and}\ \ 
b(t)=\max_{i\in[0..m]}\{h_i\circ\alpha_{\bm{x}}(t)-x_i\}.$$
Clearly $a(t)\le b(t)$ and equality holds if and only if 
${\bm{w}}\circ\alpha_{\bm{x}}(t)={\bm{w}}(p)+\bm{x}$.
The conditions (\ref{111}) and (\ref{222}) imply that $a^+(t)\ge 0$ and if $b(t)>a(t)$ then
$b^+(t)\le -\tfrac\eps2$. 
Thus, since $b(0)-a(0)=\max_i\{x_i\}\le |\bm{x}|$, for $t= \tfrac{2 }\eps|\bm{x}|$ we have ${\bm{w}}\circ\alpha_{\bm{x}}(t)=\bm{x}$.
\qeds

Define submap
$$F\:{\bm{w}}(p)+{\bm{x}}\mapsto \alpha_{\bm{x}}\l(\tfrac{2}\eps|\bm{x}|\r),\ \ 
\Dom F=\oBall\l(\tfrac{\eps r}{4} ,{\bm{w}}(p)\r)\i\WW^m.$$
Clearly $F\circ{\bm{w}}(p)=p$.
As it follows from the claim, 
${\bm{w}}\circ F$ is the identity in $\Dom F$.

Further, by construction of $f_{\bm{x}}$, it is clear that for any $q\in \spc{L}$
$$|f_{\bm{x}}(q)-f_{\bm{y}}(q)|\le |\bm{x}-\bm{y}|.$$
Therefore, according to lemma \ref{lem:fg-dist-est}, $F$ is $C^{\frac12}$-continuous.

\smallskip

???To prove the last part of the theorem, equip $\WW^m$ with standard metric and consider space $\spc{L}'=\spc{L}\times \WW^m$.
Set $\eps'=???$ and consider function $f\:\spc{L}'\to\RR$, 
$$f(q,\bm{x})=f_{\eps'\bm{x}}(q)=\min_{i\in[0..m]}\{h_i(q)-\eps' x_i\}.$$ 
Note that $f$ is $\lambda$-concave and $\sqrt{2}$-Lipschitz in $\oBall(???)\times \oBall(???)$.
For a point $\bm{x}\in\WW$, let us denote by $\beta_{\bm{x}}$ the $f$-gradient curve which starts at $(p,\bm{x})\in \spc{L}'$.
According to ??? the map $(\bm{x},t)\mapsto \beta_{\bm{x}}(t)$ is Lipschiz.
The same argument as above shows that ???
Thus, the submap 
$$F'\:\bm{x}\mapsto \beta_{\bm{x}}(???),\ \ \ \Dom F'=???$$
is Lipshitz and 
Thus the map
Therefore the gradient flow ??? is Lipschitz in ???.
Thus, we have a Lipschitz map ??? such that 
\qeds


\begin{thm}{Lemma}
Let $\kappa\le 0$,
$\spc{L}_1, \spc{L}_2\in\CBB{}\kappa$, 
$f_1\:\spc{L}_1\subto\RR$ and  $f_2\:\spc{L}_2\subto\RR$ 
\end{thm}
















\smallskip

???To prove the last part of the theorem, equip $\WW^m$ with standard metric and consider space $\spc{L}'=\spc{L}\times \WW^m$.
Set $\eps'=???$ and consider function $f\:\spc{L}'\to\RR$, 
$$f(q,\bm{x})=f_{\eps'\bm{x}}(q)=\min_{i\in[0..m]}\{h_i(q)-\eps' x_i\}.$$ 
Note that $f$ is $\lambda$-concave and $\sqrt{2}$-Lipschitz in $\oBall(???)\times \oBall(???)$.
For a point $\bm{x}\in\WW$, let us denote by $\beta_{\bm{x}}$ the $f$-gradient curve which starts at $(p,\bm{x})\in \spc{L}'$.
According to ??? the map $(\bm{x},t)\mapsto \beta_{\bm{x}}(t)$ is Lipschiz.
The same argument as above shows that ???
Thus, the submap 
$$F'\:\bm{x}\mapsto \beta_{\bm{x}}(???),\ \ \ \Dom F'=???$$
is Lipshitz and 
Thus the map
Therefore the gradient flow ??? is Lipschitz in ???.
Thus, we have a Lipschitz map ??? such that 
















$\proj\:\RR^{\kay+1}\to \RR^{m+1}$ be a coordinate projection and $\proj^*\:\RR^{m+1}\to \RR^{\kay+1}$ be corresponding embedding then
$\smx_{\bm{f}}\circ\proj^*=\smx_{\proj\circ\bm{f}}$
















\parbf{Scalar product of differentials.}
Here we introduce a scalar product for functions in $\MD_x'(\spc{L},\RR)$.

For two bounded subsets $V, W\i \T_p$, 
set 
$$\<V,W\>=\sup_{\substack{v\in V,\\ w\in W}}\<v,w\>.$$
If $\phi,\psi\:\T_x\to\RR$, 
$\phi(z)=-\<V,z\>$ 
and $\psi=-\<W,z\>$ 
set
$$\<\phi,\psi\>=\<V,W\>.$$

Further, let us extend this definition to a the class $\MD'_x(\spc{L},\RR)$.
Assume $\hmy{\phi},\hmy{\psi}\in\MD_x'(\spc{L},\RR)$ and
$\hmy{\phi}\can\Phi\circ\bm{\phi}$,
$\hmy{\psi}\can\Psi\circ\bm{\psi}$.
Set
$$\<\hmy{\phi},\hmy{\psi}\>
=
\sup_{\bar\Phi,\bar\Psi}
\sum_{i,j}
\partial_i\bar\Phi
\cdot
\partial_j\bar\Psi
\cdot
\<\phi_i,\phi_j\>$$
where supremum is taken along all pairs of linear functions $\bar\Phi$ and $\bar\Psi$  such that $\Phi\le \bar\Phi$ and $\Psi\le\bar\Psi$.

\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{}{}$.
Assume $\hmy{h},\hmy{f}\in\MD(\spc{L},\RR)$ 
and $\hmy{h}\can H\circ\dist{\bm{p}}{}$, $\hmy{f}\can F\circ\dist{\bm{q}}{}$
then for any $x\in\Dom\hmy{h}\cap\Dom\hmy{f}$ we have 
$$\<\d_x\hmy{f},\d_x\hmy{g}\>\le \sum_{i,j}\partial_iH\cdot\partial_jF\cdot\cos\angk\kappa x{p_i}{q_j}.$$

\end{thm}

\parit{Proof.}
Follows directly from ??? comparison and definition of scalar product of $\MD'$-functions.
\qeds

The following lemma provides a way to construct tight maps, which will be used in ???.


\begin{thm}{Lemma}\label{lem:comp>tight}
Let $\spc{L}\in \CBB{}{}$ and $\hmy{f}$, $\hmy{h}$ be two composite subfunctions. 
Assume $\<\d_x\hmy{f},\d_x\hmy{h}\><0$ then 
$\d_y\hmy{f}(\nabla_y\hmy{h})<0$ and $\d_y\hmy{h}(\nabla_y\hmy{f})<0$ for any $y$ sufficiently close to $x$.
\end{thm}

Special type of convergence???

















\parbf{Class $\MD'$.}
Let $\spc{L}\in\CBB{}{}$ and $x\in \spc{L}$.
For a bounded subset of tangent vectors $V\i \T_x$,
set $$\<V,w\>=\sup_{v\in V}\<v,w\>.$$
We say that a composite functions $\hmy{\phi}\:\T_x\to\RR$ belongs to class $\MD_x'(\spc{L},\RR)$ if 
$\hmy{\phi}\can\Phi\circ\bm{\phi}$, where $\Phi\:\RR^\kay\to\RR$ is concave and positive homogenius function 
and for each $i$,
there is a bounded subset $V_i\i\T_x$ 
such that $\phi_i(w)=-\<V_i,w\>$.

\parbf{Differentials of $\MD$-functions.}
Assume $\hmy{f}\in\MD(\spc{L},\RR)$.
Then for any $x\in\Dom\hmy{f}$,
the differential $\d_x\hmy{f}$ can be reagarded as a composite function, by setting
$$\d_x \hmy{f}
\can
\d_{\dist{\bm p}{x}} F\circ\d_{x}\dist{\bm p}{}.$$
Cleary,
$$\d_x\dist{\bm{p}}{}=(\d_x\dist{p_1}{},\d_x\dist{p_2}{},\dots,\d_x\dist{p_\kay}{})\:\T_x\to\RR^\kay.$$
According to \ref{thm:differential-of-dist}, if $x\not=p_i$ then $(\d_x\dist{p_i}{})(w)=-\<V,w\>$ for $V=\Dir xp$.
Thus $\d_x\hmy{f}\in\MD'_x(\spc{L},\RR)$ --- one has to check it separetly in case $x=p_i$ for some $i$, but it is not hard???AND IT IS NOT QUITE CORRECT!!!.



















 

Choose $p'\in\spc{L}^\bullet(x_1,x_2,\dots,x_n)$ sufficiently close to $p$, so that $\dist{p'}{x_i}<R$ for any $i$.
From ???, all 
$\ddir{p'}{x_1}$, $\ddir{p'}{x_1},\dots,\ddir{p'}{x_1}$ lie in $\Lin_{p'}$.
Let $E\i \Lin_{p'}$ be a finite dimensional subspace containing all $\ddir{p'}{x_i}$,
let $\kay$ be dimension of $E$.
Given $u,v\in E$,
set $\rho_\kappa(u,v)=\side_\kappa{o}{u}{v}$.
Note that describes a metric on $\oBall(o,R)\i\Lin_{p'}$ and $(\oBall(o,R),\rho_\kappa)$ is isometric to a $\oBall^\kay_\kappa(R)$

According to \ref{cor:CAT>k-sence}, we can assume that $\kappa\le 0$ ???THAT IS NOT CORRECT???.

Sinse $\spc{L}=\bigcup_{R>0}\oBall(p,R)$, 
it is enough to show that for any $R>0$ the set $\spc{L}^{(m)}$ is a $G_\delta$-set which is dence in $\oBall(p,R)$.

Sinse 
$$\pack_\eps \oBall^{m}_\kappa(R+r)\le \frac{\Const}{\eps^m},$$ 
we can find small $\eps>0$ such that 
$$n\df\pack_{\eps} \oBall(p,R)>\pack_{\eps} \oBall^{m}_\kappa(R+r).
\eqlbl{E-comeagre*}$$
Let us choose an array of points $(x_i)_{i=1}^n$ in $\oBall(p,r)$ such that $\dist{x_i}{x_j}>\eps$.
According to \ref{thm:euclid-subcone}, there is a dence $G_\delta$-set $\spc{L}^\bullet(x_1,x_2,\dots,x_n)\i \spc{L}$ such that if $p\in \spc{L}^\bullet(x_1,x_2,\dots,x_n)$ then all vectors $\{\ddir p{x_i}\}_{i=1}^n\i \T_p$ lie in subcone $E\i \T_p$ which isometric to Euclidean cone $\EE^{\kay}$.

Let $p\in \spc{L}^\bullet(x_1,..,x_n)\cap \oBall(p,R)$.
Choose $\~p\in\Lob{\kay}\kappa$ and isometry $\jmath\:E\to \T_{\~p}\Lob{\kay}\kappa$, and set 
$$\~x_i=\exp_{\~p}\circ\,\jmath\circ\ddir p{x_i}$$ 
then $\{\~x_i\}_{i=1}^n\i \oBall^\kay_\kappa(R+r)\i \Lob{\kay}\kappa$ and from camparison we have $\dist{\~x_i}{\~x_j}\ge \dist{x_i}{x_j}$.
Thus, \ref{E-comeagre*} implies that $\kay>m$ for each $p\in \spc{L}^\bullet(x_1,x_2,\dots,x_n)\i \spc{L}$.












Further, from \ref{pack-homogeneus}, the inequality \ref{eq:thm:dim-infty*} implies an analogous estimate for any ball in $\spc{L}$.
In particular there is $\Const>0$ such that
$$\pack_\eps \oBall(q,R)>\frac{\Const}{\eps^m}.$$
















Further, let us denote by
$\BD(\spc{X},\RR)$ the set of all functions of \emph{bounded difference} to a distance function;
i.e.  $f\in\BD(\spc{X},\RR)$ if for some (and therefore any) point $p\in\spc{X}$ we have $f-\dist{p}{}\in\Bnd(\spc{X},\RR)$.
The space $\BD(\spc{X},\RR)$ has natural affine structure with adjoint??? space formed by $\Bnd(\spc{X},\RR)$.
In particular, $f-g\in\Bnd(\spc{X},\RR)$ any pair of functions $f,g\in\BD(\spc{X},\RR)$
and $\|f-g\|$ defines a metric on $\BD(\spc{X},\RR)$.
















Given a curve $\gamma\:\II\to\spc{X}$ we define its left and right derivatives at $t_0\in\II$ by
$$\gamma^\pm(t_0)=\lim_{t\to t_0\pm}\frac{\dist{\gamma(t)}{}-\dist{\gamma(t_0)}{}}{|t-t_0|},$$
where limit is defined in $\Bnd(\spc{X},\RR)$.













A function $v\in\Bnd(\spc{X},\RR)$ is called \emph{tangent vector}\index{tangent vector} at $p\in \spc{X}$ if there exist sequences 
$x_n\to p$ in $\spc{X}$ and $\eps_n\to 0+$ such that $\tfrac1{\eps_n}\cdot\kur_p x_n\to v$ in $\Bnd(\spc{X},\RR)$.
The set of all tangent vectors at $p$ form a subcone in $\Bnd(\spc{X},\RR)$ which is called tangent cone at $p$.
It will be denoted by $\Tan_p=\Tan_p\spc{X}$.
The tangent cone comes with natural metric induced by the norm in $\Bnd(\spc{X},\RR)$.























\begin{thm}{???Proposition}
Let $\spc{L}\in\CBB{}{}$. 
Then $\rank_p\le\dim\spc{L}$ for any $p\in \spc{L}$.

Moreover, the function $p\mapsto\rank_p$ is upper-continuous;
i.e. for any sequence of points $p_n\to p$, we have 
$\rank_{p_n}\ge\rank_p$
for all large $n$.
\end{thm}

\parit{Proof.}
If $\dim\spc{L}\le m$, then according to ???, $\Sigma_p\le\SS^{m-1}$.
From ???, it follows that $\pack_{\pi/2}\SS^{m-1}=m+1$ and the first part follows.

Assume $\rank_p\ge \kay$, choose a point array $(x_0,x_1,\dots,x_\kay)\in\spc{L}^{\kay+1}$ as in the definition~\ref{def:rank}.
Clearly, for any point $q$ sufficiently close to $p$
we have $\angk\kappa{q}{x_i}{x_j}\approx\angk\kappa{p}{x_i}{x_j}$.
In particular, for all points $q$ sufficiently close to $p$ we have $\angk\kappa{q}{x_i}{x_j}>\pi/2$.
Thus $\rank_q= \kay$
\qeds















Let $X\i \spc{L}$ be the set of all \emph{footpoints}\index{footpoint} of all $\hmy{f}_i$;
i.e.???
The set $X$ is finite.
Thus, it follows from ???, that if 
one can choose $z\in [py]$ sufficiently close to $p$ then 
for each $x\in X$ the value $\cos\angk\kappa p z x$ is close to $-(\d_p\dist{x}{})(\dir{p}{y})$.

Consider a restriction of function $\hmy{h}\can\id_>\circ\dist{z}{}$,
where $\id_>\:(0,\infty)\to\RR$ is an identity function.
It remains to check that
$$\scal_\kappa(p,\hmy{h},\hmy{f}_i)<0$$
for each $i$.




















Choose $z\in[py]$ sufficiently close to $p$.
let us fix $i\in \{0,1,\dots,\kay\}$.
Assume $\hmy{f}_i\can F\circ\dist{\bm{x}}{}$.
Note that if $z_n\in[py]$ 
and $z_n\to p$ 
then $\cos\angk\kappa p{x_i}{z_n}\to\d_p\dist{x_i}{}(\dir{p}{y})$

We can do this so that for each $i$, the pair $\hmy{f}_i$, $\dist{x}{}$ stratts??? $p$.
Indeed, assume 
$\hmy{f}_i\can
F\circ\dist{\bm{x}}{}$.
Then $z$ can be chousen so that $\cos\angk\kappa p z{x_i}\approx \d_p\dist{x_i}(\dir{p}{y})$ is for each $i$.
Thus $\d_p\hmy{f}_i(\dir{p}{y})>0$ implies $???$.

To prove the last statement, choose a point array $\bm{z}$ in a $\oBall(z,\eps)$,
so that $\dist{\bm{z}}{}\:\spc{L}\to\RR^n$ is bi-Lipschitz embedding of a neighborhood of $p$.
We can choose $\eps>0$ so small, that $\angk\kappa p{x_j}{z_i}\approx\angk\kappa p{x_j}{z}$;
in this case, direct caculations show that $\hmy{h}\can H\circ\dist{\bm{z}}{}$ and  $f_i$ starin $p$.
In particular, we can choose $H$ as in ???, so the multidistant subfunction $\hmy{h}$ is hereditarily??? concave















\parit{Proof???.}
Note that 
$$\d_p\dist \mu^2=\int\limits_{\spc{L}}\d_p\dist x^2\mu\,\d x.$$
If $p\in \spc{L}$ is regular, i.e. $\T_p$ is isometric to Euclidean space, 
then for almost all $x\in \spc{L}$ the differential $\d_p\dist{x}{}\:\T_y\to\RR$ is $1$-Lipshitz and
for almost all $x\in \spc{L}$ it is the differential a linear function.
Therefore $\d_p(\dist \mu)^2$ is differentiable at every regular point, i.e.
$$\d_y\widetilde{???\dist p{}}\:\T_y\to\RR$$
is a linear function for any regular $y\in \spc{L}$.
\qeds

??? An analog of \ref{lem:comp>tight} is needed???





















Take $x'$ $\tfrac\eps4$-close to  $x$, 
so that 
$x'\in \spc{L}^\bullet(y,a_0,a_1,\dots,a_m)$.
According to \ref{thm:euclid-subcone}, there is an isometric copy of $\SS^{\kay-1}$ in $\Sigma_{x'}$ which contains $\dir{x'}{y}$, $\dir{x'}{b}$ and all $\dir{x'}{a_i}$.
Since $\LinDim\spc{L}=m$, we have $\kay\le m$.
Thus, according to \ref{lem:pack(S^m)}, $$\mangle(\dir{x'}y,\dir{x'}{b})<\tfrac\pi2-\eps\ \ \t{or}\ \  \mangle(\dir{x'}y,\dir{x'}{a_i})<\tfrac\pi2-\eps$$ 
for some $i$.
Since $\dist{x'}{y}<2r$, for all small $r$, 
we have 
$$\dist{b}{x'}-\dist{b}{y}>\tfrac\eps2(\dist{x}{y})\ \ \t{or}\ \ \dist{a_i}{x'}-\dist{a_i}{y}>\tfrac\eps2(\dist{x}{y}),$$
correspondingly. 
Since $\dist{x'}{x}<\tfrac\eps4$, we have
$$\dist{b}{x}-\dist{b}{y}
>
\tfrac\eps4(\dist{x}{y})
\ \ \t{or}\ \ 
\dist{a_i}{x}-\dist{a_i}{y}
>
\tfrac\eps4(\dist{x}{y})\eqlbl{eq:y-x}$$ for some 
$i$.
Switching $x$ and $y$,
$$\dist{b}{y}-\dist{b}{x}
>
\tfrac\eps4(\dist{x}{y})
\ \ \t{or}\ \ 
\dist{a_j}{y}-\dist{a_j}{x}
>
\tfrac\eps4(\dist{x}{y})\eqlbl{eq:x-y}$$ 
for some $j$.
Clearly \ref{eq:y-x} and \ref{eq:x-y} implies \ref{expend}.\qeds























Let $\spc{L}\in\CBB{m}{}$ and $p\in \spc{L}$. 
Let us introduce an operation on vectors in $\T_p$,
which immitates behavior of addition.
Let us fix a choice of geodesic $[vw]$ for any pair of tangent vectors $v,w\in \T_p$.
Set $\plus(v,w)=2\cdot z$, where $z$ is midpoint of a geodesic $[vw]$.
From ??? comparison, it follows that
$$\<x,\plus(v,w)\>
\le \<x,v\>+\<x,w\>.\eqlbl{eq:plus-1f}$$
for any vector $x\in \T_p$.

Further, let us define recurcevely
$$\plus(v_1,v_2,\dots,v_n)=\plus(v_1,\plus(v_2,v_3,\dots,v_{n})).$$
From \ref{eq:plus-1f}, we get



Let $\hmy{f}\can F\circ\dist{\bm{x}}{}$, 
$\bm{x}=(x_1,x_2,\dots,x_n)$
and $\bar F$ be a smooth function which supports $F$ at $\dist{\bm{x}}{p}\in\RR^n$.
Set $v_i=\partial_i\bar F(\dist{\bm{x}}{p})\cdot \ddir{p}{x_i}$.
We will show tha
$$w=\plus(v_1,v_2,\dots,v_\kay),$$
is a supporting vector of $\hmy{f}$ at $p$.





















\parit{Proof.}
The subfunction $\hmy{f}$ is locally Lipschitz follows from the definition???
According to \ref{lem:conv-comp}???, any multidistance subfunction $\hmy{f}\in\MD(\spc{L},\RR)$ is semicooncave.

Let $\hmy{f}\can F\circ\dist{\bm{x}}{}$, 
$\bm{x}=(x_1,x_2,\dots,x_n)$
and $\bar F$ be a smooth function which supports $F$ at $\dist{\bm{x}}{p}\in\RR^n$.
Set $v_i=\partial_i\bar F(\dist{\bm{x}}{p})\cdot \ddir{p}{x_i}$.
We will show tha
$$w=\plus(v_1,v_2,\dots,v_\kay),$$
is a supporting vector of $\hmy{f}$ at $p$.

Then according to lemma~\ref{lem:plus}, for any vector $z\in\T_p$, we have
\begin{align*}
\<w,z\>
&\le
\sum_i\<v_i,z\>
\le
\\
&\le
-\sum_i\partial_i\bar F(\dist{\bm{x}}{p})\cdot (\d_p\dist{x_i}{})(z)
=
\\
&=
-(\d_{\dist{\bm{x}}{p}}\bar F\circ\d_p\dist{\bm{x}}{})(z)
\le
\\
&\le
-\d_p\hmy{f}(z).
\end{align*}
\qedsf























Let $\spc{K}=\Cone\Sigma$ be a cone over compact length space $\Sigma$.
Given a finite set of  vectors $v_1,v_2,\dots,v_\kay\in \spc{K}$,
let us introoduce its \emph{sum-set}\index{sum-set}, $\SumSet(v_1,v_2,\dots,v_\kay)$.
We say that $w\in\SumSet(v_1,v_2,\dots,v_\kay)$ if for any positive homogenius concave function $f\:\spc{K}\to\RR$,
we have 
$$f(w)\ge\sum f(v_i).$$

It is easy to see that if $\spc{K}$ is isometric to Euclidean space,
then $\SumSet(v_1,v_2,\dots,v_\kay)$ contains unique element $v_1+v_2+\dots+v_\kay$.

Cllearly $\SumSet(v_1,v_2,\dots,v_\kay)$ forms a closed convex subset of $\spc{K}$.
Note also, that if $z$ is a midpoint of geodesic $[vw]$ then $2\cdot z\in \SumSet(v,w)$.
Further, it is straightforward to check that if $x\in\SumSet(v_1,v_2,\dots,v_{\kay-1})$ then $\SumSet(x,v_\kay)\i \SumSet(v_1,v_2,\dots,v_{\kay-1},v_\kay)$.
In particular, the set $\SumSet(v_1,v_2,\dots,v_{\kay-1},v_\kay)$ is not empty.
The above implies the following:

\begin{thm}{Lemma}
Let $\spc{K}=\Cone\Sigma$ be a cone over compact length space $\Sigma$.
Then for any finite collection of vectors $v_1,v_2,\dots,v_\kay\in\spc{K}$,
the set $\SumSet(v_1,v_2,\dots,v_\kay)$ forms a nonempty closed convex subset. 
\end{thm}

\begin{thm}{Lemma}\label{lem:plus}
Let $\spc{L}\in\CBB{m}{}$ and $p\in\spc{L}$, $v_1,v_2,\dots,v_\kay\in\T_p$.
Assume $w\in\SumSet(v_1,v_2,\dots,v_\kay)$ then 
$$\<w,x\>\le\sum\<v_i,x\>.$$
\end{thm}

\parit{Proof.}
According to ???, $\T_p\in\CBB{m}{0}$.
In particular, from ??? we get that for any vector $v\in \T_p$,
the function $x\mapsto -\<v,x\>$ is concave.
Applying the definition of $\SumSet$, we get the result.
\qeds

\begin{thm}{Definition}
Let 
\end{thm}














\parbf{Proper spaces.} For proper metric spaces, we will need an adjastment of above definitions.

Let $(\spc{X},x_0)$ and $(\spc{Y},y_0)$ be two proper metric spaces with marked points.
A map $h\:\spc{X}\to \spc{Y}$ is called $(R,\eps)$-approximation if 
\begin{itemize}
\item  For any $x,x'\in \oBall(x_0,R)\i \spc{X}$ we have
$$|\dist{h(x)}{h(x')}-\dist{x}{x'}|<\eps$$
\item for any $y\in \oBall(y_0,R)\i \spc{Y}$ there is $x\in \oBall(x_0,R)\i \spc{X}$ such that 
$$\dist{h(x)}{y}<\eps.$$
\end{itemize}

We say that a sequence of proper metric spaces with marked point $(\spc{X}_n,\star_n)$ converges to a proper metric space with marked point $(\spc{X},\star)$ if there is a sequence of positive numbers $\eps_n\to0$ and a sequence of $(1/{\eps_n},\eps_n)$-approximations $a_n\:\spc{X}_n\to \spc{X}$.
In this case we will write $(\spc{X}_n,\star_n)\GHto (\spc{X},\star)$, 
or $\spc{X}_n\GHtoh{a_n} \spc{X}$.
Note that specifying the sequence of approximations removes ambiguity of reference point.
















We say that a sequence of functions $f_n\:\spc{X}_n\to\RR$
converges uniformly??? to $f_\infty\:\spc{X}_\infty\to\RR$ 
(brifly, $f_n\rightrightarrows f_\infty$)
$f_\infty$ is continuous and for $s_n=\sup|f_n(x)-f_\infty\circ a_n(x)|\to 0$.
Given a sequence of measures $\mu_n$ on $\spc{X}_n$, 
we say that measure $\mu_\infty$ on $\spc{X}_\infty$ 
is weak limit of $\mu_n$ (brifly $\mu_n\rightharpoonup\mu_\infty$) if for any seqence of functions $f_n\:\spc{X}_n\to\RR$,
$f_n\rightrightarrows f_\infty\:\spc{X}_\infty\to\RR$













A sequenc of open sets $\Omega_n\i \spc{X}_n$ 
is called converging to $\Omega_\infty\i \spc{{X}_\infty$ (brifly $\Omega_n\to\Omega_\infty$)
if for any point $x_\infty\in\Omega_\infty$ and any seqence $x_n\to\x_\infty$, $x_n\in\spc{X}_n$ there is $\eps>0$ such that $\oBall(x_n,\eps)\i\Omega_n$ for all large $n$ and moreover, if for some $\eps>0$ there is a subsequence 

which satisfy the following condition:
for a converging sequence of points $\spc{X}_n\ni x_n\to x_\infty\in\spc{X}_\infty$,
consider seqence of numbers $\eps_n=\sup\{\,r\ge 0\mid\oBall(x_n,r)\i \Omega_n\,\}$ then either $\eps_n\to 0$ or there is $\liminf\eps_n>0$.
Set $\Omega_\infty\i \spc{X}_\infty$ to be the set of all points $x_\infty\in\spc{X}_\infty$
Note that $\eps_\infty$ depends only on 
Set $\Omega_\infty\i\spc{X}_\infty$ to be set of points 
In this case we say that $\Omega_n$ converges to
We say that $\Omega_n$ converges to $\Omega_\infty\in\spc{X}_\infty$ 
if for any $x_\infty\in\Omega_\infty$ a


This convergence defines a topology on the disjoined union $\spc{Y}=\spc{X}_\infty\sqcup(\bigsqcup_n\spc{X}_n)$ 
(in this topology each inclusion $\spc{X}_n\\hookrightarrow\spc{Y}$ is an open embedding).
Given a sequence of open sets $\Omega_n\i\spc{X}_n$,
we say that $\Omega_n\to\Omega_\infty\i \spc{X}_\infty$ if 
all the sets 

On the disjoined union 
$\spc_{X}_\infty\sqcup(\bigsqcup_n\spc{X}_n)$
there is a natural topology, with base formed by a collection of balls 




















Let $\spc{X}$ and $\spc{Y}$ be two compact metric spaces.
A map $h\:\spc{X}\to \spc{Y}$ is called $\eps$-approximation if 
\begin{itemize}
\item For any $x,x'\in \spc{X}$ we have 
$$|\dist{h(x)}{h(x')}-\dist{x}{x'}|<\eps.$$
\item For any $y\in \spc{Y}$ there is $x\in \spc{X}$ such that 
$$\dist{h(x)}{y}<\eps.$$
\end{itemize}

We say that a sequence of compact metric spaces $\spc{X}_n$ converges to a compact metric space $\spc{X}$ if there is a sequence $\eps_n\to0+$ and a sequence of $\eps_n$-approximations $a_n\:\spc{X}_n\to \spc{X}$.
In this case we will write 
$$\spc{X}_n\GHto \spc{X}\ \ \text{or}\ \ \spc{X}_n\GHtoh{a_n} \spc{X}\ \ \text{or}\ \ \spc{X}=\GHlim_{n\to\infty} \spc{X}_n.$$
The second notation will be used only if  we want to specify the sequence of approximations $a_n\:\spc{X}_n\to \spc{X}$.















Let $\spc{L}\in\CBB{m}{}$ and $p\in \spc{L}$.
An array of directions $\xi_0,\xi_1,\dots,\xi_n\in \Sigma_p$ is called \emph{straining}??? if $\mangle(\xi_i,\xi_j)>\tfrac\pi2$ for all $i\not=j$.
A straining array is called \emph{extendable}, if for any $\eps>0$ there is no straining collection $\xi_0',\xi_1',\dots,\xi_n',\xi_{n+1}'\in \Sigma_p$ such that
$\mangle(\xi_i,\xi_i')<\eps$;
otherwise it is called nonextendable.

\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{}$, $p\in \spc{L}$ and $\xi_0,\xi_1,\dots,\xi_n\in \Sigma_p$ be a nonextendable straining array.
Then there is a Lipschitz submap $F\:\RR^n\subto \spc{L}$ such that $F(\bm{0})=p$ and
for some $\eps>0$, if $q\in\oBall(p,\eps)$ and $\vol_m\Sigma_q+\eps>\vol_m\Sigma_p$  then $q\in\Im F$.
\end{thm}






















\section{New proof $\kappa=0$}

\begin{thm}{Key lemma}
Let $\spc{U}\in\CBA{}{0}$, 
$\bm{x}=(x_0,x_1,\dots,x_\kay)\in (\spc{U})^{\kay+1}$ be a point array, $\bm{\~x}=(\~x_0,\~x_1,\dots,\~x_\kay)\in (\EE^m)^{\kay+1}$ be a model point array
such that $\dist{\~x_i}{\~x_j}\ge\dist{x_i}{x_j}$ for all pairs $(i,j)$.

Then for any $\~y\in \EE^m$, there is $y\in\spc{U}$ such that $\dist{x_i}{y}\le\dist{\~x_i}{\~y}$ for any $i$.
\end{thm}

\parit{Proof.}
Set $f_i=\tfrac{1}{2}(\dist{x_i}{})^2$ and $\~f_i=\tfrac{1}{2}(\dist{\~x_i}{})^2$.
Since $\spc{U}\in\CBA{}{0}$,
all functinons $f_i$ are $1$-convex.
Thus, one can apply theorem ??? for the function array $\bm{f}=(f_0,f_1,\dots,f_\kay)$.
Let us recal $\preccurlyeq$ and $\Up$???
Then, the conclusion of the lemma can be reformulated the following way: 
for any $\~y\in \EE^m$, $\bm{\~f}(\~y)\in\Up\bm{f}(\spc{U})$.
Note that without loss of generality, one can assume that $\~y\in\Conv(\~x_0,\~x_1,\dots,\~x_\kay)$;
in particular, ???.

Assume contrary, since $\Up\bm{f}(\spc{U})$ is convex (see ???)
we get that there is $\bm{\alpha}=(\alpha_0,\alpha_1,\dots,\alpha_\kay)\in\Delta^\kay$ such that $\sum_i\alpha_i\cdot\~f_i(\~y)\le \inf\{\,\sum_i\alpha_i\cdot f_i(y)\mid y\in\spc{U}\,\}$, which cotradicts the following claim. 

\begin{clm}{Claim}
Given $\bm{\alpha}=(\alpha_0,\alpha_1,\dots,\alpha_\kay)\in\Delta^\kay$,
set
\begin{align*}
&h=\tfrac12\sum_i\alpha_i\cdot f_i
&
&h\:\spc{U}\to\RR
&
&z=\argmin h
\\
&\~h=\tfrac12\sum_i\alpha_i\cdot \~f_i
&
&\~h\:\EE^m\to\RR
&
&\~z=\argmin \~h
\end{align*}
Then 
$h(z)\le \~h(\~z)$.
\end{clm}

\parit{Proof.}
Since $z=\argmin h$, for each $i$ we have
\begin{align*}
0
&\le 
(h\circ\geod_{[zx_i]})^+(0)=
\\
&=
-\sum_j\alpha_j\cdot(\dist{z}{x_j})\cdot\cos\mangle\hinge{z}{x_i}{x_j}
\le
\\
&\le
-\sum_j\alpha_j\cdot(\dist{z}{x_j})\cdot\cos\angk0{z}{x_i}{x_j}
=
\\
&=
-\tfrac{1}{2\cdot(\dist{z}{x_i})}
\cdot 
\sum_j
\alpha_j\cdot\l[(\dist{z}{x_i})^2+(\dist{z}{x_j})^2-(\dist{x_i}{x_j})^2\r].
\end{align*}
In particular,
\begin{align*}
0&\ge 
\sum_{i}\alpha_i\cdot\l[\sum_j
\alpha_j
\cdot
\l[(\dist{z}{x_i})^2+(\dist{z}{x_j})^2-(\dist{x_i}{x_j})^2\r]\r]
=
\\
&=2\cdot h(z)-
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
(\dist{x_i}{x_j})^2.
\end{align*}
I.e.
$$h(z)\le
\tfrac{1}{2}\cdot
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
(\dist{x_i}{x_j})^2. \eqlbl{eq:h(z)=<}$$

Note, that if $\spc{U}\iso\EE^m$, then all inequalities above are sharp.
In particular, 
$$\~h(\~z)=
\tfrac{1}{2}\cdot
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
(\dist{\~x_i}{\~x_j})^2. \eqlbl{eq:h(z)=<1}$$
Since $\dist{\~x_i}{\~x_j}\ge\dist{x_i}{x_j}$ for all pairs $(i,j)$,
the lemma follows from \ref{eq:h(z)=<} and \ref{eq:h(z)=<1}.
\qeds












\begin{thm}{New Lemma}\label{lem:neg-config}
Let $\spc{U}\in \CBA{}{\kappa}$ 
and $\bm{y}=(y_1,y_2,\dots, y_n)\in (\spc{U})^m$.
Assume $q\in \spx{((\dist{\bm{y}}{})^2)}$.

Then there is a model configuration
$\~q,\~y_1,\~y_2,\dots, \~y_n$ in $\Lob{n}\kappa$ such that 
\begin{subthm}{}
$\dist{\~q}{\~y_i}= \dist{q}{y_i}$ for all $i$; 
\end{subthm}


\begin{subthm}{}$\dist{\~y_i}{\~y_j}\le\dist{y_i}{y_j}$ for all $i,j$;
\end{subthm}

\begin{subthm}{conv-cond} $\~q\in \Conv(\{y_i\}_{i})$.
\end{subthm}

Moreover, if the equality $\dist{\~y_i}{\~y_j}=\dist{y_i}{y_j}$ holds for all $i,j$, 
then there is an isometric embedding $\imath:\Conv(\{y_i\})\hookrightarrow \spc{L}$ such that $\imath(\~q)=q$ and $\imath(\~y_i)=y_i$ for each $i$.
\end{thm}


\parit{Proof.}
Let $F$ be set $\{q;y_1,y_2,\dots,y_n$ with a metric 
will be called.
We will call $F$ \emph{configuration space} if there is $\spc{U}\in\CBA{}{0}$
and an isometric embedding $F\hookrightarrow\spc{U}$ sucht that for some $\bm{x}\in\Delta^{n-1}$, we have $q=\spx{\bm{f}}(x)$, where $\bm{f}=(f_1,f_2,\dots,f_n)\:\spc{U}\to\RR^n$, be an array of functions defined as $\bm{f}=(\dist{y_i}{})^2$.

Let us introduce partial order on the class of configuration metrics.
???
Note that the set ??? is closed.
Indeed, ???

Clearly for any configuration metric $\rho$,
there is an extremal configuration metric $\rho'\preccurlyeq\rho$.
It is sufficient to show that there is configuration embedding $(F,\rho')\hookrightarrow\RR^n$.

Assume contrary; let $\spc{U}\in \CBA{}{\kappa}$ 
and $\bm{y}=(y_1,y_2,\dots, y_n)\in (\spc{U})^m$ and $q\in \spx{((\dist{\bm{y}}{})^2)}$ do not admit the model configuration.
We assume there is no other configuration $\bm{y}'=(y_1',y_2',\dots, y_n')\in (\spc{U}')^m$ and $q'\in \spx{((\dist{\bm{y'}}{})^2)}$ with ???.
Indeed, ??? passing to $\o$-limit ???

Further, we may assume that $(\spc{U},q)\iso(\T_q\spc{U},o)$.
Indeed ???

Further, we may assume that $\spx{?}$ is differentiable at $???$;
i.e. ??? and $\d_q\dist{y_i}{}|_{???}$ is linear.

\begin{clm}{Claim}
For any configuration space $F$,
there is $\spc{U}\in\CBA{}{0}$ and an isometric embedding $\imath\:F\hookrightarrow\spc{U}\times\RR$,
such that its projection to $\RR$ is not a trivial; 
i.e. $\proj_\RR\circ\imath(F)$ contains at least two distinct points, where $\proj_\RR\:\spc{U}\times\RR\to\RR$ denotes the projection to $\RR$-factor.
\end{clm}

Let $F\hookrightarrow\spc{U}$ be ???
and $q=\spx{???}(\bm{x})$.
Since $\spx{???}$ is Lipschitz (see ???)
there is a sequence of points $\bm{x}_n\in\Delta^{???}$, such that 
$\bm{x}_n\to\bm{x}$,
and for each $y_i$, $\dist{y_i}{}\circ\spx{???}$ is differentiable at $\bm{x}_n$ for each $n$.
It follows that $\sum_i x_i\cdot\d_{???}(\dist{y_i}{})^2=0$.
Thus by line-strip theorem (see ???) there is a convex subcone $???\i\T_q$,
which is  isometric to $\RR^\kay\times ???$ which contains all ???
Then we can pass to $\o$-limit ...
In case the projection ??? is not trivial, we get the claim.

Thus, it remains to consider the case $\d_{\bm{x}}\spx{???}=0$.
If so, slight move of any point in $\bm{y}$ does not change $\spx{???}(\bm{x})$. 


 
\qeds


















\begin{thm}{Old Lemma}\label{lem:neg-config:old}
Let $\spc{U}\in \CBA{}{\kappa}$ 
and $y_1,y_2,\dots, y_n\in \spc{U}$.
Assume $q\in \spc{U}$ be a point such that function
$$f(x)=\max_{i}\{\dist{y_i}{x}-\dist{y_i}{q}\}$$
has a local minimum at $q$.

Then there is a subset $F\i\{1,2,\dots,n\}$ and a model configuration
$\~q,\{\~y_i\}_{i\in F}$ in $\Lob{n}\kappa$ such that 
\begin{subthm}{}
$\dist{\~q}{\~y_i}= \dist{q}{y_i}$ for all $i\in F$; 
\end{subthm}


\begin{subthm}{}$\dist{\~y_i}{\~y_j}\le\dist{y_i}{y_j}$ for all $i,j\in F$;
\end{subthm}

\begin{subthm}{conv-cond} $\~q\in \Conv(\{y_i\}_{i\in F})$.
\end{subthm}

Moreover, if in the model configuration, we have $\dist{\~y_i}{\~y_j}=\dist{y_i}{y_j}$ for all $i,j\in F$, 
then there is an isometric embedding $\imath:\Conv(\{y_i\}_{i\in F})\hookrightarrow \spc{L}$ such that $\imath(\~q)=q$ and $\imath(\~y_i)=y_i$ for each $i\in F$.
\end{thm}

\parbf{Comment for AKP.} 
A stronger statement is expected. 
Namely one should be able to relax condition on $q$ to just $q\in \Conv\{y_i\}$.
Also, passing to the subset $F$ does not seem to be necessary.

I also hate the proof below, but I have failed to find a completely geometrical one.
In CBA case one has still nice geometrical tools, one can pass to the tangent cone (which is CBA) one can also consider the worse configuration by passing to a $\o$-limit???

\parit{Proof.}
Let us consider quadratic form $\Phi$,
$$\Phi(\bm{w})=\sum_{i,j=1}^n\<\dir q{y_i},\dir q{y_j}\>w_i w_j,$$
where $\bm{w}=(w_1,w_2,\dots,w_n)\in\RR^n$.

\begin{thm}{Claim}
There is an array of numbers $\bm{v}=(v_1,v_2,\dots,v_n)\in\RR^n$ 
such that $v_i\ge 0$ and $\Phi(\bm{v})\le 0$.
\end{thm}

\parit{Proof.} According to \ref{lem:conv-map}, there is an array $\bm{v}\in\RR^n$ such that 
$v_i\ge 0$ and 
$$h(x)=\sum_i v_i(\dist{y_i}{x}-\dist{y_i}{q})\ge 0$$ 
in a neigborhoof of $q$.
Passing to a subset of $\{y_i\}$ we can assume that $v_i>0$ for each $i$.
Note that 
$$0\le \d_qh(x)
=
-\sum_i v_i\<\dir q{y_i},x\>.\eqlbl{eq:lem:neg-config*}$$

Plug in $x=\dir q{y_j}$ in \ref{eq:lem:neg-config*}, we get $\sum_{i=1}^n v_i\<\dir q{y_i},\dir q{y_j}\>\le 0$.
Therefore
$$\Phi(\bm{v})=\sum_{j=1}^n v_j \sum_{i=1}^n v_i \<\dir q{y_i},\dir q{y_j}\>\le 0.\eqno\qed$$

Given a subset $F\i\{1,2,\dots,n\}$, 
let us denote by $\RR^{F}\i\RR^n$ the corresponding coordinate subspace
and by $\RR_{>}^{F}$ its open positive qudrant.
Let $F\i\{1,2,\dots,n\}$ be a minimal subset such that $\Phi(\mathbf w)\le 0$ for some $\mathbf w\in \RR_{>}^{F}$.
It is easy??? to see that $\Phi$ is positively defined on each $\RR^{F'}$ for any proper subset $F'\i F$.
Thus, for any a pair $i,j\in F$ there is the maximal number $r\ge 0$ such that 
$$\Phi^\flat(\bm{w}^\flat)\df\Phi(\bm{w}^\flat)+r w^\flat_i w^\flat_j\le 0$$
 for some $\bm{w}^\flat\in \RR_{>}^{F}$.
Clearly $\Phi^\flat|_{\RR^{F}}\ge 0$ and if $\Phi^\flat(\bm{w})=\sum_{i,j=1}^n a_{i j}w_i w_j$ for some symmetric matrix $(a_{i j})$
then $a_{ii}=1$, $a_{i j}\ge \<\dir q{y_i},\dir q{y_j}\>$ for all $i,j\in F$.

In particular, there is a linear map $h:\RR^F\to \RR^n$ such that
$$\Phi^\flat(\bm{w})=|h(\bm{w})|^2 \ \ \text{for any}\ \ \bm{w}\in \RR^F.$$
From above it follows that $|h(\bm{e}_i???)|=1$ and $h(\bm{0})=h(\bm{w}^\flat)$. 
In particular 
$$h(\bm{0}) \in \Conv(\{\bm{e}_i\}_{i\in F}).$$

Take a $\~q\in \Lob{n}\kappa$ and fix an isometry $\imath:\RR^n\to \T_{\~q}\Lob{n}\kappa$, then set 
$$\~y_i=\exp_{\~q}\circ\imath\circ h((\dist{q}{y_i})\cdot \bm{e}_i)\ \ \text{for all}\ \ i,j\in F$$ 
Since $|h(\bm{e}_i)|=1$, we get
$$\dist{\~q}{\~y_i}=\dist{q}{y_i}.$$ 
Further,
$$\cos\angk\kappa{\~q}{\~y_i}{\~y_j}
=a_{i j}
\ge\<\dir q{y_i},\dir q{y_j}\>
= \cos\mangle\hinge{q}{y_i}{y_j}
\ge\cos\angk\kappa{q}{y_i}{y_j};
$$
i.e. $\angk\kappa{\~q}{\~y_i}{\~y_j}\le \angk\kappa{q}{y_i}{y_j}$ and therefore
$$\dist{\~y_i}{\~y_j}\le \dist{y_i}{y_j}.$$
Finally, Since $\kappa\le 0$, $h(\bm{0}) \in \Conv(\{\bm{e}_i\}_{i\in F})$ implies
$\~q\in\Conv(\{y_i\}_{i\in F})$.

Equality???
\qeds












We can assume in addition that this configuration is minimal; 
i.e. 
$$\bigcap_{i\in F} \cBall(f(x_i,\dist{p}{x_i}))\not=\emptyset$$
for any proper subset $F\i\{1,2,\dots,n\}$.

Set $y_i=f(x_i)$ for each $i$.
Fix some smooth decreasing convex functions $\phi_i:\RR_{\ge0}\to\RR_{\ge0}$ such that 
$$\phi_i(t)>0\ \ \text{for}\ \ t> \dist{p}{x_i}\ \ \text{and}\ \ \phi_i(t)=0 \ \ \text{otherwise}.$$
From ???, the function $f=\sum_{i=1}^n \phi_i\circ\dist{y_i}{}$ is convex and ???.
Therefore, according to ???, there is a minimum point $q\in \spc{U}$ of $f$.

Since the configuration is minimal we have $\dist{q}{y_i}>\dist{p}{x_i}$%
\footnote{indeed, if say $\dist{q}{y_1}\le\dist{p}{x_1}$ then from convexity of $f$ it follows that $\cap_{i>1} \cBall(f(x_i,\dist{p}{x_i}))=\emptyset$.}%
.
Thus $\phi'(\dist{q}{y_i})>0$ for each $i$, set $v_i=\phi'(\dist{q}{y_i})$.
Since $q$ is a minimal point of $f$,
$$\sum_{i=1}^n v_i\<\xi,\dir q{y_i}\>
=
-\d_q f(\xi)\le0\ \ \text{for any}\ \ \xi\in \Sigma_q \spc{L}.$$
Therefore we can apply lemma \ref{lem:neg-config} to the configuration $q,y_1,y_2,\dots,y_n\in \spc{U}$.
Without loss of generality we can assume that $F=\{1,2,\dots,m\}$, $m\le n$; 
thus we get a model configuration $\~q,\~y_1,\~y_2,\dots,\~y_m\in \Lob{n}\kappa$ such that
\begin{enumerate}[(i)]
\item $\dist{\~q}{\~y_i}=\dist{q}{y_i}$ and 
$\dist{\~y_i}{\~y_j}\le \dist{y_i}{y_j}$ for all $i,j$;
\item $\~q\in\Conv(\~y_1,\~y_2,\dots,\~y_m)$.
\end{enumerate}

Apply \ref{thm:pos-config} to construct a model configuration 
$\{\~p,\~x_1,\~x_2,\dots,\~x_m\}\i \Lob{n}\kappa$ such that
$\dist{\~p}{\~x_i}=\dist{p}{x_i}$ 
and $\dist{\~x_i}{\~x_j}\ge \dist{x_i}{x_j}$ for all $i,j$.
Since 
$$\dist{\~x_i}{\~x_j}\ge \dist{x_i}{x_j}\ge \dist{y_i}{y_j}\ge\dist{\~y_i}{\~y_j}$$ 
we can apply Kirszbraun's lemma (\ref{lem:kirsz}) to  get a point $\~s\in \Lob{n}\kappa$ such that
$$\dist{\~s}{\~y_i}\le \dist{\~p}{\~x_i}\ \ \text{for all}\ \ i.$$
Therefore $\dist{\~s}{\~y_i}<\dist{\~q}{\~y_i}$ for each $i$, which contradicts Lemma \ref{lem:min-conv}.


























In the proof of this theorem we will use the following two lemmas in Euclidean and
Lobachevsky geometry:

\begin{thm}{Kirszbraun's lemma}\label{lem:kirsz}
Let $\kappa\le 0$, 
$\~x_1,\~x_2,\dots,\~x_m \in \Lob{\kay}\kappa$,
$\~y_1,\~y_2,\dots,\~y_m\in \Lob{n}\kappa$ be points such that $\dist{\~x_i}{\~x_j}\ge \dist{\~y_i}{\~y_j}$ for any $i,j$.
Then for any point $\~p\in \Lob{\kay}\kappa$ there is a point $\~s\in \Lob{n}\kappa$ such that $\dist{\~x_i}{\~p}\ge \dist{\~y_i}{\~s}$ for any $i$.
\end{thm}

Different proofs of Kirszbraun's lemma can be found in ???.

\parbf{Remark for AKP.} we can give a proof based on the idea of \ref{no-overlap}. it work for all $\kappa$, but we must assume that $n=\kay\ge m-1$ (which does not metter for $\kappa\le 0$).

\begin{thm}{Lemma}\label{lem:min-conv}
Let $\kappa\le 0$, 
$\{\~y_1,\~y_2,\dots,\~y_m\}\i \Lob{n}\kappa$ 
and $\~q\in \Conv(\~y_1,\~y_2,\dots,\~y_m)$. 
Then for any other point $\~s\in \Lob{n}\kappa$ the inequality 
$$\dist{\~s}{\~y_i}\ge \dist{\~q}{\~y_i}$$
holds for at least one $i$.
\end{thm}

The proof of Lemma \ref{lem:min-conv} is left to the reader.

\parit{The idea for proving \ref{thm:kirsz}.} 
Let us indicate the proof 
in case when both $\spc{L}$ and $\spc{U}$ are smooth Riemannian manifolds 
and $\kappa=0$.

Assume contrary, consider minimal set $x_1,x_2,\dots,x_n\in \spc{L}$ and $y_1,y_2,\dots,y_n\in \spc{U}$ 
such that the map $x_i\mapsto y_i$ is short%
\footnote{i.e. $\dist{y_i}{y_j}\le\dist{x_i}{x_j}$ for all $i,j$} 
and it can not be extended to $p\in \spc{L}$.
Since the set is minimal, we can find a point $q\in \spc{U}$ such that $\dist{q}{y_i}>\dist{p}{x_i}$ for each $i$ and there is no way to move $q$ decreasing all distances $\dist{q}{y_i}$.

Take $\~x_i=\ddir p{x_i}$ and $\~p=o_p$ in $\T_p \spc{L}$.
Clearly $\dist{\~p}{\~x_i}=\dist{p}{x_i}$ and from comparison, we get $\dist{\~x_i}{\~x_j}\ge\dist{x_i}{x_j}$ for all $i,j$.

Similarly, take $\~y_i=\ddir q{y_i}$ and $\~q=o_q$ in $\T_q \spc{L}$.
Clearly $\dist{\~q}{\~y_i}=\dist{q}{y_i}$ and from comparison, we get $\dist{\~y_i}{\~y_j}\le\dist{y_i}{y_j}$ for all $i,j$.
Since we can not move $q$ decreasing all distances $\dist{q}{y_i}$, we have $\~q\in\Conv(\~y_1,\~y_2,\dots,\~y_n)$.

Since both $\T_p \spc{L}$ and $\T_q \spc{L}$ are Euclidean spaces, we can apply Kirszbraun's lemma to get a point $\~s\in \T_q$ such that $\dist{\~s}{\~y_i}\le\dist{\~p}{\~x_i}$ for all $i$.
Thus $\dist{\~s}{\~y_i}<\dist{\~q}{y_i}$ for all $i$, which contradicts Lemma \ref{lem:min-conv}.
\qeds

To make a proof out of this sketch we need to deal with two main problems:
\begin{enumerate}[(i)]

\item The tangent spaces at $\T_p \spc{L}$ and $\T_q \spc{L}$ might not be Euclidean, thus one can not pass to the model configuration that easily. 
We deal with this problem applying \ref{thm:pos-config} and \ref{lem:neg-config}.

\item The general Alexandrov space is not proper, thus we can not pass to the finite minimal set that easy. It is done by applying Helly's theorem (\ref{thm:helly}).
\end{enumerate}


















\parbf{Comment for AKP.} One can reformulate this condition algebraicly. 
Namely, if one considers bilinear form $\mathrm F$ defined by
$$\mathrm F(\bm{v},\bm{w})=\sum_{i,j=1}^n \l[|x_i|\cdot|x_j|\cdot\angk\kappa p{x_i}{x_j}\r]v_iw_j,$$
where $\bm{v}=(v_1,v_2,\dots,v_n)$ and $\bm{w}=(w_1,w_2,\dots,w_n)$ are real arrays.
Then there is a representation $\mathrm F=\mathrm F_++\mathrm F_0$, where $\mathrm F_+(\bm{v},\bm{v})\ge0$ for any $\bm{v}$ and $\mathrm F_0(\mathbf e_i,\mathbf e_i)=0$ and $\mathrm F_0(\mathbf e_i,\mathbf e_j)\ge 0$ for all $i,j$.

In particular, 
$$\mathrm F(\bm{w},\bm{w})\ge 0\ \ \text{for any}\ \ \bm{w}=(w_1,w_2,\dots,w_n)\ \ \text{with all}\ \ w_i\ge0.$$
BUT, I was not able to figure out if this conditions are equivalent.

























\begin{thm}{Finite-plus-one lemma}\label{lem:kirsz-neg}
Let $\kappa\le 0$, 
$\spc{U}\in\CBA{}{\kappa}$, 
$x_1,x_2,\dots,x_n\in\spc{U}$ 
and $\~x_1,\~x_2,\dots,\~x_n\in\Lob{n}{\kappa}$
be a model configuration
such that $\dist{\~x_i}{\~x_j}\ge\dist{x_i}{x_j}$ for all pairs $(i,j)$.

Then for any $\~y\in \Lob{n}{\kappa}$, there is $y\in\spc{U}$ such that $\dist{x_i}{y}\le\dist{\~x_i}{\~y}$ for any $i$.
\end{thm}

\parit{Proof.}
It is sufficient to show only two cases: $\kappa=0,-1$.
The proofs of these two cases are identical, only formulas differ.
In the proof, we assume $\kappa=0$ but we provide the formulas for $\kappa=-1$ in the footnotes.

Note that without loss of generality, one can assume that $\~y\in\Conv(\~x_1,\~x_2,\dots,\~x_n)$.

Set%
\footnote{In case $\kappa=-1$,
$$
\begin{aligned}
&f_i=\cosh\circ\dist{x_i}{},
&
&\~f_i=\cosh\circ\dist{\~x_i}{}.
\end{aligned}\eqno{(A)_-}$$}
$$
\begin{aligned}
&f_i=\tfrac{1}{2}(\dist{x_i}{})^2,
&
&\~f_i=\tfrac{1}{2}(\dist{\~x_i}{})^2
\end{aligned}\eqno{(A)_0}
$$
and 
$\bm{f}=(f_1,f_2,\dots,f_n)$, $\bm{\~f}=(\~f_1,\~f_2,\dots,\~f_n)$.

Using definition~\ref{def:supset+succcurlyeq},
the conclusion of the lemma can be reformulated the following way: 
\textit{$\bm{\~f}(\~y)\in\Up\bm{f}(\spc{U})$ 
for any $\~y\in\Conv(\~x_1,\~x_2,\dots,\~x_n)$}.

Clearly,
$f_i''\ge 1$.
Thus, applying theorem~\ref{thm:bary}, we get that the set $\Up\bm{f}(\spc{U})\i\RR^{n}$, is convex.

Let us argue by contradiction;
assume $\bm{\~f}(\~y)\not\in\Up\bm{f}(\spc{U})$ for some $\~y\in\Conv(\~x_1,\~x_2,\dots,\~x_n)$, 
then there is $\bm{\alpha}=(\alpha_1,\alpha_2,\dots,\alpha_n)\in\Delta^{n-1}$ such that 
$$\sum_i\alpha_i\cdot\~f_i(\~y)
\le 
\inf\l\{\,\sum_i\alpha_i\cdot f_i(y)\mid y\in\spc{U}\,\r\}.$$ 
The later cotradicts the following claim.

\begin{clm}{Claim}
Given $\bm{\alpha}=(\alpha_1,\alpha_2,\dots,\alpha_n)\in\Delta^{n-1}$,
set
\begin{align*}
&h=\sum_i\alpha_i\cdot f_i
&
&h\:\spc{U}\to\RR
&
&z=\argmin h\in \spc{U}
\\
&\~h=\sum_i\alpha_i\cdot \~f_i
&
&\~h\:\Lob{n}{\kappa}\to\RR
&
&\~z=\argmin \~h\in \Lob{n}{\kappa}
\end{align*}
Then 
$h(z)\le \~h(\~z)$.
\end{clm}

\parit{Proof of the claim.}
Note that $\d_z h\ge 0$.
Thus, for each $i$, we have%
\footnote{In case $\kappa=-1$, the same calculations give
$$
\begin{aligned}
0
&\le\dots \le
-\tfrac{1}{\sinh(\dist{z}{x_i})}
\cdot 
\sum_j
\alpha_j\cdot\l[\cosh(\dist{z}{x_i})\cdot\cosh(\dist{z}{x_j})-\cosh(\dist{x_i}{x_j})\r].
\end{aligned}
\eqno{(B)_-}
$$
}
$$
\begin{aligned}
0
&\le \d_z h(\dir{z}{x_i})
=
\\
&=
-\sum_j\alpha_j\cdot(\dist{z}{x_j})\cdot\cos\mangle\hinge{z}{x_i}{x_j}
\le
\\
&\le
-\sum_j\alpha_j\cdot(\dist{z}{x_j})\cdot\cos\angk0{z}{x_i}{x_j}
=
\\
&=
-\tfrac{1}{2\cdot(\dist{z}{x_i})}
\cdot 
\sum_j
\alpha_j\cdot\l[(\dist{z}{x_i})^2+(\dist{z}{x_j})^2-(\dist{x_i}{x_j})^2\r].
\end{aligned}
\eqno{(B)_0}$$
In particular%
%%%%%%%%%%
\footnote{In case $\kappa=-1$, the same calculations give
$$
\begin{aligned} 
\sum_{i}\alpha_i\cdot\l[\sum_j
\alpha_j\cdot\l[\cosh(\dist{z}{x_i})\cdot\cosh(\dist{z}{x_j})-\cosh(\dist{x_i}{x_j})\r]
\r]\le0
\end{aligned}.
\eqno{(C)_-}
$$
},
%%%%%%%%%%
$$
\begin{aligned}
\sum_{i}
\alpha_i
\cdot
\l[\sum_j
\alpha_j
\cdot
\l[(\dist{z}{x_i})^2+(\dist{z}{x_j})^2-(\dist{x_i}{x_j})^2\r]
\r]\le 0,
\end{aligned}
\eqno{(C)_0}
$$
or%
%%%%%%%%%%
\footnote{In case $\kappa=-1$,
$$h^2(z)\le
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
\cosh(\dist{x_i}{x_j}). \eqno{(D)_-}$$
}
%%%%%%%%%%
$$2\cdot h(z)
\le
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
(\dist{x_i}{x_j})^2. \eqno{(D)_0}$$

Note, that if $\spc{U}\iso\Lob{n}{\kappa}$, 
then all inequalities above are sharp.
Thus the same argument as above, repeated for $\~x_1,\~x_2,\dots,\~x_n\in\Lob{n}{\kappa}$
gives%
\footnote%
{In case $\kappa=-1$,
$$\~h^2(\~z)
=
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
\cosh(\dist{\~x_i}{\~x_j}).\eqno{(E)_-}$$
}
$$2\cdot \~h(\~z)
=
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
(\dist{\~x_i}{\~x_j})^2. \eqno{(E)_0}$$
Since $\dist{\~x_i}{\~x_j}\ge\dist{x_i}{x_j}$ for all pairs $(i,j)$,
the claim follows from $(D)$ and $(E)$.
\qeds


















According to theorem~\ref{thm:pos-config}, 
there is a model configuration 
$\~p,\~x_1,\~x_2,\dots,\~x_n\in \Lob{n}{\kappa}$ such that
$\dist{\~p}{\~x_i}=\dist{p}{x_i}$ 
and $\dist{\~x_i}{\~x_j}\ge\dist{x_i}{x_j}$ 
for all $i$, $j$.
Since $f$ is short, we have $\dist{y_i}{y_j}\le\dist{\~x_i}{\~x_j}$ for all $i$, $j$.
Thus, the lemma~\ref{lem:kirsz-neg}, applyed to the array $y_1,y_2,\dots,y_n$ and model array $\~x_1,\~x_2,\dots,\~x_n$  and $\~y:=\~p$ contradicts \ref{eq:cap=cBalls=0}.














\section{???Rigid lemma}

The following is a result in Euclidean geometry

\begin{thm}{Lemma}
Let $\map\:\EE^m\to\EE^m$ be a short map.
Assume $X\i \EE^m$ is such that the restriction $\map|_X$ is an isometry,
then $\map$ is isometric on whole $\Conv X$.
\end{thm}










In the proof we apply a Rigit version of Kirszbraun theorem \ref{thm:kirsz} to Euclidean cone over spaces $\spc{L}$ and $\spc{U}$:

\begin{thm}{Rigit case of \ref{thm:kirsz}} 
Let $\spc{P}\in\CBB{}{0}$ and $\spc{N}\in\CBA{}{0}$ and $Q\i \spc{L}$.

Assume that a short map $f\:Q\to \spc{N}$ and for a point $p\in \spc{P}\backslash Q$ there is unique point $q\in \spc{N}$ such that
$$\dist{p}{x}\ge\dist{q}{f(x)}\ \ \text{for any} x\in Q.$$
Then there is at most countable subset $Q'\i Q$ which contained in an isometric copy $K\i \spc{P}$ of a convex subset of Hilbert space and such that $x\in K$ and ???
\end{thm}















\section{Rigit comparison}

\begin{thm}{Rigit comparison}
Let $\spc{L}\in\CBB{}0$ and $x_0,x_1,\dots\in \spc{L}$.
Assume there is a collection of points $\~x_0,\~x_1,\dots$ in a Hilbert space such that $\~x_0=\sum_{i=1}^\infty\alpha_i\~x_i$ for some $\alpha_i>0$, $\sum_{i=1}^\infty\alpha_i=1$ and $\dist{x_i}{x_j}=\dist{\~x_i}{\~x_j}$ for all $i,j$.
Then there is an isometric embedding $\imath:P???\hookrightarrow \spc{L}$ such that $\imath(\~x_i)=x_i$ for each $i\in???$.
\end{thm}

\parit{Proof} Note that according to ???, $y_i=\ddir{x_0}{x_i}$ is uniquely defined, $\Lin_p\ni y_i$ for each $i\in??$ and $\dist{y_i}{y_j}=\dist{\~x_i}{\~x_j}$ for all $i,j\in???$.
Thus there is an isometry  $\imath\:P???\to\Lin_{x_0}$ such that $\imath(\~x_i)=y_i$.
Now apply gradient exponent $\gexp\:P'???\to \spc{L}$.
According to ???, it is a short map.
On the other hand, according to ??? there is a short map $F\:\spc{L}\to P???$ such that $F(x_i)=y_i$.
Thus the composition $F\circ\gexp|_{P???}$ has to be an isometry, therefore $\gexp|_{P???}$ is isometry.
\qeds

\begin{thm}{Lemma on flat triangle}\label{lem:flat-trig}
Let $\spc{L}\in\CBB{}{\kappa}$ be geodesic.

Assume that for a hinge $\hinge p q r$, we have equality in the angle comparison, i.e. 
$$\mangle\hinge p q r=\angk\kappa p q r.$$
Let us denote by $\Delta$ the closed domain cutted from $\Lob{}\kappa$ by triangle $\trig{\~p}{\~q}{\~r}=\~\triangle_\kappa(pqr)$.
Then there is a global isometry $\imath:\Delta\to \spc{L}$ such that $\imath([\~p\~q])=[pq]$ and $\imath([\~p\~r])=[pr]$.

Moreover, given a geodesic $[q'r']$ coonectiong points $q'\in]pq[$ and $r'\in]pr[$,
one can choose $\imath$ so that $\imath(\Delta)\supset[q'r']$.
\end{thm}

\parit{Proof.} Assume $\spc{L}$ is geodesic.
Let $q'$, $r'$, $\~q'$, $\~r'$ be the mid points of  correspondingly $[pq]$, $[pr]$, $[\~p\~q]$, $[\~p\~r]$.

Let us construct a map $\imath:\Delta\to \spc{L}$ the follownig way: first map $[\~q'\~r']$ isometrically to $[\~q\~r]$, so that $\imath(\~q')=q'$ and $\imath(\~r')=r'$.

Further note that any point $x\in\Delta\backslash [\~q'\~r']$ can be uniquely presented in one of the following ways $\GF_{\dist{\~p}^2}^t(\~y)$ or $\GF_{\dist{\~q}^2}^t(\~y)$, where $\~y\in[\~q'\~r']$ ant $t> 0$.

Thus one can exted the map $\imath$ to whole $\Delta$ according the rules:
$$\imath(\GF_{(\dist{\~p}{})^2}^t(\~y))=\GF_{(\dist{p}{})^2}^t(\imath(\~y)),$$
$$\imath(\GF_{(\dist{\~q}{})^2}^t(\~y))=\GF_{(\dist{q}{})^2}^t(\imath(\~y)).$$
It is clear that $\imath(\~p)=p$, $\imath(\~q)=q$, $\imath(\~r)=r$.

According to ??? $\imath\:\Delta\to\spc{L}$ is a short map.
Sinse 
$\dist{\~p}{\~q}=\dist{p}{q}$, the image
$\imath[\~p\~q]$ is a geodesic from $p$ to $q$.
Sinse $\imath(\~q')=q'$, we have $\imath[\~p\~q]=[pq]$.
Analogousely, $\imath[\~p\~r]=[pr]$.
\qeds






\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{}0$, 
$p\in \spc{L}$ 
and $Q\i \spc{L}$.
Assume $f\:Q\to \EE^?$ is a short map such that for some $\~p\in\Conv(f(Q))\i \EE^?$ we have 
$$\dist{\~p}{f(x)}=\dist{p}{x}$$
for any $x\in Q$.
Then there is a flat subspace $E\i \T_p$ such that $E\ni\dir px$ for any $x\in Q$ and morover
$\gexp_p|_{\Conv(\Log p(Q))}$ is an isometric embedding. 
\end{thm}


\begin{thm}{Lemma}
Let $\spc{L}\in \CBB{}{0}$, 
$\spc{U}\in \CBA{}{0}$, 
$Q\i \spc{L}$ 
and $f\:Q\to \spc{U}$ be a short map.
Assume there are points $p\in \spc{L}$ and $q\in\Conv(f(Q))\subseteq \spc{U}$ such that 
$$\dist{p}{x}=\dist{q}{f(x)}$$
for any $x\in Q$.
Then there is a space $K\in \CBBA{}00$ (i.e. a flat space) and two isometric embeddings $\imath\:K\to \spc{L}$ and $\jmath\:K\to \spc{U}$ such that
$Q\i \imath(K)$ and if $\imath(x)\in Q$ then $\jmath(x)=f\circ\imath(x)$.
\end{thm}























\begin{thm}{Exact Kirszbrun's theorem}\label{clm:kirszbraun-curv=1}
Let $\spc{L}\in\CBB{}{1}$, 
$\spc{U}\in\CBA{}{1}$ 
and $Q\i \spc{L}$.
Assume that a short map $f\:Q\to \spc{U}$ can NOT be extended to a short map 
$F\:\spc{L}\to \spc{U}$.

Then for some cordinal number $\alpha$, there is a global isometric embeddings $\imath:\SS^\alpha_+\hookrightarrow \spc{L}$ and $\jmath:\partial\SS^\alpha_+\hookrightarrow \spc{U}$ such that
\begin{enumerate}
\item $Q\i \imath(\partial\SS^{\alpha-1}_0)$, but $Q$ does not belong to any hemisphere in $\imath(\partial\SS^{\alpha}_+)$.
\item if $\imath(x)\in Q$ then $f\circ\imath(x)=\jmath(x)$ 
\item the isometry $\jmath:\partial\SS^\alpha_+\to \spc{U}$ can not be extended to an ismetry $\bar\jmath:\SS^\alpha_+\to \spc{U}$.
\end{enumerate}
\end{thm}

\parit{Proof.} Note that for any $z\in \spc{U}$ there is a point $x\in Q$ such that $\dist{z}{f(x)}>\tfrac\pi2$.
Indeed, since the ball $\cBall(z,\tfrac\pi2)\i \spc{U}$ is convex we have $\cBall(z,\tfrac\pi2)\in \CBA{}\kappa$.
Thus, if $f(Q)\i \cBall(z,\tfrac\pi2)$, we arrive to a contradiction with \ref{clm:kirszbraun-curv=1-rad}.

Assume $\spc{U}$ is proper.
Then above property imples that there is an array of points $x_1,x_2,\dots, x_n\in Q$ such that
$\cap_{i=1}^n\cBall(f(x_i,\tfrac\pi2))=\emptyset$.

Assume $n$ above takes minimal possible value.
Let us denote by $\bus_i$ the Busemann function in $\mathring{\spc{U}}$ for the ray $t\cdot f(x_i)$.
The above statement is equivalent to the fact that $\max\{\bus_i(v)\}\ge0$ for any $v\in \mathring{\spc{U}}$.
Thus according to lemma~\ref{lem:conv-map}, there is an array of positive numbers $\alpha_1,\alpha_2,\dots,\alpha_n$ 
such that $\sum_i\alpha_i=1$ such that $h(v)=\sum_i\alpha_i\cdot\bus_i(v)$ is nonnegative.
Since $n$ is minimal, we have that $\alpha_i>0$ for each $i$.

Thus $\alpha_i\cdot h(\mathring{x}_i)\ge 0$ and thus
$\sum_{i,j}\alpha_i\cdot\alpha_j\cdot\cos(\dist{x_i}{x_j})\le 0$
On the other hand, for any vector $\beta_i$ we have 
$\sum_{i,j}\alpha_i\cdot\alpha_j\cdot\cos(\dist{y_i}{y_j})\ge 0$ and since
$\dist{x_i}{x_j}\le\dist{y_i}{y_j}$, we have that $\sum_{i,j}\alpha_i\cdot\alpha_j\cdot\cos(\dist{x_i}{x_j})=0$ and $\sum_{i,j}\beta_i\cdot\beta_j\cdot\cos\dist{x_i}{x_j}\ge0$



Thus we get that $\dist{f(x_i)}{f(x_j)}=\dist{x_i}{x_j}$ for all $i,j$ and according to ???, there is an isometric embedding $\imath:\SS^k\hookrightarrow \spc{L}$ and onece you konow map $f$ of $x_i$, it admits the only extension to $\imath(S^k)$ as a short map, and it is an isometry.

Moreover for any $x\in Q$ we have that ???
Thus $f(x)\in ???(E)$ and therefore $f(Q)\i ???(E)$ thus there is an isometric splitting ???
Thus the maps ??? are also not exteandable.


Let $\mathring{\spc{L}}$, $\mathring{\spc{U}}$ be two cones with curvatere $\ge0$ and $\le0$ correspondingly 
and $Q\i \mathring{\spc{L}}$.
A map $f\:Q\to \mathring{\spc{U}}$ is called irreduceble if there is no convex subcone $\mathring{\spc{U}}'\i \mathring{\spc{U}}$ which contains $f(Q)$
and there is no pair of splittings $\mathring{\spc{L}}=\mathring{\spc{L}}'\times\RR$ and $\mathring{\spc{U}}=\mathring{\spc{U}}'\times\RR$ with $\RR$-projections 
$\Pi_{\mathring{\spc{L}}}:\mathring{\spc{L}}\to\RR$ and $\Pi_{\mathring{\spc{U}}}:\mathring{\spc{U}}\to\RR$ such that for any $x\in Q$ we have 
$\Pi_{\mathring{\spc{U}}}\circ f(x)=\Pi_{\mathring{\spc{L}}}(x)$ for any $x\in Q$.

\ref{split=<0}

Clearly we may think that $f$ is irreducable, otherwise ???
\qeds





















Further, given $y\in \spc{U}$, let us denote by $\bus_y:\mathring{\spc{U}}\to\RR$ the Busemann function for direction $y$; i.e. ???sign???
$$\bus_y(w) =\lim_{t\to\infty}\l[t-(\dist{w}{t\cdot\mathring y})\r].$$ 
Applying \ref{eq:clm:kirszbraun-curv=1-rad-star} for $w=t\cdot\mathring x$ with $t\to\infty$ we get
$$\bus_{f(x)}(s)\ge \cos(\dist{p}{x}).$$

\begin{wrapfigure}{r}{42mm}
\begin{lpic}[t(0mm),b(5mm),r(0mm),l(0mm)]{pics/k_0(0.3)}
\lbl[b]{100,5;$\mathring{\spc{U}}=\Cone \spc{U}$}
\lbl[lt]{80,74;$\mathring z$}
\lbl[lb]{75,102;$\bar s=\mathring r$}
\lbl[b]{128,99;$\alpha(t)$}
\lbl[rb]{57,102;$s$}
\lbl[lt]{7,73;$o$}
\end{lpic}
\end{wrapfigure}

Since $\rad \spc{U}\le \tfrac\pi2$, there is $z\in \spc{U}$ such that $\dist{z}{y}\le\tfrac\pi2$ for any $y\in \spc{U}$.
Draw a ray $\alpha:[0,\infty)\to \mathring{\spc{U}}$, starting at $s$ in direction of $z$%
\footnote{i.e. the limit of geodesics $[s\ t\cdot\mathring z]$ as $t\to\infty$.}.
From ???, we have that $\bus_{f(x)}\circ\alpha(t)$ is increasing, therefore for the necessary unique point $\bar s$ on this ray such that $\dist{o}{\bar s}=1$, we also have 
$$\bus_{f(x)}(\bar s)\ge \cos(\dist{p}{x}).$$

Thus if $r\in \spc{U}$ be the point which corresponds to $\bar s\in \mathring{\spc{U}}$ (i.e. such that $\mathring r=\bar s$) we get 
$$\dist{r}{f(x)}
\le 
\dist{p}{x}$$
for any $x\in\bar Q$.\contradiction
\qeds














\begin{thm}{Theorem}
Let $\spc{L}\in\CBB m{}$, $x\in \spc{L}$ and $\T_x\iso\EE^m$.
Then there is a neigborhood $\Omega\ni x$ and a bi-Lipschits embedding $\map\:\Omega\to\RR^m$ such that 
the restriction $\map|_{\oBall(x,\eps)}$ is a $(1\pm o(\eps^0))$-bi-Lipschiz.
\end{thm}
















To prove the second inequality, 
it is sufficient to show that for $v\in\T_p$,
$$\d_p x^i(v)\ge 0
\ \ 
\t{for each}
\ i\ 
\t{implis that}
\ \ \d_p y(v)\le 0.\eqlbl{new-form}$$
Recall that $y=\dist{b}{}|_\Omega$ and $x^i=\dist{a_i}{}|_\Omega$  for some points $b,a_1,a_2,\dots,a_m\in \spc{L}$  and $\angk\kappa{p}{a_i}{a_j},\angk\kappa{p}{b}{a_i}>\tfrac\pi2$ for all $i,j$ (see definition of distant chart).
Since $\d_p x^i(v)=(\d_p\dist{a_i}{})(v)\le\<\dir{p}{a_i},v\>$, we get \ref{new-form} directly from lemma ???.

then for any dierection $\xi\in\Sigma_p$, we have 

Let $\bm{e}_1=(1,0,\dots,0)$, $\bm{e}_2=(0,1,\dots,0),\dots,\bm{e}_m=(0,0,\dots,1)$ be coordinate vector fields on $\RR^m$;
so $\partial^+_i\phi=\d\phi(\bm{e_i})$ for any semidifferentiable function $\phi$.
For $p\in\Omega$, set $X_i=(\d_p\bm{x})^{-1}\bm{e}_i$.
Thus, $\d_px^i(X_j)=0$ for all $i\not=j$,
$\d_px^i(X_i)=1$ for each $i$. 
In particular, $\d_px^i(X_j)\ge 0$ for all $i,j$.
Since $(\d_p\bm{x})^{-1}$ is $\tfrac{1}{\eps}$-Lipschitz, we get $|X_i|\le \tfrac1\eps$.
Applying ???, we get $\d_p y(X_i)\le 0$.

Let us connect $\bm{\bar\gamma}(t)$ to $???$ by a broken coordinate line in $\RR^m$,
it has 

Note that according to ???, for any direction $\xi\in\Sigma_p$ we have
$(\d_p\dist{b}{})(\xi)\le \eps???$
or $(\d_p\dist{a_i}{})(\xi)\le -\eps???$ for some $i$.
Assume $v_i=\partial^+_i$???

Let $v_i=\partial_i(p)\in \T_p$.
Note that $\partial_i^+f=(\d_p\dist{a}{})(v_i)$.
Thus, if $\partial_i^+f>-\eps$ then we have
$(\d_p\dist{a_i}{})(v_i)$

























Let us introduce a partial order $\succcurlyeq$ on $\RR^{m}$.
For two arrays 
$\bm{v}, \bm{w}\in \RR^{m}$, 
we will write
$\bm{v}\succcurlyeq\bm{w}$ if $v_i\ge w_i$ for each $i$.

Now,
\begin{align*}
 f\l(t\cdot\bm{x}+(1-t)\cdot\bm{y}\r)
&\ge
f(\dist{\bm{a}}{\gamma(t)}-???
\ge
\\
&\ge
t\cdot f(\bm{x})
+(1-t)\cdot f(\bm{y})
-\tfrac{m\cdot\lambda}{2\cdot\eps}\cdot t\cdot(1-t)\cdot|\bm{x}-\bm{y}|^2+???
\ge
\\
&\ge
t\cdot f(\bm{x})
+(1-t)\cdot f(\bm{y})-
-\tfrac\Lambda2\cdot t\cdot(1-t)\cdot|\bm{x}-\bm{y}|^2
\end{align*}


Since $\dist{b}{}$ 
as well as each function $\dist{a_i}{}$ is $\lambda???$-concave in $\Omega$,
we have ???
\qeds



















Let $\spc{L}\in\CBB{m}{\kappa}$,
$p,b\in\spc{L}$ 
and $\bm{a}=(a_1,a_2,\dots,a_m)\in\spc{L}^{m}$ be a point array.
Assume the distant map $\dist{\bm{a}}{}\:\spc{L}\to\RR^m$ admits an inverse submap $\map\:\RR^m\subto \spc{L}$.
Let us define metric tensor on $\Dom\map$ the following way:
for each point $x\in \Im\map$, choose a geodesics $[xa_i]$ for all $i$.
Then define $g_{ij}=\cos\mangle(\dir{x}{a_i},\dir{x}{a_j})$.

In general, the defined metric tensor is not continuous.

The next theorem implies that one can recover local metric on $\spc{L}$ from the metric tensor.

\begin{thm}{Theorem}
Let $\spc{L}\in\CBB{m}{\kappa}$ ???
and $\II$ is a real interval.
Assume $c\:\II\to\Dom\map$ be a Lipshitz curve then
$$\length(\map\circ c)=\int\limits_\II g(\dot c(t),\dot c(t))\d t.$$
\end{thm}

\parit{Proof.}
???
\qeds

\begin{thm}{Definition}
Let $U$ be an open domain in $\RR^m$.
a function $f\:U\to\RR$ has bounded variation if there is a constant 
\end{thm}


\begin{thm}{Theorem}
Let???
Then each component $g_{ij}$ of metric tensor has bounded variation
\end{thm}


















%We will call elements of the tangent cone $\T_p$ the \emph{tangent vectors}\index{tangent vector} at $p$.
%The origin $o=o_p$ of $\T_p$ plays the role of a ``zero 
%vector''.
%For a tangent vector $v$ at $p$ we define its \emph{absolute value}\index{absolute value} $|v|\df|o_p v|$\index{$\vert{*}\vert$}.
%For two tangent vectors $u,v\in \T_p$ we can define 
%their \emph{scalar product}\index{scalar product} 
%$$\langle u, v\rangle\df(|u|^2+|v|^2-|u v|^2)/2=|u|\cdot |v|\cdot\cos\alpha,$$ \index{$\<{*},{*}\>$}
%where $\alpha=\mangle\hinge o u v=\tangle_0(o;u v)$.
%Note that in general, the sum of ``tangent vectors'' is undefined, i.e. we %do abuse term ``vector'' here.

%When it is convinient, we treat $\Sigma_p$ as a ``unit sphere'' in $\T_p$ i.e. set of unit tangent vectors at $p$. 
%Thus, $\xi\in \Sigma_p$ might also refer to the cooresponding unit vector in $\T_p$

















\section{Kuratowski embedding and tangent cone}

???EVERYTHING IS WRONG IN THIS SECTION???

In this section, we define tangent cone for general metric space via Kuratowski embedding.
Usually, in Alexandrov geometry, tangent cone is defined differently.

\parbf{Tangent cone.}
Let $\spc{X}$ be a metric space and $p\in\spc{X}$.
A function $\xi\in\Bnd(\spc{X},\RR)$ is called \emph{direction}\index{direction} at $p$ if $\|\xi\|=1$ and there is a sequence of points $x_n\to p$, such that the sequence of functions $\frac{\kur_p x_n}{\dist{p}{x_n}}\rightharpoonup\xi$,
here ``$\rightharpoonup$''\index{$\rightharpoonup$} denotes \emph{weak convergence}\index{weak convergence}.
In other words, $\frac{\dist{x_n}{q}-\dist{p}{q}}{\dist{p}{x_n}}\to \xi(q)$ for any point $q\in \spc{X}$.
The set of directions at $p$ will be denoted by $\Sigma_p=\Sigma_p\spc{X}$.


Given a subset $A\i \spc{X}$, the subset of $\Sigma_p\spc{X}$ formed by all week limits of $\frac{\kur_p x_n}{\dist{p}{x_n}}$ with $x_n\in A$
will be called ???; we denote it by $\Sigma_p A$ 

The cone over  $\Sigma_p$,
i.e. the set of all functions in $v\in\Bnd(\spc{X},\RR)$, such that 
$v=r\cdot\xi$ for some $r\ge 0$ and $\xi\in\Sigma_p$ will be called tangent cone at $p$.
It will be denoted as $\Tan_p=\Tan_p\spc{X}$.
Similarly, for a subset $A\i\spc{X}$, we denote by $\Tan_p A$ the cone over $\Sigma_p A$.








\parbf{Differentiability of curves.}
Let $\II$ be a real interval,
$\spc{X}$ be a metric space 
and $\alpha\:\II\to \spc{X}$ be a curve.
We say that $v\in\T_{\alpha(t_0)}$ is a \emph{right} (or \emph{left}) \emph{derivative} of $\alpha$ at $t_0\in\II$, briefly, $v=\alpha^+(t_0)$ (or $v=\alpha^-(t_0)$)
if 
$$\frac{\kur_{\alpha(t_0)}{\alpha(t)}}{|t-t_0|}\rightharpoonup v\ \ \t{in}\ \ \Bnd(\spc{X},\RR)\ \ \t{as}\ \ t\to t_0+\ \ (\t{or}\ \ t\to t_0-).$$


For an interior value $t_0$ of $\II$, 
if $\alpha^+(t_0)$ or $\alpha^-(t_0)$ or both are well defined,
we say correspondingly that  $\alpha$ is \emph{right}\index{differentiable!right differentiable} or \emph{left}\index{differentiable!left differentiable} or \emph{both-sided differentiable}\index{differentiable!both-sided differentiable} at $t_0$.
In the exceptional cases, when $t_0$ is the left (correspondingly right) end of $\II$, $\alpha$ is by definition left (correspondingly right) differentiable at $t_0$.

For an interior value $t_0$ of $\II$,
in case if $\alpha$ is both-sided differentiable at $t_0$ and $\alpha^+(t_0)+\alpha^-(t_0)=0$, we say that $\alpha$ is \emph{differentiable}\index{differentiable} at $t_0$.
In the exceptional cases, when $t_0$ is the left (correspondingly right)
we say that $\alpha$ is both-sided differentiable at $t_0$ if $\alpha$ is right (correspondingly left) differentiable at $t_0$.














\parbf{Scalar product.}
If for two tangent vectors $u,v\in\Tan_p$,
there is $a\in\RR$ such that
$$\|t\cdot u+\tau\cdot v\|^2=t^2\cdot\|u\|^2+t\cdot\tau\cdot a+\tau^2\cdot \|u\|^2,$$
for all $t$, $\tau\in\RR$, 
then the value $a$ is called \emph{scalar product}\index{scalar product} of $u$ and $v$ (briefly, $a=\<u,v\>$).

It is easy to see that if for two vectors $u,v,\in \Bnd(\spc{X},\RR)$, the scalar product $\<u,v\>$ is well defined then both vectors lie in a Euclidean subspace of $\Bnd(\spc{X},\RR)$;
i.e. there is subspace $E\ni u,v$, such that the norm on $\Bnd(\spc{X},\RR)$ induces a Euclidean norm on $E$.
Thus, for general metric space, scalar product of tangent vectors may not be defined, but as you will see in ??? and ???, it is defined in Alexandrov space, both $\CBB{}{}$ and $\CBA{}{}$.
If $\<u,v\>$ is well defined and $\|u\|$, $\|v\|>0$ then we define angle between $u$ and $v$ as 
$$
\mangle(u,v)
=
\arccos\frac{\|u\|^2+\|v\|^2-\<u,v\>}{2\cdot\|u\|\cdot\|v\|}.
$$ 












\begin{thm}{Lemma}
Let $\spc{L}\in\CBB{}{}$ and $p\in\spc{L}$.
Then for any two tangent vectors $v$, $w\in\Tan_p$, the salar product $\<v,w\>$ is well defined.
\end{thm}

\begin{thm}{Lemma}
Let $\spc{U}\in\CBA{}{}$ 
and $\gamma\:\II\to\spc{U}$ is a geodesic then $\gamma$ is both-side differentiable.
\end{thm}


\begin{thm}{Lemma}
Let $\spc{L}\in\CBA{}{}$ and $p\in\spc{L}$.
Then for any two tangent vectors $v$, $w\in\Tan_p$, the salar product $\<v,w\>$ is well defined.
\end{thm}














\section{Tangent space via curves}

Let $\spc{L}\in \CBB{}{}$ and $p\in \spc{L}$.
Consider set $\Gamma_p$ of all Lipzchitz curves $\alpha\:[0,\eps)\to\spc{L}$ starting at $p$ (i.e. $\alpha(0)=p$) equiped with the following metric
$$(\dist{\alpha}{\beta})_{\Gamma_p}=\limsup_{t\to0+}\frac{(\dist{\alpha(t)}{\beta(t)})_{\spc{L}}}{t}$$
for $\alpha,\beta\in\Gamma_p$.
















