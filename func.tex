%%!TEX root = all.tex
%array^
\chapter{Maps and functions}

Here we introduce some classes of maps between metric spaces and develop a language to describe different levels of convexity/concavity of real-valued functions on general metric space.

Concave functions are used mainly in the $\Alex{}$ spaces,
while convex ones are used  mainly in $\CAT{}$ spaces.

\section{Submaps}

We will often need maps and functions defined on subsets of a metric space. We call them \emph{submaps} and \emph{subfunction}\index{submap}\index{subfunction}.
Thus given a metric space $\spc{X}$ and $\spc{Y}$, 
a submap $\map\:\spc{X}\subto \spc{Y}$ is a map defined on a subset $\Dom\map\subset \spc{X}$.

A submap is defined to be \index{continuous submap}\emph{continuous} if the inverse image of any open set is open.
Note that for a continuous submap $\map$, the domain $\Dom\map$ is automatically open.
Indeed, a submap $\map\:\spc{X}\subto \spc{Y}$ is continuous if the inverse image of any open set is open.
Since $\spc{Y}$ is open then so is $\Dom \map=\map^{-1}(\spc{Y})$.
The same is true for upper and lower semicontinuous functions $f\:\spc{X}\subto \RR$ since it is a continuous function for special topology on $\RR$.%

(The continuous partially defined maps could be defined via closed sets; namely, one may request that inverse images of closed sets are closed.
While this condition is equivalent to the continuity for the functions defined on whole space,
it is different for partially defined functions. 
In particular with this definition domain of the continuous submap would have to be closed.)

\section{Lipschitz conditions}


\begin{thm}{Lipschitz maps}
Let $\spc{X}$ and $\spc{Y}$ be metric spaces 
$\map\:\spc{X}\subto\spc{Y}$ be a continuous submap 
and $\Lip\in\RR$.

\begin{subthm}{}
The submap $\map$ is called \emph{$\Lip$-Lipschitz}\index{$\Lip$-Lipschitz map} if
\[\dist{\map(x)}{\map(y)}{\spc{Y}}
\le
\Lip\cdot
\dist{x}{y}{\spc{X}}\]  
for any two points $x,y\in\Dom \map$.

\begin{itemize}
 \item The $1$-Lipschitz maps will be also called \emph{short}\index{short map}.
\end{itemize}

\end{subthm}

\begin{subthm}{}
We say that $\map$ is \emph{Lipschitz}\index{Lipschitz map} if it is $\Lip$-Lipschitz for some constant $\Lip$.
The minimal such constant is denoted by $\lip\map$.
\end{subthm}

\begin{subthm}{}
We say that $\map$ is \emph{locally Lipschitz}\index{locally Lipschitz map} 
if any point $x\in\Dom \map$ admits a neighborhood 
$\Omega\subset \Dom\map$ such that the restriction $\map|_\Omega$ is Lipschitz.
\end{subthm}

\begin{subthm}{}
Given $p\in\Dom \map$, we denote by $\lip_p\map$ the infimum of the real values $\Lip$ such that
$p$ admits  a neighborhood 
$\Omega\subset \Dom\map$ such that the restriction $\map|_\Omega$ is $\Lip$-Lipschitz.
\end{subthm}
\end{thm}

Note that $\map\:\spc{X}\to\spc{Y}$ is $\Lip$-Lipschitz if
\[\map(\oBall(x, R)_{\spc{X}})\subset\oBall(\map(x),\Lip\cdot R)_{\spc{Y}}\]
for any $R\ge 0$ and $x\in \spc{X}$.
The following definition gives a dual version of it.

\begin{thm}{Definitions}
Let $\spc{X}$ and $\spc{Y}$ be metric spaces, 
$\map\:\spc{X}\to\spc{Y}$ be a map 
and $\Lip\in\RR$.
\begin{subthm}{}
The map $\map$ is called \emph{$\Lip$-co-Lipshitz}\index{$\Lip$-co-Lipshitz map} if 
\[\map(\oBall(x,\Lip\cdot R)_{\spc{X}})\supset\oBall(\map(x),R)_{\spc{Y}}\]
for any $x\in \spc{X}$ and $R>0$.
\end{subthm}

\begin{subthm}{}
The map $\map$ is called \emph{co-Lipshitz}\index{co-Lipshitz map} if it is $\Lip$-co-Lipshitz
for some constant $\Lip$.
The minimal such constant is denoted by $\colip\map$.

\end{subthm}
\end{thm}

From the definition of co-Lipschitz map we get the following.

\begin{thm}{Proposition}
Any co-Lipschitz map is open and surjective.
\end{thm}

In other words, the $\Lip$-co-Lipschitz maps 
can be considered as a quantitative version of open maps.
By that reason they also called $\Lip$-open \cite{burago-gromov-perelman}.
Also, be aware that some authors, 
refer to our $\Lip$-co-Lipschitz maps
as to $\tfrac1\Lip$-co-Lipschitz. %REF???.

\begin{thm}{Proposition}\label{prop:colip=>complete}
Let $\spc{X}$ and $\spc{Y}$ be metric spaces and
$\map\: \spc{X}\to\spc{Y}$ a continuous co-Lipschitz map. 
Then $\spc{Y}$ is complete.
\end{thm}

\parit{Proof.}
Choose a converging in itself sequence $y_1,y_2,\dots$ in $\spc{Y}$.
Passing to a subsequence if nececury, we may assume that $\dist{y_n}{y_{n+1}}{\spc{Y}}< \tfrac1{2^n}$ for each $n$.

Denote by $\Lip$ a co-Lipschitz constant of $\map$.
Note that  there is a sequence $x_1,x_2,\dots$ in $\spc{X}$
such that
\[\map(x_n)=y_n\quad \text{and}\quad \dist{x_n}{x_{n+1}}{\spc{X}}< \tfrac{\Lip}{2^n}.\eqlbl{eq:colip+1/2n}\]
for each $n$. 
Indeed, such a sequence $(x_n)$ can be constructed recursively. 
Assuming that the points $x_1,\dots,x_{n-1}$ are already constructed, 
the existence of $x_n$ satisfying \ref{eq:colip+1/2n}
follows since $\map$ is $\Lip$-co-Lipschitz.

Notice that $(x_n)$ converges in itself;
since $\spc{X}$ is complete, it converges in $\spc{X}$.
Denote by $x_\infty$ its limit
and set $y_\infty= \map(x_\infty)$.
Since $\map$ is continuous,
$y_n\to y_\infty$ as $n\to\infty$.
Hence the result.
\qeds

\begin{thm}{Lemma}\label{lem:lip-approx}
Let $\spc{X}$ be a metric space and $f\:\spc{X}\to\RR$ be a continuous function.
Then for any $\eps>0$ there is a locally Lipschitz function $f_\eps\:\spc{X}\to\RR$
such that $|f(x)-f_\eps(x)|<\eps$ for any $x\in \spc{X}$.
\end{thm}

\parit{Proof.}
Assume that $f\ge 1$.
Construct a continous positive function $\rho\:\spc{X}\to \RR_{>0}$ such that 
\[\dist{x}{y}{}<\rho(x)\quad \Rightarrow\quad |f(x)-f(y)|<\eps.\]
Consider function
\[
f_\eps(x)
=
\sup\set{f(x)
\cdot
\left(1-\tfrac{\dist{x}{y}{}}{\rho(x)}\right)}%
{x\in\spc{X}}.
\]
It is straightforward to check that each $f_\eps$ is locally Lipschtz and $0\le f_\eps-f<\eps$.

Note that any continuous function can be presented as difference of two continuous functions bounded below by $1$.
Hence the result.
\qeds

\section{Isometries and sumbetries}\label{sec:quotient-CBB}

\begin{thm}{Isometry}\label{def:isometry}
Let $\spc{X}$ and $\spc{Y}$ be metric spaces
and $\map\:\spc{X}\to \spc{Y}$ be a map
\begin{subthm}{}
The map $\map$ is \emph{distance preserving}\index{distance preserving map} if
$$\dist{\map(x)}{\map(x')}{\spc{Y}}=\dist{x}{x'}{\spc{X}}$$
for any $x,x'\in X$.
\end{subthm}

\begin{subthm}{}
A distance preserving bijection $\map$ is called an \emph{isometry}\index{isometry}.
\end{subthm}

\begin{subthm}{}
The spaces $X$ and $Y$ are called \emph{isometric}\index{isometric spaces} (briefly $X\iso Y$)
 if there is an isometry  $\map\:X\to Y$.
\end{subthm}

\end{thm}

\begin{thm}{Submetry}\label{def:submetry}
A map $\sigma\:\spc{L}\to\spc{M}$ between the metric spaces $\spc{L}$ and $\spc{M}$
is called 
\emph{submetry}\index{submetry} if 
\[\sigma(\oBall(p,r)_\spc{L})=\oBall(\sigma(p),r)_{\spc{M}}\]
for any $p\in \spc{L}$ and $r\ge 0$.
\end{thm}


Note $\sigma\:\spc{L}\to\spc{M}$ is a sumbetry if it is 1-Lipshitz and 1-co-Lipschitz at the same time.

Note that any submetry is an onto map.

The main souse of examples of submetries comes from isometric group actions.

Nemely, assume $\spc{L}$ is a metric space and $G$ be a subgroup of isometries of $\spc{L}$.
Denote by $\spc{L}/G$ the set of $G$-orbits;
let us equip it with the Hausdorff metric. 

In general, $\spc{L}/G$ is a pseudometric space,
but if all the $G$-orbits form closed sets in $\spc{L}$
then $\spc{L}/G$ is a genuine metric space.

\begin{thm}{Proposition}\label{prop:submet/G}
Let $\spc{L}$ be a metric space.
Assume that a group $G$  acts on $\spc{L}$ by isometries  
and in such a way that every $G$-orbit is closed.
Then the projection map $\spc{L}\to \spc{L}/G$ is a sumbetry.
\end{thm}

\parit{Proof.}
Denote by $\hat x$ the projection of $x\in \spc{L}$ in $\spc{L}/G$.
We need to show that the map $x\mapsto\hat x$ is $1$-Lipschitz and $1$-co-Lipschitz.
The co-Lipschitz part follows directly from the definition of Hausdorff distance and co-Lipschitz map.

Assume $\dist{x}{y}{\spc{L}}\le r$; equivalently $\cBall[x,r]_{\spc{L}}\ni y$.
Since the action $G\acts \spc{L}$ is isometric, 
$\cBall[g\cdot x,r]_{\spc{L}}\ni g\cdot y$ for any $g\in G$.

In particular the orbit $G\cdot y$ lies in the closed $r$-neighborhood of the orbit $G\cdot x$.
The same way we can prove that the orbit $G\cdot x$ lies in the closed $r$-neighborhood of the orbit $G\cdot y$. 
That is, the Hausdorff distance between the orbits $G\cdot x$ and $G\cdot y$ is at most $r$
or, equivalently, $\dist{\hat x}{\hat y}{\spc{L}/G}\le r$.
Since $x$ and $y$ are arbitrary, the map $x\mapsto\hat x$ is $1$-Lipschitz.
\qeds


\begin{thm}{Proposition}
\label{prop:submet-length}
Let  $\spc{L}$ be a length space 
and $\sigma\:\spc{L}\to \spc{M}$ is a submetry.
Then $\spc{M}$ is a length space.
\end{thm}

\parit{Proof.}
Fix $\eps>0$ and a pair of points $x,y\in \spc{M}$.

Since $\sigma$ is $1$-co-Lipschitz, there are points $\hat x,\hat y\in \spc{L}$
such that $\sigma(\hat x)\z=x$, $\sigma(\hat y)\z=y$ 
and $\dist{\hat x}{\hat y}{\spc{L}}<\dist{x}{y}{\spc{M}}+\eps$.

Since ${\spc{L}}$ is a length space, 
there is a curve $\gamma$ 
joining $\hat x$ to $\hat y$ in ${\spc{L}}$
such that
\[\length\gamma\le \dist{x}{y}{\spc{M}}+\eps.\]

Since $\sigma$ is $1$-Lipschitz,
there 
\[\length\sigma\circ\gamma\le \length\gamma.\]

Note that the curve $\sigma\circ\gamma$ joins $x$ to $y$
and from above
\[\length\sigma\circ\gamma<\dist{x}{y}{\spc{M}}+\eps.\]
Since $\eps>0$ is arbitrary,
we have that $\spc{M}$ is a length space.
\qeds

\section{Speed of curves}

Let $\spc{X}$ be a metric space.
A \emph{curve}\index{curve} in $\spc{X}$ is a continuous map $\alpha\:\II\to \spc{X}$, where $\II$ is a \emph{real interval}\index{real interval} (that is, an arbitrary convex subset of $\RR$);
the curve it called \emph{Lipschitz}\index{Lipschitz curve} or \emph{locally Lipschitz}\index{locally Lipschitz curve} if the map $\alpha\:\II\to \spc{X}$~is.

Recall that length of curves is defined in \ref{def:length}.
The following theorem follows from \cite[2.7.4]{burago-burago-ivanov}.

\begin{thm}{Theorem}\label{thm:speed}
Let $\spc{X}$ be a metric space  
and $\alpha\:\II \to \spc{X}$ be a locally Lipschitz
curve. 
Then the speed function
\[\speed_{t_0}\alpha
=
\lim_{\substack{t\to t_0+\\s\to t_0-}}\frac{\dist{\alpha(t)}{\alpha(s)}{}}{|t-s|}\] 
is defined for almost all $t_0 \in \II$ and 
\[\length\alpha=\int\limits_\II \speed_{t}\alpha\cdot\dd t,\]
where $\int$ denotes the Lebesgue integral.
\end{thm}

A curve $\alpha\:\II\to\spc{X}$ is called \emph{unit-speed curve}\index{unit-speed curve}, 
if for any subinterval $[a,b]\subset\II$, we have
\[b-a=\length(\alpha|_{[a,b]}).\]
According to the above theorem, this is equivalent to the condition that $\alpha$ is Lipschitz and $\speed\alpha\ae 1$.

The following generalization of Rademacher theorem was proved by Bernd Kirchheim \cite{kirchheim}. %CHECK??? 

The conclusion of the standard Rademacher theorem does not make sense for maps to metric space since it might have no linear structure.
But the theorem does not hold even if we assume that the target is a Banach space.
For example the map $[0,1]\to L^1[0,1]$ defined by $x\mapsto \chi_{[0,x]}$ is distance preserving and in particular Lipschitz (here $\chi_A$ denotes characteristic function of $A$).
However the differential $\dd_xf$ is not defined for any $x$.

\begin{thm}{Theorem}\label{thm:Rademacher-md}
Let $\spc{X}$ be a metric space 
and $f\:\RR^n \subto \spc{X}$ be $1$-Lipschitz. 
Then for almost all $x\in\Dom f$ there is a pseudonorm %???
$\lVert*\rVert_x$ on $\RR^n$ such that
we have
\[\dist{f(y)}{f(z)}{\spc{X}}=\lVert z-y\rVert_x+o(|y-x|+|z-x|).\]
\end{thm}


The (pseudo)norm $\lVert*\rVert_x$ in the above theorem 
will be called \emph{differential of induced metric} at $x$.

\section{Convex real-to-real functions}\label{sec:conv-real}

We will be interested in the generalized solutions
of the following differential inequalities
\[y''+\kappa\cdot  y\ge \lambda
\quad \t{and respectively}
\quad y''+\kappa\cdot  y\le \lambda
\eqlbl{eq:sec:conv-real*}\]
for fixed $\kappa,\lambda\in\RR$.
The solution $y\:\RR\subto\RR$ are only assumed to be upper (respectively lower) semicontinuous subfunctions.

The inequalities  \ref{eq:sec:conv-real*} are understood in the sense of distributions.
That is, for any smooth function $\phi$ with compact support $\supp\phi\subset\Dom y$ the following inequality should be satisfied:
\[\begin{aligned}
\int\limits_{\Dom y}\left[y(t)\cdot\phi''(t)+\kappa\cdot  y(t)\cdot\phi(t)-\lambda\right]\cdot\dd t
&\ge 0
\\
\t{respectively}\quad &\le0.
\end{aligned}
\eqlbl{eq:distr-conc}\]
The integral is understood in the sense of Lebesgue,
in particular the inequality \ref{eq:distr-conc}
makes sense for any Borel-measurable subfunction $y$.
The proofs of the following propositions are straightforward.

\begin{thm}{Proposition}
Let $\II\subset\RR$ be an open interval and $y_n\:\II\to\RR$ be a sequence of solutions of one of the inequality in \ref{eq:sec:conv-real*}.
Assume $y_n(t)\to y_\infty(t)$ as $n\to\infty$ for any $t\in \II$.
Then $y_\infty$ is a solution of the same inequality in \ref{eq:sec:conv-real*}.
\end{thm}

Assume $y$ is a solution of one of the inequality in \ref{eq:sec:conv-real*}.
For $t_0\in \Dom y$, let us define right (left) derivative $y^+(t_0)$ ($y^-(t_0)$) at $t_0$ by
\[y^\pm(t_0)=\lim_{t\to t_0\pm} \frac{y(t)-y(t_0)}{|t-t_0|}.\]
Note that our sign convention for $y^-$ is not standard --- for $y(t)=t$ we have
$y^+(t)=1$ and $y^-(t)=-1$.

\begin{thm}{Proposition}\label{prop:derivative-of-convex-function}
Let $\II\subset\RR$ be an open interval and $y\:\II\to\RR$ be a solution of the inequality in \ref{eq:sec:conv-real*}.
Then  $y$ is locally Lipschitz; its right and left derivatives $y^+(t_0)$ and $y^-(t_0)$ are defined
for any $t_0\in\II$.
Moreover 
\[y^+(t_0)+y^-(t_0)\ge 0
\quad \t{or respectively}
\quad y^+(t_0)+y^-(t_0)\le 0\]
\end{thm}


The next theorem gives a  number of equivalent ways to define such a generalized solution.

\begin{thm}{Theorem}\label{y''=<1-ky}
Let $\II$ be an open real interval and $y\:\II\to\RR$ be a locally Lipschitz function
then the following conditions are equivalent:
\begin{subthm}{}$y''\ge \lambda-\kappa\cdot  y$ (respectively $y''\le \lambda-\kappa\cdot  y)$
\end{subthm}

\begin{subthm}{barrier}(barrier inequality) For any $t_0\in \II$, 
there is a solution $\bar y$ 
of ordinary differential equation $\bar y''=\lambda-\kappa\cdot  \bar y$ 
with $\bar y(t_0)= y(t_0)$ such that $\bar y\ge y$ (respectively $\bar y\le y$) for all $t\in [t_0-\varpi\kappa,t_0+\varpi\kappa]\cap \II$.

The function $\bar y$ is called \emph{lower} (respectively \emph{upper}) \emph{barrier} of $y$ at $t_0$\index{barrier}.
\end{subthm}

\begin{subthm}{barrier'} 
Suppose $y''\le \lambda-\kappa\cdot  y$ . Let $t_0\in\II$ and let  $\bar y$ be a solution of  the
 ordinary differential equation $\bar y''=\lambda-\kappa\cdot  \bar y$ 
such that  $\bar y(t_0)= y(t_0)$ and $y^+(t_0)\le y(t_0)\le -y^-(t_0)$. (note that such $\bar{y}$ is unique if $y$ is differentiable at $t_0$). 

Then $\bar y\ge y$  for all $t\in [t_0-\varpi\kappa,t_0+\varpi\kappa]\cap \II$; that is $\bar{y}$ is a barrier of $y$ at $t_0$.
\end{subthm}

\begin{subthm}{y''-mono} (Jensen's inequality)\index{Jensen's inequality}
For any pair of values $t_1<t_2$ in $\II$, such that $|t_2-t_1|<\varpi\kappa$ the unique solutions $z(t)$ of \[z''\z=\lambda-\kappa\cdot  z\] such that
\[z(t_1)=y(t_1),\quad z(t_2)=y(t_2)\] 
satisfies $y(t)\le z(t)$ (respectively $y(t)\ge z(t)$) for all $t\in[t_1,t_2]$.
\end{subthm}
\end{thm}

The proof is left to the reader.

We will often need the following fact about convergence of derivative of convex functions:

{\sloppy 

\begin{thm}{Lemma on equilibrium}\label{lem:der-conv-lim}
Let $\II$ be an open interval 
and $f_n\:\II\to\RR$ be a sequence of concave functions. 
Assume the functions $f_n$ pointwise converge to a function $f\:\II\to\RR$.
Then for any $t_0\in \II$,
\[f^\pm(t_0)\le \liminf_{n\to\infty}f^\pm_n(t_0).\]
\end{thm}

}

\parit{Proof.}
Since $f_n$ are convex, we have $f^+_n(t_0)+f^-_n(t_0)\ge0$, and for any~$t$,
\[f_n(t)\ge f_n(t_0)\pm f^\pm(t_0)\cdot (t-t_0).\]
Passing to the limit, we get
\[f(t)\ge f(t_0)+\left[\limsup_{n\to\infty}f^+_n(t_0)\right]\cdot (t-t_0)\]
for $t\ge t_0$, and 
\[f(t)\ge f(t_0)-\left[\limsup_{n\to\infty}f^-_n(t_0)\right]\cdot (t-t_0)\]
for $t\le t_0$.
Hence the result.
\qeds

\begin{thm}{Corollary}
\label{cor:der-conv-lim}
Let $\II$ be an open interval 
and $f_n\:\II\to\RR$ be a sequence of functions such that $f_n''\le \lambda$ and converge pointwise to a function $f\:\II\to\RR$.
Then: 
\begin{subthm}{} If $f$ is differentiable at $t_0\in \II$, then
\[f'(t_0)=\pm\lim_{n\to\infty} f^\pm_n(t_0).\]
\end{subthm}

\begin{subthm}{} If all $f_n$ and $f$ are differentiable at $t_0\in \II$, then
\[f'(t_0)=\lim_{n\to\infty} f'_n(t_0).\]
\end{subthm}
\end{thm}

\parit{Proof.} Set $\hat f_n(t)=f_n(t)-\tfrac{\lambda}{2}\cdot t^2$ and $\hat f(t)=f(t)-\tfrac\lambda2\cdot t^2$.
Note that $\hat f_n$ are concave and $\hat f_n\to \hat f$ pointwise.
Thus, theorem follows from the lemma on equilibrium (\ref{lem:der-conv-lim}).\qeds











\section{Convex functions on a metric space}\label{sec:conv-fun}

The following notion will be used for geodesic spaces most of the time.

\begin{thm}{Definition}\label{def:lam-convex}
Let $\spc{X}$ be a metric space.
We say that an upper semicontinuous subfunction $f\:\spc{X}\subto(-\infty,\infty]$ 
satisfies the inequality
\[f''+\kappa\cdot  f\ge \lambda\]
if for any unit-speed geodesic $\gamma$ in $\Dom f$ 
the real-to-real function $y(t)= f\circ\gamma(t)$
satisfies 
\[y''+\kappa\cdot  y\ge \lambda\]
in the domain $\set{t}{y(t)<\infty}$;
see the definition in Section~\ref{sec:conv-real}.

We say that a lower semicontinuous subfunction $f\:\spc{X}\subto[-\infty,\infty)$ 
satisfies the inequality
\[f''+\kappa\cdot  f\le \lambda\]
if the subfunction $h=-f$ 
satisfies 
\[h''-\kappa\cdot  h\ge -\lambda.\]

Functions satisfying the inequalities
\[f''\ge \lambda\quad\text{and}\quad f''\le \lambda\]
are called $\lambda$-convex and $\lambda$-concave respectively.

$0$-convex and $0$-concave subfunctions will be also called \emph{convex} and \emph{concave} respectively.

If $f$ is $\lambda$-convex for some $\lambda>0$ it will be called \emph{strongly convex};
correspondingly if $f$ is $\lambda$-concave for some $\lambda<0$ it will be called \emph{strongly concave}.

If for any point $p\in\Dom f$ 
there is a neighborhood $\Omega\ni p$ and a real number $\lambda$
such that the restriction $f|_\Omega$ is $\lambda$-convex (or $\lambda$-concave),
then $f$ is called semiconvex (respectively semiconcave).
\end{thm}

Further, we give a meaning of certain type of second order ordinary differential inequalities in context of metric spaces.

Various authors define the class of $\lambda$-convex ($\lambda$-concave) function differently. 
It may correspond to $\pm\lambda$-convex ($\pm\lambda$-concave) or $\pm\tfrac\lambda2$-convex ($\pm\tfrac\lambda2$-concave) function in our definitions.

\begin{thm}{Proposition}\label{prop:conv-comp}
Let $\spc{X}$ be a metric space.
Assume that $f\:\spc{X}\subto \RR$ is a semiconvex subfunction
and $\phi\:\RR\to\RR$ is a nondecreasing seimconvex function.
Then the composition $\phi\circ f$ is a semiconvex subfunction.
\end{thm}

The proof is straightforward.




