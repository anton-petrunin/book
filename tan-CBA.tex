%%!TEX root = all.tex
\chapter{First order differentiation in CBA}\label{chap:tan}


\section{Tangent cones in CBA spaces}\label{sec:tan-cbb}

\parbf{Space of directions.}
Suppose $\spc{U}\in \cCat{}{}$, and $p\in\spc{U}$.
Consider the set $\Gamma_p$ of all unit-speed geodesics  starting at $p$.
According to \ref{claim:angle-3angle-inq}, the angle measure $\mangle$ gives a pre-metric on $\Gamma_p$.
Consider the factor-space $\Gamma_p/\sim$ by the equivalence relation 
\[\gamma_1\sim\gamma_2\ \ \text{iff}\ \ \mangle(\gamma_1,\gamma_2)=0.\] 
Elements of the underlying set $\Sigma'_p$ of $\Gamma_p/\sim$ will be called \emph{geodesic directions}.
The space  $(\Sigma_p', \mangle)$ will be called the  \emph{space of geodesic directions  of $\spc{U}$ at $p$ under the angle metric}\index{space of directions!space of geodesic directions}.
The completion  $(\Sigma_p, \mangle)$ of  $(\Sigma_p', \mangle)$  will be called the \emph{space of directions   of $\spc{U}$ at $p$ under the angle metric}\index{space of directions}. 



Let $\yetdist{*}{*}{}$ denote the length-metric induced  by the angle metric 
on $\Sigma_p'$ (see Section \ref{sec:intrinsic}). 
We shall see that $\mangle$ and $\yetdist{*}{*}{}$ are locally equivalent on $\Sigma_p'$, that is, $\mangle (v,w) = \yetdist{v}{w}{}$ if and only if $\yetdist{v}{w}{}\le\pi$.  When  we speak of the \emph{space of geodesic directions} $\Sigma_p'$ and the \emph{space of directions} $\Sigma_p$, without specifying the metric, we always mean  $(\Sigma_p', \yetdist{*}{*}{})$    and its completion  $(\Sigma_p, \yetdist{*}{*}{})$ , respectively.


Given a geodesic $[p q]$, the corresponding direction in $\Sigma_p$ will be denoted by $\dir{p}{q}$\index{$\dir{*}{*}$}.

\parbf{Tangent cone.} $\Cone\Sigma_p$ --- the Euclidean cone over  $(\Sigma_p, \yetdist{*}{*}{})$   (see \ref{sec:cones}) --- will be called the \emph{tangent space}\index{tangent space} of $\spc{U}$ at $p$ and be denoted by $\T_p=\T_p \,\spc{U}$\index{$\T_{*}$}.
Along with the space of directions, the  tangent cone is a complete space.
%Set \index{$\ddir{*}{*}$}\index{$\ddir{*}{*}$}
%\[\ddir p q\,
%\df
%\dist[{{}}]{p}{q}{}\cdot\dir p q
%\ \ \hbox{and} \ \ 
%\Ddir{p}{q}
%=
%\set{\dist[{{}}]{p}{q}{}\cdot\xi}{\xi\in\Dir{p}{q}}
%.\]
%Note that $\ddir p q=\ddir p{q'}$ implies $q=q'$; see ???.
%The relation $v=\ddir p q$, will be also written as $q=\exp_p v$.
%The map $\exp_p$ is defined on a starshaped subset of $\T_p$, 
%that is, if $\exp_pv$ is defined then so is $\exp_p(t\cdot v)$ for any $t\in[0,1]$. 

The subcone $\T_p'=\Cone\Sigma_p'\subset \T_p$ will be called the subcone of \emph{geodesic vectors}\index{geodesic tangent vector}.
Clearly, $\T_p'$ is dense in $\T_p$.
% and $v\in \T_p'$ iff $\exp_p(\eps\cdot v)$ is defined for small $\eps$.

We do not use the notations $\ddir p q$ and $\exp_p$ in the CBA setting.  As was pointed out in our discussion of the Lifting globalization theorem (Section \ref{sec:cat-globalize}), the appropriate notion of exponential map at $p$ is the right-hand endpoint map on the space of all local geodesic paths that start at $p$.  In general, one may say that   the tangent cone contains much less information about the local geometry of the space in the CBA setting than in the CBB setting.

\section{Differentiability of curves.}


\parbf{Right/left derivatives.}
Suppose $\spc{U}\in \cCat{}{}$
\begin{thm}{Definition}\label{def:curv^+}
Let $\II$ be a real interval containing $[0,\eps)$ for some $\eps>0$.
Let  $\alpha\:\II\to\spc{U}$ be a map, 
$\alpha(0)=p$.  
We say $\alpha$ is differentiable at $0$  if $\speed\alpha\,(0)$ 
exists, and $\dir{\alpha(0)}{ \alpha(t)}\to u\in\Sigma_p$  as $t\to 0$.
We write
$\alpha^+(0)=\speed\alpha\,(0)u$.%\[\limsup_{t\to0+}{\dist{\alpha(t)}{\gamma_n(t)}{}}/{t}\to 0
%\ \ \t{as}\ \ n\to\infty.\]
We define right/left derivatives of $\alpha$ at $t_0\in\II$ as $\alpha^\pm(t_0)=\check\alpha^+(0)$, where $\check\alpha(t)=\alpha(t_0\pm t)$.
\end{thm}

\begin{thm}{Corollary}
Let  $\gamma_t\:[0,1]\to\spc{U}$ be the  geodesic path from $\alpha(t_0)$ to $\alpha(t)$.  Then 
\[
{\gamma_t}^+(0) = \dist{\alpha(t_0)}{\alpha(t)} \cdot \dir{\alpha(t_0)}{\alpha(t)},\]
\[
\alpha^+(t_0)=\lim_{t\to t_0}\tfrac{1}{|t-t_0|}\cdot {\gamma_t}^+(0).\]

\end{thm}

*****************************


For an interior value $t_0$ of $\II$, 
if $\alpha^+(t_0)$ or $\alpha^-(t_0)$ or both are defined,
we say correspondingly that  $\alpha$ is \emph{right}\index{differentiable!right differentiable} or \emph{left}\index{differentiable!left differentiable} or \emph{both-sided differentiable}\index{differentiable!both-sided differentiable} at $t_0$.
In the exceptional cases, when $t_0$ is the left (correspondingly right) end of $\II$, $\alpha$ is by definition left (correspondingly right) differentiable at $t_0$.

For an interior value $t_0$ of $\II$,
in case if $\alpha$ is both-sided differentiable at $t_0$ and $\alpha^+(t_0)+\alpha^-(t_0)=0$, we say that $\alpha$ is \emph{differentiable}\index{differentiable} at $t_0$.
In the exceptional cases, when $t_0$ is the left (correspondingly right)
we say that $\alpha$ is both-sided differentiable at $t_0$ if $\alpha$ is right (correspondingly left) differentiable at $t_0$.

\begin{thm}{Lemma}
Let $\spc{U}$ be a complete length $\Alex{}$ space and $\gamma\:\II\to\spc{U}$ be a geodesic then $\gamma$ is both-side differentiable.
\end{thm}

\begin{thm}{Lemma}
Let $\spc{U}$ be a complete length $\Alex{}$ space and $\alpha\:\II\to\spc{U}$ be a Lipschitz curve then $\alpha$ is almost everywhere both-side differentiable.
\end{thm}

****************************
*******************


Let
$\spc{L}$ be a complete length $\Alex{}$ space 
and $\alpha\:\II\to \spc{L}$ be a curve.
We say that $v\in\T_{\alpha(t_0)}$ is a \emph{rigth} or \emph{left} \emph{derivative} of $\alpha$ at $t_0\in\II$ (briefly, $v=\alpha^+(t_0)$ or correspondingly $v=\alpha^-(t_0)$)
if 
for any $q\not=\alpha(t_0)$, we have
\[(\dist{q}{}{}\circ\alpha)^\pm(t_0)=(\d_{\alpha(t_0)}\dist{q}{}{})(v).\]

\parbf{Remark for AKP.}
This seems to be sufficient for us, but it is kind of weak def.
For example: there is $\spc{L}\in\CBB\infty{}$ and a curve $\alpha\:\RR\to \spc{L}$ such that 
$\alpha^+(0)=\0$ but 
\[\liminf_{t\to 0}\frac{\dist{\alpha(0)}{\alpha(t)}{}}{|t|}>0.\]
Also this def. is good together with Kuratowski tangent cone, and it is not that good with the standard definition.

\medskip

The following lemma gives an equivalent desription of rigth and left derivatives in finite dimensional case.


\begin{thm}{Lemma}
Let $\spc{L}$ be an $m$-dimensional complete length $\Alex{}$ space and $\alpha\:\II\to \spc{L}$ be a curve.
Assume for some $t_0\in \II$ we have $v=\alpha^\pm(t_0)$ then 
for any choice of geodesics $[\alpha(t_0)\alpha(t)]$, we have
\[v=\lim_{t\to t_0\pm}\tfrac{1}{|t-t_0|}\cdot\ddir{\alpha(t_0)}{\alpha(t)}.\]

\end{thm}

\parit{Proof.}???
\qeds

Recal that right/left differentiability of curves is defined in \ref{def:diff-curv}.
For $\Alex{}$ spaces, 

\begin{thm}{Definition}\label{def:diff-curv???}
Let
$\spc{L}$ be a metric space 
and $\alpha\:\II\to \spc{X}$ be a curve.

We say that $\alpha$ is \emph{differentiable} at $t_0\in\II$ if 
both $\alpha^+(t_0)$ and $\alpha^-(t_0)$ are defined and $\alpha^+(t_0)+\alpha^-(t_0)=0$.
\end{thm}





Let us remind that our sign convension is not standard (see also Section~\ref{sec:conv-real}). 
In particular, for $\alpha\:\RR\to \RR$, $\alpha(t)=t$ we have $\alpha^+\equiv 1,\ \ \alpha^-\equiv -1$.

If $\alpha$ right/left differentiable at $t_0$.
Then for any point $q\not=\alpha(t_0)$
\[(\dist{q}{}{}\circ\alpha)^\pm(t_0)
=
(\d_{\alpha(t_0)}\dist{q}{}{})(\alpha^\pm(t_0)).\]
Thus, both derivatives $(\dist{q}{}{}\circ\alpha)^\pm(t_0)$ are also defined.
The following lemma shows that converse holds for finite-dimensional Alexandrov's spaces.


\begin{thm}{Lemma}\label{lem:count-der}
Let $\spc{L}$ be an $m$-dimensional complete length $\Alex\kappa$ space,
$\II$ be a real inteval,
$\alpha\:\II\to \spc{L}$ be a curve,
$t_0\in\II$ 
and $Q\subset \spc{L}$ be a subset which is dense in a neighborhood of $\alpha(t_0)$.
For $q\in Q$, set $f_q=\dist{q}{}{}\circ\alpha$.
Then 
\begin{subthm}{lem:count-der:rl}
If right (left) derivative $f^+_q(t_0)$ ($f^-_q(t_0)$) is defined for each $q\in Q\backslash \{\alpha(t_0)\}$ then $\alpha$ is right (left) differentiable at $t_0$.
\end{subthm}

\begin{subthm}{} If moreover $f'_q(t_0)$ is defined for each $q\in Q$ then $\alpha$ is differentiable at $t_0$.
\end{subthm}
\end{thm}



\parit{Proof.}
Without loss of generality we can assume $t_0=0$. Set $p=\alpha(0)$.

Assume right derivatives $f^+_q(0)$ are defined for each $q\in Q$.

Let us show that for any sequence $t_n\to 0+$, the sequence $\frac{\dist{p}{\alpha(t_n)}{}}{t_n}$ is bounded.
Assume contrary;
let us pass to a subsequence of $t_n$ so that $\dir p{\alpha(t_n)}\to\xi$.
Take a point $q\in Q$ such that $\mangle(\xi,\dir p q)<\tfrac\pi4$.
Then for large $n$ we have 
\[\frac{\dist{p}{\alpha(t_n)}{}}{t_n}
<
2\cdot\frac{f_q(0)-f_q(t_n)}{t_n}
<
4\cdot|f^+_q(0)|,\] a 
contradiction.

Thus, to prove the first part of the lemma, 
it is sufficient to show that if $v_1$ and $v_2$ are two partial limit of $\ddir{p}{\alpha(t)}$ for $t\to 0+$ then $v_1=v_2$.

For both, $v_1$ and $v_2$, we have
\[f_q^+(0)=(\d_p\dist{q}{}{})(v_1)=(\d_p\dist{q}{}{})(v_2).\]
We can choose $q$ so that $|v_1|\cdot\d_p\dist{q}{}{}$ is arbitrary close to function $w\mapsto -\<v_1,w\>$.
Thus $\<v_1,v_2\>=\<v_1,v_1\>$ and similarly, $\<v_1,v_2\>=\<v_2,v_2\>$. 
Hence $v_1=v_2$.
\qeds

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Tangent space of CBA spaces}

\begin{thm}{Proposition} 
Let $\spc{U}\in\cCat{}{}$.
Then for any point $p\in\spc{U}$, 
the tangent space $\T_p$ is a length space.
\end{thm}

\parit{Proof.}
Since $\T'_p$ is dense in $\T_p$,
it is sufficent to show that $\T'_p$ is a length space.

Fix two tangent vectors $a,b\in \T'_p$;
let $\alpha$ and $\beta$ be the corresponding constant speed geodesics starting at $p$.

Given $\eps>0$ we can choose $\delta>0$ such that 
\[\tfrac1\delta\cdot\dist{a_\delta}{b_\delta}{\spc{U}}<\dist{a}{b}{\T_p}+\eps,\]
where $a_\delta=\alpha(\delta)$ and $b_\delta=\beta(\delta)$.

The path $\gamma_\delta=\tfrac1\delta\cdot\log_p\circ\geodpath_{[a_\delta b_\delta]}$
in $\T_p$ connects $a$ to $b$.
According to ???
\[\length\gamma\le\dist{a}{b}{\T_p}+\eps.\]
The statement follows since $\eps>0$ is arbitrary. 
\qeds

\begin{thm}{Proposition} 
Let $\spc{U}\in\cCat{}{}$.
Then for any point $p\in\spc{U}$,
we have $\Sigma_p\in\cCat{}{1}$ and $\T_p\in\cCat{}{0}$.
\end{thm}

