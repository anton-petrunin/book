%%%!TEX root =arXiv.tex
\chapter{Ultralimits}

Here we introduce ultralimits of sequences of points, metric spaces and functions.
The ultralimits of metric spaces can be considered as a variation of Gromov--Hausdorff convergence.
Our presentation is based on \cite{kleiner-leeb}.

In this book, the use of ultralimits is very limited; 
we use them only as a canonical way to pass to a convergent subsequence.
(In principle, we could avoid selling our souls 
to the set-theoretical devil, but in this case we must say ``pass to convergent subsequence'' too many times.)

\section{Ultrafilters}

We will need the existence of a 
selective ultrafilter $\o$,
which we fix once and for all.
Existence follows from the axiom of choice and continuum hypothesis.

Recall that $\NN$ denotes the set of natural numbers, $\NN=\{1,2,\dots\}$

\begin{thm}{Definition}
A finitely additive measure $\o$ 
on  $\NN$ 
is called an \emph{ultrafilter}\index{ultrafilter} if it satisfies 
\begin{subthm}{}
$\o(S)=0$ or $1$ for any subset $S\subset \NN$.
\end{subthm}
An ultrafilter $\o$ is called 
\emph{nonprinciple}\index{ultrafilter!nonprinciple ultrafilter}\index{nonprinciple ultrafilter} if in addition 
\begin{subthm}{}
$\o(F)=0$ for any finite subset $F\subset \NN$.
\end{subthm}
A nonprinciple ultrafilter $\o$ is called 
\emph{selective}\index{ultrafilter!selective ultrafilter}\index{selective ultrafilter} if in addition 
\begin{subthm}{}
for any partition of $\NN$ into sets $\{C_\alpha\}_{\alpha\in\IndexSet}$ such that $\o(C_\alpha)\z=0$ for each $\alpha$, 
there is a set $S\subset \NN$ such that $\o(S)=1$ and $S\cap C_\alpha$ is a one-point set for each $\alpha\in\IndexSet$.
\end{subthm}
\end{thm}

If $\o(S)=0$ for some subset $S\subset \NN$,
we say that $S$ is \emph{$\o$-small}. 
If $\o(S)=1$, we say that $S$ contains \emph{$\o$-almost all} elements of $\NN$.

\parbf{Classical definition.}
More commonly, a nonprinciple ultrafilter is defined as a collection, say $\mathfrak{F}$, of sets in $\NN$ such that
\begin{enumerate}
\item\label{filter:supset} if $P\in \mathfrak{F}$ and $Q\supset P$, then $Q\in \mathfrak{F}$,
\item\label{filter:cap} if $P, Q\in \mathfrak{F}$, then $P\cap Q\in \mathfrak{F}$,
\item\label{filter:ultra} for any subset $P\subset\NN$, either $P$ or its complement is an element of $\mathfrak{F}$.
\item\label{filter:non-prin} if $F\subset \NN $ is finite, then $F\notin \mathfrak{F}$.
\end{enumerate}
Setting $P\in\mathfrak{F}\Leftrightarrow\o(P)=1$ makes these two definitions equivalent.

A nonempty collection of sets $\mathfrak{F}$ that does not include the empty set and satisfies only conditions \ref{filter:supset} and \ref{filter:cap} is called a \emph{filter}; 
if in addition $\mathfrak{F}$ satisfies Condition~\ref{filter:ultra} it is called an \emph{ultrafilter}.
From Zorn's lemma, it follows that every filter contains an ultrafilter.
Thus there is an ultrafilter $\mathfrak{F}$ contained in the filter of all complements of finite sets; clearly this $\mathfrak{F}$ is nonprinciple.

The existence of a selective ultrafilter follows from the continuum hypothesis;
it was proved by Walter Rudin in \cite{rudin}.

\parbf{Stone--\v{C}ech compactification.}
Given a set $S\subset \NN$, consider subset $\Omega_S$ of all ultrafilters $\o$ such that $\o(S)=1$.
It is straightforward to check that the sets $\Omega_S$ for all $S\subset \NN$ form a topology on the set of ultrafilters on $\NN$. 
The obtained space is called \emph{Stone--\v{C}ech compactification} of $\NN$;
it is usually denoted as $\beta\NN$.

There is a natural embedding $\NN\hookrightarrow\beta\NN$ defined as
$n\mapsto\o_n$, where $\o_n$ is the principle ultrafilter such that $\o_n(S)=1$ if and only if $n\in S$. 
Using the described embedding, we can (and will) consider $\NN$ as a subset of $\beta\NN$.

The space $\beta\NN$ is the maximal compact Hausdorff space that contains $\NN$  as an everywhere dense subset.
More precisely, for any compact Hausdorff space $\spc{X}$ 
and a map $f\:\NN\to \spc{X}$ there is unique continuous map $\bar f\:\beta\NN\to X$ such that the restriction $\bar f|_\NN$ coincides with $f$. 

\section{Ultralimits of points}
\label{ultralimits}\index{ultralimit}

Fix an ultrafilter $\o$.
Assume $(x_n)$ is a sequence of points in a metric space $\spc{X}$. 
Let us define the \emph{$\o$-limit}\index{$\o$!$\o$-limit} of $(x_n)$ as the point $x_\o$ 
such that for any $\eps>0$, $\o$-almost all elements of $(x_n)$ lie in $\oBall(x_\o,\eps)$; 
that is,
\[\o\set{n\in\NN}{\dist{x_\o}{x_n}{}<\eps}=1.\]
In this case, we will write 
\[x_\o=\lim_{n\to\o} x_n
\ \ \text{or}\ \ 
x_n\to x_\o\ \t{as}\ n\to\o.\]

For example if $\o$ is the principle ultrafilter such that $\o(\{n\})=1$ for some $n\in\NN$, then
$x_\o=x_n$.

Note that $\o$-limits of a sequence and its subsequence may differ.
For example, in general
\[\lim_{n\to\o}x_n
\ne
\lim_{n\to\o}x_{2\cdot n}.\]

\begin{thm}{Proposition}\label{prop:ultra/partial}
Let $\o$ be a nonprinciple ultrafilter.
Assume $(x_n)$ is a sequence of points in a metric space $\spc{X}$
and $x_n\to  x_\o$ as $n\to\o$.
Then $x_\o$ is a partial limit of the sequence $(x_n)$;
that is, there is a subsequence $(x_n)_{n\in S}$ that converges to $x_\o$ in the usual sense.

Moreover, if $\o$ is selective,
then the subsequence $(x_n)_{n\in S}$ can be chosen so that $\o(S)=1$.
\end{thm}

\parit{Proof.}
Given $\eps>0$, 
set $S_\eps=\set{n\in\NN}{\dist{x_n}{x_\o}{}<\eps}$.

Note that $\o(S_\eps)=1$ for any $\eps>0$.
Since $\o$ is nonprinciple, the set $S_\eps$ is infinite.
Therefore we can choose an increasing sequence $(n_\kay)$
such that $n_\kay\in S_{\frac1\kay}$ for each $\kay\in \NN$.
Clearly $x_{n_\kay}\to x_\o$ as $\kay\to\infty$.

Now assume that $\o$ is selective.
Consider the sets
\begin{align*}
C_\kay&=\set{n\in\NN}{\tfrac1{n}<\dist{x_n}{x_\o}{}\le \tfrac1{n-1}},
\intertext{where we assume $\tfrac10=\infty$ and the set }
C_\infty&=\set{n\in\NN}{x_n=x_\o},
\end{align*}

Note that $\o(C_\kay)=0$ for any $\kay\in\NN$.

If $\o(C_\infty)=1$, we can take the sequence $(x_n)_{n\in C_\infty}$.

Otherwise discarding all empty sets among $C_\kay$ and $C_\infty$ gives a partition of $\NN$ into countable collection of $\o$-small sets.
Since $\o$ is selective, we can choose a set $S\subset\NN$ such that
$S$ meets each set of the partition at one point and $\o(S)=1$.
Clearly the sequence $(x_n)_{n\in S}$ converges to $x_\o$ in the usual sense.
\qeds

The following proposition 
is analogous to the statement that any sequence in a compact metric space 
has a convergent subsequence;
it can be proved the same way.

\begin{thm}{Proposition}\label{prop:ultra/compact}
Let $\spc{X}$ be a compact metric space.
Then
any sequence of points $(x_n)$ in $\spc{X}$ has unique $\o$-limit $x_\o$.

In particular, a bounded sequence of real numbers has a unique $\o$-limit. 
%
\end{thm}

The following lemma is an ultralimit analog of Cauchy convergence test.

\begin{thm}{Lemma}\label{lem:X-X^w}
Let $(x_n)$ be a sequence of points in a complete space $\spc{X}$. 
Assume for each subsequence $(y_n)$ of $(x_n)$, 
the $\o$-limit 
\[y_\o=\lim_{n\to\o}y_{n}\in \spc{X}\]
is defined and does not depend on the choice of subsequence, 
then the sequence $(x_n)$ converges in the usual sense.
\end{thm}

\parit{Proof.} Assume that $(x_n)$ does not converge in itself. 
Then for some $\eps>0$, there is a subsequence $(y_n)$ of $(x_n)$ such that $\dist{x_n}{y_n}{}\ge\eps$ for all $n$.

It follows that $\dist{x_\o}{y_\o}{}\ge \eps$, a contradiction.\qeds


\section{Ultralimits of spaces}\label{sec:Ultralimit of spaces}

From now on, $\o$ denotes a selective ultrafilter on the set of natural numbers.

Let $\spc{X}_n$ be a sequence of metric spaces
$\spc{X}_n$ .
Consider all sequences $x_n\in \spc{X}_n$.
On the set of all such sequences,
define a pseudometric on these subsequences by
\[\dist{(x_n)}{(y_n)}{}
=
\lim_{n\to\o} \dist{x_n}{y_n}{}.
\eqlbl{eq:olim-dist}\]
Note that the $\o$-limit on the right hand side is always defined 
and takes a value in $[0,\infty]$. 

Set $\spc{X}_\o$ to be the corresponding metric space; 
that is, the underlying set of $\spc{X}_\o$ is formed by classes of equivalence of sequences of points $x_n\in\spc{X}_n$ 
defined by 
\[(x_n)\sim(y_n)
\ \Leftrightarrow\ 
\lim_{n\to\o} \dist{x_n}{y_n}{}=0\]
and the distance is defined as in \ref{eq:olim-dist}.

The space $\spc{X}_\o$ is called \emph{$\o$-limit}\index{$\o$-limit space} of $\spc{X}_n$.
Typically  $\spc{X}_\o$ will denote the  
$\o$-limit of sequence $\spc{X}_n$;
we may also write  
\[\spc{X}_n\to\spc{X}_\o\ \ \text{as}\ \  n\to\o\ \ \text{or}\ \ \spc{X}_\o=\lim_{n\to\o}\spc{X}_n.\]

Given a sequence $x_n\in \spc{X}_n$,
we will denote by $x_\o$ its equivalence class which is a point in $\spc{X}_\o$;
equivalently we will write
\[x_n\to x_\o \ \ \text{as}\ \  n\to\o\ \ \text{or}\ \ x_\o=\lim_{n\to\o} x_n.\]

\begin{thm}{Observation}\label{obs:ultralimit-is-complete}
The $\o$-limit of any sequence of metric spaces is complete. 
\end{thm}

\parit{Proof.}
Let $\spc{X}_n$ be a sequence of metric spaces and $\spc{X}_n\to\spc{X}_\o$ as $n\to\o$.

Fix a sequence $x_m\in \spc{X}_\o$ converging in itself.
Passing to a subsequence we can assume that $\dist{x_m}{x_{m-1}}{\spc{X}_\o}<\tfrac1{2^m}$ for any $m$.

Let us choose double sequence $x_{n,m}\in \spc{X}_n$ such that for any fixed $m$ we have $x_{n,m}\to x_m$ as $n\to\o$.

Set $S_1=\NN$ and
\[S_{m}=\set{n\in\NN}{\dist{x_{n,\kay}}{x_{n,\kay-1}}{}<\tfrac1{2^\kay}\quad\text{for}\quad \kay\le m}.\]

For each $n$ consider the largest value $m(n)$ such that $m(n)\le n$
and $m(n)\in S_{m}$.
Consider the sequence $y_n=x_{n,m(n)}$;
denote by $y\in \spc{X}^\o$ its $\o$-limit.
By construction $x_n\to y$ as $n\to \infty$.
Hence the statement follows.
\qeds

\begin{thm}{Observation}\label{obs:ultralimit-is-geodesic}
The $\o$-limit of any sequence of length spaces is geodesic. 
\end{thm}

\parit{Proof.}
If $\spc{X}_n$ is a sequence length spaces, then for any sequence of pairs $x_n, y_n\in X_n$ there is a sequence of $\tfrac1n$-midpoints $z_n$.

Let $x_n\to x_\o$, $y_n\to y_\o$ and $z_n\to z_\o$ as $n\to \o$.
Note that $z_\o$ is a midpoint of $x_\o$ and $y_\o$ in $\spc{X}^\o$.

By Observation~\ref{obs:ultralimit-is-complete}, $\spc{X}^\o$ is complete.
Applying Lemma~\ref{lem:mid>geod} we get the statement.
\qeds

\parbf{Ultrapower.} If all the metric spaces in the sequence are identical $\spc{X}_n=\spc{X}$, 
its $\o$-limit 
$\lim_{n\to\o}\spc{X}_n$
is denoted by $\spc{X}^\o$
and called $\o$-power of $\spc{X}$.
 
According to Theorem~\ref{thm:ultra-GH},
there is a distance preserving map
$\iota:\spc{X}\hookrightarrow \spc{X}^\o$, here $\iota(y)$ is the equivalence class of constant sequence $y_n=y$. 

The image $\iota(\spc{X})$ might be proper subset of $\spc{X}^\o$.
For example $\RR^\o$ has pairs of points on distance $\infty$ from each other;
at the same time, each metric component of $\RR^\o$ is isometric to $\RR$.

According to Theorem~\ref{thm:ultra-GH}, 
if $\spc{X}$ is compact, then $\iota(\spc{X})=\spc{X}^\o$;
in particular, $\spc{X}^\o$ is isometric to $\spc{X}$.
If $\spc{X}$ is proper, then $\iota(\spc{X})$ forms a metric component of $\spc{X}^\o$.

The embedding $\iota$ gives us right to treat $\spc{X}$ as a subset of its ultrapower $\spc{X}^\o$. 

\begin{thm}{Observation}\label{obs:ultrapower-is-geodesic}
Let $\spc{X}$ be a complete metric space. 
Then $\spc{X}^\o$ is geodesic space if and only if $\spc{X}$ is a length space.
\end{thm}

\parit{Proof.}
Assume $\spc{X}^\o$ is geodesic space.
Then any pair of points $x,y\in \spc{X}$ has a midpoint $z_\o\in\spc{X}^\o$.
Fix a sequence of points $z_n\in  \spc{X}$ such that $z_n\to z_\o$ as $n\to \o$.

Note that 
$\dist{x}{z_n}{\spc{X}}\to \tfrac12\cdot \dist{x}{y}{\spc{X}}$
and 
$\dist{y}{z_n}{\spc{X}}\to \tfrac12\cdot \dist{x}{y}{\spc{X}}$
as 
$n\to\o$.
In particular, for any $\eps>0$, the point $z_n$ is an $\eps$-midpoint of $x$ and $y$ for $\o$-almost all $n$.
It remains to apply Lemma~\ref{lem:mid>geod}.

The ``if''-part follows from Observation~\ref{obs:ultralimit-is-geodesic}.
\qeds

\begin{thm}{Corollary}\label{cor:two-geodesics-in-ultrapower}
Assume $\spc{X}$ is a complete length space 
and $p,q\in\spc{X}$ cannot be joined by a geodesic in $\spc{X}$.  
Then there are at least two distinct geodesics between $p$ and $q$ 
in the ultrapower $\spc{X}^\o$.
\end{thm}

\section{Ultratangent space} 

Recall that we assume that $\o$ is a once for all fixed choice of a selective ultrafilter.

For a metric space $\spc{X}$ and a positive real number $\lam$,
we will denote by $\lam\cdot\spc{X}$ its \emph{$\lam$-blowup}\index{blowup},
which is a metric space with the same underlying set as $\spc{X}$ and the metric multiplied by $\lam$.
The tautological bijection $\spc{X}\to \lam\cdot\spc{X}$ will be denoted as $x\mapsto x^\lam$, 
so 
\[\dist{x^\lam}{y^\lam}{}
=
\lam\cdot\dist[{{}}]{x}{y}{}\] 
for any $x,y\in \spc{X}$.

The $\o$-blowup $\o\cdot\spc{X}$ of $\spc{X}$ is defined as the $\o$-limit
of the $n$-blowups $n\cdot\spc{X}$; that is,
\[\o\cdot\spc{X}
\df
\lim_{n\to\o} n\cdot\spc{X}.\]

Given a point $x\in \spc{X}$ we can consider the sequence $x^n\in n\cdot\spc{X}$;
it corresponds to a point $x^\o\in \o\cdot\spc{X}$.
Note that if $x\ne y$, then 
\[\dist{x^\o}{y^\o}{\o\cdot\spc{X}}=\infty;\]
that is, 
$x^\o$ and $y^\o$ 
belong to different metric components of $\o\cdot\spc{X}$.

The metric component of $x^\o$ in $\o\cdot\spc{X}$ is called ultratangent space of $\spc{X}$ at $x$ and it is denoted as $\T^\o_x\spc{X}$.

Equivalently, ultratangent space $\T^\o_x\spc{X}$ can be defined the following way.
Consider all the sequences of points $x_n\in \spc{X}$ such that
the sequence $\ell_n=n\cdot\dist{x}{x_n}{\spc{X}}$ is bounded.
Define the pseudodistance between two such sequences as 
\[\dist{(x_n)}{(y_n)}{}
=
\lim_{n\to\o}n\cdot\dist{x_n}{y_n}{\spc{X}}.\]
Then $\T^\o_x\spc{X}$ is the corresponding metric space.

Tangent space as well as ultratangent space, 
generalize the notion of tangent space of Riemannian manifold.
In the simplest cases these two notions define the same space.
In general, they are different and both useful ---
often lack of a property in one is compensated by the other.

It is clear from the definition that tangent space has cone structure.
On the other hand, in general, ultratangent space does not have a cone structure; 
the Hilbert's cube $\prod_{n=1}^\infty[0,2^{-n}]$ is an example --- it is $\Alex{0}$ as well as $\CAT{0}$.

The next theorem shows that the tangent space $\T_p$ can be (and often will be) considered as a subset of  $\T^\o_p$.

\begin{thm}{Theorem}\label{thm:tangent-ultratangent}
\label{thm:T-in-T^w} 
Let $\spc{X}$ be a metric space with defined angles.
Then for any $p\in \spc{L}$, there is an distance preserving map 
\[\iota:\T_p\hookrightarrow \T^\o_p\] 
such that for any geodesic $\gamma$ starting at $p$
we have 
\[\gamma^+(0)\mapsto \lim_{n\to\o}[\gamma(\tfrac1n)]^n.\]

\end{thm}

\parit{Proof.}
Given $v\in \T'_p$ 
choose a geodesic $\gamma$ that starts at $p$ such that $\gamma^+(0)\z=v$.
Set $v^n=[\gamma(\tfrac1n)]^n\in n\cdot \spc{X}$ and 
\[v^\o=\lim_{n\to\o}v^n.\]

Note that the value $v^\o\in\T^\o_p$ does not depend on choice of $\gamma$;
that is, if $\gamma_1$ is an other geodesic starting at $p$ such that $\gamma_1^+(0)=v$,
then 
\[\lim_{n\to\o}v^n=\lim_{n\to\o}v_1^n,\]
where $v_1^n=[\gamma_1(\tfrac1n)]^n\in n\cdot \spc{X}$.
The latter follows since
\[\dist{\gamma(t)}{\gamma_1(t)}{\spc{X}}=o(t)\]
and therefore $\dist{v^n}{v_1^n}{n\cdot \spc{X}}\to 0$ s $n\to\infty$.



Set $\iota(v)=v^\o$.
Since angles between geodesics in $\spc{X}$ are defined, for any $v,w\in \T_p'$ we have
$n\cdot\dist[{{}}]{v_n}{w_n}{}\to\dist{v}{w}{}$.
Thus $\dist{v_\o}{w_\o}{}=\dist{v}{w}{}$; that is, $\iota$ is a global isometry of $\T_p'$.

Since $\T_p'$ is dense in $\T_p$,
we can extend $\iota$ to a global isometry $\T_p\to \T^\o_p$.
\qeds

{\sloppy

\section[Gromov--Hausdorff and ultralimits]{Gromov--Hausdorff convergence and ultralimits}

}

\begin{thm}{Theorem}\label{thm:ultra-GH}
Assume $\spc{X}_n$ is a sequence of complete spaces. 
Let $\spc{X}_n\to \spc{X}_\o$ as $n\to\o$,
and $\spc{Y}_n\subset \spc{X}_n$ 
be a sequence of subsets such that $\spc{Y}_n\GHto\spc{Y}_\infty$. 
Then there is a distance preserving map 
$\iota:\spc{Y}_\infty\to \spc{X}_\o$.

Moreover:

\begin{subthm}{thm:ultra-GH:a}
If $\spc{X}_n\GHto \spc{X}_\infty$ 
and $\spc{X}_\infty$ is compact, then 
$\spc{X}_\infty$ is isometric to $\spc{X}_\o$.
\end{subthm}

\begin{subthm}{thm:ultra-GH:b}
If $\spc{X}_n\GHto \spc{X}_\infty$ 
and $\spc{X}_\infty$ is proper, then 
$\spc{X}_\infty$ is isometric to a metric component of $\spc{X}_\o$.
\end{subthm}

\end{thm}

\parit{Proof.} 
For each point $y_\infty\in \spc{Y}_\infty$ 
choose a lifting $y_n\in \spc{Y}_n$.
Pass to the $\o$-limit $y_\o\in \spc{X}_\o$ of $(y_n)$.
Clearly for any $y_\infty,z_\infty\in \spc{Y}_\infty$, 
we have 
\[\dist{y_\infty}{z_\infty}{\spc{Y}_\infty}=\dist{y_\o}{z_\o}{\spc{X}_\o};\] 
that is, the map $y_\infty\mapsto y_\o$ gives a distance preserving map $\iota:\spc{Y}_\infty\to \spc{X}_\o$. 


\parit{(\ref{SHORT.thm:ultra-GH:a})$+$(\ref{SHORT.thm:ultra-GH:b}).}
Fix $x_\o\in \spc{X}_\o$.
Choose a sequence $x_n\in \spc{X}_n$ 
such that $x_n\to x_\o$ as $n\to\o$. 

Denote by $\bm{X}=\spc{X}_\infty\sqcup\spc{X}_1\sqcup\spc{X}_2\sqcup\dots$ the common space for the convergence $\spc{X}_n\GHto \spc{X}_\infty$;
as in the definition of Gromov--Hausdorff convergence.
Consider the sequence $(x_n)$ 
as a sequence of points in~$\bm{X}$.

If the $\o$-limit $x_\infty$ of $(x_n)$ exists, 
it must lie in $\spc{X}_\infty$. 

The point $x_\infty$, if defined, does not depend on the choice of $(x_n)$.
Indeed, if $y_n\in\spc{X}_n$ is an other sequence such that $y_n\to x_\o$ as $n\to\o$, then 
\[
\dist{y_\infty}{x_\infty}{}=\lim_{n\to\o}\dist{y_n}{x_n}{}=0;
\]
that is, $x_\infty=y_\infty$.


In this way we obtain a map $\nu\:x_\o\to x_\infty$;
it is defined on a subset of $\Dom\nu \subset\spc{X}_\o$.
By construction of $\iota$, 
we get  $\iota\circ\nu(x_\o)=x_\o$ for any $x_\o\in \Dom\nu$.

Finally note that if $\spc{X}_\infty$ is compact, then $\nu$ is defined on all of $\spc{X}_\o$;
this proves (\ref{SHORT.thm:ultra-GH:a}).

If $\spc{X}_\infty$ is proper, choose any point $z_\infty\in \spc{X}_\infty$
and set $z_\o=\iota(z_\infty)$.
For any point $x_\o\in \spc{X}_\o$ at finite distance from $z_\o$,
for the sequence $x_n$ 
as above we have that $\dist{z_n}{x_n}{}$ is bounded for $\o$-almost all $n$.
Since $\spc{X}_\infty$ is proper, $\nu(x_\o)$ is defined;
in other words $\nu$ is defined on the metric component of $z_\o$.
Hence (\ref{SHORT.thm:ultra-GH:b}) follows.
\qeds

\begin{thm}{Corollary} 
\label{cor:ulara-geod}
The $\o$-limit of a sequence of complete length spaces is geodesic.
\end{thm}

\parit{Proof.} Given two points $x_\o,y_\o\in \spc{X}_\o$, find two bounded sequences of points $x_n,y_n\in \spc{X}_n$, $x_n\to x_\o$, $y_n\to y_\o$ as $n\to\o$.
Consider a sequence of paths  $\gamma_n\:[0,1]\to \spc{X}_n$ from $_n$ to $y_n$
 such that 
\[\length\gamma_n\le \dist{x_n}{y_n}{}+\tfrac{1}{n}.\]
Apply Theorem~\ref{thm:ultra-GH} 
for the images $\spc{Y}_n=\gamma_n([0,1])\subset \spc{X}_n$.
\qeds

\section{Ultralimits of sets}

Let $\spc{X}_n$ be a sequence of metric spaces and $\spc{X}_n\to \spc{X}_\o$
as $n\to \o$.

For a sequence of sets $\Omega_n\subset \spc{X}_n$,
consider the maximal set $\Omega_\o\subset \spc{X}_\o$ such that 
for any $x_\o\in\Omega_\o$ and any sequence $x_n\in\spc{X}_n$ such that $x_n\to x_\o$ as $n\to \o$, we have $x_n\in\Omega_n$ for $\o$-almost all $n$.

The set $\Omega_\o$ is called the  \emph{open $\o$-limit} of $\Omega_n$;
we could also write  $\Omega_n\to \Omega_\o$ as $n\to\o$ or $\Omega_\o=\lim_{n\to\o}\Omega_n$. 

{\sloppy

Applying Observation~\ref{obs:ultralimit-is-complete} to the sequence of complements $\spc{X}_n\backslash \Omega_n$, we see that $\Omega_\o$ is open for any sequence $\Omega_n$.
The definition can be applied for arbitrary sequences of sets, but  
open $\o$-convergence  will be applied here only for sequences of open sets.

}

\section{Ultralimits of functions}

Recall that a family of submaps between metric spaces $\{f_\alpha\co \spc{X}\subto\spc{Y}\}_{\alpha\in\mathcal A}$ is called \emph{equicontinuous} if for any $\eps>0$ there is $\delta>0$ such that for any $p,q\in\spc{X}$ with $\dist{p}{q}{}<\delta$ and any $\alpha\in\mathcal A$ it holds that $\dist{f(p)}{f(q)}{}<\eps$.

Let $f_n\:\spc{X}_n\subto\RR$ be a sequence of subfunctions.

Set $\Omega_n=\Dom f_n$.
Consider the open $\o$-limit set $\Omega_\o\subset \spc{X}_\o$ of $\Omega_n$.

Assume there is a subfunction $f_\o\:\spc{X}_\o\subto\RR$
that satisfies the following conditions: 
(1) $\Dom f_\o=\Omega_\o$, (2) if $x_n\to x_\o\in \Omega_\o$ for a sequence of points $x_n\in\spc{X}_n$, then $f_n(x_n)\to f_\o(x_\o)$ as $n\to\o$.
In this case 
the subfunction $f_\o\:\spc{X}_\o\to\RR$ 
is said to be the 
$\o$-limit of $f_n\:\spc{X}_n\to\RR$.

The following lemma gives a mild condition on a sequence of functions $f_n$
guaranteeing the existence of its $\o$-limit.

\begin{thm}{Lemma}
Let $\spc{X}_n$ be a sequence of metric spaces
and $f_n\:\spc{X}_n\subto\RR$ be a sequence of subfunctions.

Assume for any positive integer $\kay$, there is an open set $\Omega_n(\kay)\subset \Dom f_n$
such that the restrictions $f_n|_{\Omega_n(\kay)}$ are uniformly bounded and continuous
and the open $\o$-limit of $\Omega_n(n)$ coincides with the open $\o$-limit of $\Dom f_n$.
Then the $\o$-limit of $f_n$ is defined.

In particular, if the $f_n$ are uniformly bounded and continuous, then the $\o$-limit is defined.
\end{thm}

The proof is straightforward.

{\sloppy

\begin{thm}{Exercise}\label{ex:nonconvex-limit}
Construct a sequence of compact length spaces 
$\spc{X}_n$  
with a converging sequence of $\Lip$-Lipschitz concave functions $f_n\:\spc{X}_n\to\RR$ such that
the $\o$-limit $\spc{X}_\o$ of $\spc{X}_n$ is compact
and the $\o$-limit $f_\o\:\spc{X}_\o\to\RR$ of $f_n$ is not concave.
\end{thm}

}

If $f\:\spc{X}\subto\RR$ is a subfunction, 
the $\o$-limit of the constant sequence $f_n=f$ is called the $\o$-power of $f$ and denoted by $f^\o$.
So
\[f^\o\:\spc{X}\subto\RR,\ \ f^\o(x_\o)=\lim_{n\to\o} f(x_n).\]

Recall that we treat $\spc{X}$ as a subset of its $\o$-power $\spc{X}^\o$.
Note that $\Dom f=\spc{X}\cap \Dom f^\o$.
Moreover, 
if $\oBall(x,\eps)_{\spc{X}}\subset \Dom f$
then $\oBall(x,\eps)_{\spc{X}^\o}\subset \Dom f^\o$.


\parbf{Ultradifferential.}
Given a function $f\:\spc{L}\to\RR$, consider sequence of functions $f_n\:n\cdot\spc{L}\to\RR$, defined by 
\[f_n(x^n)=n\cdot(f(x)-f(p)),\]
here $x^n\in n\cdot\spc{L}$ is the point corresopnding to $x\in\spc{L}$.
While $n\cdot(\spc{L},p)\to(\T^\o,\0)$ as $n\to\o$, 
functions $f_n$ converge to $\o$-differential of $f$ at $p$.
It will be denoted by $\dd_p^\o f$;
\[\dd_p^\o f\:\T_p^\o\to\RR,\ \ \dd_p^\o f=\lim_{n\to\o} f_n.\] 

Clearly, the $\o$-differential $\dd_p^\o f$ of a locally Lipschitz subfunction $f$ is defined at each point $p\in \Dom f$.

