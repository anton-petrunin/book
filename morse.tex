%%!TEX root = the-morse.tex
\chapter{Topological tools}

\section{Morse theory}

\begin{thm}{Morse lemma}\label{lem:morse} A tight map admits a local splitting in a neighborhood of its regular point, and a proper everywhere regular tight map is a locally trivial fiber bundle. Namely

\begin{subthm}{} If $F:\Omega\to\RR^{\kay+1}$ is a tight map and $p\in \Omega$ is a regular point, then there is a neighborhood $\Omega\supset\Omega_p\ni p$ and homeomorphism 
\[h:\Upsilon\times F(\Omega_p)\to \Omega_p,\] 
such that
$F\circ h$ coincides with the projection to the second coordinate $\Upsilon\times F(\Omega_p)\to F(\Omega_p)$.
\end{subthm}

\begin{subthm}{} If $F:\Omega\to\Delta\subset\RR^{\kay+1}$ is a proper tight map and all points in $\Delta\subset \RR^{\kay+1}$ are regular values of $F$, then $F$ is a locally trivial fiber bundle.
\end{subthm}
\end{thm}
The proof is a backward induction on $\kay$, see 
\cite[1.4]{perelman:morse}, \cite[1.4.1]{perelman:spaces2} or
\cite[6.7]{kapovitch:stability}.


\begin{thm}{Grove--Petersen's lemma}\label{lem:grove-petersen}
It should be here: \cite[lemma 1]{grove-petersen:rad-sphere}
\end{thm}



\section{Background}\label{sec:background}
\subsection{Stratified spaces} 
Most of the material of this section is taken with almost no changes  from ~\cite{Per} as no significant simplifications or improvements of the exposition seem to be possible.

\begin{thm}{Definition}
A metrizable space $X$ is called an MSC-space (space with multiple conic singularities) of dimension $n$ if  every point $x\in X$ has a neighborhood pointed homeomorphic to an open cone over a compact  $(n-1)$-dimensional MCS space. Here we assume the empty set to be the unique $(-1)$-dimensional MCS-space.  
\end{thm}

\begin{thm}{Remark}
A compact $0$-dimensional MCS-space is a finite collection of points with discrete topology.
\end{thm}

\begin{thm}{Remark}
An open conical neighborhood of a point in an MCS-space is unique up to pointed homeomorphism ~\cite{Kwun}.
\end{thm}

It easily follows from the definition that an MCS space  has a natural topological stratification.

We say that a point $p\in X$ belongs to the $l$-dimensional strata $X_l$ if $l$ is the maximal number $m$ such that the conical neighbourhood 
of $p$ is pointed homeomorphic to $\RR^m\times K(S)$  for some  MCS-space $S$. It is clear that $X_l$ is an $l$-dimensional topological manifold.


The following two  lemmas will be useful in geometric applications

\begin{thm}{Lemma}\label{n-1-strat}
Let $X$ be a  compact $n$-dimensional $MCS$ space. Then $X_{n-1}=\emptyset$ iff $K(X)_{n}=\emptyset$.
\end{thm}
\begin{proof}
 Suppose $X_{n-1}\ne\emptyset$.
By construction of the stratification $X_{n-1}$ consists exactly of those points whose pointed conical neighbourhoods are homeomorphic to $\RR^{n-1}\times K(A)$ where $A$ is a finite set with $|A|\ne 2$. Therefore $K(X)$ contains a point whose  pointed conical neighbourhood is homeomorphic to $\RR^{n}\times K(A)$ and hence $K(X)_{n}\ne\emptyset$.

Now suppose $X_{n-1}=\emptyset$ but  $K(X)_{n}\ne\emptyset$. Since $K(X)_{n}$ contains more than one point $\RR\times X$ also has nontrivial codimension 1 strata.   Let $X_{\le n-2}$ be the union of the strata of $X$ of dimension $\le n-2$.

Since $(\RR\times X)_n$ is an $n$-manifold and  $\RR\times X_{\le n-2}$ is at most $(n-1)$-dimensional there exists $p\in (\RR\times X)_n\backslash (\RR\times X_{\le n-2})$ i.e $p$ belongs to $\RR\times X_n$. But this means that  the pointed conical neighborhood of $p$ is homeomorphic to $\RR^{n+1}$ which contradicts the fact that $p$ lies in the  codimension 1 strata of $K(X)$.
\end{proof}
As an immediate corollary we obtain

\begin{thm}{Corollary}
Let $X,Y$ be compact $MCS$ spaces such that $\RR^k\times K(X)$ is homeomorphic to $\RR^l\times K(Y)$ for some $k,l\ge 0$.

Then $X$ has nonempty codimension 1 strata iff $Y$ does.
\end{thm}
\begin{thm}{Lemma}\label{top-gr-pet}
Let $X$ be a  compact $n$-dimensional $MCS$ such that $X_{n-1}=\emptyset$ and $X_n$ is connected. Then $X$ has a fundamental class in Alexander-Spanier cohomology with $\ZZ_2$ coefficients, i.e. $\bar H^{n}(X,\ZZ_2)\cong \ZZ_2$. 

Also, If $X_n$ is orientable, then   $\bar H^{n}(X,\ZZ)\cong \ZZ$. 
\end{thm}
\begin{proof}
It easily follows from the assumptions that the top-dimensional strata $X_l$ is a {\it connected} topological manifold. Therefore, its compactly supported cohomology satisfies $\bar H^n_c(X_l,\ZZ_2)\cong \ZZ_2$.
Let $X_{\le n-2}$ be the union of all strata of dimensions $\le n-2$. Then by the Alexander-Spanier duality we have $\bar H^n_c(X_l,\ZZ_2)=\bar H^n_c(X\backslash X_{\le n-2},\ZZ_2)\cong \bar H^n(X, X_{\le n-2},\ZZ_2)$. 
For dimension reasons we obviously have that $\bar H^{n-1}(X_{\le n-2},\ZZ_2)=0$ and $\bar H^{n}(X_{\le n-2},\ZZ_2)=0$.

From the long exact sequence of the pair this gives

\[
0=\bar H^{n-1}(X_{\le n-2},\ZZ_2)\to \bar H^n(X, X_{\le n-2},\ZZ_2)\to \bar H^n(X,\ZZ_2)\to \bar H^n(X_{\le n-2},\ZZ_2)=0
\]
Therefore the natural map $\bar H^n(X, X_{\le n-2},\ZZ_2)\to \bar H^n(X,\ZZ_2)$ is an isomorphism and hence $\bar H^{n}(X,\ZZ_2)\cong \ZZ_2$.

The orientable case is proved in exactly the same way.
\end{proof}
\parbf{Remark.}

Note that $MCS$ spaces are paracompact and locally contractible. Therefore for such spaces  the Alexander-Spanier cohomology coincides with the usual singular cohomology ~\cite{Spanier}[page 440 in Russian edition]
We will need two general topological results which hold for spaces more general than  Alexandrov spaces and follow from the general theory of deformations of homeomorphisms developed by Siebenmann~\cite{Sieb}.

\begin{thm}{Theorem}\label{local bundle}\cite[Theorem 5.4, Corollary 6.14, 6.9]{Sieb}

Let $X$ be a metric space and $f\: X\to \RR^k$ be a continuous, open, proper map such that for each $x\in X$ we have

\begin{subthm}{} $f^{-1}(f(x))$ is a compact MCS-space;
\end{subthm}

\begin{subthm}{} $x$ admits a product neighborhood with respect to $f$, i.e there exists an open neighbourhood $U_x$ of $x$ and a homeomorphism $F_x\: U_x\to U_x\cap f^{-1}(f(x))\times f(U_x)$ such that $f_x=p_2\circ F_x$ where $p_2\: U_x\cap f^{-1}(f(x))\times f(U_x)\to \RR^k$ is the coordinate  projection onto the second factor.
\end{subthm}

Then $f$ is a locally trivial fiber bundle.

Moreover, suppose we have  in addition   that $f(U_x)=I^k$. Let $K\subset U_x$  be a compact subset.  Then there exists a homeomorphism
$\phi\: f^{-1}(I^k)\to f^{-1}(f(x))\times I^k$ respecting $f$ (I.e. such that $f=p_2\circ \phi$. and such that $\phi|K=F_x|K$.
\end{thm}




The next gluing theorem is the key topological ingredient in the proof of the Stability Theorem.   It says that for MCS spaces close local homeomorphisms given on a finite  open covering can be glued to a nearby  global homeomorphism under some mild (but important!) geometric assumptions.

First we need a technical definition.

\begin{thm}{Definition}
A metric space $X$ is called $\varkappa$-connected if for any two points $x_1,x_2\in X$ there exists a curve  connecting $x_1$ and $x_2$ of $\diam\le \varkappa(\dist{x_1}{x_2}{})$.
\end{thm}



\begin{thm}{Theorem}\label{gluingthm}
Let $X$ be a compact MCS-space, $\{U_\a\}_{\a\in \frak A}$ be a finite covering of $X$. Given a function $\varkappa_0$, there exists $\varkappa=\varkappa(X, \{U_\a\}_{\a\in \frak A},\varkappa_0)$ such that the following holds:

Given a $\varkappa_0$-connected MCS-space $\tilde{X}$,  an open cover of $\tilde{X}$  $\{\tilde{U}_\a\}_{\a\in \frak A}$, a $\delta$-Hausdorff approximation $\phi\co X\to \tilde{X}$ and a family of homeomorphisms $\phi_\a\co  U_\a \to \tilde{U}_\a$, $\delta$-close to $\phi$,

Then there exists a homeomorphism $\bar{\phi}\co X\to  \tilde{X}$, $\varkappa(\delta)$-close to $\phi$.
\end{thm}

\begin{proof}[Proof of Theorem~\ref{gluingthm}]
This proof of Theorem~\ref{gluingthm} is taken verbatim from~\cite{Per}.


We'll need two lemmas.

\begin{thm}{Deformation Lemma}\label{deflem}
Let $X$ be a compact metric MCS-space,  $W\Subset V\Subset U\subset X$ be open subsets.

Let $\phi\co U\to X$ be an open embedding $\delta$-close to the inclusion $i$.

Then there exists an open embedding $\psi\co U\to X$, $\varkappa(\delta)$-close to $i$ and such that  $\psi\equiv\phi$ on $W$ and $\psi\equiv i$ on $U\backslash V$.

(Here $\varkappa$ depends on $W,U,V,X$ but not on $\phi$).
\end{thm}
\begin{proof}
Consider the open embedding $\phi |_{U\backslash \bar{W}}\co U\backslash \bar{W}\to X$. By the deformation theorem of Siebenmann~\cite[Theorem 5.4]{Sieb},  it can be perturbed to an open embedding $\phi_1\co U\backslash \bar{W}\to X$ which is $\varkappa(\delta)$-close to $i$,  coincides with $i$ on some neighborhood of $\partial V$ and is equal to $\phi$ outside some compact subset of  $U\backslash \bar{W}$. Now let

\[
\psi(x)=
\begin{cases}
\phi(x),\text{ for } x\in W\\
\phi_1(x), \text{ for } x\in V\backslash W\\
x, \text{ for } x\in U\backslash V
\end{cases}
\]

It's clear that $\psi$ satisfies the conclusion of the Lemma.

\end{proof}
\begin{thm}{Lemma}\label{ontolem}
Under the assumptions of Theorem~\ref{gluingthm},  let $x\in X, \tilde{x}\in\tilde{X}$ satisfy $d(\phi(x),\tilde{x})<\delta$. Let $V\subset X$ be an open set containing $B(x,\varkappa_0(\delta)+10\delta)$.
Suppose $\psi\co V\to\tilde{X}$ be an open embedding, $\delta$-close to $\phi$.

Then $\tilde{x}\in \psi(V)$.

\end{thm}
\begin{proof}
Let $\tilde{\gamma}\co [0,1]\to \tilde{X}$ be a curve of $\diam\le \varkappa_0(\delta)$ with $\tilde{\gamma}(0)=\psi(x),\tilde{ \gamma}(1)=\tilde{x}$.

We'll  show that $\tilde{\gamma}$  has a lift $\gamma\co [0,1]\to V$ with respect to $\psi$. Since $\psi $ is an open embedding we can lift $\tilde{\gamma}$ on some interval $[0,\eps)$. Observe that given a lift $\gamma$  of $\tilde{\gamma}$  on $[0,t)$ for some $t\le 1$  it can always be extended to $[0,t]$ provided the closure of $\gamma([0,t))$ is contained in $B(x,\varkappa_0(\delta)+10\delta)$. The fact that $\psi$ is $\delta$-close to $\phi$ and $\phi$ is a $\delta$-Hausdorff approximation assures that this is always the case. Therefore the lift $\gamma$ can be extended to $[0,1]$ with $\psi(\gamma(1))=\tilde{x}$.
\end{proof}

\begin{thm}{Remark}
The proof of Lemma~\ref{ontolem} is the only place in the proof of Theorem~\ref{gluingthm} where we use the assumption that $\tilde{X}$ is $\varkappa_0$-connected.
\end{thm}


We can now continue with the proof of Theorem~\ref{gluingthm}.

Suppose $U_{\a_1}\cap U_{\a_2}\ne \emptyset$. Let $U_1^4\Subset U_1^3\Subset U_1^2\Subset U_1^1\Subset U_{\a_1}$ and 
$U_2^4\Subset U_2^3\Subset U_2^2\Subset U_2^1\Subset U_{\a_2}$ be open subsets such that $U_1^4, U_2^4$ still cover
$X\backslash \cup_{\a\in \frak A\backslash\{\a_1,\a_2\}}U_\a$.

By Lemma~\ref{ontolem},  we have $\phi_{\a_1}(U_1^1\cap U_2^1)\subset \phi_{\a_2}(U_{\a_2})$ provided $\delta$ is sufficiently small.

Therefore we can consider the open embedding $\phi_{\a_2}^{-1}\circ \phi_{\a_1}\co U_1^1\cap U_2^1\to U_{\a_2}$. Clearly, it is $2\delta$-close to the inclusion $i$. By Lemma~\ref{deflem}, there exists an open embedding $\psi\co U_1^1\cap U_2^1\to U_{\a_2}$, $\varkappa(\delta)$-close to $i$ and such that $\psi\equiv \phi_{\a_2}^{-1}\circ \phi_{\a_1}$ on $U_1^3\cap U_2^3$ and $\psi\equiv i$ on $U_1^1\cap U_2^1\backslash U_1^2\cap U_2^2$. We can extend $\psi$ to $U_2^1$ by setting $\psi\equiv i$ on $U_2^1 \backslash  U_1^2\cap U_2^2$ and define $\phi_{\a_2}'=\phi_{\a_2}\circ\psi$.

Now we define $\phi'\co U_1^4\cup U_2^4\to\tilde{X}$ by the formula
\[
\phi'(x)=
\begin{cases}
\phi_{\a_1}(x) \text{ for } x\in U_1^4\\
\phi_{\a_2}'(x) \text{ for } x\in U_2^4
\end{cases}
\]

It is clear that $\phi'$ is an open immersion and it's is actually an embedding provided $\delta$ is sufficiently small.

Moreover, by Lemma~\ref{ontolem} we have 
\[\tilde{X}\backslash \underset{\a\in \frak A\backslash\{\a_1,\a_2\}}  { \cup}\tilde{U}_\a\subset \phi'(U_1^4\cup U_2^4).\]

 Now the statement of the theorem immediately follows by induction on the number of elements in $\frak A$.


\end{proof}


\begin{comment}
In  fact, we will need a somewhat stronger version of this theorem which assures that the gluing can be done relative to a fiber bundle structure on all the limit and approximating spaces.

\begin{thm}[Strong Gluing Theorem]\label{stronggluing}
Under the assumptions of Gluing Thorem~\ref{gluingthm} we are given in addition continuous maps $f\co X\to \R^k, \tilde f\co \tilde{X}\to \R^k, h\co X\to R, \tilde{h}\co \tilde{X}\to\R$ and a compact set $K\subset X$ such that the following holds
\begin{enumerate}
\item for any $U_\a$ with $U_\a\cap K\ne \emptyset$ we have $(\tilde{f},\tilde{h})\circ \phi_\a=(f,h)$
\item for any $U_\a$ with $U_\a\cap K=\emptyset$ we have $\tilde{f}\circ \phi_\a=f$
\item for any  $U_\a$ with $U_\a\cap K\ne \emptyset$ , $U_\a$ is contained in a product neighbourhood with respect to $(f,h)$
\item for any $U_\a$ with $U_\a\cap K=\emptyset$,  $U_\a$ is contained in a product neighbourhood with respect to $f$
\end{enumerate}

Then the gluing homeomorphism $\bar{\phi}$ can be chosen to respect $f$ on $X$ and $(f,h)$ on $K$  (i.e $(\tilde{f},\tilde{h})\circ \bar{\phi}=(f,h)$ on $K$ and  $\tilde{f}\circ \bar{\phi}=f$ on $X$.

\end{thm}


\begin{proof}

The proof of Theorem~\ref{gluingthm} can be trivially adapted to prove  Strong Gluing Theorem~\ref{stronggluing}  once we observe that  the  theorem of Siebenmann quoted in the proof of Lemma~\ref{deflem} has a stronger version respecting products with $\R^k$~\cite[Theorem 6.9]{Sieb} so that the deformation $\psi$ given by   Lemma~\ref{deflem} can be made to respect the product structure $X\cong X_1\times \R^k$ if $\phi\co U\to X$ respects that product structure.

\end{proof}

For applications to pointed Gromov-Hausdorff convergence we will need the following  local version of the Gluing theorem for which the requirement that the approximated space be $\varkappa$-connected can be slightly weakened. For simplicity, we only state the unparameterized version.

\begin{thm}\label{locgluing}

Let $U\Subset V\Subset W\subset X$ be relatively compact  open subsets in an MCS-space $X$. Let 
$\{U_\a\}_{\a\in \frak A}$ be a finite covering of $\bar{W}$ with the property that if $U_\a\cap \bar{V}\ne \emptyset$ then $U_\a\Subset W$.

Then  given a function $\varkappa_0$, there exists $\varkappa=\varkappa(X, U,V,W, \{U_\a\}_{\a\in \frak A},\varkappa_0)$ such that the following holds:

Given a $\varkappa_0$-connected MCS-space $X'$,  and  subsets $U'\Subset V'\Subset W'\Subset X'$,  an open cover  $\{U'_\a\}_{\a\in \frak A}$ of $\bar{W}'$ , a $\delta$-Hausdorff approximation $(\bar{W}, \bar{V}, \bar{U})\to (\bar{W}', \bar{V}', \bar{U}')$ and a family of homeomorphisms $\phi_\a\co  U_\a \to {U}'_\a$, $\delta$-close to $\phi$,

then there exists an open embedding  $\phi'\co V\to X'$, $\varkappa(\d)$-close to $\phi$ such that $\phi(V)\supset U'$ if $\d$ is sufficiently small.
\end{thm}

\begin{proof}
The proof is exactly the same as the proof of Theorem~\ref{gluingthm} except in the induction procedure we only glue the embeddings of those $U_\a$ which intersect $\bar{V}$.
\end{proof}

\begin{defn}
A map $f\co X\to Y$  between two metric spaces is called $\e$-co-Lipschitz if for any $p\in X$ and all small $R$ we have $f(B(p,R))\supset B(f(p),\e R)$.
\end{defn}


We will often make use of the following simple observation the proof of which is left to the reader as an exercise.


\begin{lem}\label{colip}
Let $f\co X\to Y$ is $\e$-co-Lipschitz where $X$ is compact. Let $p\in X$ and $\gamma\co [0,1]\to Y$ be a rectifiable curve with $\gamma(0)=f(p)$. Then there exists  a lift $\tilde{\gamma}\co [0,1]\to X$ of $\gamma$  such that $\tilde{\gamma}(0)=p$ and $L(\tilde{\gamma})\le \frac{1}{\e}L(\gamma)$.

\end{lem}



A function $f\: \Sigma\to  \RR$ is called {\it spherically concave} if for any $y$ lying on a shortest geodesic connecting $x$ and $z\in \Sigma$ we have

\[
f(y)\sin d(x,z)\ge f(z) \sin d(x,y)+f(x)\sin d(z,y).
\]

As with ordinary concave functions, for a space with boundary we demand that the canonical extension of $f$ to the doubling of $\Sigma$ be spherically concave.

It's easy to see that $f$ is spherically concave iff its  1-homogeneous extension to $C\Sigma$ is concave. In particular, if $f\:\spc{X}\to\RR$ is semi-concave then $df_p\: \Sigma_pX\to \RR$ is spherically concave.
\end{comment}

\section{Derivatives of multidistance functions}
In this section we will consider derivatives of multidistance functions. 
Let $\Sigma\in\CBB{n}{1}$.
 We call a function   $h\co \Sigma\to\R$ where $\curv\Sigma\ge 1$ a function of class DER
if it has the form

\[
\sum_\a -a_\a\langle \cdot, {A_\a}\rangle \text{  where } a_\a\ge 0%, \quad \sum_\a a_\a\le 1.
\]

for some  finite collection $\{A_\a\}_{\a\in \frak A}$ of subsets of $\Sigma$.

DER functions are spherically concave on $\Sigma$ i.e. they are concave when radially extended to $C\Sigma$.


We define the scalar product of two functions in DER by the formula:
for
\begin{equation}\label{e:rep}
h=\sum_\a -a_\a\langle \cdot, {A_\a}\rangle, \quad g=\sum_\a -a_\beta\langle \cdot, {B_\beta}\rangle
\end{equation}
put 

\[
\dlang h, g\drang:=\sum_{\alpha,\beta}a_\alpha b_\beta \langle A_\alpha, B_\beta\rangle.
\]


Note that as with the notion of  $\sdk\kappa{p}{\phi}{\psi}$ for multidistance functions  $\phi,\psi$, this definition depends on the representations of $h,g$ given by (\ref{e:rep}) and not just the values of $h,g$ at every point. Also note that for any $u\in \Sigma$ and $\hat g=\langle \cdot, u\rangle$ we have that
\[
\dlang h, \hat g\drang=-h(u)
\]
\begin{thm}{Remark}\label{box-scalar-ineq} The definition of  $\dlang \cdot, \cdot \drang$ is just the infinitesimal version of $\sdk\kappa{p}{\phi}{\psi}$ for multidistance functions $\phi$ and $\psi$ on $\spc{L}\in\CBB{\kappa}{n}$. In particular, for any  $p\in\spc{L}$ and $\Sigma=\Sigma_p\spc{L}$ by the angle comparison we have

\[
\dlang \d_p\phi, \d_p\psi\drang\le \sdk\kappa{p}{\phi}{\psi}
\]

\end{thm}
Let us collect some properties of the scalar product that will be needed in the next section (cf. ~\cite{Per-Morse})


\begin{thm}{Lemma}\label{der-prop}

\begin{enumerate}[(i)]
\item \label{der-commute}
\[
\dlang h, g\drang=\dlang g, h\drang
\]
\item \label{der-der} If $h\in DER(\Sigma)$ and $p\in \Sigma$ then $\d_ph\in DER(\Sigma_p\Sigma)$;
\item \label{der-der-ineq} $ \dlang d_ph,d_pg\drang\le \dlang h, g\drang-h(p)g(p)$ for any $p\in\Sigma$;
\item \label{der-single-vector} For any $h\in DER(\Sigma)$ there is a vector $\hat{A}\in C\Sigma$ such that for
 $\hat{h}=-\langle \cdot, \hat{A}\rangle$ we have $\dlang h, g\drang \ge \dlang \hat{h}, g\drang$ for any $g\in DER(\Sigma)$;
 \item \label{der-pos-scalar} $ \dlang h,h \drang\ge   0$ for any $h\in DER(\Sigma)$.
% \item $ \langle h,h \rangle\ge \left(\inf_{g\in DER(\Sigma)}\langle h, g\rangle \right)^2\ge  0$;
\end{enumerate}
\end{thm}
Property (\ref {der-der-ineq})  follows from the angle comparison and an elementary observation that
for the unit vectors $h,g,p$ in $\mathbb R^n$ we have that $\langle P(h),P(g)\rangle=\langle h,g\rangle-\langle h,p\rangle\cdot \langle h,p\rangle$ where $P$ is the orthogonal projection to $p^\perp$. Of particular importance in  applications will be generalization of  the implication that if $\langle h,g\rangle<0$ and $\langle h,p\rangle>0$, $\langle g,p\rangle>0$ then $\langle P(h),P(g)\rangle<0$ also.

\begin{proof}
(\ref{der-commute}) is obvious.

  To see (\ref{der-der})  let  $h=\sum_\a -a_\a\langle \cdot, {A_\a}\rangle$ then by the first variation formula we have
  \[\d_ph=\sum_\a -a_\a\sin \angle A_\a p \langle \cdot, \Dir{p}{A_\a}\rangle\]
and therefore $d_ph\in DER(\Sigma_p\Sigma)$.

To prove (\ref{der-der-ineq}) observe that  by linearity of expressions involved it is sufficient to consider the case $h= \langle \cdot, {A}\rangle, g= \langle \cdot, {B}\rangle$for some $A,B\in\Sigma$. For such $h$ and $g$   (\ref{der-der-ineq})  is a direct consequence of Toponogov and the equality case on the sphere for linear functions.

(\ref{der-single-vector}) is an immediate consequence of the  Sum lemma (\ref{lem:sum}) applied to $h$.

(\ref{der-pos-scalar})  is an immediate consequence of (\ref{der-single-vector}) since $ \dlang h,h \drang\ge  \dlang h,\hat h \drang  \ge \dlang \hat h,\hat h \drang={\hat a}^2\ge 0$.
\end{proof}
From now on we will slightly abuse notations and will denote the function $-\langle \cdot, \hat{A}\rangle$ by the same letter $\hat A$.
\section{Admissible multi distance maps and functions}

\begin{thm}{Lemma}\label{ann-pi/2-vol}
For any $n\ge 1$ there exists $c(n)$ such that the following holds. For any
$\Sigma\in\CBB{n}{1}$, $0<\nu<1/100$ and any $S\subset \Sigma$ we have that
\[
\vol_n \Ann[\Sigma, \pi/2-\nu,\pi/2+\nu]\le \nu\cdot c(n)\vol_n\Sigma
\]
\end{thm}
\begin{proof}
This is a direct consequence of Corollary~\ref{cor:bishop-gromov-annulus}
with $R=\pi/2+\nu$ and $r=\pi/2-\nu$.
\end{proof}
\begin{thm}{Corollary}
Under the assumptions of Lemma~\ref{ann-pi/2-vol} suppose $\delta<\nu/100$ and $x_1,\ldots,x_N$ is a $\delta$-separated net in $\Ann[\Sigma, \pi/2-\nu,\pi/2+\nu]$.

Then $N\le \frac{c_1(n)\cdot\nu}{\delta^n}$ for some universal $c_1(n)$.
\end{thm}
\begin{proof}
The balls $\oBall[x_i,\tfrac\delta2]$ are disjoint and are contained in $\Ann[\Sigma, \tfrac\pi2-2\cdot\nu,\tfrac\pi2+2\cdot\nu]$. 
By Lemma~\ref{ann-pi/2-vol} we have that 

\[
\vol_n\Ann[\Sigma, \pi/2-2\nu,\pi/2+2\nu]\le 2\cdot \nu\cdot c(n)\vol_n\Sigma
\]
On the other hand each $\oBall[x_i,\delta/2]$ has volume at least $c_2(n)\delta^n\vol_n\Sigma$ by Bishop-Gromov volume comparison~\ref{thm:bishop-gromov}.
As the balls are disjoint the result follows.
\end{proof}

Let us recall the following definition


\begin{thm}{Definition}\label{def:strut-II}
Let $\spc{L}\in\CBB{}{}$.
An array of multidistant functions 
$\bm{\phi}\z=(\phi^0,\phi^1,\dots,\phi^\kay)$
on $\spc{L}$
is \emph{$\kappa$-strutting}\index{strutting array of multidistance functions} for a point $p\in\spc{L}$ if 
\[\sdk\kappa{p}{\phi^i}{\phi^j}<0\]
for all $i\not=j$.

In this case, we say that $p$ is a 
\emph{critical point}\index{critical point} 
for the submap $\bm{\phi}\:\spc{L}\subto \RR^{\kay+1}$
if
\[\min_i\d_p\phi^i\le 0\]
and otherwise $p$ is called 
\emph{regular point}\index{regular point} of $\bm{\phi}$.
\end{thm} 

\begin{thm}{Remark}\label{equiv-def-reg}
It is immediate from  the definition that if $\bm{\phi}$ is a $\kappa$-strutting at $p$ then it is also a $\kappa$-strutting for points close to $p$. Moreover, suppose $\spc{L}_n\in\CBB{}{\kappa}$ Gromov-Hausdorff converges to $\spc{L}$ and $\bm{\phi}\:\spc{L}\subto \RR^{\kay+1}$ is a $\kappa$-strutting. Let $p_n\in\spc{L}_n$ and $\bm{\phi}\:\spc{L}_n\subto \RR^{\kay+1}$ be natural lifts of $p$ and $\bm{\phi_n}$ to $\spc{L}_n$. Then for all large $n$ $\bm{\phi_n}$ is a $\kappa$-strutting for $p_n$.

Also, by Proposition~\ref{prop:regular=+1} we have that  $\bm{\phi}\:\spc{L}\subto \RR^{\kay+1}$ is regular at $p$ if and only if there exists a point $a_{\kay+2}$ arbitrary close to $p$ such that $\bar {\bm{\phi}}=(\bm{\phi},\dist{a_{\kay+1}}{}{})$ is a $\kappa$-strutting for $p$. 


Here we think of $\bar {\bm{\phi}}$ as a multi distance function in the natural way as follows. If $\bm\phi\can F\circ\dist{\bm{a}}{}{}$ where $\bm a=(a_0,\ldots, a_\kay)$   then  $\bar{\bm\phi}\can \bar F\circ\dist{\bar{\bm{a}}}{}{}$ where $\bar{\bm a}=(a_0,\ldots a_{\kay+1})$ and $\bar F(x_0,\ldots x_{\kay+1})=(F(x_0,\ldots x_{\kay}), x_{\kay+1})$. Combined with the above this shows if $\bm\phi$ is regular at $p$ then it is also regular for points near $p$ and the same remains true for lifts of $\bm\phi$ and $p$ to $\spc{L}_n$ for all large $n$  if  $\spc{L}_n\to\spc{L}$ with $\spc{L}_n\in\CBB{}{\kappa}$.
\end{thm}


We will need the following Lemma about differentials of tight maps (cf. perelman-morse and Perelman-DC)

\begin{thm}{Lemma}\label{lem-tight-diff-new}
Let $\spc{L}\in \CBB{n}{\kappa}$ 
Let  $\bm\phi =(\phi^0,\ldots,\phi^\kay)\: \spc{L}\to\RR^{\kay+1}$ be a $\kappa$-strutting at $p\in U$ such that $|dF|_1=\max_i\sum_j|\partial _jF^i|\le 1$ 
(this guarantees that $\phi^i$ is $1$-Lipschitz for all $i$) and 

\[\sdk\kappa{p}{\phi^i}{\phi^j}<-\eps\]
for all $i\not=j$.

Then 

\begin{subthm}{}\label{dim-ineq-strut}
 $k\le n$;
\end{subthm}


\begin{subthm}{}\label{incr-decr-all}
There exist unit vectors $\xi_+$ and $\xi_-$ in $T_p\spc{L}$ such that for every $i>0$ we have

\[
\d_p\phi^i(\xi_+)>\eps\qquad \text{ and } \d_p\phi^i(\xi_-)<-\eps
\]
\end{subthm}


\begin{subthm}{} \label{pos-eps}
 For every $i=1,\ldots \kay$ there exists $\xi^i+\in \Sigma_p\spc{L}$ such that $\d_p\phi^i(\xi^i_+)> \eps$ and $\d_p\phi^j(\xi^i_+)=0$ for $j\ne 0, i$.
\end{subthm}
\begin{subthm}{} \label{neg-eps}
 For every $i=1,\ldots \kay$ there exists $\xi^i_-\in \Sigma_p\spc{L}$ such that $\d_p\phi^i(\xi^i_-) <- \eps$ and $\d_p\phi^j(\xi^i_-)=0$ for $j\ne 0, i$.
\end{subthm}
\end{thm}
 Note that the requirement that $|dF|_1\le 1$ is not serious as it can always be achieved by rescaling $\bm{\phi}$. It is only added to the statement of the Lemma to clarify the quantitative estimates.
 
 \parit{Proof of Lemma \ref{lem-tight-diff-new}}
 
 Let us first prove \eqref{dim-ineq-strut}. 
 
  Recall that by Remark~\ref{box-scalar-ineq}  we have that 
 \[
\dlang \d_p\phi^i, \d_p\phi^j\drang\le \sdk\kappa{p}{\phi^i}{\phi^j}<-\eps
\]
For all $i\ne j$.

  Let $\hat A^i\in T_p\spc{L}$ be the vector provided by Lemma~\ref{der-prop} (\ref{der-single-vector}) for $\d\phi^i$.  By the sum Lemma out assumptions on $|dF|_1$ guarantee that $|\hat A^i|\le 1$ for all $i$.
 On the other hand for $i\ne j$ we have 
 \[
 -\eps>\dlang \d_p\phi^i, \d_p\phi^j\drang\ge \dlang \hat A^i, \d_p\phi^j\drang\ge \dlang  \hat A^i, \hat A^j\drang=\langle  \hat A^i, \hat A^j\rangle
 \]
 Thus $\angle \hat A^i\hat A^j>\pi/2$ for all $i\ne j$.
 
 The fact that  a space $\Sigma\in \CBB{n-1}{1}$ contains $\kay+1$ vectors with pairwise angles $>\pi/2$ easily  implies that $\kay\le n$ (this is surely written up somewhere already?) by induction on $n$. Indeed, the base of induction is trivial. Suppose it's true for all spaces in $\CBB{n-2}{1}$ and let $\xi_0,\ldots \xi_\kay\in \Sigma$ where  $\Sigma\in \CBB{n-1}{1}$  and $\angle \xi_i\xi_j>\pi/2$.  Then the vectors $\zeta_i=\dir{\xi_0}{\xi_i}\in\Sigma_{\xi_0}\Sigma$ still satisfy $\angle \zeta_i\zeta_j>\pi/2$ for a lll $i\ne j\ge 1$ by Toponogov and the claim follows by induction. This proves \eqref{dim-ineq-strut}.
 
 To prove \eqref{incr-decr-all} For any $i>0$ we have
 
  \[
-\d_p\phi^i(\xi_+)=\dlang \hat A^0, \d_p\phi^i\drang\le \dlang \d_p\phi^0, \d_p\phi^i\drang\le \sdk\kappa{p}{\phi^i}{\phi^j}<-\eps
\]
 which means  that $\d_p\phi^i( \hat A^0)>\eps$. Since $|\hat A^0|\le 1$ by the Sum Lemma (\ref{lem:sum}), we can set $\xi_+=\frac{\hat A^0}{|\hat A^0|}$.
 Next, let $u$ be polar to $\xi_+$. Then $|u|\le 1$ and  for any $i>0$ we have $\d_p\phi^i(\xi_+)+\d_p\phi^i(u)\le 0$ which implies that $\d_p\phi^i(u)< -\eps$ for all $i>0$. Again we can set $\xi_-=\frac{u}{|u|}$. Then $\xi_+$ and $\xi_-$  satisfy \eqref{incr-decr-all}.
 
 
 Let us prove \eqref{pos-eps} and \eqref{neg-eps}. We will prove that for every $i>0$ there exists $v\in \Sigma_p\spc{L}$ such that $\d_p\phi^i(v)\ge \eps$ and $\d_p\phi^j(v)=0$ for $j\ne 0, i$ and  $\d_p\phi^0(v)\le- \eps$.
 This will obviously  imply b). It  will  also imply  c) by interchanging $\phi^0$ and $\phi^i$.
 
To simplify notations let us denote $f^i=\d_p\phi^i$.
 

 

Fix an $1\le i_0\le k$. Let $v\in T_q\spc{L}$ be a maximum point of $f^{i_0}$ on the set $S_{i_0}=\{w\in T_q\spc{L} | $ with $|w|\le 1$ and $ f^j(w)\ge 0$ for $j=1,\ldots k\}$.\
Note that this set is not empty as it contains $\xi_+$ by part  \eqref{incr-decr-all}. Obviously, $f^{i_0}(v)\ge f^{i_0}(u)\ge \eps$. Also,  by homogeneity of $f^i$  it's clear that $|v|=1$.
We claim that $f^j(v)=0$ for $j\ne 0,i_0$.

Indeed, suppose $f^{j_0}(v)>0$ for some $j_0\ne 0,i_0$.



By Lemma~\ref{der-prop} (\ref{der-der-ineq}) we see that for all  $i,j\ne 0$, $i\ne j$ and $\Sigma=\Sigma_p\spc{L}$ we have

\[
\dlang d_vf^i,d_vf^j\drang\le \dlang f^i, f^j\drang-f^i(v)\cdot f^j(v)\le \dlang f^i, f^j\drang<-\eps
\]


Let $u\in \Sigma_v\Sigma_p\spc{L}$ be given by $u= \d_vf^{j_0}$. By the same argument as above  $d_vf^{j_0}<0$ and $d_vf^j(v)>0$ for all $j>0,j\ne j_0$.  Let $\beta(t)\in \Sigma_p\spc{L}\subset T_p\spc{L}$ (we identify $ \Sigma_p\spc{L}$ be a curve in the direction of $u$ then for small $t>0$ we have that 
 $\beta(t)\in S_{i_0}$ with $f^{i_0}(\beta(t)>f^{i_0}(v)$
(note that $|\beta(t)|=1$ for all $t$ by construction).
 
  This contradicts the choice of $v$ and therefore $f^j(v)=0$ for $j\ne 0,i_0$ as claimed.
  
  Lastly, let us verify that the constructed vector $v$ also satisfies $f^{0}(v)\le -\eps$. Suppose not  and$ f^{0}(v)> -\eps$. Then  we have $-f^0(v)<\eps, f^{i_0}(v)\le 1$ and hence 
  $-f^0(v)\cdot f^{i_0}(v)< \eps$.  Therefore, by Lemma~\ref{der-prop} (\ref{der-der-ineq}) we have
  
  \[
  \dlang d_vf^0,d_vf^{i_0}\drang\le  \dlang f^0, f^{i_0}\drang-f^0(v)\cdot f^{i_0}(v)\le \dlang f^0, f^{i_0}\drang+\eps<0
  \]
  Therefore we can find a vector $w\in \Sigma_v\Sigma_p\spc{L}$ such that for a curve $\alpha(t)\in \Sigma_p\spc{L}\subset T_p\spc{L}$ such that $f^(i)(\alpha(t))'(0)>0$ for all $i>0$. this means that all that for small positive $t$ $\alpha(t)$ lies in $S_{i_0}$ but $f^{i_0}(\alpha(t))>f^{i_0}(v)$. This  again contradicts the choice of $v$ and therefore $f^{0}(v)\le -\eps$.
\qeds



For technical reasons it will be convenient to increase the class of multidistance maps by allowing compositions with bi-Lipschitz homeomorphisms  of open subsets of  Euclidean spaces.

\begin{thm}{Definition}
A map $\bm g\co \spc{L}\to\RR^k$ is called admissible on an open set $\Omega\subset {\spc{L}}$ if it admits a representation $\bm g=G\circ \bm\phi$ where $\bm\phi$ is multidistance and $G$ is a bi-Lipschitz homeomorphism between open sets in $\RR^k$.

We will say that $\bm g$ is regular at $p$ if $\bm\phi$ is regular   at $p$ as a  multidistance map.
\end{thm}



To unburden the exposition we will employ the following convention.
If an admissible map is denoted by $\bm\phi$ (with any indices) we will automatically assume that in the above definition $G\equiv \Id$.


\begin{thm}{Lemma}\label{propr-reg}
Let $\bm g\co \spc{L}\to \R^k$ be an admissible map. Let $\spc{L}_{reg}(\bm g)\subset \spc{L}$ be the set of  regular  points of $\bm g$.

Then the following properties hold
\begin{enumerate}[(i)]
\item  \label{reg-open}  $\spc{L}_{reg}(\bm g)$  is open.
\item \label{reg-colip} Suppose $\bm{\bar\phi}\can \bar F\circ\dist{\bm{a}}{}{}=(\phi_0,\phi_1,\ldots \phi_\kay)$ is a $\kappa$-strutting such that $|dF|_1\le 1$ and
\[\sdk\kappa{x}{\phi^i}{\phi^j}<-\eps\]
for all $i\not=j$ and $x\in B(p,r)$. 
Then $\bm\phi=(\phi_1,\ldots \phi_\kay)$ is $L$-co-Lipschitz on $B(p,R)$ where $L=L(\eps)$ depends only $\eps$ and $R=R(\kappa,\eps,r)$ depends only on $\kappa,\eps$ and $r$.


\item \label{reg-open-map} $\bm g\co \spc{L}_{reg}(g)\to \R^k$ is open. 
\item \label{reg-dim-bound} $k\le \dim \spc{L}$ if  $\spc{L}_{reg}(\bm g)\ne \emptyset$.  
\end{enumerate}
\end{thm}
\begin{proof}
Part \eqref{reg-open}  is obvious by Remark~\ref{equiv-def-reg}. Part \eqref{reg-colip}  is a corollary of Lemma~\ref{lem-tight-diff} by  a successive approximation  argument or by Theorem~\ref{thm:right-inverse-function}.
\begin{comment}
Let $\xi_i^{\pm}\in T_p\spc{L}$ be unit vectors provided by Lemma~\ref{lem-tight-diff}  so that $\d_p\phi^i(\xi_i^-)<-\eps$, $\d_x\phi^i(\xi_i^+)>\eps$ and $\d_x\phi^j(\xi_i^\pm)=0$ for all $j\ne i$. We can assume that $v_i^\pm=\dir{p}{a_i^\pm}$ for some points $a_i^\pm$.

Also, without loss of generality $\phi^0=\dist{a^0}{}{}$ and let $\xi^+=\dir{p}{a^0}$.

Then $\d_p(\xi^+)>\eps$ for $i>0$ and  the same is true for all points $x$ near $p$.  
Let $v_0=\phi(p)$ and let $v$ be  close to $v$. we want to find a point $x$ such that $\phi(x)=v$ and $\dist{x}{p}{}< \frac{|v-v_0|}{\eps}$. 

First observe that by moving $p$ in the direction of $a^0$  which increases all $\phi^i$  we can assume that $v^i_0\ge v^i$ for all $i$.
\end{comment}

Part \eqref{reg-open-map} is immediate from part  \eqref{reg-colip}. 
Part \eqref{reg-dim-bound} immediately follows from  part a) of Lemma~\ref{lem-tight-diff}.\label{incomple-dim}
\end{proof}
\begin{thm}{Local Fibration Theorem}\label{fibration}\cite{Per-Morse, Per-DC}
Let $\bm g\co \spc{L}\to \R^k$ be an admissible map. Then $\bm g|_{\spc{L}_{reg}(\bm g)}\co \spc{L}_{reg}(\bm g)\to \R^k$ is locally a topological bundle map. This means that any point $p\in  \spc{L}_{reg}(\bm g)$ possesses an open product neighborhood with respect to $\bm g$ with an $MSC$-space as a fiber.
\end{thm}

 
 
 We will need the following  technical Lemma  due to Perelman which plays a key  role in the proofs of both the Stability Theorem and the Fibration Theorem above.

\begin{thm}{Key Lemma}\label{incompl}~\cite[Section 3]{Per-Morse}
 Let $p$ be a regular point of $f\co \spc{L}\to \R^k$.  Suppose $f$ is incomplementable at $p$, i.e.  for any admissible function  $f_1\co \spc{L}\to\R$, the point $p$ is not regular for $(f,f_1)\co \spc{L}\to \R^{k+1}$. 

Then there exists an admissible function $h\co \spc{L}\to\R$ with the following properties

\begin{subthm}{}  $h(p)=0$.
\end{subthm}

\begin{subthm}{} $h$ is strictly concave on $B(p,R)$ for some $R>0$.
\end{subthm}

\begin{subthm}{} There are $r>0, A>0$ such that  $h< A$ on $f^{-1}\left(\bar{I}^k(f(p),r) \right)$ and   $f^{-1}\left(\bar{I}^k(f(p),r) \right)\cap  \{h\ge -A\}$ is compact in $B(p,R)$\label{h-proper}
\end{subthm}


%\begin{subthm}{} $p$ is the point of strict maximum of $h$ on $B(p,R)$.\end{subthm}
\begin{subthm}{} \label{kl-reg}$h$ has a unique maximum in $B(p,R)\cap f^{-1}(v)$ for all $v\in \bar{I}^k(f(p),r) $.  Let $S$ denote the set of such maximum points.
\item $(f,h)$ is regular on $\left(\bar{I}^k(f(p),r) \cap B(p,R)\right)\backslash S$.
\end{subthm}
\end{thm}


As an immediate corollary we obtain

\begin{thm}{Corollary}\label{bilip}
Let $f\co X^n\to\R^n$ be an admissible map. Then $f$ is locally bi-Lipschitz on the set of its regular points $X_{reg}(f)$.
\end{thm}

\parit{Proof  of Corollary~\ref{bilip}.}

Let $p$ be a regular point of $f$.  By part a) of Lemma~\ref{lem-tight-diff}, $f$ is incomplementable at $p$. Let $h$ be the function in $B(p,R)$ provided by lemma~\ref{incompl}.  Then $(f,h)\co B(p,R)\backslash S\to\R^{n+1}$ is regular. However,  by part a) of Lemma~\ref{lem-tight-diff},  a map from $X^n$ to $\R^{n+1}$ can not have any regular points. Therefore $B(p,R)\backslash S=\emptyset$. By part (d) of Lemma \ref{incompl}, this is equivalent to saying that $B(p,R)\cap f^{-1}(v)$  consists of a single point for all $v\in \bar{I}^k(f(p),r)$  which means that $f$ is  injective near $p$. Finally, recall that being regular,  $f$ is both Lipschitz and co-Lipschitz near $p$, which together with local injectivity means that it is locally bi-Lipschitz on  $X_{reg}(f)$.\qeds

The proof of Key Lemma~\ref{incompl} will use the following easy observation

\begin{thm}{Lemma}\label{lem-rough-volume}
Let $\spc{L}\in \CBB{n}{0}$ and let $p\in \spc{L}$ be any point. Let $0<\e<R/3$.
Consider the annulus $A(R,\eps,p)=\{x\in\spc{L}| $ such that $R-\e< \dist{x}{p}{}<R+\e\}$. Let $\delta\ll \e$  ($\delta<\e/10$ will do) and let $\{z_1,\ldots z_N\}$ be al $\delta$-separated net in  $A(R,\eps,p)$. 
Then

\[
N\le \frac{c(n)R^{n-1}\e}{\delta^n}
\]
\end{thm}

where $c(n)$ is a universal constant depending only on $n$.
\parit{Proof.}
By changing the point $p$ slightly we can assume that $T_p\spc{L}\cong \R^n$. Then logarithms $\{\ddir{p}{z_1},\ldots \ddir{p}{z_N} \}$ give a $\delta$-separated net in the annulus $A(R,\eps,0)$ in $\R^n$ and the result follows.
\qeds
Note that this Lemma easily generalizes to arbitrary lower curvature bound (cf. \cite[Lemma 8.2]{BGP}).



\parit{Proof of Key Lemma~\ref{incompl}}

Without loss of generality we can assume that all components  $f_j$ of $f$ are $1$-Lipschitz and $\lambda_1$-concave  near $p$. 
%Furthermore, for simplicity we assume that all   $f_j$'s are actually concave near $p$ (the proof can be easily adapted to the general case of semiconcave $f_j$s) !!! I think I'll get rid of that assumption and just do the semiconcave case!!! .  
Since $f$ is regular at $p$ there is an $\e>0$ and a point $q$ near $p$ such that $f_j(q)>f_j(p)+\e \dist{p}{q}{}$ for all $j=1,\ldots,k$. Since $f_j$'s are  $1$-Lipschitz, for all $r$ near $p$ and all $x\in B(q,\e \dist{p}{q}{}/4)$ we have

\begin{equation}\label{eq:growth}
f_j(x)>f_j(r)+\e \frac{\dist{x}{r}{}}{4}
\end{equation}

Fix a small  positive $\delta\ll \e \dist{p}{q}{}$.  Choose a maximal collection of points $\{q_\a\}_{\a\in \mathfrak A}$ in $B(q,\e \dist{p}{q}{}/4)$ satisfying 

\begin{equation}\label{ineq:delta-sep}
\angk{\kappa}{p}{q_\alpha}{q_\beta}>\delta \quad\text{ for all } \alpha\ne \beta
\end{equation}
Of course, the same inequality holds for points $x$ near $p$.

Let $N=|\mathfrak A|$.
 A standard volume comparison argument  shows that 
\begin{thm}{Sublemma}\label{vol-est}

For all sufficiently small $\delta>0$ we have 
\begin{equation}\label{ineq:-delta-sep}
N\ge \frac{c_1}{\delta^{n-1}}
\end{equation}
 where $n=\dim \spc{L}$ and the constant $c_1$ depends on $n,\spc{L}, \eps, \dist{p}{q}{},\kappa$ but does not depend on $\delta$.
 \end{thm}
 \begin{proof}
 Indeed, let $\gamma(t)$ be a shortest geodesic from $q$ to $p$. Let $s=\gamma(\frac{\e \dist{p}{q}{}}{8})$.  Without loss of generality we can assume that $T_s\spc{L}\cong \R^n$. 
 Therefore we can complete it to a strutting  $(a^0,\dots,a^n)\in\spc{L}^{n+1}$ with $a_1=p$ and  
 \[\angk\kappa{s}{a^i}{a^j}>\tfrac{\pi}{2}+\tilde\eps.\]
 
 for some $\tilde\e>0$. Hence the map $\dist{\bm{a}}{}{}\:\spc{L}\to\RR^{n+1}$ is tight in a neighbourhood  of $s$ and the restricted map $H=\dist{\bm{a}^{\without 0}}{}{}\co \spc{L}\to\R^n$ is regular near $s$. Therefore, by the Inverse Function Theorem (~\ref{thm:inverse-function}) $H$ is an L-bilipschitz homeomorphism of the  ball $\oBall(s,R)$ for some $L,R>0$ onto an open subset of $\R^n$.
Since $p=a_1$ we have that $H$ maps $S(p,\dist{p}{q}{}-\frac{\e \dist{p}{q}{}}{8})\cap \oBall(s,R)$ onto an open set in a hyperplane in $\R^n$ and therefore for all small $\delta$  we can find at least $\frac{c_1'}{\delta^{n-1}}$ points $q_\alpha$ in $S(p,\dist{p}{q}{}-\frac{\e \dist{p}{q}{}}{8})\cap \oBall(s,R)$ with pairwise distances $\ge \delta$. This clearly implies that 
\[
\angk{\kappa}{p}{q_\alpha}{q_\beta}>c_1''\delta \quad\text{ for all } \alpha\ne \beta
\]
where $c_1''$ depends only on $\kappa$ and $\dist{p}{q}{}$.
This obviously yields the conclusion of  sublemma \ref{vol-est}. 
\end{proof}
\begin{thm}{Remark}
By part c) of  the Inverse Function Theorem (~\ref{thm:inverse-function}) it follows that the constants $L$ and $R$ (and hence also $c_1',c_1''$ and $c_1$) depend only on $\tilde\e,\kappa$, $\dist{\bm{a}}{s}{}$ and $\dist{p}{q}{}$ (in fact, as mentioned above, $c_1''$ depends only on $\kappa$ and $\dist{p}{q}{}$). Therefore the constant $c_1$ depends continuously on the space $\spc{L}$ in the Gromov-Hausdorff topology on $\CBB{m}{\kappa}$ (!!! to be clarified!!!). This fact is not needed in this section but it will be important in the proof of the Stability theorem.
\end{thm}


Next, consider the function $h=N^{-1}\Sigma_\a h_\a$ where $h_\a=\phi_\a(\dist{q_\a}{}{})$  and $\phi_\a\co \R\to \R$ is the unique continuous  function  satisfying the following properties

\begin{enumerate}
\item $\phi_\a'(t)=1$ for $t\le \dist{p}{q_\a}{}-\delta$;
\item $\phi_\a'(t)=1/2$ for $t\ge\dist{p}{q_\a}{}+\delta$;
\item $\phi_\a''(t)=-\frac{1}{4\delta}$ for $\dist{p}{q_\a}{}-\delta<t<\dist{p}{q_\a}{}+\delta$;
\item $\phi_a(\dist{p}{q_\a}{})=0$
\end{enumerate}

It is easy to see that 

\begin{equation}\label{h_alpha-lambda-concave}
\text{ $h_\a$ is $1$-Lipschitz and $\lambda_2$-concave near $p$ with $h_\a(p)=0$ for any } \alpha
\end{equation}
 where $\lambda_2>0$ depends only on the lower curvature bound $\kappa$ and $\dist{p}{q}{}$. 
 Therefore the same is obviously true for $h$.
 
 
 Let $\lambda=\max\{\lambda_1,\lambda_2\}$. Then
 
 \begin{equation}\label{h-lambda-concave}
 \text{  $h,h_\alpha$ and $f_i$ are  $\lambda$-concave near $p$.}
 \end{equation}
 It is also easy to see that $(h,f)$ is $\e/8$-tight near $p$. \label{e:grad}

\begin{thm}{Lemma}\label{lem:concave}

Under the above assumptions $h$ is strictly $c_2\delta^{-1}$-concave on $B(p,\delta)$ for all sufficiently small $\delta>0$ for some $c_2$ independent of $\delta$. 
 \end{thm}
 
 
\parit{Proof.}
First observe the following: Let $\xi \in \Sigma^{n}$ be a point
in a space $\Sigma\in \CBB{n}{1}$. Let $A(\pi/2,\nu,\xi) =\{ x \in
\Sigma \ |\  \pi/2-\nu \le\dist{x}{p}{} \le \pi/2+\nu\}$ where $\nu\ll 1$.

Let  $\{{z_i}\}_{i=1\dots M}$ be a $\delta$
-separated net in $A(\pi/2,\nu,\xi)$ .
Then by Lemma~\ref {lem-rough-volume}
\begin{equation}\label{v:1}
M \le \nu \frac{c_3(n)}{ \delta ^{n}}
\end{equation}


 Now let $x, z\in B(p,\delta)$ and  
let $y$
be the midpoint of a shortest geodesic from $x$ to $z$. Let $t=\dist{x}{y}{}$. 

We aim to prove that

\begin{equation}\label{ineq:str-concave}
2h(y)-h(x)-h(z)\ge c_2\delta^{-1}{\dist{x}{z}{}}^2
\end{equation}
for all small $\delta>0$.
Without loss of generality we can assume that geodesics from $y$ to all $q_\a$ are unique. If not we can move points $q_\a$ toward $y$ along some minimizing geodesics by arbitrary small amount $\eps$ and prove inequality \eqref{ineq:str-concave} for the modified function $h_\eps$.

For anyl $\nu>0$ and consider the set of indices
$I'$ such that for any $\a \in I'$ we have
 $|\cos \mangle\hinge {y} {q_{\alpha}}{ x}|>\nu$. And let $I''$ 
be the set of
indexes for which $|\cos \mangle\hinge {y} {q_{\alpha}}{ x}|\le
\nu$. Here $ \mangle\hinge {y} {q_{\alpha}}{ x}$ stands for the 
 angle between $yx$ and the shortest geodesic connecting $y$
and $q_{\alpha}$.

 Denote $N'=|I'|$ and
$N''=|I''|$.

Observe that $ \mangle\hinge {y} {q_\alpha} {q_\beta}\ge \angk{\kappa} {y} {q_\alpha}{q_\beta}\ge \delta$ by \eqref{ineq:delta-sep}.

Hence,  by $(\ref{v:1})$ applied to $\Sigma=\Sigma_y\spc{L}$ and $\xi=\dir{y}{x}\in \Sigma_y\spc{L}$ (which is unique by construction) it follows that $N''\le \nu
\frac{c_3(n)}{\delta^{n-1}}$. On the other hand,  according to \eqref{ineq:-delta-sep} the total number of points
 $N= N'+ N''$ satisfies $N \ge 
c_1\delta^{1-n}$. Therefore
\begin{equation}\label{e:3}
N''/N \le \nu/c_4 \text{ and } N'/N \ge
1-\nu/c_4
\end{equation}

with $c_4=\frac{c_3}{c_1}$.

Fix a small $\nu>0$ satisfying
\begin{equation}\label{e:4}
\nu/c_4 \le 1/2
\end{equation}

Now we are going to give two separate concavity estimates for
$h_\alpha$ along $xz$: one for  $ \alpha \in
I'$ and  the other one for $ \alpha \in I''$.

First, choose  any   $ \alpha \in I'$. In this case, for all sufficiently small $\delta$
we have the following estimate:
\begin{equation}\label{e:5}
2h_\alpha(y)-h_\alpha(x)-h_\a(z) \ge 
\frac{\nu^2}{16\delta}{\dist{x}{z}{}}^2
\end{equation}
Indeed, by construction of $I'$, we have
$|\cos \mangle\hinge {y} {q_{\alpha}}{ x}|>\nu$.
Consider, for example, the case when $\cos \mangle\hinge {y} {q_{\alpha}}{ x}>\nu$. (The  case $\cos \mangle\hinge {y} {q_{\alpha}}{ x}<-\nu$ is treated similarly by
reversing the roles of $x$ and $z$). By the triangle comparison we
obtain:
\[
\dist{x}{q_\alpha}{} \le \dist{y}{q_\alpha}{} -\nu t+c_5t^2 \text{ and }  \dist{z}{q_\alpha}{} \le \dist{y}{q_\alpha}{} +\nu t+c_5t^2\]
where $c_5$  depends only on the lower curvature bound $\kappa$ and $\dist{p}{q}{}$.  Next observe that by construction,
$\phi_{\alpha}(s)$  is 1-Lipschitz, monotone for all $s$ and  is strictly
$\frac{1}{4\delta}$ concave with constant second derivative for
$\dist{p}{q_\alpha}{}-\delta < s<\dist{p}{q_\alpha}{}+\delta$. Hence,


\[
 \phi_{\alpha}(\dist{y}{q_\alpha}{} -\nu t+c_5t^2) \le  \phi_{\alpha}(\dist{y}{q_\alpha}{} -\nu t)+c_5t^2
\]
\[
= 
\phi_{\alpha}(\dist{y}{q_\alpha}{})-\phi_{\alpha}'(\dist{y}{q_\alpha}{})(\nu 
t)-1/({8\delta})(\nu t)^2+c_5t^2\]

 which for sufficiently 
small $t$ implies
\[h_\alpha(x) \le  \phi_{\a}(\dist{y}{q}{} -\nu 
t+c_5t^2)\le \phi_{\a}(\dist{y}{q}{}-\phi_{\a}'(\dist{y}{q}{})(\nu t) 
-\left(\frac{\nu^2}{8\delta}-c_5\right)t^2 \]
\[
=h_\a(y)- \phi_{\a}'(\dist{y}{q}{})(\nu t) 
-\left(\frac{\nu^2}{8\delta}-c_5\right)t^2
\]
Similarly,
\[
h_\a(z) \le h_\a(y)
+ \phi_{\a}'(\dist{y}{q}{})(\nu t) 
-\left(\frac{\nu^2}{8\delta}-c_5\right)t^2
\]
Adding these two inequalities we immediately obtain $(\ref{e:5})$  provided $\delta$ is chosen to be $<\frac{\nu^2}{16c_5}$.
So we have a good concavity estimate for $h_\a$ along $xz$ for any $ \alpha \in I'$. For
the rest of the indices ~\eqref{h_alpha-lambda-concave} implies that
$h_\a$ is $\lambda_2$-concave and therefore
\begin{equation}\label{e:6}
2h_\alpha(y)-h_\alpha(x)-h_\a(z) \ge -\lambda_2{\dist{x}{z}{}}^2
\end{equation}
 for some $\lambda_2$ independent of $\delta$ and all $\a\in I''$.
Combining $(\ref{e:5})$ and $(\ref{e:6})$ we get
\[
2h(y)-h(x)-h(z)
\ge \frac{N'}{N}\frac{\nu^2}{16\delta}{\dist{x}{z}{}}^2
-\frac{N''}{N}\lambda_2{\dist{x}{z}{}}^2 \]

 Finally, by $(\ref{e:3})$ and  $(\ref{e:4})$   this last inequality  implies that for all sufficiently small 
$\delta >0$ we have
\[
2h(y)-h(x)-h(z) \ge ((1-\frac{ \nu} {c_4})\frac{\nu^2}{16\delta}-\frac{\nu}{c_4}\lambda_2){\dist{x}{z}{}}^2
\ge c_2\delta^{-1}{\dist{x}{z}{}}^2
\]

as promised with $c_2=\frac{\nu^2}{32\lambda_2}$.
\qedsf 
 
 
Denote $\Sigma_p^\e=\{\xi\in \Sigma_p \quad |\quad \d_pf_j(\xi)>\e \text{ for all } j=1,\ldots,k\}$.

It easily follows from the definition that  $f$ is incomplementable at $p$ iff $\diam (\Sigma_p^0)\le \pi/2$.

\begin{thm}{Sublemma}\label{estimate}
If $\diam (\Sigma_p^0)\le \pi/2$ then for all $r\in B_p(\delta)$ we have

\begin{equation}\label{e:estimate}
h(r)\le h(p)-c\cdot \dist{p}{r}{}+c\cdot \max_j\{0,f_j(p)-f_j(r)\}
\end{equation}

\end{thm}


\begin{proof}
Since $h$ is $1$-Lipschitz and $f$  is $\e$-co-Lipschitz, by using Lemma~\ref{lem-tight-diff} it is sufficient to prove the Sublemma for $r\in B(p,\delta)$ satisfying $f_j(r)\ge f_j(p)+\lambda{\dist{p}{r}{}}^2$ for all $j=1,\ldots,k$. Since $f_j$ is $\lambda$-concave for all $j$ this guaranties  that  $\Dir{p}{r}\subset \Sigma_p^0$. By \eqref{eq:growth} we also have that $\Dir{p}{q_\a}\subset \Sigma_p^0$ which by assumption of the sublemma implies that 
 that $\angle \Dir{p}{r} \Dir{p}{q_\a} \le \pi/2$ for all $\a$.  (This is the only place in the proof where we use that  $\diam (\Sigma_p^0)\le \pi/2$ i.e that $f$ is incomplementable at $p$). This means that the derivative of $h_\a$ at $p$ in the direction of $r$ is $\le 0$. By semi-concavity of $h_\a$ this implies
\begin{equation}\label{e:1}
h_\a(r)\le h_\a(p)+\frac{\lambda}{2} \cdot  {\dist{p}{r}{}}^2
\end{equation}
\begin{comment}
Moreover,  a volume comparison argument (cf~\cite{Per-Morse} or ~\cite[Lemma 4.2]{Kap} )  shows that for most $\a\in \mathfrak A$ we actually have $\angle \Dir{p}{r} \Dir{p}{q_\a} \le \pi/2-const$.
\end{comment}
As in the proof of  Lemma~\ref{lem:concave} this estimate can be improved for most points $q_\alpha$.

Indeed, recall that $N\ge \frac{c_1}{\delta^{n-1}}$.

Fix a small $\mu>0$ satisfying  $\mu<\frac{c_3}{2}$ where $c_3$ is the constant from the proof of Lemma ~\ref{lem:concave} . By the first variation formula and semi-concavity of $h_\a$  we see that  if $\angle \Dir{p}{r} \Dir{p}{q_\a} \le \pi/2-\mu$ then  

\begin{equation}\label{b1}
h_\a(r)\le h_\a(p)+\frac{\lambda}{2}  \cdot {\dist{p}{r}{}}^2-\frac{1}{2}\mu \cdot \dist{p}{r}{}
\end{equation}

 Let  $I_r'$ be the set of $\alpha$'s such  $\angle \Dir{p}{r} \Dir{p}{q_\a} \le \pi/2-\mu$ and $I_r''$ be the set of $\alpha$'s with $ \pi/2-\mu < \angle \Dir{p}{r} \Dir{p}{q_\a} \le \pi/2$.
Again, let $N'_r=|I_r'|$, $N_r''=|I_r''|$.

Exactly the same argument as in the proof \eqref{e:3} our choice of $\mu$ implies that  $\frac{N_r'}{N}\ge \frac 1 2$ .

By the definition of $h$ and \eqref{e:estimate} and \eqref{b1} this gives

\[
h(r)\le h(p)+\frac{\lambda}{2}  \cdot {\dist{p}{r}{}}^2-\frac{1}{4}\mu \cdot \dist{p}{r}{}\le h(p)-c\cdot  \dist{p}{r}{}
\]

with $c=\frac{\mu}{8}$ provided $\delta<\frac{\mu}{4\lambda}$.
\begin{comment}

A standard volume comparison argument shows that  the $(n-1)$-volume of the set 

$A_\mu=\{\xi\in\Sigma_p$ such that $ \pi/2-\mu \le \angle \xi  \Dir{p}{r}\le \pi/2\}$ is bounded above by $c\mu$.   By another standard volume comparison this implies that the maximal number of points in $A_\mu$ with pairwise angles  $\ge \delta$ is at most $c\mu\delta^{1-n}$.

This means that if $\mu\ll c$ then  for  the vast majority of $q_\a$ we must have $\angle  \Dir{p}{r} \Dir{p}{q_\a} \le \pi/2-\mu$.
\end{comment}



\end{proof}


Sublemma~\ref{estimate} obviously implies that  inside $B(p,\delta)$ the  sets $\{h\ge -c\delta\}\cap f^{-1}(v)$ are compact for all $v$ close to $f(p)$ which proves \eqref{h-proper}.

To finish the proof of  the Key Lemma~ (\ref{incompl}) it  remains to verify \ref{kl-reg}.
For any $v\in \R^k$ denote $U_v=B(p,\delta)\cap f^{-1}(v)$ and $U_v^+=\{x\in B(p,\delta)\quad |\quad f_j(x)\ge v_j \text{ for all } j=1,\ldots,k\}$

\begin{thm}{Sublemma}\label{max-fibers}
Let $v\in\R^k$ satisfy  $|f_j(p)-v_j|\le \delta^2, j=1,\ldots, k$.

Let $z\in U_v$ be a point of maximum of $h$ on $U_v$.
Then for every $x\in U_v\cap B(p,\delta/2)$ we have
\[
h(z)\ge h(x)+c\delta^{-1}{\dist{x}{z}{}}^2
\]

\end{thm}



\begin{proof}

First we notice that
\begin{equation}\label{max}
\max_{U_v^+} h=\max_{U_v^+\cap \bar{B}(p,\delta/2)} h=\max_{U_v \cap \bar{B}(p,\delta/2)} h=h(z)
\end{equation}

The first and the last equalities follow from Sublemma~\ref{estimate} and the fact that $h$ is $1$-Lipschitz and $f$ is $\e$-co-Lipschitz.
If the equality in the middle is violated, then there exists a maximum point $r\in U_v^+\cap \bar{B}(p,\delta/2)$ such that $f_l(r)>v_l$ for some $l$. By applying \ref{incr-decr-all} to $\d_rh, \d_r f_j$ in $\Sigma_rX$ we can find a direction $\xi\in \Sigma_rX$ such that $\d_rh(\xi)>0$ and $\d_rf_j(\xi)>0$ for all $j\ne l$. This contradicts the fact that $r$ is a point of maximum of $h$ on $ U_v^+\cap \bar{B}(p,\delta/2)$. This proves~\eqref{max}.

Now consider the midpoint $y$ of a shortest curve connecting $x$ and $z$. By $\lambda$-concavity of $f_j$ and strict concavity of $h$ we get

\begin{equation}\label{p2}
h(y)\ge \frac{h(x)+h(z)}{2}+c\delta^{-1}{\dist{x}{z}{}}^2, \text{ and }
\end{equation}
\[
 f_j(y)\ge f_j(z)-{\lambda}{\dist{x}{z}{}}^2 \text{ for all } j=1,\ldots,k
\]

Because $f$ is  $\e$-co-Lipschitz, we can find a point $y'$ such that $\dist{y}{y'}{}\le \frac{\lambda {\dist{x}{z}{}}^2}{\e}$ and 
\[
 f_j(y')\ge f_j(z) \text{ for all } j=1,\ldots,k
\]
In particular $y'\in U_v^+$ and therefore $h(y')\le h(z)$. 
On the other hand, since $h$ is 1-Lipschitz, by above we get 

\begin{equation}\label{e:split}\begin{split}
&h(y')\ge h(y)-\dist{y}{y'}{}\ge h(y)-\frac{\lambda {\dist{x}{z}{}}^2}{\e}\overset{\text{ by \eqref{p2} }}{\ge}\\ 
& \frac{h(x)+h(z)}{2}+c\delta^{-1}{\dist{x}{z}{}}^2 -\frac{\lambda {\dist{x}{z}{}}^2}{\e}\ge \frac{h(x)+h(z)}{2}+\tilde c\delta^{-1}{\dist{x}{z}{}}^2
\end{split}\end{equation}

 where the last inequality holds since $\e,\lambda$ are fixed and $\delta$ can be taken arbitrary small.




Combining this with $h(y')\le h(z)$ we immediately get the statement of Sublemma~\ref{max-fibers}.



\end{proof}



To complete the proof of Lemma~\ref{incompl} it remains to verify (d).

Let $z\in U_v\cap B(p,\delta)$ be the point of maximum of $h$ on $U_v$. For any other point $x\in U_v$, connect $x$ to $z$ by a shortest geodesic $\gamma$  and let $s$ be a point on $\gamma$ close to $x$.
By Sublemma~\ref{max-fibers} we have that 

\[h(s)>h(x)+c\delta^{-1}{\dist{x}{s}{}}^2
\]
and since both $z,x\in U_v$, by $\lambda$-concavity of $f$ we have that

\[
f_j(s)>f_j(x)-\lambda{\dist{x}{s}{}}^2
\]
for any $j=1,\ldots k$.

Since $f$ is $\e$-co-Lipschitz we can find a point $s'$ such that $\dist{s}{s'}{}<\frac{4\lambda{\dist{x}{s}{}}^2}{\e}$ and $
f_j(s')>f_j(x)+4\lambda{\dist{x}{s}{}}^2$.

Also, since $h$  is $1$-Lipschitz we have that 

\[h(s')>h(x)+c\delta^{-1}{\dist{x}{s}{}}^2-\frac{4\lambda{\dist{x}{s}{}}^2}{\e}>h(x)+\frac{c}{2}\delta^{-1}{\dist{x}{s}{}}^2
\]



Let $\xi=\dir{x}{s'}$.  By concavity of $h$ and $\lambda$-concavity of $f_j$'s it is obvious that $\d_xh(\xi)>0$ and $\d_xf_j(\xi)>0$ for all $j$. Combined with (\ref{e:grad}) this means that $(f,h)$ is regular at $x$.

\qeds

Key Lemma (~\ref{incompl}) easily yields the local fibration theorem (~\ref{fibration})

\begin{proof}[Proof of Theorem~\ref{fibration}]


We argue by reverse induction in $k$.  If $k>n$ then the set of regular points is empty by Lemma~\ref{dim-ineq-strut} and there is nothing to prove. Suppose $k\le n$ and the theorem has been proved for $k+1$.
 Let $f\co X\to \R^k$ be regular at $p\in X$.
If $f$ is complementable at $p$ the statement follows by the induction assumption. Suppose $f$ is incomplementable at $p$. Let $h$ be the function provided by Lemma~\ref{incompl}. 
\begin{comment}Suppose for simplicity that $h$ is identically zero on $S$. 
Let $U= f^{-1}\left(\bar{I}^k(f(p),r) \right)\cap\{-A<h<0\}\cap B(p,R)$ and $W=f^{-1}\left(\bar{I}^k(f(p),r) \right)\cap\{-A<h\le 0\}\cap B(p,R)$

Then $U=W\backslash S$ and $(f,h)$ is regular on $U$. Therefore the  local fibration theorem holds for $(f,h)$ on $U$ by induction assumption.  

By Lemma~\ref{incompl}, $(f,h)$ is proper on $U$ and hence, 
$(f,h)\co U\to \bar{I}^k(f(p),r)\times (-A,0)$ is a  bundle map by~\cite[6.10]{Sieb}. This means that
$U$ is homeomorphic to $F\times  \bar{I}^k(f(p),r)\times (-A,0)$ respecting $(f,h)$ where $F$ is an MCS-space of $\dim=n-k-1$. By Lemma~\ref{incompl}, we can extend this homeomorphism to
a homeomorphism $W\to KF\times \bar{I}^k(f(p),r)$ which proves the induction step.

The general case when $h$ is not  constant on $S$ is handled  by constructing an auxiliary function $\tilde h$ obtained by shifting $h$ by constants on each of the fiber of $f$ to make it identically zero on $S$. 
\end{comment}


 As in the proof of Lemma~\ref{incompl}  for any $v\in\R^k$ we set $U_v=B(p,\delta)\cap f^{-1}(v)$.
 By  \eqref{kl-reg} $h$ has a unique point of maximum  in $B(p,R)\cap f^{-1}(v)$ for all $v\in \bar{I}^k(f(p),r) $.  Again let $S$ denote the set of such maximum points.
 
 
Let $g (v)=\max_{x\in U_v}h(x)$ and set $\tilde h(x)=h(x)-g(f(x))$. 
Note that $\tilde h|_S=0$ by construction. 
Also,  since $f$ is $L(\e)$-co-Lipschitz 
and $h$ is 1-Lipschitz, 
$g$ is $\frac{1}{L(\e)}$-Lipschitz 
and $\tilde h$ is $\frac{2}{L(\e)}$-Lipschitz.
 
 We claim that $(f,\tilde h)$ is admissible. Indeed $(f,\tilde h)=G\circ (f,h)$ where $G\?\R^{k+1}\to\R^{k+1}$ is  given by $G(v,t)=(v, t-g(v))$.
 By above $G$ is $C(\e,n)$-Lipschitz and so is $G^{-1}$ which is equal to  $G^{-1}(v,t)=(v, t+g(v))$.
 This is the place where we make use of allowing compositions with bilipschitz homeomorphisms of $\R^k$ in the definition of an admissible map.
 
Again by  \eqref{kl-reg}, $(f, h)$ is  regular on $U$. Therefore it's a local fibration on $U$   by the induction assumption and hence the same is true for $(f,\tilde h)=G\circ (f,h)$.  By the induction assumption the fibers of   $(f,\tilde h)$ are $MCS$-spaces. Since  $(f,\tilde h)$ is proper on $U$, by Theorem ~\ref{local bundle}\ we conclude that   $(f,\tilde h)\co U\to \bar{I}^k(f(p),r)\times (-A,0)$ is a global  bundle map by~\cite[6.10]{Sieb} with $MCS$-fibers. This means that
$U$ is homeomorphic to $F\times  \bar{I}^k(f(p),r)\times (-A,0)$ respecting $(f,\tilde h)$ where $F$ is an MCS-space of $\dim=n-k-1$. By Lemma~\ref{incompl}, we can extend this homeomorphism to
a homeomorphism $W\to KF\times \bar{I}^k(f(p),r)$ in an obvious way (by mapping points of $x\in S$ to $o\times f(x)$ where $o$ is the vertex of $KF$).


This proves the induction step and concludes the proof of Theorem~\ref{fibration}.


\end{proof}

 \begin{thm}{Corollary}\label{sphere-neighb}
 Let $\spc{L}\in \CBB{\kappa}{n}{}$ and let $p\in \spc{L}$ be any point. Then there exists $\eps>0$ such that for any $0<r\le\eps$ the sphere $S(p,r)$ is homeomorphic to $S(p,\eps)$ and $(B(p,r),p)$ is homeomorphic to the cone $(CS(p,\eps),o)$
 \end{thm}
\begin{proof}
By ??? (is this proved somewhere yet?) there is $\eps>0$ such that  $f=\dist{p}{}{}$ has no critical points in $B(p,2\eps)\backslash\{p\}$. Therefore by the Fibration Theorem ~\eqref{fibration}, it's a bundle map from $B(p,2\eps)\backslash\{p\}$ to $(0,2\eps)$. This easily yields the result.
\end{proof}
It will follow from the Stability Theorem that under the assumptions of Corollary ~\ref{sphere-neighb}, $S(p,\eps)$ is homeomorphic to $\Sigma_p\spc{L}$ if $\eps$ is sufficiently small but we can no claim this yet.
Once this is proved we can derive the following result (??? can this be proved without using stability???)

\begin{thm}{Theorem}\label{top-char--bry}
Let $\spc{L}\in \CBB{\kappa}{n}{}$. Then a point $p\in \spc{L}$ belongs to $\partial \spc{L}$ if and only its pointed conical neighborhood has nonempty codimension 1 strata.
\end{thm}
\begin{proof}
We proceed by induction on the dimension of $\spc{L}$. The base of induction is trivial.
Suppose the claim has been proved for Alexandrov spaces of $\dim\le n-1$ and $\spc{L}\in \CBB{\kappa}{n}{}$. Let $p\in \partial \spc{L}$. By the definition of the boundary that means that $\Sigma=\Sigma_p\spc{L}$ has a boundary. By the induction assumption this means that $\Sigma$ has nonempty codimension 1 strata. Therefore, by Lemma~\ref{n-1-strat} $K(\Sigma)$ also has nonempty codimension 1 strata. Since $K(\Sigma)$ is homeomorphic to the pointed neighborhood of $p$ in $\spc{L}$ this concludes the proof of the only if implication.

Now suppose $p\notin \partial \spc{L}$. Then $\Sigma=\Sigma_p\spc{L}$ has no boundary and hence, by the induction assumption $\Sigma$ has empty codimension 1 strata. Again by Lemma ~\ref{n-1-strat} this implies that $K(\Sigma)$ has empty codimension one strata.
\end{proof}
Since  the set of points whose conical neighborhoods have empty codimension 1 strata is obviously open we immediately obtain the following
\begin{thm}{Corollary}\label{top=geom-bry}
Let $\spc{L}\in \CBB{\kappa}{n}{}$. Then $\partial \spc{L}$ is equal to the closure of the $n-1$-dimensional strata of $\spc{L}$ as an $MCS$ space. In particular,
$\partial \spc{L}$ is closed.
\end{thm}

\begin{thm}{Grove-Petersen Theorem}\label{grove-pet}
Let  $\spc{L}\in \CBB{\kappa}{n}{}$ be compact connected and without a boundary. 
Then $\spc{L}$ has a fundamental class in Alexander-Spanier cohomology with $\ZZ_2$ coefficients, i.e. $\bar H^{n}(\spc{L},\ZZ_2)\cong \ZZ_2$. 

Also, If $\spc{L}$ is orientable, then   $\bar H^{n}(\spc{L},\ZZ)\cong \ZZ$. 


\end{thm}
\begin{proof}
By Theorem \ref{top-char--bry} $\spc{L}$ has no codimension 1 start. Also, since $\spc{L}$ is connected its top dimensional strata $\spc{L}_n$ is connected also (note that this need not be the case for a general  compact connected $MCS$-space without boundary). In fact $\spc{L}_n$ contains a dense {\it convex} set of points which have tangent cones isometric to $\RR^n$.
Therefore Lemma~\ref{top-gr-pet} applies 
and we can conclude that  $\bar H^{n}(\spc{L},\ZZ_2)\cong \ZZ_2$.
The orientable case is handled in the same way.
\end{proof}

\begin{thm}{Corollary}
Let $\spc{L}\in \CBB{\kappa}{n}{}$ be connected and without boundary.
Let $f\: \spc{L}\to\RR$ be a multidistance function
\end{thm}

\section{Homotopy lifting theorem}

The main result of such type is the result in
\cite{perelman:collapsing}. 
It roughly states that a collapsing to a compact
space without proper extremal subsets carries a natural Serre bundle structure.

This theorem is analogous to  the following:

\begin{thm}{Yamaguchi's fibration theorem
\cite{yamaguchi:bundle}}
Let $\spc{L}_n\in\CBB{m}{\kappa}$ and $\spc{L}_n\GHto M$, $M$ be a Riemannian manifold.

Then there is a sequence of locally trivial fiber bundles $\sigma_n\:\spc{L}_n\to M$.
Moreover, $\sigma_n$ can be chosen to be \emph{almost submetries}\footnote{i.e. Lipshitz and co-Lipschitz with constants almost 1.} and the diameters of
its fibers converge to $0$.
\end{thm}

The conclusion in Perelman's theorem is weaker, but on the other hand it is just
as good for practical purposes. 
In addition it is sharp, i.e. there are examples of a collapse to spaces with
extremal subsets which do not have the homotopy lifting property. 
Here is a source of examples: take a compact Riemannian manifold $M$ with an isometric and
non-free action by a compact connected Lie group $G$, then 
$(M\times [\eps\blow G])/G\GHto M/G$ as $\eps\to0$ and since the curvature of $G$ is non-negative, by
O'Naill's formula, we get that the curvature of $(M\times [\eps\blow G])/G$ is uniformly bounded
below.

\begin{thm}{Homotopy lifting theorem}
\label{thm:per-ser} Let $\spc{L}_n\GHto \spc{L}$, $\spc{L}_n\in\CBB{m}{\kappa}$, $\spc{L}$ be compact
without proper extremal subsets and $K$ be a finite simplicial complex. 

Then, given a homotopy 
\[F_t\:K\to \spc{L},\ \ t\in [0,1]\] 
and a sequence of maps 
$G_{0;n}\:K\to \spc{L}_n$ such that $G_{0,n}\to F_0$ as $n\to\infty$ one can extend
$G_{0;n}$ by homotopies 
\[G_{t;n}\:K\to \spc{L}\]
such that $G_{t;n}\to F_t$ as $n\to\infty$.
\end{thm}

An alternative proof is based on Lemma~\ref{lem:hom-approx}.


\begin{thm}{Remark}\label{rem:hom-seq} {\rm 
As a corollary of this theorem one obtains that for all large $n$
it is possible to write a homotopy exact sequence:

\[\cdots\longrightarrow\pi_\kay(F_n)
\longrightarrow\pi_\kay(\spc{L}_n) \longrightarrow\pi_\kay(\spc{L}) 
\longrightarrow\pi_{\kay-1}(F_n)\longrightarrow\cdots,\]
where the space $F_n$ can be obtained the following way:
Take a point $p\in \spc{L}$, and fix $\eps>0$ so that $\dist{p}{}{}\:\spc{L}\to\RR$ has no critical values
in the interval $(0,2\cdot\eps)$. 
Consider a sequence of points $\spc{L}_n\ni p_n\to p$ and take 
$F_n=\oBall(p_n,\eps)\subset \spc{L}_n$.
In particular, if $p$ is a regular point then for large $n$, $F_n$ is homotopy
equivalent to a \emph{regular fiber over $p$}\footnote{\label{reg-fib} It is constructed the
following way: take a distance chart $G:\oBall(p,{2\cdot\eps})\to \RR^{k}$, $k=\dim \spc{L}$ around $p\in \spc{L}$
and lift it to $\spc{L}_n$. 
It defines a map $G_n:\oBall(p_n,\eps)\to\RR^k$.
Then take
$F_n=G_n^{-1}\circ G(p)$ for large $n$. 
If $\spc{L}_n$ are Riemannian then $F_n$ are manifolds and they do not depend on $p$ up to a homeomorphism.
Moreover, $F_n$ are almost non-negatively curved in a generalized sense; see \cite[definition 1.4]{KPT}.}. }
\end{thm}

\section{DC-functions and maps}

Let $\spc{L}\in\CBB{}{\kappa}$, $\Omega\subset \spc{L}$ be an open subset and $f:\Omega\to\RR$ be a semiconcave function.
A vector $v\in \T_p^\o$ is called supporting vector of $f$ at $p$ if for any $w\in \T_p^\o$, we have
\[\d^\o_pf(w)\le -\<v,w\>.\]
The set of all supporting vectors at $p$ will be denoted by $\partial_pf$ forms??? a convex subset in $\T_p^\o$.

In general, the set of supporting vectors at $p\in \Omega$ might be empty;
take for example $\spc{L}=[0,1]$ and $f(x)=x$, $p=0$.

\begin{thm}{Definition}
Let $\spc{L}\in\CBB{}{\kappa}$, $\Omega\subset \spc{L}$ be an open subset, a semiconcave function $f:\Omega\to\RR$ is called inner, if for any point $p\in \Omega$ there is a supporting vector.
\end{thm}

Let $f:\Omega\to\RR$ be a DC-function.
A point $p\in\Omega$ is called regular point of $f$ if there is a representaion $f=a-b$, where $a$ and $b$ are inner semiconcave functions and for any pair $v_a\in\partial_pa$ and $v_b\in\partial_pb$, we have $\<v_a,v_b\><0$.
In case if there is no such representation, the point $p$ is called critical point of $f$.

The set of regular points of $f$ forms an open set (why???).
Moreover if $f_n\:\spc{L}_n\to \RR$ DC-converges to a $f\:\spc{L}\to\RR$ and $p\in \spc{L}$ is a regular point of $f$ then all points in a seqence $A_n\ni p_n\to p$ for sufficiently large $n$ are regular points of $f_n$ (why???)

Let $\spc{L}_n\to \spc{L}_\o$ 
and $\spc{L}_n\ni p_n\to p_\o\in \spc{L}_\o$ as $n\to\o$.
Given a bounded seqeunce of vectors $v_n\in T^?_{p_n}$ consider corresponding radial curves $\gamma_n(t)=\gexp_{p_n}(t\cdot v_n)$.
Set $\gamma_\o(t)=\lim_{n\to\o}\gamma_n(t)$.
Clearly???, for some $v_\o\in T^?_p$, we have $\gamma_\o(t)=\gexp_{p_\o}(t\cdot v_\o)$.
In this case we say that $v_n\to v_\o$ as $n\to\o$.

Note that if for a two bounded sequences of vectors $v_n,w_n\in \T_{p_n}$ we have $\<v_n,w_n\>\le 0$ 
then $\<v_\o,w_\o\>\le 0$

\section{Exercises}


\begin{thm}{Domain invariance}
Let $\spc{L},\spc{M}\in \CBB{m}{}$,
$\Omega\subset\spc{L}\backslash\partial\spc{L}$ be an open set
and $f\:\Omega\to\spc{M}$ be a continuous injective map.
Prove that $f$ is open.
\end{thm}

\begin{thm}{Problem}
Show that any space $\spc{L}\in \CBB2{}$ is homeomorphic to a manifold with boundary. 
\end{thm}

\begin{thm}{Problem}
Show that for any space $\spc{L}\in \CBB3{}$ 
there is $\spc{M}\in \CBB3{}$ with an isometric involution $\phi\:\spc{M}\to \spc{M}$
such that 
\begin{subthm}{}
$\spc{L}\iso\spc{M}/_{\phi(x)\sim x}$
\end{subthm}
\begin{subthm}{}
$\spc{M}$ is homeomorphic to a manifold with boundary
\end{subthm}
\begin{subthm}{}
$\phi$ has only isolated fixed points.
\end{subthm}

\end{thm}




