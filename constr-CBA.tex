\chapter{Convexity, curvature bounded above}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Convex sets and projection}



Part (\ref{SHORT.distance-to-convex}) of  the next theorem should be compared to the theorem on distance to the boundary of a $\Alex{}{}$-space (\ref{thm:dist-to-bry}).


%Recall that $\cBall[K,\tfrac{\varpi\kappa}{2}]$ denotes the closed tubular neighborhood of radius $R$ about $K$ (\ref{sec:metric spaces}).



\begin{thm}{Theorem on distance to a convex set} 
\label{thm:retract-to-convex} 
Suppose $\spc{U}$ is  a complete  length space satisfying with curvature $\le\kappa$.  Let  $A\subset\spc{U} $  be a closed totally $\varpi\kappa$-convex subset. 
Then:

\begin{subthm}{footpoint}
There is a continuous map 
$$f_A\: \oBall[A,\tfrac{\varpi\kappa}{2}]\to A$$
	such that  $f_A(x)$ is the unique closest  point of $x$ to $A$. 
%For any $x\in \cBall[K,\tfrac{\varpi\kappa}{2}]$, there is a unique closest  point of $x$ to $K$ (called the \emph{footpoint of $x$ on $K$}, 
%denoted here by $f_K(x))$.  
Moreover, there is a unique geodesic from $x$ to $f_A(x)$, and this geodesic depends continuously on $x$.  \end{subthm}

%\begin{subthm}{retract-to-convex}
%If $\kappa\le 0$, $K$ is a short retract under $f_K$  of $\cBall[K,\tfrac{\varpi\kappa}{2}]$; that is, the footpoint map  
%\[f_K\:\cBall[K,\tfrac{\varpi\kappa}{2}]\to K
%\]
%is a short map that is identical on $K$.

%Moreover $K$  is a strictly short retract under $f_K$ of $\oBall[K,\tfrac{\varpi\kappa}{2}]$; that is, 
%for any $x\in K$ and $y\notin K\cap\oBall[K,\tfrac{\varpi\kappa}{2}] $, we have 
%\[\dist{f_K(y)}{x}{}<\dist{y}{x}{}.\]
%\end{subthm}

\begin{subthm}{distance-to-convex}
Set
$f=\sn{\kappa}\circ\dist{A}{}{}.$
Then the  restriction of $f$ to  $\oBall[A,\tfrac{\varpi\kappa}{2}]$  satisfies \[f''+\kappa\cdot f\ge 0%\eqlbl{eq:dist-convex}
 .\]
In particular, if $\spc{U}$ is a complete  length space  with curvature $\le0$, and $A\subset\spc{U}$  is  totally convex, then the  function
$f= \dist{A}{}{}$
is convex on $\spc{U}$.
\end{subthm} 

\begin{subthm}{short-retract} 
If $\kappa\le 0$,
%$A\subset \oBall(p,\tfrac{\varpi\kappa}{2})$, 
then $f_A$ is a strictly short retraction of $\spc{U}$ onto $A$;
that is, $f_A$ is a short map
that is identical on $A$, such that for any $x\in A$ and $y\notin A$ we have 
\[\dist{x}{f_A(y)}{}<\dist{x}{y}{}.\]
 % If $\kappa \le 0$, then $f_A$ is a short retraction of $\spc{U}$ onto $A$.
 \end{subthm}
\end{thm}
\parit{Proof; (\ref{SHORT.footpoint}).}
By the Lifting globalization theorem  \ref{thm:globalization-lift}, for any  $p\in\spc{U}$
 there is a space $\spc{B}_p\in\Cat{}{\kappa}$, where $\spc{B}_p=\oBall[\hat p,\varpi\kappa/2]$ for some $\hat p \in \spc{B}$,
and a locally isometric map $\map_p\:\spc{B}_p\to\spc{U}$
with $\map(\hat p)=p$ and the following lifting property: 
for any curve $\alpha\:[0,a]\to\spc{U}$ with $\alpha(0)=p$ and $\length\alpha\le\varpi\kappa/2$,
there is a unique curve $\hat\alpha \:[0,a]\to \spc{B}_p$ such that $\hat\alpha (0) = \hat p$ and $\map_p\circ\hat\alpha=\alpha$.

%Let $\map\: \hat {\spc{U}}\to\spc{U}$
%be the simply connected metric covering.
%By the Hadamard--Cartan theorem
%(\ref{thm:hadamard-cartan}), $\hat {\spc{U}}\in\Cat{}{0}$.  The map $\map$ is a local isometry and has  the lifting property; that is,
%for any $x \in \spc{U}$ and $\hat x \in \hat {\spc{U}}$ such that $\map (\hat x) = x$, and any path $\alpha\:[0,1]\to\spc{U}$ such that  $\alpha(0)=x$, 
%there is a unique path $\hat\alpha \:[0,1]\to \hat{\spc{U}}$ such that $\hat\alpha(0)=\hat x$ 
%and $\map\circ\hat\alpha=\alpha$.

Fix $p\in \oBall[A,\tfrac{\varpi\kappa}{2}]$. 
Set $\hat A_p= (\map_p)^{-1}(A)$.

If $\hat\gamma$ is a geodesic of $\spc{B}_p$  with endpoints in $\hat A_p$, then $\length \hat\gamma < \varpi\kappa$, and $\map_p\circ\hat\gamma$ is a local geodesic of the same length in $\spc{U}$ with endpoints in $A$.  Since  $A\subset\spc{U} $  is totally $\varpi\kappa$-convex,  $\map_p\circ\hat\gamma$ lies in $A$.  Therefore $\hat\gamma$ lies in $\hat A_p$, and   $\hat A_p$ is a convex subset of  $\spc{B}_p$.  

Since $\map_p$ is a local isometry,  $\dist{\hat A_p}{\hat p}{\spc{B}_p} \ge \dist{A}{p}{\spc{U}}$.  Then the lifting property of $\map_p$ implies $\dist{\hat A_p}{\hat p}{\spc{B}_p} = \dist{A}{p}{\spc{U}}$.  Moreover, a curve $\hat\alpha$ realizes distance from $\hat p$ to $\hat A_p$ if and only if  $\alpha = \map_p\circ\hat\alpha$
 realizes distance from $p$ to $A$.

Let  $\spc{W}=\spc{B}_p
\sqcup_{\iota}\spc{B}_p$ be the doubling of $\spc{B}_p$ with respect to  $\hat A_p$, where  $\iota\:\hat A_p\to\spc{B}_p$ is the inclusion map; that is, $\spc{W}$ is the result of gluing two copies of $\spc{B}_p$ along $\hat A_p$  (\ref{sec:doubling}).  Then $\spc{W}\in\Cat{}{\kappa}$ by Reshetnyak gluing (\ref{thm:gluing}).


Given $w=(\hat p,1)\in \spc{W}$, set $w'=(\hat p,- 1)$.  Then there is a unique geodesic $\ddot\gamma_p$ in $\spc{W}$ joining $w$ and $w'$.  This geodesic must intersect $\hat A_p\subset \spc{W}$, and since there is no shorter curve in $\spc{W}$ that joins $w$ and $w'$, must consist of two geodesic segments $(\hat \gamma_p,1)$ and $(\hat\gamma_p, -1)$ where $\hat \gamma_p$ is a geodesic in $\spc{B}_p$  that realizes distance from $\hat p$ to  $\hat A_p$.  Uniqueness of $\ddot\gamma_p$ implies uniqueness of $\hat \gamma_p$.  It follows from the lifting property  that there is a unique closest point of $A$ to $p$, and  $\gamma_p=\map_p\circ\hat\gamma_p$ is the unique geodesic of $\spc{U}$ that realizes distance from $p$ to $A$.

Suppose $x\in \oBall[A,\tfrac{\varpi\kappa}{2}]$ satisfies $ \dist{p}{x}{\spc{U}}=\eps>0$ and lies in a $\Cat{}{\kappa}$ 
 neighborhood $\Omega$ of $p$ for which $\map_p|\Omega$ is an isometry. For sufficiently small $\eps $,  the unique minimizer $\gamma_x$ from $x$ to $A$ lies in $ \oBall[p,\tfrac{\varpi\kappa}{2}]$.    Let $\alpha\:[0,a]\to\spc{U}$ be the unitspeed curve that runs first  along  the geodesic in $\Omega$  from $p$ to $x$ and then along $\gamma_x$ to $A$. Let $\hat\alpha_{p,x}$ be the curve in $\spc{B}_p$ such that  $\hat\alpha (0) = \hat p$ and $\map_p\circ\hat\alpha=\alpha$.  Set $\hat x =\hat\alpha_{p,x} (\eps)$.  Then the curve
\[
\hat\gamma_{p,x} =\hat\alpha_{p,x} |[\eps, a]
%\eqlbl{eq:d-realizer}
\]
 is a geodesic of $\spc{B}_p$ that  realizes distance from $\hat x$ to  $\hat A_p$.  
Since  $\map_p\circ\hat\gamma_{p,x}$ is a reparametrization of $\gamma_x$,
\[
\dist{\hat A_p}{\hat x}{\spc{B}_p}= \dist{A}{ x}{\spc{U}}. 
\eqlbl{eq:d-realizer}
\]
 
Since geodesics of  $\spc{W}$ vary continuously with their endpoints (\ref{thm:cat-unique}), then $\hat\gamma_{p,x}$ varies continuously with $x$.
Hence (\ref{SHORT.footpoint}).

%Suppose there are two closest points $z_1,z_2$ of $\hat A_x$ to $\hat x$.  By point-on-side comparison (\ref{cat-monoton}), the distance from $\hat x$  to an interior point of $[z_1z_2]$ is $<\dist{\hat x}{z_i}{}$. This contradiction shows there is a unique closest point of $\hat A_x$ to $\hat x$.  It follows that there is a unique closest point of $A$ to $x$. 

\parit{(\ref{SHORT.distance-to-convex}).} 
%It suffices to verify the differential inequality $(f\circ\gamma)''+\kappa\cdot (f\circ\gamma)\ge 0$ for any geodesic 
For any $p\in \oBall[A,\tfrac{\varpi\kappa}{2}]$, set $ p^*=f_A( p )$. 


Suppose  $\beta\:[0,\eps]\to\spc{U}$ is a unit-speed geodesic  in $\oBall[A,\tfrac{\varpi\kappa}{2}]$ from $p$ to $x$.  
We wish to examine the distances $\dist{\beta (t)}{ A}{\spc{U}}$.
By \ref{eq:d-realizer}, we may assume $\spc{U}\in\Cat{}{\kappa}.$

Extend $\beta$ to $\alpha\:[0,a]\to\spc{U}$, so that $\alpha[0,\eps]=\beta$  and $\alpha$  is a closed unit-speed curve that parametrizes 
the  quadrilateral $Q$ with sides   $\alpha([0,\eps]) =[px]$, $[xx^*]$, $[x^* p^*]$, $[p^*p]$.
 For $\eps$ sufficiently small, $\length Q < 2\varpi\kappa$ by continuity of $f_A$, and we may  apply majorization (\ref{thm:major}) to  $\alpha$.  

Thus $\alpha$ is majorized by a closed convex region $D$  lying in a hemisphere $\Lob2\kappa$, where $D$ is bounded by a simple closed unit-speed curve $\tilde\alpha\:[0,a]\to\Lob2\kappa$.  By definition the majorizing map $F\:D\to \spc{U}$ is length-nonincreasing and  we may take $F\circ\tilde\alpha=\alpha$. It follows that  $\tilde\alpha$ parametrizes a convex quadrilateral $\tilde Q$ having  the same sidelengths as $Q$.  Let $\tilde\sigma$ denote the side of $\tilde Q$ opposite $\tilde\alpha([0,\eps])$.

By majorization, for $0\le t\le\eps$,
$$\dist{\tilde\alpha (t)}{ \tilde\sigma}{\Lob2\kappa}\ge  \dist{\beta (t)}{ y_t}{\spc{U}}\ge \dist{\beta (t)}{ A}{\spc{U}},$$
 where $y_t\in A$ is a point on $[p^* x^*]$.  


By construction, these inequalities are equalities  at
$t=0$ and $\eps$. 
Since $\dist{\tilde\alpha (t)}{ \tilde\sigma}{\Lob2\kappa}$, $0\le t\le \eps$, satisfies the desired convexity condition by Lemma \ref{lem:model-d-seg},
then
(\ref{SHORT.distance-to-convex}) follows.

\parit{(\ref{SHORT.short-retract}).}
For any $x\in \spc{U}=\oBall[A,\tfrac{\varpi\kappa}{2}]$, set  $x^*=f_A( x )$. 
Suppose  $x,y\in\spc{U}$.

Clearly $x=x^*$ if and only if $x\in A$.
Further, if $x\notin A$ then 
\[\mangle\hinge{x^*}{x}{p}\ge\tfrac\pi2\eqlbl{eq:<x*xp>=pi/2}\] 
for any $p\in A$;
otherwise there would be a point on $[x^*p]\subset A$ which is closer to $x$ than $x^*$.

Let us show that $\dist{x^*}{y^*}{}\le\dist{x}{y}{}$ for any $x,y\in \spc{U}$.
Without loss of generality we assume $x^*\not=y^*$ and $x\notin A$.

\parit{Case 1:} $y\in A$, so $y=y^*$.
From \ref{eq:<x*xp>=pi/2}, we have $\mangle\hinge{x^*}{x}{y^*}\ge\tfrac\pi2$.
From ??? comparison it follows that $\dist{x^*}{y^*}{}=\dist{x^*}{y}{}\le \dist{x}{y}{}$.

%%%ADD PIC

\parit{Case 2:} $x,y\notin A$.
In this case, \ref{eq:<x*xp>=pi/2} implies $\mangle\hinge{x^*}{x}{y^*}$, $\mangle\hinge{y^*}{x}{x^*}\ge\tfrac\pi2$.
Apply Reshetnyak majorization to the quadrilateral $Q$ with sides   $[xy]$, $[yy^*]$, $[y^* x^*]$, $[x^*x]$. Since a majorizing map cannot increase angles, there is a quadrilateral in  $\Lob2\kappa$ with the same sidelengths as $Q$, and whose angles at the vertices corresponding to $x^*$ and $y^*$ are $\ge\tfrac\pi2$.  It follows that 
$\dist{x^*}{y^*}{}\le \dist{x}{y}{}$.\qeds

  
\begin{thm}{Theorem on short retract, $\kappa>0$}
\label{strictly-short-retract} 
Suppose $\spc{U}\in\Cat{}{\kappa}$ where $\kappa>0$.  
Let $A\subset\spc{U} $  be a closed convex subset.
Assume $A\subset \cBall[p,\varpi\kappa]$ for some $p\in \spc{U}$.
Then $A$ is a \emph{short retract}\index{short retract} of $\spc{U}$;
that is, there is a short map $\map[2]\:\spc{U}\to A$ which is identical on $A$.

More over if $A\subset \oBall(p,\tfrac{\varpi\kappa}{2})$, 
then the map $\map[2]$ can be chosen so that in addition 
\[\dist{\map[2](y)}{x}{}<\dist{y}{x}{}.\]
 for any $x\in A$ and $y\notin A$.
\end{thm}

We note here that, in contrast to $\kappa$-concave functions on $\Alex{}{}$-spaces, highly non-Lipschitz $\kappa$-convex functions are easily constructed in spaces of curvature bounded above. For example, following a remark of Kleiner (\city{}, p.411), let $X^0$ be a basepoint and construct a metric tree $X^n$ recursively by attaching $2^n$ edges of length $2^{-n}$ to each end vertex of $X^{n-1}$.  Let $X=$ the completion of $\cup X^n$, and $T=X-\cup X^n$. Then $T$ has infinite Hausdorff dimension.

Now modify $X^n, n\ge 2$, by putting an additional vertex at the midpoint of each edge of $X^{n-1}$ and attaching to it an edge of length $2^{-n}$. 
Again let $X=$ the completion of $\cup X^n$, and $T=X-\cup X_^n$. Starting with value $0$ at $X^0$, recursively define a continuous convex function$f$ on $X$, to be linear with slope $n$ on each edge of length $2^{-n}$ that has been newly attached to $X^{n-1}$.  Then $T$ consists of the points $p$ that satisfy $(f\circ \gamma)'(0)=-\infty$ for all geodesics $\gamma$ from $p$. $T$ is dense in $X$, which is compact.  $T$ has infinite Hausdorff dimension while its complement in $X$ has Hausdorff dimension  $1$.


\section{Exercises}

\begin{thm}{Exercise} 
(Gluing with short maps)
 Let $X,X' \in\Cat{}{0}$, $K \subset X, K' \subset X'$ be closed convex subsets, 
and suppose the length-distance between any two points
on $\partial_X K$ and $\Fr_{X'} K'$ are finite.
Suppose $\phi\: \partial_X K \to \Fr_{X'} K'$ is length-preserving and 
short with respect to the inherited
metrics. 
To $X'\setminus\Int K'$ in its length metric, 
glue $K$ along $\phi$, to obtain the space $Y$. 
Show $Y \in \Cat{}{0}$.

For example, take $K= \cBall[x,\sinh R]  \subset \Lob{m}0$ and $K' = \cBall(x',R)  \subset \Lob{m}{-1}$.
\end{thm}


