Â­%%!TEX root = the-constr-CBA.tex
\chapter{Constructions in CBA spaces}


\section{Cones} 
\label{sec:cones}

Now we consider warped products (as defined  \ref{sec:wp-def}) for which the base $\spc{B}$ is an interval   and the warping function $f$ satisfies $f''=-\kappa\cdot f$.  We write  $\II_\kappa= [0,\varpi\kappa]$ if $\kappa > 0$, $\II_\kappa= [0,\infty)$ if $\kappa\le 0$.

\begin{thm}{Definition}
\label{def:cones}
The  \emph{$\kappa$-cone} $\Cone_\kappa \spc{X}$ over a metric space $\spc{X}$ is defined by
\[\Cone_\kappa \spc{X}= \II_\kappa\times_{\sn{\kappa} } \spc{X}.\]  
$\Cone_{\,0}  \spc{X}$ is called the  \emph{Euclidean cone} over $\spc{X}$, and written $\Cone \spc{X}$. $\Cone_{\,1} \spc{X}$ is called the
 \emph{spherical suspension} of $\spc{X}$. 
 
 For $\kappa <0$, we  also define  \emph{$\kappa$-cylinders} (respectively, \emph{ideal $\kappa$-cones}) over $\spc{X}$ as 
 \[\RR\times_{\cs{\kappa}} \spc{X} 
\quad (\text{respectively }\RR\times_{\exp (t\cdot\sqrt{-\kappa})} \spc{X}).\]

For $\kappa\le 0$, the \emph{vertex} of $\Cone_\kappa \spc{X}$ is the equivalence class $\{0\}\times \spc{X}$. If $\kappa>0$, there are two vertices, $\{0\}\times \spc{X}$ and $\{\varpi\kappa\}\times \spc{X}$.  We denote a vertex by  $o$.                             \end{thm} 

\parbf{Remark.} In these constructions, the leaves $\II_\kappa\times\{x\}$ or $\RR\times\{x\}$ in the restricted  metric are isometric copies of $\II_\kappa$ or $\RR$,  and are clearly uniquely minimizing on proper subintervals.
The leaf $\{t\}\times \spc{X}$ is length-isometric to $\spc{X}$ rescaled by the value of the warping function at $t$.  In a $\kappa$-cone, this leaf is the sphere of radius $t$ about $o$.
\ms

$\Cone_\kappa \spc{X}$ inherits the cosine law of the model space $\Lob{}\kappa$, as follows.  
We denote the points of $\Cone_\kappa \spc{X}$ by $t\cdot x\df (t,x)$ where $ t\in \II_\kappa, x\in \spc{X}$, and $t\cdot x = o$ if $t=0$. 

\begin{thm}{Lemma}\label{lem:cos-law}
For $u=s\cdot x,v=t\cdot y$, and  $\alpha=\mangle\hinge{o}u v$ (taken to be $0$ if $u$ or $v$ is a cone point), distance in $\Cone_\kappa \spc{X}$ is given by:
\[\dist{u}{v}{}=\side\kappa\{\alpha;t,s\}.\]

\end{thm}


\parit{Proof.}
If $\dist{x}{y}{}<\pi$, apply  Lemma \ref{lem:fiber-independence} to $\Cone_\kappa \spc{X}$ and $\Lob{}\kappa= \Cone_\kappa(\Lob11)$, where $\Lob11$ is the circle of length $2\pi$. Since $\dist{x}{y}{}=\angk{\kappa}{o}{u}{v} = \alpha$, the formula follows from the cosine law of $\Lob{}\kappa$. If $\dist{x}{y}{}\ge\pi$, apply  Lemma \ref{lem:fiber-independence} to $\Cone_\kappa \spc{X}$ and $ \Cone_\kappa(\RR-)$.  
Then $\alpha=\pi$ and 
\[\dist{u}{v}{}=\min\{s+t,2\varpi\kappa-s-t\},\] 
so the formula holds.
\qeds


We sometimes refer to the elements of $\Cone \spc{X}$ as \emph{vectors}.  The vertex $o$ plays the role of a ``zero vector''. 
\begin{thm}{Definition}
\label{def:scalar-product}
The \emph{absolute value}\index{absolute value} $|v|$ of $v=t\cdot x\in \Cone \spc{X}$ is defined by
\[|v|= t =\dist{o}{v}{}.\]
\index{$\vert{*}\vert$}
The \emph{scalar product}\index{scalar product} $\langle u, v\rangle$ of $u,v\in \Cone \spc{X}$ is defined by
\[\langle u, v\rangle
=
(|u|^2+|v|^2-\dist[2]{u}{v}{})/2=|u|\cdot |v|\cos\alpha,\] 
\index{$\<*,*\>$}where $\alpha=\mangle\hinge o u v=\angk{0}{o}{u}{v}$ will be also denoted as $\mangle(u,v)$.
\end{thm}
Note that in general, the sum of ``tangent vectors'' is undefined, so we do abuse the term ``vector'' here.

When it is convenient, we treat $\spc{X}$ as a ``unit sphere'' in $\Cone \spc{X}$, 
i.e., the set of unit vectors. 
Thus, $x\in \spc{X}$ might also refer to the corresponding unit vector in $\Cone \spc{X}$.
In this case for $x,y\in \spc{X}$ we will use mostly $\mangle(x,y)$ for $\dist{x}{y}{\spc{X}}$ 
and $\dist{x}{y}{}$ for $\dist{x}{y}{\Cone \spc{X}}$.

\ms

\begin{thm}{Definition}
\label{def:kappa-join}
The \emph{$\kappa$-join} of metric spaces $\spc{X}$ and $\spc{Y}$ is defined by
\[ \Join_\kappa \l(\spc{X},\spc{Y}\r) 
= 
[0,\varpi\kappa/2]\times_{(\sn{\kappa},\,\cs{\kappa})}\spc{X}\times \spc{Y}).\]
We call $\Join_1 \l(\spc{X},\spc{Y}\r)$
 the \emph{spherical join} of $\spc{X}$ and $\spc{Y}$, and $\Join_{-1} \l(\spc{X},\spc{Y}\r)$  the \emph{hyperbolic join} of $\spc{X}$ and $\spc{Y}$.
\end{thm}

We may express the  model spaces $\Lob{n}\kappa$ as $\kappa$-cones ands $\kappa$-joins. 

\begin{thm}{Lemma}\label{lem:model-as-join}
 Let $\Lob{0}\kappa$ be a point if $\kappa \le 0$ , and two points at distance  $\pi/\sqrt{\kappa}$ apart if $\kappa >0$. Then for $n\ge 1$,
 \begin{align*}
\Lob{n}\kappa &= 
\Cone_\kappa \Lob{n-1}1\\
&=
\RR\times_{\cs{\kappa}} \Lob{n-1}1 \\
&= \RR\times_{\exp \sqrt{-\kappa}\,t} \Lob{n-1}1,
\end{align*}

and

 \begin{align*}
\Lob{m+n+1}\kappa=\Join_\kappa\l(\Lob{m}1,\Lob{n}{\sgn\kappa}\r).
\end{align*}
\end{thm}

\parit{Proof.} Immediate from the definitions.
\qedsf


\begin{thm}{Lemma}\label{lem:cone-of-join}
The spherical join, $\Join_1 \l(\spc{X},\spc{Y}\r)$,
 of metric spaces $\spc{X}$ and $\spc{Y}$  satisfies 
\[ \Cone \Join_1 \l(\spc{X},\spc{Y}\r)
=\Cone \spc{X}\times\Cone \spc{Y}.\]
\end{thm}
\parit{Proof.} By definition, 
\begin{align*}
\Cone\Join_1 \l(\spc{X},\spc{Y}\r)
&= \RR_{\ge 0}\times_r\l(([0,\tfrac\pi2]\times_{\sin t}\spc{X})\times_{\cos t}\spc{Y}\r)
\\&= \l(( \RR_{\ge 0}\times_r[0,\tfrac\pi2])\times_{r\sin t}\spc{X}\r)\times_{r\cos t}\spc{Y}
\\&=\l((\RR_{\ge 0}\times\RR_{\ge 0})\times_x\spc{X}\r)\times_y\spc{Y}
\\&=\Cone \spc{X}\times\Cone \spc{Y}.
\end{align*}
\qedsf



For a function $f:\spc{X}\to\RR$ on a metric space $\spc{X}$, let $\Cone f:\Cone \spc{X}\to\RR$ be the linear homogeneous extension of $f$,
defined by 
\[(\Cone f)(t\cdot x)=tf(x).\]

\begin{thm}{Lemma}\label{lem:cone_f}  Let $f:\spc{X}\to\RR$ be a function on a geodesic space $\spc{X}$.  Then $\Cone f$ is convex  if and only if $f''\ge -f$ on $\spc{X}$ and $f(x)+f(y)\ge 0$ whenever
$\dist{x}{y}{}\ge\pi$.
\end{thm}

\parit{Proof.} 
Let $[xy]$ be a geodesic in $\spc{X}$, and $m$ be its midpoint.  
By lemma \ref{lem:cos-law}, if $\dist{x}{y}{}\le\pi$ then $\Cone [xy]$ in both its length-metric and external metric is isometric to the sector of $\Lob{}0$ whose angle at the origin is $\dist{x}{y}{}$;  
if $\dist{x}{y}{}\ge\pi$,  the geodesic $[s\cdot x\,\,t\cdot y]$ is the union of two segments from the vertex $o$ of lengths $s$ and $t$ respectively.

The inequality  $f''\ge -f$ on $\spc{X}$ is equivalent to the following midpoint inequality for all geodesics $[xy]$ with $\dist{x}{y}{}\le\pi$:
\[f(m)
\le 
\bigl(f(y)+f(x)\bigr)\bigl/\bigl(2\cos\frac{\dist{x}{y}{}}{2}\bigr),\]
since the solutions of $f''(t)=-f(t)$ satisfy the corresponding equation on any interval of length $<\pi$.  The convexity
inequality for $\Cone f$ on a geodesic $[s\cdot x\,\,t\cdot y]$ with $\dist{x}{y}{}\le\pi$, evaluated at the point that divides this geodesic in the
ratio $s:t$, is 
\[2st(s+t)^{-1} f(m)\cos\frac{\dist{x}{y}{}}{2} 
\le 
s(s+t)^{-1}tf(y)+t(s+t)^{-1}sf(x),\]
since linear functions satisfy the corresponding equation.  By sequential application of this process, $f''\ge-f$ holds on $\spc{X}$ if and only if $\Cone f$ is convex on any geodesic whose projection to $\spc{X}$ has length $\le\pi$.

When $\dist{x}{y}{}\ge\pi$, $\Cone f$ on $[s\cdot x\,\,t\cdot y]$ is linear on each segment from $o$, and hence is convex if and only if $f(x)+f(y)\ge 0$.
\qeds

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Gluing.}\label{sec:cba-gluing}

The following theorem was proved by Reshetnyak \cite{reshetnyak:glue},  assuming $\spc{U}_1, \spc{U}_2$ are proper.

\begin{thm}{Reshetnyak gluing}\label{thm:gluing}
Suppose 
$\spc{U}_1$ and  $\spc{U}_2$ are two $\varpi\kappa$-geodesic spaces 
with isometric complete $\varpi\kappa$-convex sets $A_i\subset\spc{U}_i$.  Let $\iota\:A_1\to A_2$ be an isometry.
Let $\spc{W}=\spc{U}_1\sqcup_{\iota}\spc{U}_2$;
i.e., $\spc{W}$ is gluing of $\spc{U}_1$ and  $\spc{U}_2$ along $\iota$;see Section~\ref{sec:quotient}.

Then 
\begin{subthm}{gluing0}
Both canonical mappings $\jmath_i\:\spc{U}_i\to\spc{W}$ are isometric 
and the images $\jmath_i(\spc{U}_i)$ are $\varpi\kappa$-convex subsets in $\spc{W}$.
\end{subthm}

\begin{subthm}{gluing2}
If $\spc{U}_1, \spc{U}_2\in\cCat{}{\kappa}$  
then $\spc{W}\in\cCat{}{\kappa}$.
\end{subthm} 
\end{thm}

\parit{Proof.} 
Part (\ref{SHORT.gluing0})
follows directly from $\varpi\kappa$-convexity of $A_i$.

\parit{(\ref{SHORT.gluing2}).} 
According to (\ref{SHORT.gluing0}),
we can identify $\spc{U}_i$ with its image $\jmath_i(\spc{U}_i)$ in $\spc{W}$;
this way both subsets $A_i\subset \spc{U}_i$ will be identified and denoted further by $A$.
Note that $A=\spc{U}_1\cap \spc{U}_2\subset \spc{W}$,
therefore $A$ is also $\varpi\kappa$-convex set in $\spc{W}$.

Further note that completeness of $\spc{U}_1$ and $\spc{U}_2$ implies completeness of $\spc{W}$.
Thus part (\ref{SHORT.gluing2}) can be reformulated the following way:

\begin{thm}{Reformulation of \ref{gluing2}}
Let $\spc{W}$ be a complete length space which has two closed $\varpi\kappa$-convex sets $\spc{U}_1,\spc{U}_2\subset\spc{W}$ such that
$\spc{U}_1\cup\spc{U}_1=\spc{W}$ and $\spc{U}_1,\spc{U}_2\in\cCat{}{\kappa}$.
Then $\spc{W}\in\cCat{}{\kappa}$.
\end{thm}

Set $A=\spc{U}_1\cap\spc{U}_1$.
First we prove the following:

\begin{clm}{}\label{clm:geod-gluing}
If our space $\spc{W}$ happened to be $\varpi\kappa$-geodesic then $\spc{W}\in\cCat{}{\kappa}$
\end{clm}



\begin{wrapfigure}{r}{20mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]
{pics/resh-glue(1)}
\lbl[l]{6.5,21;$x^0$}
\lbl[r]{1.5,1.5;$x^1$}
\lbl[tl]{16,0.5;$x^2$}
\lbl[rb]{4,11;$z^1$}
\lbl[lb]{13,8;$z^2$}
\end{lpic}
\end{wrapfigure}

\parit{Proof of the claim.}
According to \ref{prop:k-thin},
it is sufficient to show that any triangle $\trig {x^0}{x^1}{x^2}$ of perimeter $<2\cdot \varpi\kappa$ 
in $\spc{W}$ is $\kappa$-thin.
This is obviousely true if all three points $x^0$, $x^1$, $x^2$ lie in one of $\spc{U}_i$.
Thus, without loss of generality, we may assume that $x^0\in\spc{U}_1$ and $x^1,x^2\in\spc{U}_2$.

Choose points $z^1,z^2\in A$ 
which lie correspondingly on the sides $[x^0x^1], [x^0x^2]$.
Note that all distances between any pair of points from $x^0$, $x^1$, $x^2$, $z^1$, $z^2$ are less than $\varpi\kappa$.
Therefore
\begin{itemize}
\item triangle $\trig{x^0}{z^1}{z^2}$ lies in $\spc{U}_1$,
\item both triangles $\trig{x^1}{z^1}{z^2}$ and $\trig{x^1}{z^2}{x^2}$ lie in $\spc{U}_2$.
\end{itemize}
In particular each triangle $\trig{x^0}{z^1}{z^2}$,
$\trig{x^1}{z^1}{z^2}$ and $\trig{x^1}{z^2}{x^2}$ is $\kappa$-thin.

Applying the inheritance lemma for thin triangles (\ref{lem:inherit-angle}) twice 
we get that $\trig {x^0}{x^1}{z^2}$ 
and consequently $\trig {x^0}{x^1}{x^2}$ is $\kappa$-thin.
\claimqeds

Now we come back to the general case;
i.e., $\spc{W}$ is not necessury $\varpi\kappa$-geodesic.
Note that the ultrapower $\spc{W}^\o$ is geodesic, see \ref{cor:ulara-geod}.
It is easy to see that 
\begin{itemize}
\item $\spc{U}_i^\o$ form weak $\varpi\kappa$-convex sets of $\spc{W}^\o$,
\item $A^\o=\spc{U}_1^\o\cap\spc{U}_2^\o$ is also a weakly $\varpi\kappa$-convex set.
\end{itemize}
%???IT SEEMS THAT ULTRAPRODUCT FOR SUBSETS ARE NOT REALLY DEFINED YET
From Proposition~\ref{prop:CAT^omega}, $\spc{U}_i^\o\in \cCat{}{\kappa}$.
According to Corollary~\ref{cor:weak>convex}, 
we get that $A^\o$ is $\varpi\kappa$-convex in both $\spc{U}_i$ and
concequently both $\spc{U}_i^\o$ are $\varpi\kappa$-convex subsets in $\spc{W}^\o$.

From Claim~\ref{clm:geod-gluing}, 
we get $\spc{W}^\o\in\cCat{}{\kappa}$.
Applying the Proposition~\ref{prop:CAT^omega} once more, 
we get $\spc{W}\in\cCat{}{\kappa}$.
\qeds 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Convex sets and projection}

\begin{thm}{Lemma}\label{lem:model-d-seg}
Let $A\subset \Lob2\kappa$ 
be a geodesic segment. 
Then 
$f=\sn{\kappa}\circ\dist{A}{}{}.$
 satisfies \[f''+\kappa\cdot f \ge  0.\]
\end{thm}
\parit{Proof.} The restriction of
$\dist{A}{}{}$ to a sufficiently short geodesic coincides either with
distance to the image of a complete geodesic, or distance to an endpoint of
$A$, or a join of these two. The first  satisfies $f''+\kappa\cdot f =  0$ by \ref{sn-diff-eq}.  The second satisfies $f''+\kappa\cdot f \ge 0$ by direct calculation from \ref{md-diff-eq}. This suffices, since the derivative at the
join is two-sided, by the first variation formula.
\qeds

\begin{thm}{Definition} 
\label{def:convex-set}
Let $\spc{X}$ be a metric space. 
A set $A\subset\spc{X}$ is called 
\emph{totally $R$-convex}%
\index{convex set!totally convex set}\index{totally convex set}
if for every two points $p,q\in A$, every local geodesic with endpoints $p$ and $q$ and length $< R$  lies in $A$.
\end{thm}

Note that if $\spc{X}\in\Cat{}{\kappa}$, then by Corollary \ref{cor:loc-geod-are-min},  $A\subset\spc{X}$ is totally $\varpi\kappa$-convex if and only if $A$ is $\varpi\kappa$-convex.


Part (\ref{SHORT.distance-to-convex}) of  the next theorem should be compared to the theorem on distance to the boundary of a $\CBB{}{}$-space (\ref{thm:dist-to-bry}).


%Recall that $\cBall[K,\tfrac{\varpi\kappa}{2}]$ denotes the closed tubular neighborhood of radius $R$ about $K$ (\ref{sec:metric spaces}).



\begin{thm}{Theorem on distance to a convex set} 
\label{thm:retract-to-convex} 
Suppose $\spc{U}$ is  a complete  length space satisfying $\curv\spc{U}\le\kappa$.  Let  $A\subset\spc{U} $  be a closed totally $\varpi\kappa$-convex subset. 
Then:

\begin{subthm}{footpoint}
There is a continuous map 
$$f_A\: \oBall[A,\tfrac{\varpi\kappa}{2}]\to A$$
	such that  $f_A(x)$ is the unique closest  point of $x$ to $A$. 
%For any $x\in \cBall[K,\tfrac{\varpi\kappa}{2}]$, there is a unique closest  point of $x$ to $K$ (called the \emph{footpoint of $x$ on $K$}, 
%denoted here by $f_K(x))$.  
Moreover, there is a unique geodesic from $x$ to $f_A(x)$, and this geodesic depends continuously on $x$.  \end{subthm}

%\begin{subthm}{retract-to-convex}
%If $\kappa\le 0$, $K$ is a short retract under $f_K$  of $\cBall[K,\tfrac{\varpi\kappa}{2}]$; i.e. the footpoint map  
%\[f_K\:\cBall[K,\tfrac{\varpi\kappa}{2}]\to K
%\]
%is a short map that is identical on $K$.

%Moreover $K$  is a strictly short retract under $f_K$ of $\oBall[K,\tfrac{\varpi\kappa}{2}]$; i.e. 
%for any $x\in K$ and $y\notin K\cap\oBall[K,\tfrac{\varpi\kappa}{2}] $, we have 
%\[\dist{f_K(y)}{x}{}<\dist{y}{x}{}.\]
%\end{subthm}

\begin{subthm}{distance-to-convex}
Set
$f=\sn{\kappa}\circ\dist{A}{}{}.$
Then the  restriction of $f$ to  $\oBall[A,\tfrac{\varpi\kappa}{2}]$  satisfies \[f''+\kappa\cdot f\ge 0%\eqlbl{eq:dist-convex}
 .\]
In particular, if $\spc{U}$ is a complete  length space  with  $\curv\spc{U}\le0$, and $A\subset\spc{U}$  is  totally convex, then the  function
$f= \dist{A}{}{}$
is convex on $\spc{U}$.
\end{subthm} 

\begin{subthm}{short-retract} 
If $\kappa\le 0$,
%$A\subset \oBall(p,\tfrac{\varpi\kappa}{2})$, 
then $f_A$ is a strictly short retraction of $ \spc{U}$ onto $A$,
i.e. $f_A$ is a short map
that is identical on $A$, such that for any $x\in A$ and $y\notin A$ we have 
\[\dist{x}{f_A(y)}{}<\dist{x}{y}{}.\]
 % If $\kappa \le 0$, then $f_A$ is a short retraction of $\spc{U}$ onto $A$.
 \end{subthm}
\end{thm}
\parit{Proof.} 
\parit{(\ref{SHORT.footpoint}).}
By the Lifting globalization theorem  \ref{thm:globalization-lift}, for any  $p\in\spc{U}$
 there is a space $\spc{B}_p\in\Cat{}{\kappa}$, where $\spc{B}_p=\oBall[\hat p,\varpi\kappa/2]$ for some $\hat p \in \spc{B}$,
and a locally isometric map $\map_p\:\spc{B}_p\to\spc{U}$
with $\map(\hat p)=p$ and the following lifting property: 
for any curve $\alpha\:[0,a]\to\spc{U}$ with $\alpha(0)=p$ and $\length\alpha\le\varpi\kappa/2$,
there is a unique curve $\hat\alpha \:[0,a]\to \spc{B}_p$ such that $\hat\alpha (0) = \hat p$ and $\map_p\circ\hat\alpha=\alpha$.

%Let $\map\: \hat {\spc{U}}\to\spc{U}$
%be the simply connected metric covering.
%By the Hadamard--Cartan theorem
%(\ref{thm:hadamard-cartan}), $\hat {\spc{U}}\in\Cat{}{0}$.  The map $\map$ is a local isometry and has  the lifting property, i.e.
%for any $x \in \spc{U}$ and $\hat x \in \hat {\spc{U}}$ such that $\map (\hat x) = x$, and any path $\alpha\:[0,1]\to\spc{U}$ such that  $\alpha(0)=x$, 
%there is a unique path $\hat\alpha \:[0,1]\to \hat{\spc{U}}$ such that $\hat\alpha(0)=\hat x$ 
%and $\map\circ\hat\alpha=\alpha$.

Fix $p\in \oBall[A,\tfrac{\varpi\kappa}{2}]$. 
Set $\hat A_p= (\map_p)^{-1}(A)$.

If $\hat\gamma$ is a geodesic of $\spc{B}_p$  with endpoints in $\hat A_p$, then $\length \hat\gamma < \varpi\kappa$, and $\map_p\circ\hat\gamma$ is a local geodesic of the same length in $\spc{U}$ with endpoints in $A$.  Since  $A\subset\spc{U} $  is totally $\varpi\kappa$-convex,  $\map_p\circ\hat\gamma$ lies in $A$.  Therefore $\hat\gamma$ lies in $\hat A_p$, and   $\hat A_p$ is a convex subset of  $\spc{B}_p$.  

Since $\map_p$ is a local isometry,  $\dist{\hat A_p}{\hat p}{\spc{B}_p} \ge \dist{A}{p}{\spc{U}}$.  Then the lifting property of $\map_p$ implies $\dist{\hat A_p}{\hat p}{\spc{B}_p} = \dist{A}{p}{\spc{U}}$.  Moreover, a curve $\hat\alpha$ realizes distance from $\hat p$ to $\hat A_p$ if and only if  $\alpha = \map_p\circ\hat\alpha$
 realizes distance from $p$ to $A$.

Let  $\spc{W}=\spc{B}_p
\sqcup_{\iota}\spc{B}_p$ be the doubling of $\spc{B}_p$ with respect to  $\hat A_p$, where  $\iota\:\hat A_p\to\spc{B}_p$ is the inclusion map, i.e. $\spc{W}$ is the result of gluing two copies of $\spc{B}_p$ along $\hat A_p$  (\ref{sec:doubling}).  Then $\spc{W}\in\Cat{}{\kappa}$ by Reshetnyak gluing (\ref{thm:gluing}).


Given $w=(\hat p,1)\in \spc{W}$, set $w'=(\hat p,- 1)$.  Then there is a unique geodesic $\ddot\gamma_p$ in $\spc{W}$ joining $w$ and $w'$.  This geodesic must intersect $\hat A_p\subset \spc{W}$, and since there is no shorter curve in $\spc{W}$ that joins $w$ and $w'$, must consist of two geodesic segments $(\hat \gamma_p,1)$ and $(\hat\gamma_p, -1)$ where $\hat \gamma_p$ is a geodesic in $\spc{B}_p$  that realizes distance from $\hat p$ to  $\hat A_p$.  Uniqueness of $\ddot\gamma_p$ implies uniqueness of $\hat \gamma_p$.  It follows from the lifting property  that there is a unique closest point of $A$ to $p$, and  $\gamma_p=\map_p\circ\hat\gamma_p$ is the unique geodesic of $\spc{U}$ that realizes distance from $p$ to $A$.

Suppose $x\in \oBall[A,\tfrac{\varpi\kappa}{2}]$ satisfies $ \dist{p}{x}{\spc{U}}=\eps>0$ and lies in a $\Cat{}{\kappa}$ 
 neighborhood $\Omega$ of $p$ for which $\map_p|\Omega$ is an isometry. For sufficiently small $\eps $,  the unique minimizer $\gamma_x$ from $x$ to $A$ lies in $ \oBall[p,\tfrac{\varpi\kappa}{2}]$.    Let $\alpha\:[0,a]\to\spc{U}$ be the unitspeed curve that runs first  along  the geodesic in $\Omega$  from $p$ to $x$ and then along $\gamma_x$ to $A$. Let $\hat\alpha_{p,x}$ be the curve in $\spc{B}_p$ such that  $\hat\alpha (0) = \hat p$ and $\map_p\circ\hat\alpha=\alpha$.  Set $\hat x =\hat\alpha_{p,x} (\eps)$.  Then the curve
\[
\hat\gamma_{p,x} =\hat\alpha_{p,x} |[\eps, a]
%\eqlbl{eq:d-realizer}
\]
 is a geodesic of $\spc{B}_p$ that  realizes distance from $\hat x$ to  $\hat A_p$.  
Since  $\map_p\circ\hat\gamma_{p,x}$ is a reparametrization of $\gamma_x$,
\[
\dist{\hat A_p}{\hat x}{\spc{B}_p}= \dist{A}{ x}{\spc{U}}. 
\eqlbl{eq:d-realizer}
\]
 
Since geodesics of  $\spc{W}$ vary continuously with their endpoints (\ref{lem:cat-unique}), then $\hat\gamma_{p,x}$ varies continuously with $x$.
Hence (\ref{SHORT.footpoint}).\qeds

%Suppose there are two closest points $z_1,z_2$ of $\hat A_x$ to $\hat x$.  By point-on-side comparison (\ref{cat-monoton}), the distance from $\hat x$  to an interior point of $[z_1z_2]$ is $<\dist{\hat x}{z_i}{}$. This contradiction shows there is a unique closest point of $\hat A_x$ to $\hat x$.  It follows that there is a unique closest point of $A$ to $x$. 

\parit{(\ref{SHORT.distance-to-convex}).} 
%It suffices to verify the differential inequality $(f\circ\gamma)''+\kappa\cdot (f\circ\gamma)\ge 0$ for any geodesic 
For any $p\in \oBall[A,\tfrac{\varpi\kappa}{2}]$, set $ p^*=f_A( p )$. 


Suppose  $\beta\:[0,\eps]\to\spc{U}$ is a unit-speed geodesic  in $\oBall[A,\tfrac{\varpi\kappa}{2}]$ from $p$ to $x$.  
We wish to examine the distances $\dist{\beta (t)}{ A}{\spc{U}}$.
By \ref{eq:d-realizer}, we may assume $\spc{U}\in\Cat{}{\kappa}.$

Extend $\beta$ to $\alpha\:[0,a]\to\spc{U}$, so that $\alpha[0,\eps]=\beta$  and $\alpha$  is a closed unit-speed curve that parametrizes 
the  quadrilateral $Q$ with sides   $\alpha([0,\eps]) =[px]$, $[xx^*]$, $[x^* p^*]$, $[p^*p]$.
 For $\eps$ sufficiently small, $\length Q < 2\varpi\kappa$ by continuity of $f_A$, and we may  apply Reshetnyak majorization (\ref{thm:major}) to  $\alpha$.  

Thus $\alpha$ is majorized by a closed convex region $D$  lying in a hemisphere $\Lob2\kappa$, where $D$ is bounded by a simple closed unit-speed curve $\tilde\alpha\:[0,a]\to\Lob2\kappa$.  By definition the majorizing map $F\:D\to \spc{U}$ is length-nonincreasing and  we may take $F\circ\tilde\alpha=\alpha$. It follows that  $\tilde\alpha$ parametrizes a convex quadrilateral $\tilde Q$ having  the same sidelengths as $Q$.  Let $\tilde\sigma$ denote the side of $\tilde Q$ opposite $\tilde\alpha([0,\eps])$.

By majorization, for $0\le t\le\eps$,
$$\dist{\tilde\alpha (t)}{ \tilde\sigma}{\Lob2\kappa}\ge  \dist{\beta (t)}{ y_t}{\spc{U}}\ge \dist{\beta (t)}{ A}{\spc{U}},$$
 where $y_t\in A$ is a point on $[p^* x^*]$.  


By construction, these inequalities are equalities  at
$t=0$ and $\eps$. 
Since $\dist{\tilde\alpha (t)}{ \tilde\sigma}{\Lob2\kappa}$, $0\le t\le \eps$, satisfies the desired convexity condition by Lemma \ref{lem:model-d-seg},
then
(\ref{SHORT.distance-to-convex}) follows.\qeds

\parit{(\ref{SHORT.short-retract}).}
For any $x\in \spc{U}=\oBall[A,\tfrac{\varpi\kappa}{2}]$, set  $x^*=f_A( x )$. 
Suppose  $x,y\in\spc{U}$.

Clearly $x=x^*$ if and only if $x\in A$.
Further, if $x\notin A$ then 
\[\mangle\hinge{x^*}{x}{p}\ge\tfrac\pi2\eqlbl{eq:<x*xp>=pi/2}\] 
for any $p\in A$;
otherwise there would be a point on $[x^*p]\subset A$ which is closer to $x$ than $x^*$.

Let us show that $\dist{x^*}{y^*}{}\le\dist{x}{y}{}$ for any $x,y\in \spc{U}$.
Without loss of generality we assume $x^*\not=y^*$ and $x\notin A$.

\parit{Case 1:} $y\in A$, so $y=y^*$.
From \ref{eq:<x*xp>=pi/2}, we have $\mangle\hinge{x^*}{x}{y^*}\ge\tfrac\pi2$.
From ??? comparison it follows that $\dist{x^*}{y^*}{}=\dist{x^*}{y}{}\le \dist{x}{y}{}$.

%%%ADD PIC

\parit{Case 2:} $x,y\notin A$.
In this case, \ref{eq:<x*xp>=pi/2} implies $\mangle\hinge{x^*}{x}{y^*}$, $\mangle\hinge{y^*}{x}{x^*}\ge\tfrac\pi2$.
Apply Reshetnyak majorization to the quadrilateral $Q$ with sides   $[xy]$, $[yy^*]$, $[y^* x^*]$, $[x^*x]$. Since a majorizing map cannot increase angles, there is a quadrilateral in  $\Lob2\kappa$ with the same sidelengths as $Q$, and whose angles at the vertices corresponding to $x^*$ and $y^*$ are $\ge\tfrac\pi2$.  It follows that 
$\dist{x^*}{y^*}{}\le \dist{x}{y}{}$.\qeds

  
\begin{thm}{Theorem on short retract, $\kappa>0$}
\label{strictly-short-retract} 
Suppose $\spc{U}\in\Cat{}{\kappa}$ where $\kappa>0$.  
Let $A\subset\spc{U} $  be a closed convex subset.
Assume $A\subset \cBall[p,\varpi\kappa]$ for some $p\in \spc{U}$.
Then $A$ is a \emph{short retract}\index{short retract} of $\spc{U}$;
i.e. there is a short map $\map[2]\:\spc{U}\to A$ which is identical on $A$.

More over if $A\subset \oBall(p,\tfrac{\varpi\kappa}{2})$, 
then the map $\map[2]$ can be chousen so that in addition 
\[\dist{\map[2](y)}{x}{}<\dist{y}{x}{}.\]
 for any $x\in A$ and $y\notin A$.
\end{thm}


\parit{Proof.} 
Applying rescaling, we can assume  $\kappa=1$.
Without loss of generality, we may assume that $p\in A$.

If $\dist{A}{x}{}\ge\tfrac\pi2$ then set $\map[2](x)=p$.

Otherwise, if $\dist{A}{x}{}<\tfrac\pi2$, by ???, 
there is unique point $x^*\in A$ that minimizes distance to $x$;
i.e. $\dist{x^*}{x}{}=\dist{A}{x}{}$.
In this case set 
\begin{align*}
\ell_x&=\dist{p}{x^*}{},
\\
\phi_x&=\tfrac\pi2-\dist[{{}}]{x^*}{x}{},
\\
\sin\psi_x&=\sin\phi_x\cdot\sin\ell_x, 
\ \ 0\le \psi_x\le \tfrac\pi2
\intertext{and define}
\map[2](x)&=\geod_{[px^*]}(\psi_x).
\end{align*}

Note that $\map[2]$ is a retraction to $A$; 
i.e.,
$\map[2](x)\in A$ for any $x\in \spc{U}$
and 
$\map[2](a)=a$ for any $a\in A$.

Let us show that $\map[2]$ is short.
Assume $x,y\in\oBall(A,\tfrac\pi2)$,
\begin{align*}
x'&=\map[2](x)
&
y'&=\map[2](y)
\\
r&=\dist{x}{y}{}
&
r'&=\dist{x'}{y'}{}
\\
d&=\dist{x^*}{y^*}{}
&
\alpha&=\angk1{p}{x^*}{y^*}
\end{align*}

Note that 
\[\cos r\le 
\cos\phi_x\cdot\cos\phi_y
-
\cos d\cdot\sin\phi_x\cdot\sin\phi_y.\eqlbl{eq:cos(r)}\]

Indeed, if $x,y\notin A$,
then 
$\mangle\hinge{x^*}{x}{y*}, 
\mangle\hinge{y^*}{y}{x*}
\ge 
\tfrac\pi2$
and
the inequality~\ref{eq:cos(r)} follows from the Arm lemma (\ref{lem:arm}).
If $x\in A$ and $y\notin A$, we get \ref{eq:cos(r)}, by angle comparison (\ref{cat-hinge}) 
since $\mangle\hinge{y^*}{y}{x*}\ge \tfrac\pi2$.
The same way \ref{eq:cos(r)} is proved 
in case $x\notin A$ and $y\in A$.
Finally, if $x,y\in A$, $\phi_x=\phi_y=\tfrac\pi2$ and $r=d$;
i.e., the inequality trivially holds.

Further note that
\[\cos\alpha
=
\frac{\cos d-\cos \ell_x\cdot\cos\ell_y}{\sin\ell_x\cdot\sin\ell_y}.\]
Applying angle-sidelength  monotonicity (\ref{cor:monoton-cba}) we get
\begin{align*}
\cos r'&\ge
\cos\psi_x\cdot\cos\psi_y
-
\cos \alpha \cdot\sin\psi_x\cdot\sin\psi_y=
\\
&=
\cos\psi_x\cdot\cos\psi_y
-(\cos d-\cos \ell_x\cdot\cos\ell_y)\cdot\sin\phi_x\cdot\sin\phi_y\ge
\\
&\ge \cos\psi_x\cdot\cos\psi_y
-\cos d\cdot\sin\phi_x\cdot\sin\phi_y
\end{align*}


Note that 
$\psi_x\le \phi_x$
and
$\psi_y\le \phi_y$;
in particular,
\[
\cos\phi_x\cdot\cos\phi_y\le \cos\psi_x\cdot\cos\psi_y.
\]
Hence 
\[\cos r'\ge \cos r;\]
i.e., the restriction $\map[2]|\oBall(A,\tfrac\pi2)$ is short.
Clearly $\map[2]$ is continuous,
since the complement of $\oBall(A,\tfrac\pi2)$ is mapped to $p$,
we get that $\map[2]$ is short; i.e.,
\[r'\le r \eqlbl{eq:cos=<cos}\]
for any $x,y\in\spc{U}$.

If we have equality in \ref{eq:cos=<cos}
then 
\[\cos\ell_x\cdot\cos\ell_y\cdot\sin\phi_x\cdot\sin\phi_y=0.\]
If $A\subset \oBall(p,\tfrac\pi2)$ then $\ell_x,\ell_y<\tfrac\pi2$;
which implies that $x\in A$ or $y\in A$.
Without loss of generality we may assume that $x\in A$.

It remains to show that if $y\notin A$ 
then the inequality~\ref{eq:cos=<cos}
is strict.
If $\dist{A}{y}{}\ge\tfrac\pi2$ then \ref{eq:cos=<cos} holds since 
the left hand side is $<\tfrac\pi2$,
while right hand side is $\ge \tfrac\pi2$.
If $\dist{A}{y}{}<\tfrac\pi2$ then $\phi_y>0$ and clearly $\psi_y<\phi_y$,
hence the inequality~\ref{eq:cos=<cos} is strict.
\qeds

We fail to find a transparent geometric proof of the statement above.
Below you will find a geometric way to think about the construction;
compare to the construction 
in the proof of Kirszbraun's theorem (\ref{thm:kirsz+}).

\parit{Geometric interpretation of the map $\map[2]$.}
Set $\mathring{\spc{U}}=\Cone \spc{U}$;
denote by $\mathring{A}$ the subcone of $\mathring{\spc{U}}$ spanned by $A$.
The space $\spc{U}$ can be naturally identified with the unit sphere in $\mathring{\spc{U}}$;
i.e., the set 
\[\set{z\in \mathring{\spc{U}}}{|z|=1}.\]

According to ??? $\mathring{\spc{U}}\in\cCat{}{0}$.
Note that $\mathring{A}$ forms a convex closed subset of $\mathring{\spc{U}}$.
According to ???, for any point $x$ there is unique point $\hat x\in \mathring{A}$
which minimize the distance to $x$;
i.e., $\dist{\hat x}{x}{}=\dist{A}{x}{}$.
(If $|\hat x|\ne0$ then in the notations above we have
$x^*=\tfrac1{|\hat x|}\cdot\hat x$.)

Consider the ray $t\mapsto t\cdot p$ in  $\mathring{\spc{U}}$.
According to ???, %ASK Stephanie???
for given $s\in \mathring{\spc{U}}$
the geodesics $\geod_{[s\ t\cdot p]}$ converge as $t\to\infty$ to a ray, 
say $\alpha_s\:[0,\infty)\to \mathring{\spc{U}}$.



Note that if $|x|=1$ then $|\hat x|\le 1$.
By assumption for any $a\in A$ the function $t\mapsto |\alpha_a(t)|$ is monotonicity increasing.
Therefore there is unique value $t_x\ge 0$ such that
$|\alpha_{\hat x}(t_x)|=1$.
Consider the map $\map[2]\:\spc{U}\to A$
defined as 
\[\map[2](x)=\alpha_{\hat x}(t_x).\]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{jac-length.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{tmp-13.tex}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Warped products}\label{sec:wp-def}
First we define  $\spc{B}\times_f\spc{F}$ for length spaces $\spc{B}$ and $\spc{F}$.  Then we expand the definition to allow arbitrary metric spaces $\spc{F}$.

In this paper, 
$\JJ$ always denotes some finite closed  interval.

%Let $\II=[0,1]$, and $\JJ$ be an arbitrary interval.

%Suppose $\spc{B}$ and $\spc{F}$ are length spaces, and
%$f:\spc{B}\to\RR_{\ge 0}$ is Lipschitz.  
%For a  map $\alpha\:\II\to  \spc{B}\times \spc{F}$,  with Lipschitz projections $\alpha_\spc{B}$ and  $\alpha_\spc{F}$  to $\spc{B}$ and $\spc{F}$, define 
%\begin{equation*}
%\length\alpha = \int \sqrt{v_\spc{B}^2(t) + f^2(\alpha_\spc{B}(t))v_\spc{F}^2(t)}\cdot \d t.
%\eqlbl{wp-length}
%\end{equation*}
%Here $v_\spc{B}$ and $v_\spc{F}$ are the speeds, defined almost everywhere, of $\alpha_\spc{B}$ and  $\alpha_\spc{F}$, and $\int$ is the Lebesgue integral. 
%Define a pseudometric $d$ on  $\spc{B}\times \spc{F}$ by infimum of path-lengths, taken over all $\alpha$.
%\begin{thm}{Definition}\label{def:wp1} % If $\spc{B}$ and  $\spc{F}$ are length spaces, the  \emph{warped product} $\spc{B}\times_f\spc{F}$ is the metric space corresponding to $d$, i.e. the quotient under the equivalence relation of zero distance between points. The equivalence classes containing more than one point have the form  $\{p\}\times \spc{F}$ where $f(p)=0$; we continue to denote this class by $(p,x)$, for any $ x\in \spc{F}$.
\begin{thm}{Definition}\label{def:wp1}
Consider the topological space  $(\spc{B}\times \spc{F})/\!\sim$, where the elements of $\{p\}\times \spc{F}$ are identified if $f( p )=0$.  We denote this class by $\overline p$, or by  any of its representatives $(p,\varphi)$, $\phi\in \spc{F}$.

%Consider length spaces $\spc{B}$ and  $\spc{F}$,  and a continuous  function
%$f:\spc{B}\to\RR_{\ge 0}$. 
%An \emph{admissible curve} is a  map $\gamma=(\gamma_{\spc{B}},\gamma_{\spc{F}}):
%\II\to  \spc{B}\times \spc{F}$,  with  projections $\gamma_\spc{B}$ and  $\gamma_\spc{F}$  to $\spc{B}$ and $\spc{F}$,
% together with its associated \emph{length}.
% We assume $\gamma_\spc{B}$ is Lipschitz, and the restriction of $\gamma_\spc{F}$ to the closure of each maximal subinterval of $\,I -(f\circ\gamma_\spc{B})^{-1}(0)$ is  Lipschitz.  We define   
%\[
%\length\gamma 
%= 
%\int\limits_\II \sqrt{v_\spc{B}^2(t) + f^2(\gamma_\spc{B}(t))\cdot v_\spc{F}^2(t)}  \cdot\d t.
%\eqlbl{wp-length}
%\]
%Here $v_\spc{B}$ is the speed of  of $\gamma_\spc{B}$, defined almost everywhere;  $v_\spc{F}$ is the speed of  $\gamma_\spc{F}$, defined almost everywhere on $\II -(f\circ\gamma_\spc{B}^{-1}(0)$; and $\int$ is the Lebesgue integral. 
%The class of admissible curves, being cl  osed under restriction, concatenation and linear reparameterization, forms a \emph{length structure} \cite[\S 2.1.1]{BBI}.

An \emph{admissible curve} for the triple $(\spc{B},f,\spc{F})$ is a curve $\gamma:\JJ\to (\spc{B}\times \spc{F})/\!\sim$.  We write $\gamma=(\gamma_\spc{B},\gamma_\spc{F})$ for $\gamma_\spc{B}:\JJ\to \spc{B}$   
and $\gamma_\spc{F}:\JJ^+\to \spc{F}$, where  $\JJ^0=(f\circ\gamma_\spc{B})^{-1}(0)$, $\JJ^+=\JJ-\JJ^0$.  
Set  $\JJ^+=\sqcup_{i=1,2,\ldots} \,\JJ^i$, where the $\JJ^i$ are maximal open subintervals of $\JJ^+$. 
We further assume $\gamma_\spc{B}$ and   $\gamma_\spc{F}|\JJ^i$ to be Lipschitz, where   $\gamma_\spc{F}|\JJ^i$, $i=1,\ldots$, have a uniform Lipschitz constant. 
(Our class of admissible curves does not satisfy the concatenation property of  length structures in the sense of \cite{BBI}.) 
Set
\[\length\gamma\  \ =\ \ \int _{\JJ}\,\sqrt{
v_B^2+ (f\circ\gamma_\spc{B})^2\cdot v_F^2}\,,
\eqlbl{eq:length}\]
where $\int$ is Lebesgue integral, $v_\spc{B}$ is the speed of $\gamma_B$, $v_\spc{F}|\JJ_+$ is  the speed of $\gamma_\spc{F}|\JJ_+$ and $v_\spc{F}|\JJ_0=0$.   
Then the integrand is defined  almost everywhere on $\JJ$  and bounded.  

Equivalently,  
\[
\length\gamma\  \ =\ \  \sum_i \int _{\JJ_i}\sqrt{
v_\spc{B}^2+ (f\circ\gamma_\spc{B})^2\cdot v_\spc{F}^2}  \ \ +\ \  \length\, (\gamma_\spc{B}|\JJ_0).
\]
   Here the first term
 is defined, 
 independently of enumeration, because the summands are positive.  
 
  
Then the   \emph{warped product} \,$\spc{B}\times_f\spc{F}$\, is the corresponding intrinsic  space, where distance is given by infimum of lengths of admissible curves joining two given points. 

We refer to $\spc{B}$ and $\spc{F}$ as \emph{base} and \emph{fiber} respectively.
$\spc{B}\times\{\phi_0\}$  is called a \emph{horizontal leaf};  and $\{p_0\}\times \spc{F}$ when $f( p_0 )>0$,   a \emph{vertical leaf}.
\end{thm}

The vanishing set $f^{-1}(0)$ of $f$ represents the set on which the horizontal leaves $\spc{B}\times\{\phi_0\}$ are glued together.  At these points there is no well-defined projection $\gamma_\spc{F}$ to $\spc{F}$. 

\begin{thm}{Proposition}
\label{prop:wp-basics}
The warped product $\spc{\spc{B}}\times_f\spc{F}$ satisfies:
\begin{enumerate}

\item\label{horiz-leaf-proj}
The intrinsic and extrinsic metrics   of any  horizontal leaf $B\times\{\phi_0\}$ agree, and projection $(p,\phi_0)\mapsto p$   is an isometry onto $\spc{B}$.

\item\label{vert-leaf-proj}
If $f(p_0)\ne 0$, then the projection $(p_0,\phi)\mapsto \phi$ of any  vertical leaf $\{p_0\}\times \spc{F}$, with its length-metric,  is a homothety onto $\spc{F}$ with multiplier $1/f(p_0)$.

\item\label{Df>0}
If  $f$ achieves a positive minimum at $p_0$, then the intrinsic and extrinsic metrics of
$\{p_0\} \times \spc{F}$ agree.
\end{enumerate}

\end{thm}


\parit{Proof.} 
Claims  \ref{horiz-leaf-proj} and \ref{vert-leaf-proj}  are immediate from the 
length formula  \ref{eq:length}.

Also by \ref{eq:length}, the projection onto  $\{p_0\} \times \spc{F}$ given by  $(p,\phi)\mapsto (p_o,\phi)$ is length-nonincreasing if $p_0$ is a minimum point of $f$.  
Hence \ref{Df>0}.
\qeds


A horizontal leaf need not be convex even if $\spc{B}\times_f\spc{F}$ is a geodesic space, since vanishing of the warping function$\,f$ allows geodesics to bifurcate into distinct horizontal leaves.  For instance, suppose $\alpha:[0,1]\to \spc{B}$ is a geodesic of $\spc{B}$ such that 
$f(\alpha(0))=f(\alpha(1))
=0$ and $f\circ\alpha$ is not identically $0$.
 Then for any distinct $\phi_1, \phi_2 \in \spc{F}$, the geodesic $(\alpha,\phi_2)$ of  $\spc{B} \times_f\spc{F}$ has its endpoints in $\spc{B}\times\{\phi_1\}$ but does not lie in $\spc{B}\times\{\phi_1\}$.

Now we show that distance in a warped product is fiber-independent, in the sense that distances may be calculated by substituting for $\spc{F}$ a different intrinsic space.  Propositions \ref{prop:wp-basics} and \ref{prop:fiber-independence} summarize properties that for the case $f>0$ are given in \cite{had-wp}.  Proposition \ref{fiber-proj} is due to Chen.

\begin{thm}{Theorem (Fiber-independence)}\label{prop:fiber-independence}
Let $\spc{W}=\spc{B}\times_f\spc{F}$ and $\spc{W}^*=\spc{B}\times_f\spc{F}^*$, where 
$\spc{F}^*\ne$ point\, is an intrinsic space. 
\begin{subthm}{dist-fiber-indep}
Let $p,q\in \spc{B}$, $\phi,\psi\in \spc{F}$, and $\phi^*,\psi^*\in \spc{F}^*$.
\[
\text{If  }\ \  \ 
|\phi\,\psi |_\spc{F}=|\phi^*\,\psi^*|_{\spc{F}^*}\,,\ \ \ \text{then }\ \ \
|(p,\phi)\, (q,\psi) |_\spc{W}=|(p,\phi^*)\, (q,\psi^*)|_{\spc{W}}\\\spc{^*} 
.\]
\end{subthm}

\begin{subthm}{fiber-proj}
\cite{C}
$\gamma_\spc{F}$ is a pregeodesic in $\spc{F}$.
\end{subthm}

\begin{subthm}{geo-fiber-indep}
Suppose $\beta^*:\JJ\to \spc{F}^*$ is a pregeodesic in $\spc{F}^*$ such that  $\beta^*$ and $\gamma_\spc{F}$ have the same  speed, i.e. $v_{\spc{F}^*}=v_\spc{F}$ where $v_{\spc{F}}^*$ is the speed of $\beta^*$.  Then $(\gamma_\spc{B},\beta^*)$ is a geodesic in $\spc{B}\times_f\spc{F}^*$.
\end{subthm}
\end{thm}

\parit{Proof.} 
\ref{SHORT.dist-fiber-indep})
Let $\gamma_i:\JJ\to \spc{W}$ be admissible curves with endpoints $(p,\varphi)$, $(q,\psi)$,  where $\length\gamma_i\to |(p,\varphi)\, (q,\psi) |$.

Suppose $f\circ(\gamma_i)_{\spc{B}}>0$.  Set $L_i=\length\, (\gamma_i)_\spc{F}$ and $v_i=\speed\,(\gamma_i)_\spc{F}$. Let $\beta^*_i$ be curves in $\spc{F}^*$  with endpoints $\varphi^*$, $\psi^*$ and lengths $L_i^*\to |\varphi^*\,\psi^*|=|\varphi\,\psi |$. Without loss of generality, $L_i^*\le L_i+\epsilon_i$, $\epsilon_i\to 0$.  Define $\gamma_i^*:\JJ\to \spc{W}^*$ by setting $(\gamma_i^*)_\spc{B}=(\gamma_i)_\spc{B}$, and  letting \,$(\gamma_i^*)_{\spc{F}^*}$\,  be \,$\beta_i^*$\, reparametrized with speed $(L_i^*/L_i)\cdot v_i$. By the length formula  \ref{eq:length},  $|(p,\varphi)\, (q,\psi) |=\lim\length(\gamma_i )\ge \limsup(\length\gamma_i^*)$. Hence  $|(p,\varphi)\, (q,\psi) |\ge |(p,\varphi^*)\, (q,\psi^*)|$.  


Suppose $(f\circ(\gamma_i)_\spc{B})^{-1}(0)\ne\emptyset$. By the length formula,  there is an admissible curve $\check\gamma_i$ with endpoints  $(p,\varphi)$, $(q,\psi)$ that is not longer than $\gamma_i$, such that $(\check\gamma_i)_\spc{B}=(\gamma_i)_\spc{B}$ and $(\check\gamma_i)_\spc{F}$  is constant on each maximal subinterval on which  $f\circ(\gamma_i)_\spc{B}>0$. Thus we may assume  $(\gamma_i)_\spc{F}$ has this form, hence $\length\gamma_i=\length(\gamma_i)_\spc{B}$. There are  curves $\gamma_i^*$ of the same form  in $\spc{W}^*$ with endpoints  
$(p,\varphi^*)$, $(q,\psi^*)$, such that $(\gamma_i^*)_\spc{B}=(\gamma_i)_\spc{B}$  and \,$\length\gamma_i^*=\length(\gamma_i)_\spc{B}=\length\gamma_i$.  

Therefore in all cases, $|(p,\varphi)\, (q,\psi) |\ge |(p,\varphi^*)\, (q,\psi^*)|$.
Reversing the roles of $\spc{W}$ and $\spc{W}^*$ proves \ref{SHORT.dist-fiber-indep}).

\ref{SHORT.fiber-proj}) Suppose $\gamma_\spc{F}$ has length $L>|\varphi\,\psi|$. Set $v=\speed\gamma_\spc{F}$. 
Let $\beta:\JJ\to \spc{F}$ be a curve with endpoints $\varphi$, $\psi$ and  length $L'<L$. Then the length of $\gamma$ is reduced  by replacing $\gamma_\spc{F}$ with the reparametrization of $\beta$  with speed $(L'/L)\cdot v$.  This contradiction gives \ref{SHORT.fiber-proj}).

\ref{SHORT.geo-fiber-indep}) Immediate from \ref{SHORT.dist-fiber-indep}) and the length formula  \ref{eq:length}.
\qeds



The simplest example is the \emph{direct product} $\spc{B}\times_1 \spc{F}$, also written $\spc{B}\times \spc{F}$.  
For $p,q\in \spc{B}$ and $\varphi, \psi\in \spc{F}$, the direct product metric simplifies to
\[
\dist{(p,\varphi)}{(q,\psi)}{} =\sqrt{\dist[2]{p}{q}{} + \dist[2]{\varphi}{\psi}{}}.
\]
This is taken as the defining formula for the direct product of two arbitrary metric spaces $\spc{B}$ and $\spc{F}$. 


%\begin{thm}{Lemma}\label{lem:fiber-independence}
%If $\spc{B}$, $\spc{F}$ and $\spc{\spc{X}}$ are length spaces, then distances in $\spc{B}\times_f\spc{F}$ and $\spc{B}\times_f\spc{X}$ satisfy, for $p,q\in \spc{B}$, $x,y\in \spc{F}$ and $\check{x},\check{y}\in \spc{X}$:
%\[
%\dist{(p,x)}{(q,y)}{}=\dist{(p,\check{x})}{(q,\check{y})}{} \ \ \ \ \text{if}\ \ \ \ \dist{x}{y}{}=\dist{\check{x}}{\check{y}}{}.
%\]
%\end{thm}

%\parit{Proof.} The length formula \ref{wp-length} for $\alpha$ depends only on $\alpha_\spc{B}$ and $v_\spc{F}$.  Therefore
%\begin{equation*}
%\dist{(p,x)}{(q,y)}{}=\inf\left\{\int \sqrt{v_\spc{B}^2(t) + f^2(\alpha_\spc{B}(t))v_\spc{F}^2(t)}\cdot \d t\}\right\},
%\eqlbl{wp-distance}
%\end{equation*}
%where the infimum is taken over all Lipschitz curves $\alpha_\spc{B}:\II\to\spc{F}$ from $p$ to $q$, and all Lipschitz functions 
%$v_\spc{F}: \II\to\RR_{\ge 0}$ such that  $ \int v_\spc{F}\ge\dist{x}{y}{}.$
%The lemma follows.  \qeds

%\parbf{Remark.}
%\label{22remark} 
%Suppose the infimum in \ref{wp-distance} is realized by  a sequence of curves ${(\alpha_\spc{B})}_n$  that intersect  $f^{-1}0$, 
%as happens for instance if there is a geodesic $\alpha$ of $\spc{B}\times_f\spc{F}$  joining $(p,x)$ and $(q,y)$ and satisfying $\alpha_\spc{B}\cap f^{-1}0\ne\emptyset$.   Since $f$ is Lipschitz,  the infimum may be realized by choosing corresponding speed functions  $v_\spc{F}$ that have support in arbitrarily small neighborhoods of $\alpha_\spc{B}^{-1}0$ and are linear on intervals where they do not vanish.  Then    $\dist{(p,x)}{(q,y)}{}=\dist{p}{q}{}$. In the case of a geodesic $\alpha$ with $\alpha_\spc{B}\cap f^{-1}0\ne\emptyset$, $\alpha_\spc{F}$ is constant on intervals on which $f$ does not vanish.

\
The following definition extends Definition \ref{def:wp1}.


\begin{thm}{Definition}\label{def:wp2}
If $\spc{B}$ is a length space and $\spc{F}$ is an arbitrary metric space, we  define  the metric of  the  \emph{warped product} $\spc{W}=\spc{B}\times_f\spc{F}$ by  \ref{dist-fiber-indep}), taking
%, using any convenient geodesic space $\spc{F}$ with $\diam \spc{F}\ge \dist{x}{y}{}$, e.g., 
 $\spc{F}^*=\RR$. Thus 
 %if $f(p)=0$  the points of $\{p\}\times \spc{F}$ are identified, and  
 for any  $(p,\phi), (q,\psi) \in 
 \spc{B}\times\spc{F}$,
 \[
\dist{(p,\phi)}{(q,\psi)}{\spc{W}}=\dist{(p,0)}{(q,|xy|)}{\spc{B}\times_f \RR}. 
\]
\end{thm}


\begin{thm}{Proposition (Vanishing warping function)}
\label{prop:f=0} 
%Consider the warped product $B\times_fF$, where $B$ and  $F$ are length  spaces and
%$f:B\to\R_{\ge 0}$ is a continuous function.  
Let $\gamma=(\gamma_\spc{B},\gamma_\spc{F}):\JJ\to \spc{W}=\spc{B}\times_f \RR$ be a geodesic  joining $(p,\phi)$ and $(q,\psi)$.  Suppose $\JJ_0\ne\emptyset$ where $\JJ_0=(f\circ\gamma_\spc{B})^{-1}(0)$.  


\begin{subthm}{f=0-fiber-projection} The  restriction of $\gamma_F$ to any maximal subinterval $\JJ_i$ of $\JJ-\JJ_0$   is constant. 
 If $\JJ_i$ Êhas no common endpoint with $\JJ$, the constant can be changed to any other
Êpoint in $\spc{F}$ and the resulting curve will still be a geodesic in $\spc{B}\times_f\spc{F}$ with the same endpoints.
\end{subthm}

\begin{subthm}{f=0-distance}
$|(p,\varphi)\,(q,\psi)| = \length \gamma_\spc{B}$.
\end{subthm}

\begin{subthm}{f=0-base-projection}{\rm (Two-piece property)}
$\gamma_\spc{B}$ consists of two geodesics of $\spc{B}$ that intersect on the maximal subinterval $[t_0,t_1]$ of $\JJ$ having endpoints in $\JJ_0$. 
\end{subthm}
\end{thm}

\parit{Proof.}
By the length formula \ref{eq:length}, any curve in $\spc{B}$ joining $p$ and  $q$ and passing through $Z=f^{-1}(0)$ is the projection of a curve in $\spc{B}\times_f\spc{F}$ of the same length joining $(p,\phi)$ and $(q,\psi)$, and such that the projection to $\spc{F}$ on each interval $\JJ_i$ is constant.  
Claims \ref{SHORT.f=0-fiber-projection}) and \ref{SHORT.f=0-distance}) follow.  

It follows also that  $\gamma_\spc{B}$ minimizes length of curves in $\spc{B}$ from $p$ to $q$ that intersect $Z$.  If $t_0=t_1$ in claim \ref{SHORT.f=0-base-projection}), it follows that $\gamma |[0,t_0]$ and $\gamma |[t_0,1]$ are geodesics and the claim holds. Suppose $t_0<t_1$.  Then $\gamma |[0,t_1]$ is  a geodesic, since otherwise  by the triangle inequality there is a curve from $p$ to $q$ passing through $\gamma(t_1)\in Z$ that is shorter than $\gamma$.  Similarly,  
$\gamma |[t_0,1]$ is a geodesic.
%Let  $a\in (f\circ\gamma_\spc{B})^{-1}(0)$. For a nontrivial closed subinterval $\,\JJ$ of $\,\II$ with endpoint $a$, we may choose  $v_\spc{F}$ satisfying (ii*) to have constant value $L/|\JJ|$ on $\,\JJ$,  and to vanish on the interior of $\,\II-\JJ$.   Then  %%% notation for length??
%
%\begin{align*}
%\int\limits_\II \sqrt{v_\spc{B}^2(t) + f^2(\gamma_\spc{B}(t))\cdot v_\spc{F}^2(t)} \cdot \d t 
%&
%\le \int\limits_\II v_\spc{B}(t) \cdot \d t + 
%\int\limits_\JJ f(\gamma_\spc{B}(t))\cdot v_\spc{F}(t)\cdot \d t\\
%&
%\le  \int\limits_\II v_\spc{B}(t) \cdot \d t +\left( \max f|\gamma_\spc{B}^{-1}(J)\right)(L/|J|)|J| \\
%&
%\le 
%\int\limits_\II v_\spc{B}(t) \cdot\d t 
%+\left( \max f|\gamma_\spc{B}^{-1}(J)\right)L.
%\end{align*}
%By continuity of $f$, the second term approaches $0$ as $|\JJ|\to 0$. Therefore claim (\ref{SHORT.f=0-dist}) follows from (\ref{wp-distance}).
%
%Claims (\ref{SHORT.f=0-base-proj}), (\ref{SHORT.f=0-fiber-proj}) and (\ref{SHORT.f=0-fiber-choice}) follow directly from (\ref{SHORT.f=0-dist}) and the length formula (\ref{wp-length}).
\qeds

The following theorem is from \cite{AB3} and \cite{BP}.

\begin{thm}{Clairaut's Theorem}
\label{thm:clairaut} 
%Suppose $B$ and  $F$ are length  spaces and
%$f:B\to\R_{\ge 0}$ is a continuous function.  

Let $\gamma=(\gamma_\spc{B},\gamma_\spc{F}):\JJ\to B\times_f\spc{F}$ be a geodesic with speed $v$.  Then $v_\spc{B}$ and an extension $\overline{v}_\spc{F}$
of $v_\spc{F}$ are defined and
Lipschitz
 continuous for all $t\in \JJ$, and 
 there is a constant $c(\gamma)$ such that\[
(f\circ \gamma_\spc{B})^{2}\cdot \overline{v}_\spc{F}=c(\gamma);
\eqlbl{eq:clairaut-fiber}
\]
\[
\text{if } f\circ\gamma_B>0,\,\, \text{ then } v_\spc{B} = \sqrt{v^2-(c(\gamma)/f\circ\gamma_\spc{B})^2}.
\eqlbl{eq:clairaut-base}
\]
\end{thm}

\parit{Proof.} 
Suppose $\JJ_0\ne\emptyset$ where $\JJ_0=(f\circ\gamma_\spc{B})^{-1}(0)$.  
By Proposition \ref{f=0-fiber-projection},  $v_\spc{F}:\JJ-\JJ_0\to \spc{F}$ satisfies $v_\spc{F}=0$. In this case, $v_F$ may be extended to all of $\JJ$ by setting 
$\overline{v}_\spc{F} \equiv 0$, and
\ref{eq:clairaut-fiber} holds with $c(\gamma)=0$. Moreover, from the two-piece property we conclude that $\gamma_\spc{B}$ is a geodesic, with the only exception
possible being a single break point  when $t_0 = t_1$;  in this case, $v_\spc{B}$ still exists   with constant value $v$.

So suppose $f\circ \gamma_
\spc{B}>0\,$:

\begin{clm}{}\label{clairaut-ae} Equations \ref{eq:clairaut-fiber} and \ref{eq:clairaut-base} hold almost everywhere.  
\end{clm}

We know that $v_\spc{B},v_\spc{F}$ exist almost everywhere and
$v_\spc{B}^2 + f^2v_\spc{F}^2 =v^2$ almost everywhere. Thus it suffices to verify \ref{eq:clairaut-fiber} almost everywhere, namely, to show that for any closed subintervals $\JJ_1,\JJ_2$ of $\JJ$ of the same length,
$$\int\limits_{\JJ_1 }f^2\cdot v_\spc{F} = \int_{\JJ_2 } f^2\cdot v_\spc{F}.$$

By Schwarz's inequality, the energy of $\gamma$, 
$$\int\limits_\JJ({v_\spc{B}}^2+f^2\cdot {v_\spc{F}}^2),$$ is a minimum among all curves
$\~\gamma$ connecting the endpoints of $\gamma$. Without loss of
generality we may assume $\JJ_1$ and $\JJ_2$ do not overlap. For $|u|$
sufficiently small we define a new curve $\gamma_u = (\gamma_\spc{B},
\beta_u)$ such that $\beta_u$ is a reparametrization of $\gamma_\spc{F}$ with
speed

$$w_u =
\begin{cases}
v_\spc{F} \quad &\text{\ on\ } \JJ- (\JJ_1\cup \JJ_2)\\
v_\spc{F}+u \quad &\text{\ on\ } \JJ_1\\
v_\spc{F}-u \quad &\text{\ on\ } \JJ_2.
\end{cases}
$$

If  $s$ is the arclength parametrization of $\gamma_\spc{F}$ starting at
$s(0) = $ lefthand endpoint $\gamma_\spc{F}(a)$ of $\gamma_\spc{F}$, then specifically $\beta_u(s) = s(\int_a^s
w_u)$. Hence the energy of $\gamma_u$ is
\begin{align*}
\int\limits_\JJ(v&^2+f^2\cdot w_u^2) 
= \int\limits_{\JJ -J_1\cup \JJ_2} (v^2+f^2\cdot w^2) +\\
&+\int\limits_{\JJ_1}(v^2+f^2\cdot w_u^2 + 2\cdot u\cdot f^2\cdot w + u^2\cdot f^2) +\int_{\JJ_2}v^2+f^2\cdot w_u^2 - 2\cdot u\cdot f^2\cdot w
+ u^2\cdot f^2).
\end{align*}
At $u=0$,  the minimum occurs and calculating the
derivative gives
$$\int\limits_{\JJ_1} 2\cdot f^2\cdot w - \int\limits_{\JJ_2} 2\cdot f^2\cdot w = 0.$$ 
The claim follows.  

\begin{clm}{}\label{clm:clairaut} $v_\spc{F}$ is defined and continuous on $\JJ$ and satisfies \ref{eq:clairaut-fiber}.
\end{clm}

Set $c=c(\gamma)$.
Since $c/(f\circ \gamma_\spc{B})^{2}$ is defined and continuous on $\JJ$, then $v_ \spc{F}$ has a continuous extension $\overline{v}_\spc{F}$ to all of $\JJ$ by claim \ref{clairaut-ae}. It follows that the arclength function  $s(t)$ of   $\gamma_\spc{F}$ is obtained by integrating the continuous function $\overline{v}_\spc{F}$, and so $ds/dt=\overline{v}_\spc{F}$. Since $\gamma_\spc{F}$ is a pregeodesic, $ds/dt$ is the speed of $\gamma_\spc{F}$, i.e. $v_\spc{F}=ds/dt=\overline{v}_\spc{F}$.  The claim follows.

\begin{clm}{}\label{clm:v_B} $v_\spc{B}$ is defined and continuous on $\JJ$ and satisfies \ref{eq:clairaut-base}.
\end{clm}


It suffices to assume $0$ is in interior $\JJ$, and show that $v_\spc{B}$ is defined and continuous at $t=0$. 

Suppose $\speed\gamma=1$.  Let  $f(\gamma_\spc{B}(0))=b>0$. For 
 $\eps>0$, consider a ball B $=\oBall[\gamma_\spc{B}(0),2R]\subset f^{-1}(b+\eps,b-\eps)$.  If $0<s_1,s_2< R$, then $\gamma_\spc{B}|[-s_1,s_2]\subset$ B.
 
Comparing the warped product metric with the Cartesian product metric on
 $\spc{B}\times_{b+\eps}\spc{F}$,
\[
s_1+s_2 < 
\sqrt{{\dist{\gamma_\spc{B}(-s_1)}{\gamma_\spc{B}(s_2)}{}}^2 + (b+\eps)^2\cdot {\dist{\gamma_\spc{F}(-s_1)}{\gamma_\spc{F}(s_2)}{}}^2}.
\eqlbl{compare-product}\]
Since \ref{eq:clairaut-fiber} holds almost everywhere,
\[
\dist{\gamma_\spc{F}(-s_1)}{ \gamma_\spc{F}(s_2)}{}= \int_{-s_1}^{s_2}\frac{c}{f(\gamma_\spc{B}(s))^2}ds
< (s_1+s_2)\cdot\frac{c}{(b-\epsilon)^2}.
\]

Hence by \ref{compare-product}
$${\dist{\gamma_\spc{B}(-s_1)}{ \gamma_\spc{B}(s_2)}{}}^2 >
(s_1+s_2)^2\cdot \left(1 -\frac{(b+\eps)^2\cdot c^2}{(b-\eps)^4}\right).$$

Similarly, comparison with  
$B\times_{b-\epsilon}F$ gives an upper bound:
$${\dist{\gamma_\spc{B}(-s_1)} {\gamma_\spc{B}(s_2)}{}}^2 <
(s_1+s_2)^2\cdot \left(1 -\frac{(b-\eps)^2\cdot c^2}{(b+\eps)^4}\right).$$

Dividing by $(s_1+s_2)^2$, and taking the limit first as
$s_1, s_2 \to 0$, then as $\eps \to 0$, we obtain that  $v_\spc{B}^2$ exists and  equals $1- (c/b)^2$,  the value needed
for continuity.


By (\ref{eq:clairaut-fiber}), if  $\speed\gamma =a$ then $c(\gamma)=a\cdot c(\check\gamma)$ where  $\check\gamma$ is a unitspeed reparametrization of $\gamma$. Hence \ref{eq:clairaut-base}.

\begin{clm}{}
$v_\spc{B}$ and $v_\spc{F}$ are Lipschitz continuous.
\end{clm}

This claim follows from \ref{eq:clairaut-fiber} and \ref{eq:clairaut-base}, since we assume $f$ is locally Lipschitz.
\qeds

\begin{thm}{Corollary (Vertical geodesics)}
 \label{cor:vertical}
Let $\gamma=(\gamma_\spc{B},\gamma_\spc{F}):[-s_0,s_0]\to \spc{B}\times_f\spc{F}$ be a geodesic with speed $a$, 
where   $\gamma(-s_0)$ and $\gamma(s_0)$ lie in the
same vertical leaf $\{p\}\times \spc{F}$. Then
\begin{enumerate}
\item\label{F-midpt}
If $f\circ\gamma_\spc{B}>0$, then $\gamma_\spc{F}(0)$ is the midpoint of $\gamma_\spc{F}$.

\item\label{symmetry}If $f\circ\gamma_\spc{B}>0$, there is a geodesic $\check\gamma:[-s_0,s_0]\to \spc{B}\times_f\spc{F}$ with the same endpoints as $\gamma$ that is symmetric about its midpoint, i.e., $\check\gamma_\spc{B}(-s) = \check\gamma_\spc{B}(s)$.

 \item\label{F-midpt1}
 If $\,(f\circ\gamma_\spc{B})^{-1}(0)\ne\emptyset$, then $\gamma_\spc{B}(0)$ is a nearest point to $p$ of $Z=f^{-1}(0)$.

 \item\label{min}
The minimum value of  \,$f\circ\gamma_\spc{B}$\, is \,$(f\circ \gamma_\spc{B})(0))=c(\gamma)/ a$.


\item\label{speed-0}
If $f\circ\gamma_\spc{B}>0$, then the speed $v_\spc{B}$ of $\gamma_B$ satisfies 
$v_\spc{B}(s)=0$ if and only if  $(f\circ\gamma_\spc{B})(s)=c(\gamma)/ a$.

\end{enumerate} 
\end{thm}

\begin{proof}
Suppose  $f\circ\gamma_\spc{B} >0$.  
 
It suffices to take 
 $\spc{F}=[-\ell/2,\ell/2]$, $\gamma_\spc{F}(-s_0)= -\ell/2$,  $\gamma_\spc{F}(s_0)=\ell/2$, 
where $\ell=\length\gamma_F$. Indeed, by Proposition \ref{geo-fiber-indep},
 $\gamma_\spc{B}$ remains unchanged by this substitution; and by \ref{eq:clairaut-fiber}, $c(\gamma)$ also remains unchanged.

Without loss of generality, the midpoint of  $\gamma_\spc{F}$ is $\gamma_\spc{F}(s_1)$ for $s_1\in [0,s_0)$.

The reflection of $\spc{F}$ in $0$ induces an isometric reflection of $\spc{B}\times_f \spc{F}$. Let $\check\gamma: [-s_0+2s_1,s_0]\to \spc{B}\times_f\spc{F}$ be defined in two halves, for which the second half coincides with $\gamma$ on $[s_1,s_0]$ and first half traces in reverse the reflection of the first half on $[-s_0+2s_1, s_1]$. Then  $\check\gamma$ has the same endpoints as $\gamma$; both arcs have the same length, $a(s_0-s_1)$, hence $\length\check\gamma =  
2a(s_0-s_1)\le 2as_0= \length \gamma$, with equality if and only if $s_1=0$.  Since $\gamma$ is a geodesic, $s_1=0$, hence  \ref{F-midpt} and \ref{symmetry}. 


Since $\check v_\spc{B}(0)=0$ where $\check v_\spc{B}$ is the speed of $\check\gamma_\spc{B}$, we also have $v_\spc{B}(0)=0$.  By \ref{eq:clairaut-base}, the vanishing set of $v_\spc{B}$ is also the set on which  $f\circ\gamma_\spc{B}$ takes its minimum value $c(\gamma)/a$, hence \ref{min} and \ref{speed-0}.


Alternatively, suppose $(f\circ\gamma_\spc{B})^{-1}(0)\ne \emptyset$. 
Since $\gamma_\spc{B}$ minimizes length of loops in $\spc{B}$ at $p$  that intersect $Z$, we have  \ref{F-midpt1}.  Since $c(\gamma)=0$, 
\ref{min} is immediate.
\end{proof}

\parbf{Remark.}
Let $L$ denote  \,$\length\gamma$\, as defined by \ref{eq:length}.  Then \,$L=L_{\,\Sigma}$,\, for
\[
L_{\,\Sigma}\,\,=\,\sup_{t_0<\ldots<t_n}\,\sum_{i=1}^n \,d_{\,i}\,,
\eqlbl{eq:length}\]
where the supremum is taken over all partitions  \,$t_0<\ldots<t_n$\, of $\JJ$.  Here, letting $\overline t_i$ be a minimum point of $(f\circ\gamma_\spc{B})|[t_{i-1}\,t_i]$\,, 
\[
d_i=
\begin{cases}
 \dist{\gamma(t_i)}{\gamma(t_{i-1})}{\spc{B}\,\times(f\circ\gamma_\spc{B})(\overline t_i)\cdot \spc{F}} 
& \text{if }(f\circ\gamma_\spc{B})(\overline t_i)>0,\\
\dist{\gamma_\spc{B}(t_i)}{\gamma_\spc{B}(t_{i-1})}{\spc{B}}
\quad & \text{if } (f\circ\gamma_\spc{B})(\overline t_i)=0,
\end{cases}
 \]
where $\spc{B}\,\times\,(f\circ\gamma_\spc{B})(\overline t_i)\cdot \spc{F}$\, denotes the Cartesian product  of $\spc{B}$ with a scaling of $\spc{F}$.
 The choice of  $\overline t_i$ ensures the formula is well-defined and any sequence of successively refined   sums is nondecreasing. 
The proof that \,$L=L_{\Sigma}$\,  proceeds  as in the classical case  for length of an absolutely continuous curve.
 
It is natural to ask if the length induced by the warped product metric of Definition \ref{def:wp1} returns us the length formula \ref{eq:length}.  
 Since we are assuming $f$ is locally Lipschitz, 
 then $f$ is locally uniformly continuous. It follows that length is a lower semi-continuous functional on the space of admissible curves with respect to pointwise convergence, i.e. if \,$\gamma_i\to\gamma$\, then \,$\liminf\,(\length\gamma_i) \ge\length\gamma$. In this case, as in the proof in \cite[p. 39]{bbi} for length structures, the two lengths agree.

\section{Curvature bounds of cones and joins.}\label{sec:cones-joins}


We begin with important examples, for which the proofs are almost immediate.

\begin{thm}{Lemma on curvature of cones}
\label{cor:cone-curvature} Let $\spc{X}$  be a metric space, and  $X=\Cone_\kappa \spc{X}$, $\Cone^\circ_\kappa \spc{X}$, or $\Cyl_\kappa \spc{X}$. Then
\begin{enumerate}[(a)]
\item\label{cba-cone-curvature}
$X\in \Cat{}{\kappa}$ 
if and only if $\spc{M}\in \Cat{}{1}$.

\item\label{cbb-cone-curvature}
$X\in \CBB{}{\kappa}$ 
if and only if $\spc{M}\in \CBB{}{1}$.
\end{enumerate}
\end{thm}
\parit{Proof.}\qeds

\begin{thm}{Lemma on curvature of $\kappa$-joins}
\label{cor:join-curvature} Let $\spc{M}$ and $\spc{N}$ be metric spaces, and $X=\Join_\kappa (\spc{M},\spc{N})$. Then
\begin{enumerate}[(a)]
\item\label{cba-join-curvature}
$X \in \Cat{}{\kappa}$ if and only if $\spc{M}\in \Cat{}{1}$ and $\spc{N}\in \Cat{}{\sgn\kappa}$ for $\sgn\kappa\in\{\pm 1,0\}$.  In particular, for spherical joins, $\spc{M}\star \spc{N}\in\Cat{}{1}$ if and only if $\spc{M},\spc{N}\in \Cat{}{1}$.
\item\label{cbb-join-curvature}
$X \in \CBB{}{\kappa}$ if and only if $\spc{M}\in \CBB{}{1}$ and $\spc{N}\in \CBB{}{\sgn\kappa}$ for $\sgn\kappa\in\{\pm 1,0\}$.  In particular, for spherical joins, $\spc{M}\star \spc{N}\in \CBB{}{1}$ if and only if $\spc{M},\spc{N}\in \CBB{}{1}$.
\end{enumerate}
\end{thm}
\parit{Proof.} %For $\kappa>0$, the claim also follows from Corollary \ref{cor:cone-curvature}, since $\Cone_{\,0} (\spc{M}\star \spc{N})=\Cone_{\,0}  \spc{M}\times\Cone_{\,0}  \spc{N}$ by \ref{cone-join} in section \ref{sec:cones}. 
\qeds

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 
\section{Exercises}

\begin{thm}{Exercise} 
(Gluing with short maps)
 Let $X,X' \in\Cat{}{0}$, $K \subset X, K' \subset X'$ be closed convex subsets, 
and suppose the length-metrics on $\Fr_X K$ and $\Fr_{X'} K'$ are finite (???). 
Suppose $\phi\: \Fr_X K \to \Fr_{X'} K'$ is length-preserving and 
short with respect to the inherited
metrics. 
To $X'\backslash\Int K'$ in its length metric, 
glue $K$ along $\phi$, to obtain the space $Y$. 
Show $Y \in \Cat{}{0}$.

For example, take $K= \cBall[x,R]  \subset \Lob{m}0$ and $K' = \cBall(x',\sinh R)  \subset \Lob{m}{-1}$.
\end{thm}


