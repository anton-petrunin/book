%%!TEX root = all.tex
%arrays --- YES
\chapter{Kirszbraun revisited %READY
}

This chapter is based on our paper \cite{akp-kirszbraun}
and earlier paper of Lang and Schroeder
\cite{lang-schroeder}.


\section{Short map extension definitions.}\label{sec:4pt}

Theorems \ref{thm:kirsz-def} and \ref{thm:cba-kirsz-def} 
 give characterizations of $\CBB{}{\kappa}$ and  $\Cat{}{\kappa}$.

\begin{thm}{Theorem}\label{thm:kirsz-def} 
Let $\spc{L}$ be a complete length space. 
Then $\spc{L}\in\CBB{}{\kappa}$ if and only if for any 3-point set $V_3$ and any 4-point set $V_4\supset V_3$ in $\spc{L}$, 
any short map $f\:V_3\to\Lob2\kappa$ can be extended to a short map $F\:V_4\to\Lob2\kappa$ (so $f=F|V_3$).
\end{thm}


The proof of the ``only if'' part of Theorem \ref{thm:kirsz-def} can be obtained as a corollary of Kirszbraun's theorem (\ref{thm:kirsz+}).
But we present another proof, based on more elementary ideas.  The ``only if'' part of Theorem \ref{thm:cba-kirsz-def} does not follow directly from Kirszbraun's theorem, since the desired extension is in $\spc{U}$, not just the completion of $\spc{U}$.

In the proof of Theorem~\ref{thm:kirsz-def}, we use the following lemma in the  geometry of model planes;
it is useful in studying model angles determined by subtriples of a quadruple of points in a metric space.
Here we say that  two triangles with a common vertex  \emph{do not overlap} if their convex hulls intersect only at the common vertex.


\begin{thm}{Overlap lemma} \label{lem:extend-overlap}
Let $\trig{\~x^1}{\~x^2}{\~x^3}$ be a triangle in $\Lob2{\kappa}$.  Let $\~p^1,\~p^2,\~p^3$ be points such that, for any permutation $\{i,j,k\}$ of $\{1,2,3\}$, we have
\begin{enumerate}[(i)]

\item 
\label{no-overlap:px=px}
$\dist{\~p^i}{\~x^\kay}{}=\dist{\~p^j}{\~x^\kay}{}$,
%$\dist{\~p^i}{\~x^\kay}{}=\dist{\~p^j}{\~x^\kay}{}$,

\item
\label{no-overlap:orient-1}
$\~p^i$ and $\~x^i$ lie in the same closed halfspace determined by $[\~x^j\~x^\kay]$,  
\end{enumerate}

Assume no pair of triangles $\trig{\~p^i}{\~x^j}{\~x^\kay}$ overlap
then 
\[\mangle{\~p^1} +\mangle {\~p^2}+\mangle{\~p^3}> 2\cdot\pi,\]
where $\mangle\~p^i$ denotes $\mangle\hinge{\~p^i}{\~x^\kay}{\~x^j}$
for a permutation $\{i,j,k\}$ or $\{1,2,3\}$.
\end{thm}

\begin{wrapfigure}{r}{20mm}
\begin{lpic}[t(-3mm),b(0mm),r(0mm),l(0mm)]{pics/contr-no-overlap(0.4)}
\lbl[rt]{37,34;$\~p^1$}
\lbl[tl]{10,36;$\~p^2$}
\lbl[bl]{14,6;$\~p^3$}
\lbl[lb]{13,51;$\~x^1$}
\lbl[tr]{12,0;$\~x^2$}
\lbl[l]{44,30;$\~x^3$}
\end{lpic}
\end{wrapfigure}

\parbf{Remarks.}
If $\kappa\le 0$, then overlap lemma can be proved without using condition (\ref{no-overlap:px=px}).
This follows immediately from the formula that relates the sum of angles for the hexagon
$[\~p^1\~x^2\~p^3\~x^1\~p^2\~x^3]$ and its area:
\[ \mangle\~p^1
-
\mangle\~x^2
+
\mangle\~p^3
-
\mangle\~x^1
+
\mangle\~p^2
-
\mangle\~x^3
=2\cdot\pi-\kappa\cdot{\area}.
\]

In case $\kappa>0$, condition (\ref{no-overlap:px=px}) is essential.
An example for $\kappa>0$ can be constructed by perturbing the degenerate spherical configuration on the picture.

                            




\parit{Proof.}   Rotate the  triangle $\trig{\~p^3}{\~x^1}{\~x^2}$ around $\~x^1$ to make $[\~x^1\~p^3]$ coincide with $[\~x^1\~p^2]$.
Let  $\dot x^2$ denote the image of $\~x^2$ after rotation. 
Note that 
$$\mangle\hinge{\~x^1}{\~x^3}{\dot x^2}
=
\min\{\,\mangle\hinge {\~x^1}{\~x^2}{\~p^3}
+
\mangle\hinge {\~x^1}{\~p^2}{\~x^3},\,
2\cdot\pi -(\mangle\hinge {\~x^1}{\~x^2}{\~p^3}
+
\mangle\hinge {\~x^1}{\~p^2}{\~x^3})\,\}.
$$
By (\ref{no-overlap:orient-1}), 
the triangles 
$\trig{\~p^3}{\~x^1}{\~x^2}$ 
and $\trig{\~p^2}{\~x^3}{\~x^1}$ do not overlap if and only if 
\[
2\cdot\pi>\mangle\hinge {\~x^1}{\~x^2}{\~p^3}+\mangle\hinge {\~x^1}{\~p^2}{\~x^3}+\mangle\hinge {\~x^1}{\~x^2}{\~x^3}\eqlbl{eq:old-iii}\]
and
\[\mangle\hinge{\~x^1}{\~x^3}{\~x^2}
> 
\mangle\hinge{\~x^1}{\~x^3}{\dot x^2}.\eqlbl{eq:main-overlap}\]
The condition \ref{eq:main-overlap} holds if and only if 
$\dist{\~x^2}{\~x^3}{}>\dist{\dot x^2}{\~x^3}{}$,
which in turn holds if and only if 
\[
\begin{aligned}
\mangle\~p^1
&> \mangle\hinge{\~p^2}{\~x^3}{\dot x^2}
\\
&=
\min\{\mangle\~p^3+\mangle\~p^2,2\cdot\pi -(\mangle\~p^3+\mangle\~p^2)\}.
\end{aligned}
\eqlbl{eq:no-overlap}\]
The  inequality follows since the  corresponding hinges have the same pairs of sidelengths.
(The two pictures show that both possibilities for the minimum can occur.)

\begin{center} 
%\begin{wrapfigure}{l}{44mm} 
\begin{lpic}[t(0mm),b(10mm),r(0mm),l(0mm)]{pics/4-pnt-kirsz-x2(0.2)}
\lbl[t]{125,52;$\~p^3$}
\lbl[l]{154,96;$\~p^1$}
\lbl[rb]{108,80;$\~p^2$}
\lbl[tr]{5,5;$\~x^1$}
\lbl[t]{246,5;$\~x^2$}
\lbl[l]{242,65;$\dot x^2$}
\lbl[b]{97,200;$\~x^3$}
%\end{lpic}
%\begin{lpic}[t(5mm),b(0mm),r(0mm),l(0mm)]{pics/4-pnt-kirsz-sba(0.4)}
\lbl[lb]{449,51;$\~p^1$}
\lbl[l]{544,185;$\~p^2$}
\lbl[l]{590,65;$\~p^3$}
\lbl[t]{283,4;$\~x^1$}
\lbl[t]{521,5;$\~x^2$}
\lbl[lt]{500,105;$\dot x^2$}
\lbl[b]{372,200;$\~x^3$}
\end{lpic}       


%\end{wrapfigure}
\end{center}

Now assume $\mangle\~p^1 + \mangle\~p^2+\mangle\~p^3 \le 2\cdot\pi$.
Then  \ref{eq:no-overlap} implies 
\[\mangle\~p^i>\mangle\~p^j + \mangle\~p^\kay.\]
Since no pair of triangles overlap, the same holds 
for any permutation $(i,j,\kay)$ of $(1,2,3)$.
Therefore
\[\mangle\~p^1+\mangle\~p^2+\mangle\~p^3>2\cdot(\mangle\~p^1+\mangle\~p^2+\mangle\~p^3),\]
a contradiction. 
\qeds

\parit{Proof of \ref{thm:kirsz-def}; ``if'' part.} 
Assume $\spc{L}$ is geodesic.
Take $x^1,x^2,x^3\in \spc{L}$ so the model triangle 
$\trig{\~x^1}{\~x^2}{\~x^3}=\modtrig\kappa(x^1 x^2 x^3)$ is defined.
Choose $p\in \,{]}x^1x^2{[}\,$;
apply Kirszbrun property for $V_3=\{x^1,x^2,x^3\}$ and 
$V_4=\{x^1,x^2,x^3,p\}$ and the map $f(x^i)=\~x^i$. 
You obtain point-on-side comparison (\ref{point-on-side}).

In case $\spc{L}$ is not geodesic, pass to its ultrapower $\spc{L}^\o$.
Note that the short map extension property survives
for $\spc{L}^\o$ and recall that $\spc{L}^\o$ is geodesic (see \ref{cor:ulara-geod}).
Thus, from above, ${\spc{L}^\o}\in\CBB{}{\kappa}$. 
By Proposition~\ref{prp:A^omega}, we get ${\spc{L}}\in\CBB{}{\kappa}$.
\parit{``Only if'' part.}
Assume the contrary;
i.e.,  $x^1,x^2,x^3,p\in \spc{L}$, and 
$\~x^1,\~x^2,\~x^3\in\Lob2\kappa$ are such that
$\dist{\~x^i}{\~x^j}{}\le\dist{x^i}{x^j}{}$ for all $i,j$ and there is no point $\~p\in \Lob2\kappa$ such that $\dist{\~p}{\~x^i}{}\le \dist{p}{x^i}{}$ for all $i$.

Note that in this case all comparison triangles $\modtrig\kappa(p x^ix^j)$ are defined.
That is always true if $\kappa\le0$.
If $\kappa>0$, and say $\modtrig\kappa(p x^1x^2)$ is undefined, then 
\begin{align*}
\dist{p}{x^1}{}+\dist{p}{x^2}{}
&\ge 2\cdot\varpi\kappa-\dist{x^1}{x^2}{}
\ge
\\
&\ge
2\cdot\varpi\kappa-\dist{\~x^1}{\~x^2}{}\ge 
\\
&\ge 
\dist{\~x^1}{\~x^3}{}+\dist{\~x^2}{\~x^3}{}.
\end{align*}
It follows that we can take $\~p$ on $[\~x^1\~x^3]$ or  $[\~x^2\~x^3]$.

For each $i\in \{1,2,3\}$, consider a point $\~p^i\in\Lob2\kappa$ such that $\dist{\~p^i}{\~x^i}{}$ is minimal among points satisfying $\dist{\~p^i}{\~x^j}{}\le\dist{p}{ x^j}{}$ for all $j\not=i$. 
Clearly, every $\~p^i$ is inside the triangle $\trig{\~x^1}{\~x^2}{\~x^3}$ (i.e. in $\Conv(\~x^1,\~x^2,\~x^3)$), and $\dist{\~p^i}{\~x^i}{}>\dist{p}{ x^i}{}$ for each $i$.
Since the function $x\mapsto\tangle\mc\kappa\{x;a,b\}$
is increasing, it follows that
\begin{enumerate}[(i)]
\item $\dist{\~p^i}{\~x^j}{}=\dist{p}{ x^j}{}$ for $i\not=j$;
\item no pair of triangles from $\trig{\~p^1}{\~x^2}{\~x^3}$, $\trig{\~p^2}{\~x^3}{\~x^1}$, $\trig{\~p^3}{\~x^1}{\~x^2}$ overlap in $\trig{\~x^1}{\~x^2}{\~x^3}$.
\end{enumerate}

As follows from Overlap lemma (\ref{lem:extend-overlap}), 
in this case 
\[\mangle\hinge {\~p^1}{\~x^2}{\~x^3} 
+\mangle\hinge {\~p^2}{\~x^3}{\~x^1}
+\mangle\hinge {\~p^3}{\~x^1}{\~x^2}
>2\cdot\pi.
\]
Since $\dist{\~x^i}{\~x^j}{}\le\dist{x^i}{x^j}{}$ we get
\[\mangle\hinge {\~p^\kay}{\~x^i}{\~x^j}
\le
\angk\kappa p{x^i}{x^j}\]
if $(i,j,k)$ is a permutation of $(1,2,3)$.
Therefore 
\[\angk\kappa p{x^1}{x^2}+\angk\kappa p{x^2}{x^3}+\angk\kappa p{x^3}{x^1}>2\cdot\pi;\]
the later contradicts (1+3)-comparison (\ref{df:cbb1+3}).
\qeds

\begin{thm}{Theorem}\label{thm:cba-kirsz-def} 
Let $\spc{U}$ be a metric space in which any pair of points at distance $<\varpi\kappa$ are joined by a unique geodesic. Then $\spc{U}\in\Cat{}{\kappa}$ if and only if for any $3$-point set $V_3$ and  $4$-point set $V_4\supset V_3$ in $\Lob2\kappa$, where the perimeter of $V_3$ is $<2\cdot\varpi\kappa$, any short map $f\:V_3\to\spc{U}$ can be extended to a short map $F\:V_4\to\spc{U}$.
\end{thm}

In the proof of Theorem~\ref{thm:cba-kirsz-def},
we use the following lemma in the geometry of model planes: 

\begin{thm}{Lemma}\label{lem:smaller-trig}
Let $x^1,x^2,x^3,y^1,y^2,y^3\in\Lob{}{\kappa}$
be points such that $\dist{x^i}{x^j}{}\ge\dist{y^i}{y^j}{}$ for all $i,j$.
Then there is a short map $\map\:\Lob{}{\kappa}\to\Lob{}{\kappa}$ such that $\map(x^i)=y^i$ for all $i$;
moreover, one can choose $\map$ so that 
\[\Im \map\subset\Conv(y^1,y^2,y^3).\]

\end{thm}

We only give an idea of the proof of  this lemma;
alternatively, one can get the result as a corollary of  Kirszbraun's theorem (\ref{thm:kirsz+}) 

\parit{Idea of the proof.}
The map $\map$ can be constructed as a composition of the following folding maps:
Given a halfspace $H$ in $\Lob{}{\kappa}$, consider the map $\Lob{}{\kappa}\to H$, 
which is identity on $H$ and reflects all points outside of $H$ into $H$.
This map is a path isometry, in particular it is short. 

One can get the last part of the lemma by composing the above map with foldings along the sides of triangle $\trig{y^1}{y^2}{y^3}$ and passing to a partial limit.
\qeds

\parit{Proof of \ref{thm:cba-kirsz-def}; ``if'' part.}
The point-on-side comparison (\ref{cat-monoton}) follows  by
taking $V_3=\{\~x,\~y,\~p\}$ and  $V_4=\{\~x,\~y,\~p,\~z\}$ where $z\in \l]x y\r[$.  
It is only necessary to observe that  $F(\~z)=z$ by uniqueness of $[x y]$.


\parit{``Only if'' part.}
Let $V_3=\{\~x^1,\~x^2,\~x^3\}$ and $V_4=\{\~x^1,\~x^2,\~x^3,\~p\}$.

Set $y^i\z=f(\~x^i)$ for all $i$;
we need to find a point $q\in\spc{U}$ such that $\dist{y^i}{q}{}\le\dist{\~x^i}{\~p}{}$ for all $i$.

Let $D$ be the convex set in $\Lob2\kappa$ bounded by C the model triangle 
$\trig{\~y^1}{\~y^2}{\~y^3}\z=\modtrig\kappa{y^1}{y^2}{y^3}$;
i.e., $D\z=\Conv({\~y^1},{\~y^2},{\~y^3})$.

Note that $\dist{\~y^i}{\~y^j}{}=\dist{y^i}{y^j}{}\le\dist{\~x^i}{\~x^j}{}$ for all $i,j$.
Applying Lemma \ref{lem:smaller-trig},
we get a short map 
$\map\:\Lob{}{\kappa}\to D$ such that 
$\map\:\~x^i\mapsto\~y^i$.

Further, from majorization (\ref{thm:major}), 
there is a short map $F\:D\to \spc{U}$ such that $\~y^i\mapsto y^i$ for all $i$.

Thus one can take $q=F\circ\map(\~p)$.
\qeds



\section{(1+\textit{n})-point comparison}\label{sec:1+n}

The following theorem gives a more sensitive analog of (1+3)-point comparison (\ref{df:cbb1+3}).
In a bit more analytic form it appears in \cite{sturm}.


\begin{thm}{(1+\textit{n})-point comparison}
\label{thm:pos-config} 
Let $\spc{L}\in\CBB{}{\kappa}$.
Then for any array of points $p,x^1,\dots,x^n\in \spc{L}$  
there is a model array $\~p,\~x^1,\dots,\~x^n\in\Lob{n}\kappa$ such that
\begin{subthm}{}
$\dist{\~p}{\~x^i}{}=\dist{p}{x^i}{}$ for all $i$.
\end{subthm}

\begin{subthm}{}$\dist{\~x^i}{\~x^j}{}\ge\dist{x^i}{x^j}{}$ for all $i,j$.
\end{subthm}
\end{thm}

\parit{Proof.} 
It is enough to show that given $\eps>0$ there is a configuration $\~p,\~x^1,\dots,\~x^n\in\Lob{n}\kappa$ such that $\dist{\~x^i}{\~x^j}{}\ge\dist{x^i}{x^j}{}$ and $\bigl|\dist{\~p}{\~x^i}{}-\dist{p}{x^i}{}\bigr|\le \eps$.
Then one can pass to a limit configuration for $\eps\to 0+$.

According to \ref{lem:straight}, the set $\Str(x^1,\dots,x^n)$ 
 is dense in $\spc{L}$.
Thus, there is a point $p'\in \Str(\~x^1,\dots,\~x^n)$ such  that $\dist{p'}{p}{}\le\eps$.
According to Corollary~\ref{cor:euclid-subcone}, 
$\T_{p'}$ contains a subcone $E$ isometric to a Euclidean space 
which contains all vectors $\ddir{p'}{x^i}$.
Passing to subspace if necessary, we can assume that $\dim E\le n$.

Mark a point $\~p\in \Lob{n}\kappa$ and choose a distance preserving map
$\iota\: E\to \T_{\~p}\Lob{n}\kappa$.
Set 
\[\~x^i
=
\exp_{\~p}\circ\iota(\ddir{p'}{x^i}).\]
Thus $\dist{\~p}{\~x^i}{}=\dist{p'}{x^i}{}$ and therefore
\[\bigl|\dist{\~p}{\~x^i}{}-\dist{p}{x^i}{}\bigr|
\le 
\dist{p}{p'}{} \le\eps.\]
From the hinge comparison (\ref{angle}) 
we have 
\[\angk\kappa{\~p}{\~x^i}{\~x^j}
=\mangle\hinge{\~p}{\~x^i}{\~x^j}
=\mangle\hinge{p'}{x^i}{x^j}\ge \angk\kappa{p'}{x^i}{x^j},\]
thus 
\[\dist{\~x^i}{\~x^j}{}\ge \dist{x^i}{x^j}{}.\]
\qedsf

\begin{thm}{Exercise}
Give an example of metric on a finite set, which satisfies the comparison inequality 
\[\angk{0}{p}{x_1}{x_2}+\angk{0}{p}{x_2}{x_3}+\angk{0}{p}{x_3}{x_1}
\le
2\cdot\pi\]
for any quadruple of points $(p,x_1,x_2,x_3)$, 
but which is not isometric to a subset of Alexandrov space with curvature $\ge0$.
\end{thm}


\input{helly.tex}



\section{Kirszbraun's theorem}\label{sec:kirszbraun}

A slightly weaker version of the following theorem
appears in \cite{lang-schroeder}.
The Conjecture~\ref{conj:kirsz} (if true) gives an equivalent condition for the existence of a short extension;
roughly it states that example \ref{example:SS_+} is the only obstacle.

\begin{thm}{Kirszbraun's theorem}
\label{thm:kirsz+}
Let
$\spc{L}\in\CBB{}{\kappa}$, 
$\spc{U}\in\cCat{}{\kappa}$, 
$Q\subset \spc{L}$ be arbitrary subset
and $f\: Q\to\spc{U}$ be a short map.
Assume that there is $z\in\spc{U}$ such that 
$f(Q)\subset \oBall[z,\tfrac{\varpi\kappa}{2}]$.
Then $f\:Q\to\spc{U}$ can be extended to a short map 
$F\:\spc{L}\to \spc{U}$
(that is, there is a short map $F\:\spc{L}\to \spc{U}$ such that $F|Q=f$.)
\end{thm}
 
The condition $f(Q)\subset \oBall[z,\tfrac{\varpi\kappa}{2}]$ trivially holds for any $\kappa\le 0$ since in this case $\varpi\kappa=\infty$. 
The following example shows that this condition is needed for $\kappa>0$.

\begin{thm}{Example}\label{example:SS_+}
Let $\SS^m_+$ be a closed $m$-dimensional unit hemisphere.  Denote its boundary, which is isometric to $\SS^{m-1}$, by  $\partial\SS^m_+$.
Clearly, $\SS^m_+\in\CBB{}1$ and $\partial\SS^m_+\in\cCat{}1$ but the identity map ${\partial\SS^m_+}\to \partial\SS^m_+$ cannot be extended to a short map $\SS^m_+\to \partial\SS^m_+$ (there is no place for the pole).

There is also a direct generalization of this example to a hemisphere in a Hilbert space of arbitrary cardinal dimension.
\end{thm}

First we prove this theorem in the case $\kappa\le 0$ (\ref{thm:kirsz}).
In the proof of the more complicated case $\kappa>0$, we use the case $\kappa=0$.
The following lemma is the main ingredient in the proof. 

\begin{thm}{Finite$\bm{+}$one lemma}\label{lem:kirsz-neg:new}
Let $\kappa\le 0$,
$\spc{L}\in\CBB{}{\kappa}$, and 
$\spc{U}\in\cCat{}{\kappa}$.  Let  
$x^1,x^2,\dots,x^n\in\spc{L}$ 
and $y^1,y^2,\dots,y^n\in\spc{U}$
be
such that $\dist{x^i}{x^j}{}\ge\dist{y^i}{y^j}{}$ for all $i,j$.

Then for any $p\in\spc{L}$, there is $q\in\spc{U}$ such that $\dist{y^i}{q}{}\le\dist{x^i}{p}{}$ for each $i$.
\end{thm}

\parit{Proof.}
It is sufficient to prove the lemma only for $\kappa=0$ and $-1$.
The proofs of these two cases are identical, only the formulas differ.
In the proof, we assume $\kappa=0$ and provide the formulas for $\kappa=-1$ in the footnotes.

From (1+\textit{n})-point comparison (\ref{thm:pos-config}), 
there is a model configuration 
$\~p,\~x^1,\~x^2,\dots,\~x^n\in \Lob{n}{\kappa}$ such that
$\dist{\~p}{\~x^i}{}=\dist{p}{x^i}{}$
and $\dist{\~x^i}{\~x^j}{}\ge\dist{x^i}{x^j}{}$ 
for all $i$, $j$.

For each $i$, consider functions 
$f^i\:\spc{U}\to\RR$ and $\~f^i\:\Lob{n}{\kappa}\to\RR$ 
defined as follows%
%%%%%%%%%%%%
\footnote{In case $\kappa=-1$,
\[
\begin{aligned}
&f^i=\cosh\circ\dist{y^i}{}{},
&
&\~f^i=\cosh\circ\dist{\~x^i}{}{}.
\end{aligned}
\leqno{(A)\mc-}\]}
%%%%%%%%%%%%
\[
\begin{aligned}
&f^i=\tfrac{1}{2}\cdot\dist[2]{y^i}{}{},
&
&\~f^i=\tfrac{1}{2}\cdot\dist[2]{\~x^i}{}{}.
\end{aligned}
\leqno{(A)\mc0}
\]
Set
$\bm{f}=(f^1,f^2,\dots,f^n)\:\spc{U}\to\RR^n$ and $\bm{\~f}=(\~f^1,\~f^2,\dots,\~f^n)\:\Lob{n}{\kappa}\to\RR^n$.

Recall that $\Up$ (superset in $\RR^n$) is defined on page \pageref{PAGE.def:Up}.
Note that it is sufficient to prove that
$\bm{\~f}(\~p)\in\Up\bm{f}(\spc{U})$.

Clearly,
$(f^i)''\ge 1$.
Thus, by the theorem on barycentric simplex (\ref{thm:web:Up-convex}), 
the set $\Up\bm{f}(\spc{U})\subset\RR^{n}$ is convex.

Arguing by contradiction, let us assume that $\bm{\~f}(\~p)\notin\Up\bm{f}(\spc{U})$.

Then there  exists a supporting hyperplane  $\alpha_1\cdot x_1+\ldots \alpha_n\cdot x_n=c$ to $\Up\bm{f}(\spc{U})$, separating it from  $\bm{\~f}(\~p)$.
According to Lemma~\ref{lem:Up-convex:subnormal}, 
$\alpha_i\ge 0$ for each $i$. 
So we can assume that $(\alpha_1,\alpha_2,\dots,\alpha_n)\in\Delta^{n-1}$ and 
\[\sum_i\alpha_i\cdot\~f^i(\~p)
< 
\inf
\set{\sum_i\alpha_i\cdot f^i(q)}{q\in\spc{U}}.\]
The latter contradicts the following claim.

\begin{clm}{}
Given $\bm{\alpha}=(\alpha_1,\alpha_2,\dots,\alpha_n)\in\Delta^{n-1}$,
set
\begin{align*}
&h=\sum_i\alpha_i\cdot f^i
&
&h\:\spc{U}\to\RR
&
&z=\argmin h\in \spc{U}
\\
&\~h=\sum_i\alpha_i\cdot \~f^i
&
&\~h\:\Lob{n}{\kappa}\to\RR
&
&\~z=\argmin \~h\in \Lob{n}{\kappa}
\end{align*}
Then 
$h(z)\le \~h(\~z)$.
\end{clm}

\parit{Proof of the claim.}
Note that $\d_z h\ge 0$.
Thus, for each $i$, we have%
\footnote{In case $\kappa=-1$, the same calculations give
\[
\begin{aligned}
0
&\le\dots \le
-\tfrac{1}{\sinh\dist[{{}}]{z}{y^i}{}}
\cdot 
\sum_j
\alpha_j\cdot\l[\cosh\dist[{{}}]{z}{y^i}{}\cdot\cosh\dist[{{}}]{z}{y^j}{}-\cosh\dist[{{}}]{y^i}{y^j}{}\r].
\end{aligned}
\leqno{(B)\mc-}
\]
}
\[
\begin{aligned}
0
&\le (\d_z h)(\dir{z}{y^i})
=
\\
&=
-\sum_j\alpha_j\cdot\dist[{{}}]{z}{y^j}{}\cdot\cos\mangle\hinge{z}{y^i}{y^j}
\le
\\
&\le
-\sum_j\alpha_j\cdot\dist[{{}}]{z}{y^j}{}\cdot\cos\angk0{z}{y^i}{y^j}
=
\\
&=
-\tfrac{1}{2\cdot\dist[{{}}]{z}{y^i}{}}
\cdot 
\sum_j
\alpha_j\cdot\l[\dist[2]{z}{y^i}{}+\dist[2]{z}{y^j}{}-\dist[2]{y^i}{y^j}{}\r].
\end{aligned}
\leqno{(B)\mc0}\]
In particular%
%%%%%%%%%%
\footnote{In case $\kappa=-1$, the same calculations give
\[
\begin{aligned} 
\sum_{i}\alpha_i\cdot\l[\sum_j
\alpha_j\cdot\l[\cosh\dist[{{}}]{z}{y^i}{}\cdot\cosh\dist[{{}}]{z}{y^j}{}
-\cosh\dist[{{}}]{y^i}{y^j}{}\r]
\r]\le0
\end{aligned}.
\leqno{(C)\mc-}
\]
},
%%%%%%%%%%
\[
\begin{aligned}
\sum_{i}
\alpha_i
\cdot
\l[\sum_j
\alpha_j
\cdot
\l[\dist[2]{z}{y^i}{}+\dist[2]{z}{y^j}{}-\dist[2]{y^i}{y^j}{}\r]
\r]\le 0,
\end{aligned}
\leqno{(C)\mc0}
\]
or%
%%%%%%%%%%
\footnote{In case $\kappa=-1$,
\[(h(z))^2\le
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
\cosh\dist[{{}}]{y^i}{y^j}{}. \leqno{(D)\mc-}\]
}
%%%%%%%%%%
\[2\cdot h(z)
\le
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
\dist[2]{y^i}{y^j}. \leqno{(D)\mc0}\]

Note, that if $\spc{U}\iso\Lob{n}{\kappa}$, 
then all inequalities in $(B,C,D)$ are sharp.
Thus the same argument as above, repeated for $\~x^1,\~x^2,\dots,\~x^n\in\Lob{n}{\kappa}$
gives%
\footnote%
{In case $\kappa=-1$,
\[(\~h(\~z))^2
=
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
\cosh\dist[{{}}]{\~x^i}{\~x^j}{}.
\leqno{(E)\mc-}\]
}
\[
2\cdot \~h(\~z)
=
\sum_{i,j}
\alpha_i\cdot\alpha_j
\cdot
\dist[2]{\~x^i}{\~x^j}{}. 
\leqno{(E)\mc0}
\]
Note that 
\[\dist{\~x^i}{\~x^j}{}
\ge
\dist{x^i}{x^j}{}\ge\dist{y^i}{y^j}{}\]
for all $i$, $j$.
Thus, $(D)$ and $(E)$ imply the claim.
\qedqeds






\begin{thm}{Kirszbraun's theorem for nonpositive bound}
\label{thm:kirsz}
Let
$\kappa\le0$,
$\spc{L}\in\CBB{}{\kappa}$, 
$\spc{U}\in\cCat{}{\kappa}$, 
$Q\subset \spc{L}$ be arbitrary subset
and $f\: Q\to\spc{U}$ be a short map.
Then there is a short extension 
$F\:\spc{L}\to \spc{U}$ of $f$;
that is, there is a short map $F\:\spc{L}\to \spc{U}$ such that $F|Q=f$.
\end{thm}

\parbf{Remark.}
If $\spc{U}$ is proper, then in the following proof the Helly's theorem (\ref{thm:helly}) is not needed.
Everything follows directly from compactness of closed balls in $\spc{U}$.


\parit{Proof of \ref{thm:kirsz}.} 
By Zorn's lemma, we can assume 
that $Q\subset\spc{L}$ is a maximal set;
i.e. $f\:Q\to\spc{U}$ does not admits a short extension to any larger set $Q'\supset Q$.

Let us argue by contradiction.
Assume that $Q\not=\spc{L}$;
choose $p\in \spc{L}\backslash Q$.
Then
\[\bigcap_{x\in Q} \cBall[f(x),\dist{p}{x}{}]
=
\emptyset.\]

Since $\kappa\le 0$, the balls are convex; 
thus, by Helly's theorem (\ref{thm:helly}), 
one can choose a point array $x^1,x^2,\dots, x^n\in Q$ such that
\[\bigcap_{i=1}^n \cBall[y^i,\dist{x^i}{p}{}]
=
\emptyset,
\eqlbl{eq:cap=cBalls=0}\]
where $y^i=f(x^i)$.
Finally note that \ref{eq:cap=cBalls=0} contradicts the Finite+one lemma (\ref{lem:kirsz-neg:new})\qeds




\parit{Proof of Kirszbraun's theorem (\ref{thm:kirsz+}).} 
The case $\kappa\le 0$ is already proved in \ref{thm:kirsz}.
Thus it remains to prove the theorem only in case $\kappa>0$.
After rescaling we may assume that $\kappa=1$
and therefore $\varpi\kappa=\pi$.

Since $\cBall[z,\pi/2]\in\cCat{}{\kappa}$ %(see ???)
,we can assume $\spc{U}=\cBall[z,\pi/2]$. 
In particular, any  two points of $\spc{U}$  at distance $<\pi$ are  joined by a geodesic, and $\diam\spc{U}\le\pi$.
If $\dist{x}{y}{}=\pi$ for some $x,y\in\spc{U}$ then the concatenation  of 
$[x z]$ and $[z y]$ forms a geodesic $[x y]$.
Hence $\spc{U}$ is geodesic.

Further, we can also assume that $\diam\spc{L}\le\pi$.
Otherwise $\spc{L}$ is one-dimensional (see \ref{diam-k>0});
in this case the result follows since $\spc{U}$ is geodesic.

\medskip

Assume the theorem is false. Then 
there is a set $Q\subset \spc{L}$, 
a short map $f\: Q\to \spc{U}$ and  
$p\in \spc{L}\backslash  Q$ such that 
\[\bigcap_{x\in  Q}
\cBall[f(x),\dist{x}{p}{}]=\emptyset.
\eqlbl{eq:cap-of-balls}\]

We will apply \ref{thm:kirsz} for $\kappa=0$ to Euclidean cones $\mathring{\spc{L}}=\Cone \spc{L}$ and $\mathring{\spc{U}}\z=\Cone \spc{U}$. 
Note that 
\begin{itemize}
\item ${\mathring{\spc{U}}}\in\cCat{}0$, %???(see ???)
\item since $\diam \spc{L}\le \pi$ we have ${\mathring{\spc{L}}}\in\CBB{}0$. %???(see ???).
\end{itemize}
Further, we will view spaces $\spc{L}$ and $\spc{U}$ as unit spheres in $\mathring{\spc{L}}$ and $\mathring{\spc{U}}$ respectively.
In the cones $\mathring{\spc{L}}$ and $\mathring{\spc{U}}$ we will use 
``$|{*}|$'' for distance to the vertex, say $o$, 
``$\cdot$'' for cone multiplication,
``$\mangle(x,y)$'' for $\angle\hinge{o}{x}{y}$ 
and ``$\<x,y\>$'' for $|x|\cdot|y|\cdot\cos\angle\hinge{o}{x}{y}$.
In particular,
\begin{itemize}
\item $\dist{x}{y}{\spc{L}}=\mangle(x,y)$ for any $x,y\in\spc{L}$,
\item $\dist{x}{y}{\spc{U}}=\mangle(x,y)$ for any $x,y\in\spc{U}$,
\item for any $y\in \spc{U}$, we have
\[\mangle(z,y)\le\tfrac\pi2.
\eqlbl{eq:=<pi/2}\]

\end{itemize}
Set $\mathring{Q}=\Cone Q\subset \mathring{\spc{L}}$ and let $\mathring f\:\mathring{Q}\to \mathring{\spc{U}}$ be the natural cone extension of $f$; 
i.e., 
$y=f(x)$ $\Rightarrow$ $t\cdot y=\mathring f(t\cdot x)$ 
for $t\ge0$.
Clearly $\mathring f$ is short.

\begin{wrapfigure}{r}{42mm}
\begin{lpic}[t(0mm),b(3mm),r(0mm),l(0mm)]{pics/k_0(0.3)}
\lbl[t]{100,150;$\mathring{\spc{U}}=\Cone \spc{U}$}
\lbl[br]{75,20;$\nwarrow$}
\lbl[tl]{75,20;$\spc{U}$}
\lbl[lt]{80,74;$z$}
\lbl[lb]{75,102;$\bar s$}
\lbl[b]{128,101;$\alpha$}
\lbl[rb]{57,102;$s$}
\lbl[lt]{7,73;$o$}
\end{lpic}
\end{wrapfigure}

Applying \ref{thm:kirsz} for $\mathring f$, 
we get a short extension map $\mathring F\:\mathring{\spc{L}}\to\mathring{\spc{U}}$. 
Set $s=\mathring F(p)$.
Thus, 
\[\dist{s}{\mathring f(w)}{}
\le 
\dist{p}{w}{}
\eqlbl{eq:clm:kirszbraun-curv=1-rad-star}\]
for any $w\in \mathring Q$.
In particular, $|s|\le 1$.
Applying \ref{eq:clm:kirszbraun-curv=1-rad-star} 
for $w=t\cdot x$ and $t\to\infty$ we get

\[\<f(x),s\>\ge \cos\mangle(p,x)\eqlbl{eq:<,>=<}\]
for any $x\in Q$.

According to ???, %ASK Stephanie???
the geodesics $\geod_{[s\ t\cdot z]}$ converge as $t\to\infty$ to a ray, say $\alpha\:[0,\infty)\to \mathring{\spc{U}}$.
From \ref{eq:=<pi/2}, 
we have that the function $t\mapsto\<f(x),\alpha(t)\>$ is non-decreasing. 
From \ref{eq:<,>=<}, for
the necessarily unique point $\bar s$ on the ray $\alpha$ such that $|\bar s|=1$ we also have 
\[\<f(x),\bar s\>\ge \cos\mangle(p,x)\]
or
\[\mangle(\bar s,f(x))
\le 
\mangle(p,f(x))\]
for any $x\in Q$.
The latter contradicts \ref{eq:cap-of-balls}.
\qeds

























\section{(2\textit{n}+2)-point comparison}\label{sec:2n+2}

Here we give a generalization of the (2+2)-point comparison  to $n$ points.  It follows from the generalized Kirszbraun's theorem.

First let us give a reformulation of (2+2)-point comparison. 

\begin{thm}{Reformulation of (2+2)-point comparison}
Let $\spc{X}$ be a metric space.
A quadruple $p,q,x,y\in \spc{X}$ satisfies (2+2)-point comparison if one of the following holds:
\begin{subthm}{}
One of the triples 
$(p,q,x)$ 
or 
$(p, q, y)$ 
has perimeter $>2\cdot\varpi\kappa$.
\end{subthm}

\begin{subthm}{}
If $\trig{\~p}{\~q}{\~x}
=
\modtrig\kappa(p q x)$ 
and
$\trig{\~p}{\~q}{\~y}
=
\modtrig\kappa p q y$, then
\[\dist{\~x}{\~z}{}+\dist{\~z}{\~y}{}\ge \dist{x}{y}{},\]
for any $\~z\in[\~p\~q]$.

\end{subthm}

\end{thm}

\begin{thm}{(2\textit{n}+2)-point comparison}\label{CBA-n-point}
Let $\spc{U}\in\cCat{}{\kappa}$.
Consider $x,y\in \spc{U}$ and  an array of pairs of points $(p^1,q^1)$, $(p^2,q^2),\dots,(p^n,q^n)$  in $\spc{U}$, such that there is a model configuration
$\~x$, $\~y$ and array of pairs $(\~p^1,\~q^1)$, $(\~p^2,\~q^2),\dots,(\~p^n,\~q^n)$ in $\Lob{3}\kappa$ with the following properties:
\begin{subthm}{}
$\trig{\~x}{\~p^1}{\~q^1}=\modtrig\kappa x p^1q^1$
and 
$\trig{\~y}{\~p^n}{\~q^n}=\modtrig\kappa y p^n q^n$;
\end{subthm}

\begin{subthm}{}
The simplex $\~p^i\~p^{i+1}\~q^i\~q^{i+1}$ is a model simplex%
\footnote{i.e.,
perimeter of each triple in $p^i,p^{i+1},q^i$ and $q^{i+1}$ is $<2\cdot\pi$ and
$\dist{\~p^i}{\~q^i}{}
=\dist{p^i}{q^i}{}$,
$\dist{\~p^i}{\~p^{i+1}}{}
=\dist{p^i}{p^{i+1}}{}$,
$\dist{\~q^i}{\~q^{i+1}}{}
=\dist{q^i}{q^{i+1}}{}$,
$\dist{\~p^i}{\~q^{i+1}}{}
=
\dist{p^i}{q^{i+1}}{}$ 
and $\dist{\~p^{i+1}}{\~q^{i}}{}=\dist{p^{i+1}}{q^{i}}{}$.}
 of $p^ip^{i+1}q^iq^{i+1}$
for all $i$.
\end{subthm}

Then for any choice of $n$ points $\~z^i\in [\~p^i\~q^i]$,
we have
\[\dist{\~x}{\~z^1}{}+\dist{\~z^1}{\~z^2}{}+\dots+\dist{\~z^{n-1}}{\~z^n}{}+\dist{\~z^n}{\~y}{}
\ge 
\dist{x}{y}{}.\]
\begin{center}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]{pics/chain(0.27)}
\lbl[r]{4,33;$\~x$}
\lbl[tr]{87,12;$\~p^1$}
\lbl[t]{147,20;$\~p^2$}
\lbl[t]{175,3;$\~p^3$}
\lbl[lt]{275,18;$\~p^4$}
\lbl[br]{40,104;$\~q^1$}
\lbl[br]{138,127;$\~q^2$}
\lbl[bl]{192,105;$\~q^3$}
\lbl[bl]{266,100;$\~q^4$}
\lbl[bl]{70,49;$\~z^1$}
\lbl[br]{143,60;$\~z^2$}
\lbl[bl]{184,51;$\~z^3$}
\lbl[bl]{272,54;$\~z^4$}
\lbl[l]{369,51;$\~y$}
\end{lpic}
\end{center}
\end{thm}

To prove (2\textit{n}+2)-point comparison, we need the following lemma, which is an easy corollary from Kirszbraun's theorem (\ref{thm:kirsz+}).

\begin{thm}{Lemma}\label{cor:kir-from-hemisphere}%Cor>Lem
Let $\spc{L}\in\CBB{}{\kappa}$, 
$\spc{U}\in\cCat{}{\kappa}$,
and $Q\subset \oBall(p,\tfrac{\varpi\kappa}2)\subset \spc{L}$.
Then any short map $f\:Q\to \spc{U}$ can be extended to a short map 
$F\:\spc{L}\to \spc{U}$.
\end{thm}

\parit{Proof.} Directly from Kirszbraun's theorem (\ref{thm:kirsz} or \ref{thm:kirsz+}), we obtain the case $\kappa\le 0$. 
Thus it remains to prove the theorem only in case $\kappa>0$.
After rescaling we may assume that $\kappa=1$
and therefore $\varpi\kappa=\pi$.

It is enough to prove that there is a point $z\in \spc{U}$ such that $\dist{z}{f(x)}{}\le \tfrac\pi2$ for all $x\in Q$; once it is proved, the statement follows from Kirszbraun's theorem (\ref{thm:kirsz+}).

Further we use the same notations as in the proof of \ref{thm:kirsz+}. 

Apply Kirszbraun's theorem (\ref{thm:kirsz} or \ref{thm:kirsz+}) for $\mathring f\:\mathring Q\to\mathring{\spc{U}}$ and set $q\z={\mathring F}(p)$.
Clearly,
\[\<f(x),q\>
\ge 
\cos\mangle(p,x)>0\]
for any $x\in Q$.
In particular, $|q|>0$. 
Thus, for $z=\tfrac{1}{|q|}\cdot q\in\spc{U}$,
we get $\dist{z}{f(x)}{\spc{U}}=\mangle(z,f(x))\le \tfrac{\pi}{2}$ for all $x\in Q$.
\qeds


\parit{Proof of (2\textit{n}+2)-point comparison.} Direct application of \ref{cor:kir-from-hemisphere} 
gives an array of short maps $f^0,f^1,\dots,f^n\:\Lob{3}\kappa\to \spc{U}$ such that
\begin{enumerate}[(i)]

\item $\~x\stackrel{f^0}{\longmapsto} x$, 
$\~p^1\stackrel{f^0}{\longmapsto} p^1$ and 
$\~q^1\stackrel{f^0}{\longmapsto}q^1$;

\item 
$\~p^i      \stackrel{f^i}{\longmapsto} p^i$, 
$\~q^{i}    \stackrel{f^i}{\longmapsto} q^i$ and 
$\~p^{i+1}  \stackrel{f^i}{\longmapsto} p^{i+1}$, 
$\~q^{i+1}  \stackrel{f^i}{\longmapsto} q^{i+1}$\\ 
for $1\le i\le n-1$;
\item 
$\~p^n\stackrel{f^n}{\longmapsto} p^n$,
$\~q^n\stackrel{f^n}{\longmapsto}q^n$ and $\~y\stackrel{f^n}{\longmapsto} y$.
\end{enumerate}
For each $i>0$, we have that $f^{i-1}|_{[\~p^i\~q^i]}=f^{i}|[\~p^i\~q^i]$ as 
both $f^{i-1}$ and $f^{i}$ send $[\~p^i\~q^i]$ isometrically to a geodesic $[p^i q^i]$ in $\spc{U}$ which is unique.
Thus the curves
\[f^0([\~x\~z^1]),\ f^1([\~z^1\~z^2]),\dots,\ f^{n-1}([\~z^{n-1}\~z^n]),\ f^n([\~z^n\~y])\]
can be joined in $\spc{U}$ into a curve connecting $x$ to $y$ with length at most 
\[\dist{\~x}{\~z^1}{}+\dist{\~z^1}{\~z^2}{}+\dots+\dist{\~z^{n-1}}{\~z^n}{}+\dist{\~z^n}{\~y}{}.\]
\qedsf







\section{Remarks and open problems}\label{sec:kirszbraun:open}


\begin{thm}{Open problem}\label{open:n-point-CBB}
Find a necessary and sufficient condition for a finite metric space to be isometrically embeddable into some $\CBB{}{\kappa}$-space.
\end{thm}

A metric on a finite set $\{a^1,a^2,\dots,a^n\}$,
can be described by the matrix with components
\[s^{ij}
=
\dist[2]{a^i}{a^j}{},\]
which we will call the  \emph{decrypting matrix}\index{decrypting matrix}.
The set of decrypting matrices of all metrics that admit a distance preserving map into a $\CBB{}{0}$-space 
form a convex cone, as follows from the fact that the  product of $\CBB{}{0}$-spaces is a $\CBB{}{0}$-space.
This convexity gives hope that the cone admits an explicit description.

The set of metrics on $\{a^1,a^2,\dots,a^n\}$ that can be embedded into a product of spheres with different radii admits a simple description.
Obviously, this gives a sufficient condition for \ref{open:n-point-CBB}.
This  condition is not necessary.
For instance, as follows from \cite[2.2]{vilms},
a sufficiently dense finite subset in a generic closed positively 
curved manifold can not be embedded into a product of spheres.

Theorem \ref{thm:pos-config} gives a necessary condition for \ref{open:n-point-CBB},
but the condition is not sufficient.
One can see this in the following example constructed by Sergei Ivanov:

\begin{wrapfigure}{r}{40mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]{pics/ivanov-example(0.7)}
\lbl[rb]{1,16;$a$}
\lbl[lb]{55,16;$b$}
\lbl[rb]{28,31;$x$}
\lbl[rb]{28,7;$y$}
\lbl[rt]{28,1;$z$}
\lbl[lb]{44,26;$q$}
\end{lpic}
\end{wrapfigure}


\parbf{Example.}
Consider the finite set $\mathcal{F}$ formed by 6 points $a$, $b$, $x$, $y$, $z$ and $q$ with distances defined as follows:
\begin{enumerate}
\item $\dist{a}{b}{}=4$;
\item $\dist{a}{x}{}=\dist{a}{y}{}=\dist{a}{z}{}=\dist{b}{x}{}=\dist{b}{y}{}=\dist{b}{z}{}=2$;
\item $\dist{x}{y}{}=2$, $\dist{y}{z}{}=1$, $\dist{x}{z}{}=3$;
\item $\dist{x}{q}{}=\dist{q}{b}{}=1$ and thus $\dist{a}{q}{}=3$;
\item $\angk{0}{x}{q}{y}=\angk{0}{x}{q}{z}=\tfrac\pi3$; 
i.e., $\dist{q}{y}{}=\sqrt{3}$ and $\dist{q}{z}{}=\sqrt{7}$.
\end{enumerate}

On the diagram the degenerate triangles are marked by solid lines.
Note that if one removes from $\spc{F}$ the point $q$ then the remaining part can be embedded in a sphere of intrinsic diameter $4$ with poles at $a$ and $b$ and the points $x,y,z$ on the equator.
On the other hand, if one removes the  point $a$ from the space and changes the distance $\dist{z}{b}{}$ then it can be isometrically embedded into  the plane.

It is straightforward to check that this finite set satisfies the conclusion of Theorem \ref{thm:pos-config} for $\kappa=0$.
However, if such a metric appeared as an inherited metric on a subset $\{a,b,x,y,z,q\}\subset \spc{L}\in\CBB{}{0}$
then clearly  
\[
\mangle\hinge x a y\z
=
\mangle\hinge y a z\z
=
\mangle\hinge y b z\z
= 
\tfrac{\pi}{3},
\]
contradicting $\dist{b}{z}{}=2$.

\medskip

The following problem was mentioned in \cite[15(b)]{gromov-CAT}


\begin{thm}{Open problem}\label{open:n-point-CBA}
Describe metrics on an $n$-point set which are embeddable into $\cCat{}{\kappa}$-spaces.
\end{thm}

The set of metrics on $\{a^1,a^2,\dots,a^n\}$ which can be embedded into a product of trees and hyperbolic spaces admits a simple description using decrypting matrices defined above.
Obviously, this gives a sufficient condition for problem \ref{open:n-point-CBA}.
This  condition is not necessary.
The existence of a counterexample follows again
from \cite[2.2]{vilms};
it is sufficient to take a sufficiently dense finite subset 
in a ball in a generic Hadamard space.

The (2$n$+2)-point comparison (\ref{CBA-n-point}) gives a necessary condition for \ref{open:n-point-CBA} 
which is not sufficient.
One can see this in the following example constructed by Nina Lebedava:

Consider a square $[\~x^1\~y^1\~x^2\~y^2]$ in $\EE^3$
with yet two points in general position $\~z^1$, $\~z^2$ so that the convex hull of $\~x^1,\~x^2,\~y^1,\~y^2,\~z^1,\~z^2$ forms a nonregular octahedron with the faces formed by triangles $[\~x^i \~y^j \~z^\kay]$.
Consider the induced metric on the 6-point set $\~x^1,\~x^2,\~y^1,\~y^2,\~z^1,\~z^2$.
Note that if we increase the $\dist{\~z^1}{\~z^2}{}$ slightly 
then in the obtained 6-point metric $\spc{F}_6$ space all the (2+2) and (4+2)-point comparisons continue to hold.

Now assume we embed the points $x^1,x^2,y^1,y^2,z^1,z^2$ lie in a $\cCat{}{0}$ space $\spc{U}$ in such a way that all the distances except $\dist{z^1}{z^2}{}$ are the same as between corresponding points in $\spc{F}_6$.
Since $[\~x^1\~y^1\~x^2\~y^2]$ is a square,
by Exercise~\ref{ex:square}, 
we get that $\spc{U}$ contains an isometric copy of a square $\Conv(x^1,y^1,x^2,y^2)_{\spc{U}}\iso\Conv(\~x^1,\~y^1,\~x^2,\~y^2)_{\EE^3}$.
Let \[\~w\in  \Conv(\~x^1,\~y^1,\~x^2,\~y^2)_{\EE^3}\]
and $w$ be corresponding point in $\Conv(x^1,y^1,x^2,y^2)_{\spc{U}}$.
By 
point-on-side comparison (\ref{cat-monoton}) we have $\dist{z^i}{w}{\spc{U}}\le \dist{\~z^i}{\~w}{\EE^3}$.
It follows that 
\[\dist{z^1}{z^2}{\spc{U}}
\le
\dist{\~z^1}{\~z^2}{\EE^3},\] 
a contradiction.%???

\begin{thm}{Exercise}
Consider a metric space $\spc{F}_s$
on 5 point set $p,q,x,y,z$ such that $\dist{p}{q}{}=s$
and all the remaining distances are equal $1$.
Assume $\spc{F}_s$ admits a distance preserving map into a $\cCat{}{0}$ space.
Show that $\spc{F}_s$ admits a distance preserving map into a $\CBB{}{0}$ space.
\end{thm}


The following conjecture (if true) would give the  right generality for  Kirszbraun's theorem (\ref{thm:kirsz+}).
Roughly it states that the example \ref{example:SS_+}, 
is the only obstacle for extending short map.

\begin{thm}{Conjecture}\label{conj:kirsz}
Assume $\spc{L}\in\CBB{}{1}$,
$\spc{U}\in\cCat{}{1}$,
$Q\subset \spc{L}$ is a proper subset
and $f\: Q\to\spc{U}$ be a short map, which does not admit a short extension to any bigger set $Q'\supset Q$. 
Then 

\begin{subthm}{}
$Q$ is isometric to a sphere in a Hilbert space (of finite or cardinal dimension).
Moreover, there is a point $p\in \spc{L}$ such that $\dist{p}{q}{}=\tfrac{\pi}{2}$ for any $q\in Q$.
\end{subthm}

\begin{subthm}{}
The map $f\:Q\to\spc{U}$ is a distance preserving map and there is no point $p'\in \spc{U}$ such that $\dist{p'}{q'}{}=\tfrac{\pi}{2}$ for any $q'\in f(Q)$.
\end{subthm}
\end{thm}

\section{Exercises}\label{sec:kirszbraun:exercises}

\begin{thm}{Exercise}\label{ex:flat-in-CAT}
Let $\spc{U}\in\cCat{}{0}$ 
Assume there are two point arrays $x^0,x^1,\dots,x^\kay\in\spc{U}$ and $\~x^0,\~x^1,\dots,\~x^\kay\in\EE^m$ such that 
$\dist{x^i}{x^j}{\spc{U}}=\dist{\~x^i}{\~x^j}{\EE^m}$ for each $i,j$ and 
for any point $z_0\in\spc{U}$, we have $\dist{z_0}{x_i}{}\ge\dist{x_0}{x_i}{}$ for at least one $i>0$.

Prove that there is a subset $Q\subset\spc{L}$ which is isometric to a convex set in $\EE^m$ and which contains all points $x^i$.
\end{thm}

\begin{thm}{Exercise}\label{ex:flat-in-CBB}
Let $\spc{L}\in\CBB{}{0}$,
$x^0,x^1,\dots,x^\kay\in\spc{L}$ and $\~x^0,\~x^1,\dots,\~x^\kay\in\EE^m$
be two point arrays such that 
$\dist{x^i}{x^j}{\spc{L}}=\dist{\~x^i}{\~x^j}{\EE^m}$ for each $i,j$.
Assume 
$\~x^0$ lies in the interior of $\Conv(\~x^1,\dots,\~x^\kay)$.

Prove that there is a subset $Q\subset\spc{L}$ which is isometric to a convex set in $\EE^m$ and which contains all points $x^i$.
\end{thm}

\begin{thm}{Flat triangle is not flat} 
\label{ex:not-flat}
Construct a space $\spc{L}\in\CBB{3}0$ with a triangle 
$\trig x y z$ in $\spc{L}$ with all angles equal to the corresponding angles of its model triangle, but which can not be filled by an isometric copy of the model triangle.
\end{thm}

\begin{thm}{Exercise}\label{ex:strut+embedding}
Let $\spc{L}\in\CBB{}{\kappa}$ and $p, a^0,a^1,\dots,a^m\in\spc{L}$. 
Assume that a point array $(a^0,a^1,\dots,a^\kay)$ in $\spc{L}$
 is \emph{$\kappa$-strutting} for a point $p\in\spc{L}$.
Show that there are point 
$\~p,\~a^0,\dots,\~a^m\in \Lob{m+1}\kappa$ such that
\[\dist{\~p}{\~a^i}{}=\dist{p}{a^i}{}\ \text{and}\ \dist{\~a^i}{\~a^j}{}=\dist{a^i}{a^j}{}\]
for all $i$ and $j$.
\end{thm}

The following statement was first observed in \cite{isbell}

\begin{thm}{Exercise}
We say that a space $\spc{X}$ is a \emph{Kirszbraun target}\index{Kirszbraun target} 
if for an arbitrary metric space $\spc Z$ 
and a subset $Q\subset\spc Z$, 
any short map $Q\to\spc{X}$ can be extended as a short map $\spc{Z}\to\spc{X}$.
\begin{enumerate}
\item Prove that any metric space $\spc X$ can be isometrically embedded into a Kirszbraun target.
\item Use it to construct an analog of convex hull in the category of metric spaces.
\end{enumerate}
\end{thm}

\begin{thm}{Exercise}
We say that a compact space $\spc{X}$ is a \emph{Kirszbrun source}\index{Kirszbrun source} if for an arbitrary complete metric space $\spc Z$ and subset $Q\subset\spc X$, any short map $Q\to \spc{Z}$ can be extended to a short map $\spc{X}\to\spc{Z}$.
Prove that a metric space $\spc{X}$ is a Kirszbrun source if and only if it satisfies ultratriangle inequality for all triples of points;
i.e.
\[
\dist{x}{z}{}\le\max\{\dist{x}{y}{},\dist{y}{z}{}\}
\]
for any $x,y,z\in\spc{X}$.
\end{thm}


\begin{thm}{Exercise}
Assume that a Riemannian manifold $\spc R$ satisfies the following condition:
for an arbitrary  subset $Q\subset\spc R$, any short map $Q\to\spc{R}$ can be extended to a short map $\spc{R}\to\spc{R}$.
Show that $\spc R$ has constant sectional curvature.
\end{thm}

\begin{thm}{Exercise}
Assume $\spc{X}$ is a complete length space which satisfy the following condition: any 4-point subset can be isometrically embedded in Euclidean 3-space.

Prove that $\spc{X}$ is isometric to a closed convex substet of a Hilbert space.
\end{thm}





