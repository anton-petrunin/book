%%%!TEX root = arXiv.tex
%%%%arXiv
\chapter{Fundamentals of curvature bounded above}
\chaptermark{Fundamentals of CBA}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Four-point comparison.} \label{sec:cba-def}

\index{$\CAT{}$}
\begin{thm}{Four-point comparison}\label{def:2+2}
A quadruple of points $p^1,p^2,x^1,x^2$ in a metric space 
satisfies 
\index{$\CAT{}$!$\CAT\kappa$ comparison}
\emph{$\CAT\kappa$ comparison}
if
  
\begin{subthm}{}
$\angk{\kappa}{p^1}{x^1}{x^2} 
\le 
\angk{\kappa}{p^1}{p^2}{x^1}+\angk{\kappa}{p^1}{p^2}{x^2}$, or
\end{subthm}

\begin{subthm}{}
$\angk{\kappa} {p^2}{x^1}{x^2}\le \angk{\kappa} {p^2}{p^1}{x^1} + \angk{\kappa} {p^2}{p^1}{x^2}$, or
\end{subthm}

\begin{subthm}{}
one of the six model angles 
\begin{align*}
\angk{\kappa}{p^1}{x^1}{x^2},\quad&\angk{\kappa}{p^1}{p^2}{x^1},\quad\angk{\kappa}{p^1}{p^2}{x^2},
\\
\angk{\kappa}{p^2}{x^1}{x^2},\quad&\angk{\kappa}{p^2}{p^1}{x^1},\quad\angk{\kappa}{p^2}{p^1}{x^2}
\end{align*}
is undefined.
\end{subthm}
\end{thm}

\begin{wrapfigure}{r}{30 mm}
\vskip-0mm
\centering
\includegraphics{mppics/pic-905}
\end{wrapfigure}

Here is a more intuitive formulation.

\begin{thm}{Reformulation}\label{def:2+2-reformulated}
Let $\spc{X}$ be a metric space.
A quadruple $p^1,p^2,x^1,x^2\in \spc{X}$ satisfies 
$\CAT\kappa$ comparison if one of the following holds:
\begin{subthm}{}
One of the triples 
$(p^1,p^2,x^1)$ 
or 
$(p^1, p^2, x^2)$ 
has perimeter $>2\cdot\varpi\kappa$.
\end{subthm}

\begin{subthm}{}
If $\trig{\tilde p^1}{\tilde p^2}{\tilde x^1}
=
\modtrig\kappa(p^1 p^2 x^1)$ 
and
$\trig{\tilde p}{\tilde p^2}{\tilde x^2}
\z=
\modtrig\kappa p^1 p^2 x^2$, then
\[\dist{\tilde x^1}{\tilde z}{}+\dist{\tilde z}{\tilde x^2}{}\ge \dist{x^1}{x^2}{},\]
for any $\tilde z\in[\tilde p^1\tilde p^2]$.

\end{subthm}

\end{thm}

\begin{thm}{Definition}
\label{def:ccat}
Let $\spc{U}$ be a metric space.

\begin{subthm}{}
$\spc{U}$ is 
\index{$\CAT{}$!$\CAT{\kappa}$ space} 
$\CAT{\kappa}$ 
if any quadruple $p^1,p^2,x^1,x^2\in \spc{X}$  satisfies  $\CAT{\kappa}$ comparison.
\end{subthm}

\begin{subthm}{}
$\spc{U}$ is 
\index{$\CAT{}$!locally $\CAT{\kappa}$ space}
\emph{locally $\CAT{\kappa}$} 
if any point $q\in \spc{U}$ admits a neighborhood $\Omega\ni q$ such that any quadruple $p^1,p^2,x^1,x^2\in \spc{X}$  satisfies  $\CAT\kappa$ comparison.
\end{subthm}

\begin{subthm}{}
$\spc{U}$  is a  
\index{$\CAT{}$!$\CAT{}$ space}
$\CAT{}$ space if  $\spc{U}$  is $\CAT{\kappa}$ for some $\kappa\in\RR$.
\end{subthm}
\end{thm}

%\begin{thm}{Definition}
%\label{def:ccat}
%A metric space $\spc{U}$ 
%is called $\CAT{\kappa}$ if every quadruple $p^1,p^2,x^1,x^2$ satisfies the $\CAT\kappa$ comparison (\ref{def:2+2}).  

%We say that $\spc{U}$ is $\CAT{}$ if it is $\CAT{\kappa}$ for some $\kappa\in\RR$.  
%\end{thm}

The condition $\spc{U}$ is $\CAT\kappa$ should be understood as ``$\spc{U}$ has global curvature $\le\kappa$''.
In Proposition~\ref{prop:inherit-bound}, it will be shown that this formulation makes sense; 
in particular, if $\kappa\le\Kappa$, then any $\CAT\kappa$ space is $\CAT\Kappa$.


This terminology was introduced by Michael Gromov;  
$\CAT{}$ stands for \'Elie Cartan, Alexandr Alexandrov, and Victor Toponogov.
Originally these spaces were called \index{$\mathfrak{R}_\kappa$ domain}\emph{$\mathfrak{R}_\kappa$ domains};
this is Alexandrov's terminology and is still in use.


\begin{thm}{Exercise}\label{ex:ccat-(3+1)}
Let $\spc{U}$ be a metric space.
Show that $\spc{U}$ is $\CAT\kappa$
if and only if every quadruple of points in $\spc{U}$ admits a labeling by $(p,x^1,x^2,x^3)$ such that the three angles 
$\angk\kappa p{x^1}{x^2}$,
$\angk\kappa p{x^2}{x^3}$ and
$\angk\kappa p{x^1}{x^3}$
satisfy all three triangle inequalities or one of these angles is undefined.
\end{thm}

\begin{thm}{Exercise}\label{ex:sba-2+2-short}
Show that $\spc{U}$ is $\CAT\kappa$
if and only if for any quadruple of points 
$p^1,p^2,x^1,x^2$ in $\spc{U}$ such that
$\dist{p^1}{p^2}{},\dist{x^1}{x^2}{}\le \varpi\kappa$,
there is a quadruple $q^1,q^2,y^1,y^2$ in $\Lob m\kappa$
such that 
\begin{align*}
\dist{q^1}{q^2}{}&=\dist{p^1}{p^2}{},
&
\dist{y^1}{y^2}{}&=\dist{x^1}{x^2}{},
&
\dist{q^i}{y^j}{}&\le \dist{p^i}{x^j}{}
\end{align*}
for any $i$ and $j$.
\end{thm}

\begin{thm}{Advanced exercise}\label{ex:berg-nikolaev}
Let $\spc{U}$ be a complete length space such that for any quadruple $p,q,x,y\in\spc{L}$ 
the following inequality holds
\[\dist[2]{p}{q}{}+\dist[2]{x}{y}{}\le \dist[2]{p}{x}{}
+\dist[2]{p}{y}{}+\dist[2]{q}{x}{}+\dist[2]{q}{y}{}.
\eqlbl{eq:berg-nikolaev-CAT}\]
Prove that $\spc{U}$ is $\CAT0$.

Construct a 4-point metric space $\spc{X}$ that satisfies inequality \ref{eq:berg-nikolaev-CAT} for any relabeling of its points by $p,q,x,y$, and such that $\spc{X}$ is not $\CAT{0}$.
\end{thm}

The next proposition follows directly from Definition \ref{def:ccat} and the definitions of ultralimit and ultrapower;
see Section~\ref{ultralimits} for the related definitions.
Recall that $\o$ denotes a fixed selective ultrafilter on $\NN$.


\begin{thm}{Proposition}\label{prop:CAT-olim}
\label{prop:CAT^omega}
Let $\spc{U}_n$ be a $\CAT{\kappa_n}$ space for each $n\in\NN$.
Assume $\spc{U}_n\to \spc{U}_\o$ and $\kappa_n\to\kappa_\o$ as $n\to\o$.
Then $\spc{U}_\o$ is $\CAT{\kappa_\o}$.

Moreover, a metric space $\spc{U}$ is $\CAT\kappa$ if and only if so is its ultrapower~$\spc{U}^\o$.

\end{thm} 

\section{Geodesics}

\begin{thm}{Uniqueness of geodesics}\label{thm:cat-unique}\label{thm:cat-complete} 
In a complete length $\CAT\kappa$ space, pairs of points at distance $<\varpi\kappa$ are joined by unique geodesics, and these geodesics depend continuously on their endpoint pairs.
\end{thm}

\parit{Proof.} 
Fix a complete length $\CAT\kappa$ space $\spc{U}$.
Fix two points $p^1,p^2\in \spc{U}$  such that 
\[\dist{p^1}{p^2}{\spc{U}}<\varpi\kappa.\]

Choose a sequence of approximate midpoints $z_n$ between $p^1$ and $p^2$;
that is,  
\[\dist{p^1}{z_n}{},\dist{p^2}{z_n}{}
\to\tfrac12\cdot\dist[{{}}]{p^1}{p^2}{}
\quad\text{as}\quad n\to\infty.
\eqlbl{eq:to|p1p2|/2}\]

By the law of cosines, $\angk{\kappa} {p^1}{z_n}{p^2}$ and $\angk{\kappa} {p^2}{z_n}{p^1}$ are arbitrarily small when $n$ is sufficiently large.

Let us apply $\CAT\kappa$  comparison (\ref{def:2+2}) to the quadruple $p^1$, $p^2$, $z_n$, $z_\kay$ with large $n$ and $\kay$.
We conclude that  $\angk{\kappa} {p}{z_n}{z_\kay}$ is arbitrarily small when $n,\kay$ are sufficiently large and $p$ is either $p^1$ or $p^2$.  
By \ref{eq:to|p1p2|/2} and the law of cosines, the sequence $z_n$ converges.  

Since $\spc{U}$ is complete, the sequence $z_n$ converges to a midpoint between $p^1$ and $p^2$. 
By Lemma~\ref{lem:mid>geod} we obtain  the existence of a geodesic $[p^1p^2]$.

Now suppose $p^1_n\to p^1$, $p^2_n\to p^2$ as $n\to\infty$.
Let $z_n$ be the midpoint of a geodesic $[p^1_n p^2_n]$ and $z$ be the midpoint of a geodesic $[p^1p^2]$.  

It suffices to show that 
\[\dist{z_n}{z}{}\to0
\quad \text{as}\quad 
n\to\infty.
\eqlbl{eq:z_n->z}\]

By the triangle inequality, the $z_n$ are approximate midpoints between $p^1$ and $p^2$.
Apply the $\CAT\kappa$ comparison (\ref{def:2+2}) to the quadruple $p^1$, $p^2$, $z_n$,~$z$. 
For $p=p^1$ or $p=p^2$, we see that $\angk{\kappa} {p}{z_n}{z}$ is arbitrarily small when $n$ is sufficiently large.  
By the law of cosines, \ref{eq:z_n->z} follows.
\qeds

\begin{thm}{Exercise}\label{ex:CAT-mnfld=>ext.geod}
Let $\spc{U}$ be a complete length $\CAT{}$ space.
Assume $\spc{U}$ is a topological manifold.
Show that any geodesic in $\spc{U}$ can be extended 
as a two-side infinite local geodesic.

Moreover the same holds for any locally geodesic locally $\CAT{}$ space $\spc{U}$ with nontrivial local homology groups at any point;
the latter holds in particular if $\spc{U}$ is a homological manifold.
\end{thm}

\begin{thm}{Exercise}\label{ex:complete-space-of-dir}
Assume $\spc{U}$ is a locally compact geodesic $\CAT{}$ space with extendable geodesics;
that is, any geodesic in $\spc{U}$ can be extended to a both-sided infinite local geodesic.

Show that the space of geodesic directions $\Sigma_p'$ is complete for any $p\in \spc{U}$.
\end{thm}

By the uniqueness of geodesics (\ref{thm:cat-unique}),
we have the following.

\begin{thm}{Corollary}\label{cor:cat-ccat}
Any  complete length $\CAT\kappa$ space is $\varpi\kappa$-geodesic.

\end{thm}

\begin{thm}{Proposition}\label{cor:cat-completion} 
The completion $\bar{\spc{U}}$ of any geodesic $\CAT{\kappa}$ space $\spc{U}$ is a complete length $\CAT\kappa$ space.

Moreover, $\spc{U}$ is a geodesic $\CAT\kappa$ space
if and only if there is a complete length $\CAT\kappa$ space $\bar{\spc{U}}$ that contains a $\varpi\kappa$-convex dense set isometric to $\spc{U}$.
\end{thm}

\parit{Proof.} 
By Theorem \ref{thm:cat-complete},
in order to show that  $\bar{\spc{U}}$ is $\CAT{\kappa}$,
it is sufficient to verify that the completion of a length space is a length space; 
this is straightforward.

For the second part, note that the completion $\bar{\spc{U}}$
contains the original space $\spc{U}$ as a dense $\varpi\kappa$-convex subset, and the metric on $\spc{U}$ coincides with the induced length metric from $\bar{\spc{U}}$.
\qeds

Here is a corollary from Proposition~\ref{cor:cat-completion}
and Theorem~\ref{thm:cat-unique}.

\begin{thm}{Corollary}\label{cor:cat-unique}
Let $\spc{U}$ be a  $\varpi\kappa$-geodesic $\CAT\kappa$ space.
Then pairs of points in $\spc{U}$ at distance less than $\varpi\kappa$ are joined by unique geodesics, and these geodesics depend continuously on their endpoint pairs.

Moreover for any pair of points $p,q\in \spc{U}$ and any value
\[\Lip>\sup\set{\frac{\sn\kappa r}{\sn\kappa \dist{p}{q}{}}}{0\le r\le \dist{p}{q}{}}\]
there are neighborhoods $\Omega_p\ni p$ and $\Omega_q\ni q$ such that the map
\[(x,y,t)\mapsto \geodpath_{[xy]}(t)\]
is $\Lip$-Lipschitz in $\Omega_p\times \Omega_q\times[0,1]$.
\end{thm}

\parit{Proof.}
By Proposition~\ref{cor:cat-completion}, any geodesic $\CAT{\kappa}$ space is isometric to a convex dense subset of a complete length $\CAT\kappa$ space.
It remains to apply  Theorem~\ref{thm:cat-unique}.
\qeds


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{More comparisons}\label{sec:cat-angles}

Here we give a few reformulations of Definition~\ref{def:ccat}.

\begin{wrapfigure}{r}{25 mm}
\vskip-0mm
\centering
\includegraphics{mppics/pic-910}
\end{wrapfigure}

\begin{thm}{Theorem}
\label{thm:defs_of_cat} 
If $\spc{U}$ is a $\CAT\kappa$ space, then 
the following conditions hold for all triples $p,x,y\in \spc{U}$ of perimeter $<2\cdot\varpi\kappa$:

\begin{subthm}{cat-2-sum} (adjacent angle comparison\index{comparison!adjacent angle comparison}) for any geodesic $[x y]$ and $z\in \mathopen{]}x y\mathclose{[}$, we have
\[\angk\kappa z p x
+\angk\kappa z p y\ge \pi.\]
\end{subthm}

\begin{subthm}{cat-monoton}
(point-on-side comparison\index{comparison!point-on-side comparison}) 
for any geodesic $[x y]$ and $z\in \mathopen{]}x y\mathclose{[}$, we have
\[\angk\kappa x p y\ge\angk\kappa x p z,\]
or equivalently, 
\[\dist{\tilde p}{\tilde z}{}\ge \dist{p}{z}{},\]
where $\trig{\tilde p}{\tilde x}{\tilde y}=\modtrig\kappa(p x y)$, $\tilde z\in\mathopen{]} \tilde x\tilde y\mathclose{[}$, $\dist{\tilde x}{\tilde z}{}=\dist{x}{z}{}$.
\end{subthm}

\begin{subthm}{cat-hinge}(hinge comparison\index{comparison!hinge comparison})
for any hinge $\hinge x p y$, the angle 
$\mangle\hinge x p y$ exists and
\[\mangle\hinge x p y\le\angk\kappa x p y,\]
or equivalently,
\[\side\kappa \hinge x p y\le\dist{p}{y}{}.\]
\end{subthm}
%SBA:  a ``hinge'' in English is a ``movable mechanism''.  It must MOVE. BBI uses it correctly:  if you look up ``hinge'' in BBI index, it sends you to monotonicity.

Moreover, if  $\spc{U}$ is  $\varpi\kappa$-geodesic, then the converse holds in each case.  

\end{thm}


\parbf{Remark.}
\label{22remark}
In the following proof, the part \ref{SHORT.cat-hinge}$\Rightarrow$\ref{SHORT.cat-2-sum})
only requires that the $\CAT\kappa$ comparison (\ref{def:2+2}) hold for any quadruple, and does not require the existence of geodesics at distance $<\varpi\kappa$. 
The same is true of the parts \ref{SHORT.cat-2-sum}$\Leftrightarrow$\ref{SHORT.cat-monoton} and
\ref{SHORT.cat-monoton}$\Rightarrow$\ref{SHORT.cat-hinge}.  
Thus the conditions \ref{SHORT.cat-2-sum}, \ref{SHORT.cat-monoton}) and \ref{SHORT.cat-hinge} are valid for any metric space (not necessarily a length space) that satisfies $\CAT\kappa$ comparison (\ref{def:2+2}). 
The converse does not hold; for example, all these conditions are 
vacuously true in a 
totally disconnected space, while 
$\CAT\kappa$ comparison is not.

\parit{Proof; \ref{SHORT.cat-2-sum}}. 
Since the perimeter of $p,x,y$ is $<2\cdot \varpi\kappa$, so is the perimeter of any subtriple of $p,z,x,y$ by the triangle inequality. 
By Alexandrov's lemma (\ref{lem:alex}), 
\[\angk\kappa p z x +\angk\kappa p z y  < \angk{\kappa} p x y \quad \text{or}\quad  \angk\kappa z p x  +\angk\kappa z p y  =\pi.\]
In the former case, the $\CAT\kappa$ comparison (\ref{def:2+2}) applied to the quadruple $p, z, x, y$ implies
\[\angk\kappa z p x  +\angk\kappa z p y  \ge \angk{\kappa} z x y =\pi.\]

\parit{\ref{SHORT.cat-2-sum}$\Leftrightarrow$\ref{SHORT.cat-monoton}.}
Follows from  Alexandrov's lemma (\ref{lem:alex}).

\parit{\ref{SHORT.cat-monoton}$\Rightarrow$\ref{SHORT.cat-hinge}.} 
By \ref{SHORT.cat-monoton}, for $\bar p\in\mathopen{]}x p]$ and $\bar y\in\mathopen{]}x y]$ the function $(\dist{x}{\bar p}{},\dist{x}{\bar y}{})\mapsto\angk\kappa x{\bar p}{\bar y}$ is nondecreasing in each argument.
In particular, 
$\mangle\hinge x p y\z=\inf\angk\kappa x{\bar p}{\bar y}$.
Thus $\mangle\hinge x p y$ exists and is
at most $\angk\kappa x p y$. 

\parit{Converse.} Assume $\spc{U}$ is $\varpi\kappa$-geodesic. 
Let us first show that in this case \ref{SHORT.cat-hinge}$\Rightarrow$\ref{SHORT.cat-2-sum}.

\begin{wrapfigure}{r}{30 mm}
\vskip-4mm
\centering
\includegraphics{mppics/pic-915}
\end{wrapfigure}

Indeed, by \ref{SHORT.cat-hinge} and the triangle inequality for angles (\ref{claim:angle-3angle-inq}),
\[\angk\kappa z p x
+\angk\kappa z p y \ge \mangle\hinge z p x
+\mangle\hinge z p y \ge \pi.\]
It remains to prove the converse for \ref{SHORT.cat-monoton}.

Given a quadruple  $p^1,p^2,x^1,x^2$ whose subtriples have perimeter $<2\cdot\varpi\kappa$, we must verify the $\CAT\kappa$ comparison (\ref{def:2+2}).
In $\Lob2\kappa$, construct the model triangles  $\trig{\tilde p^1}{\tilde p^2}{\tilde x^1} = \modtrig\kappa(p^1 p^2 x^1 )$ 
and $\trig{\tilde p^1}{\tilde p^2}{\tilde x^2}\z= \modtrig\kappa(p^1 p^2 x^2)$, lying on either side of a common segment $[\tilde p^1 \tilde p^2]$.
We may suppose 
\[\angk{\kappa} {p^1}{p^2}{x^1}+\angk{\kappa} {p^1}{p^2}{x^2}
\le
\pi
\quad \text{and}\quad 
\angk{\kappa}{p^2}{p^1}{x^1}+\angk{\kappa} {p^2}{p^1}{x^2}
\le 
\pi,\] 
since otherwise $\CAT\kappa$ comparison holds trivially.  
Then $[\tilde p^1 \tilde p^2]$ and $[\tilde x^1 \tilde x^2]$ intersect, say at $\tilde q$.  

By assumption, there is a geodesic $[p^1 p^2]$.
Choose $q\in[p^1 p^2]$ corresponding to $\tilde q$; 
that is, $\dist{p^1}{q}{}=\dist{\tilde p^1}{\tilde q}{}$.
Then 
\[\dist{x^1}{x^2}{} \le \dist{x^1}{q}{} + \dist{q}{x^2}{} \le \dist{\tilde x^1}{\tilde q}{} + \dist{\tilde q}{\tilde x^2}{} = \dist{\tilde x^1}{\tilde x^2}{},\]
where the second inequality follows from \ref{SHORT.cat-monoton}. 
By monotonicity of the function $a\mapsto\tangle\mc\kappa\{a;b,c\}$ (\ref{increase}),
\begin{align*}
\angk{\kappa} {p^1}{x^1}{x^2} \le  \mangle\hinge{ \tilde p^1}{ \tilde x^1}{ \tilde x^2}
= \angk{\kappa} {p^1}{p^2}{x^1} + \angk{\kappa} {p^1}{p^2}{x^2}.
\end{align*}
\qedsf

Let us display a corollary of the proof of \ref{thm:defs_of_cat},
namely, monotonicity of the model angle with respect to adjacent sidelengths. 

\begin{thm}{Angle-sidelength  monotonicity}\label{cor:monoton-cba} 
Suppose $\spc{U}$ is a $\varpi\kappa$-geodesic $\CAT\kappa$ space, and 
$p,x,y\in \spc{U}$ have  perimeter $<2\cdot \varpi\kappa$.
Then for $\bar y\in\mathopen{]}x y]$, the function 
\[\dist{x}{\bar y}{}\mapsto \angk\kappa x p{\bar y}\] 
is nondecreasing.

In particular, if $\bar p\in \mathopen{]}x p]$, then
\begin{subthm}{two-mono-cba}the function 
\[(\dist{x}{\bar y}{},\dist{x}{\bar p}{})\mapsto \angk\kappa x {\bar p}{\bar y}\] is nondecreasing in each argument,
\end{subthm}
 
\begin{subthm}{cor:monoton-cba:angle=inf} 
$\mangle\hinge{x}{p}{y}
=
\inf\set{\angk\kappa x {\bar p}{\bar y}}{
\bar p\in\mathopen{]}x p],\ 
\bar y\in\mathopen{]}x y]}.$
\end{subthm}
\end{thm}

\begin{thm}{Exercise}\label{mink+CAT=euclid} 
Let $\spc{U}$ be  $\RR^m$ with the metric defined by a norm.
Show that $\spc{U}$ is a complete length $\CAT{}$ space if and only if $\spc{U}\iso\EE^m$.
\end{thm}

\begin{thm}{Exercise}\label{ex:convexity-CAT0}
Assume $\spc{U}$ is a geodesic $\CAT0$ space.
Show that for any two geodesic paths 
$\gamma,\sigma\:[0,1]\to \spc{U}$
the function 
\[t\mapsto\dist{\gamma(t)}{\sigma(t)}{}\] 
is convex.
\end{thm}

\begin{thm}{Proposition}
\label{prop:inherit-bound}
Assume $\kappa<\Kappa$.
Then any complete length $\CAT\kappa$ space is $\CAT\Kappa$.

Moreover a space $\spc{U}$ is $\CAT\kappa$ if  $\spc{U}$ is $\CAT\Kappa$ for all $\Kappa>\kappa$.
\end{thm}

\parit{Proof.}
The first statement follows from Corollary \ref{cor:cat-ccat}, the adjacent-angles comparison (\ref{cat-2-sum}) and the monotonicity of the function $\kappa\mapsto\angk\kappa x y z$ (\ref{k-decrease}).

The second statement follows since the function $\kappa\mapsto\angk\kappa x y z$ is continuous.
\qeds

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Thin triangles} \label{sec:thin-triangle}

In this section we define thin triangles
and use them to characterize $\CAT{}$ spaces.
Inheritance for thin triangles with respect to decomposition
is the main result of this section.
It will lead to two fundamental constructions:  
Alexandrov's patchwork globalization  (\ref{thm:alex-patch}) 
and Reshetnyak gluing (\ref{thm:gluing}).
 
\begin{thm}{Definition of $\bm\kappa$-thin triangles}\label{def:k-thin}
Let $\trig{x^1}{x^2}{x^3}$ be a triangle of perimeter $<2\cdot \varpi\kappa$ in a metric space
and
$\trig{\tilde x^1}{\tilde x^2}{\tilde x^3}\z=\modtrig\kappa({x^1}{x^2}{x^3})$.
Consider the \emph{natural map} $\trig{\tilde x^1}{\tilde x^2}{\tilde x^3}\to \trig{x^1}{x^2}{x^3}$ 
that sends a point $\tilde z\in[\tilde x^i\tilde x^j]$ to the corresponding point $z\in[x^ix^j]$
(that is, such that $\dist{\tilde x^i}{\tilde z}{}=\dist{x^i}{z}{}$ and therefore $\dist{\tilde x^j}{\tilde z}{}=\dist{x^j}{z}{}$).

We say the triangle $\trig{x^1}{x^2}{x^3}$ is \index{thin triangle}\emph{$\kappa$-thin} if the natural map $\trig{\tilde x^1}{\tilde x^2}{\tilde x^3}\to \trig{x^1}{x^2}{x^3}$ is short.
\end{thm}

\begin{thm}{Exercise}\label{ex:equality-for-thin}
Let $\spc{U}$ be a $\varpi\kappa$-geodesic $\CAT\kappa$ space.
Let $\trig xyz$ be a triangle in $\spc{U}$
and $\trig{\tilde x}{\tilde y}{\tilde z}$ be its model triangle in $\Lob{2}{\kappa}$.
Prove that the natural map $f\:\trig{\tilde x}{\tilde y}{\tilde z}\to \trig xyz$ 
 is distance-preserving if and only if one of the following conditions hold:

\begin{subthm}{ex:equality-for-thin:angle}
$\mangle\hinge x y z= \angk\kappa x y z$,
\end{subthm}

\begin{subthm}{ex:equality-for-thin:vertex-base}
$\dist{x}{w}{}=\dist{\tilde x}{\tilde w}{}$ for some  $\tilde w\in]\tilde y\tilde z[$ and
$w= f(\tilde w)$,   
\end{subthm}

\begin{subthm}{ex:equality-for-thin:side-side} 
$\dist{v}{w}{}=\dist{\tilde v}{\tilde w}{}$ for some  
$\tilde v\in \mathopen{]}\tilde x \tilde y\mathclose{[}$,  $\tilde w\in\mathopen{]}\tilde x \tilde z\mathclose{[}$
and $v=f(\tilde v)$, $w=f(\tilde w)$.
\end{subthm} 

\end{thm}

{\sloppy 

\begin{thm}{Proposition}\label{prop:k-thin}
Let $\spc{U}$ be a $\varpi\kappa$-geodesic space. 
Then $\spc{U}$ is  $\CAT\kappa$
if and only if every triangle of perimeter $<2\cdot \varpi\kappa$ in $\spc{U}$  is $\kappa$-thin.
\end{thm}

}

\parit{Proof.}
The if part follows from the point-on-side comparison (\ref{cat-monoton}).  
The only-if part follows from angle-sidelength  monotonicity (\ref{two-mono-cba}).
\qeds


\begin{thm}{Corollary}\label{cor:loc-geod-are-min}
Suppose $\spc{U}$ is a $\varpi\kappa$-geodesic $\CAT\kappa$ space.  
Then any local geodesic in $\spc{U}$ of length $<\varpi\kappa$ is length-minimizing.
\end{thm}

\parit{Proof.}
Suppose $\gamma\:[0,\ell]\to\spc{U}$ is a local geodesic  that is not minimizing, with $\ell<\varpi\kappa$.
Choose $a$ to be the maximal value 
such that $\gamma$ is minimizing on $[0,a]$.
Further choose $b>a$ so that $\gamma$ is minimizing on~$[a,b]$.

Since triangle $\trig{\gamma(0)}{\gamma(a)}{\gamma(b)}$ is $\kappa$-thin, we have
\[\dist{\gamma(a-\eps)}{\gamma(a+\eps)}{}<2\cdot\eps\]
for all small $\eps>0$,
a contradiction.
\qeds


Now let us formulate the main result of this section.
The inheritance lemma states that  in any metric space, a triangle is $\kappa$-thin if it decomposes into $\kappa$-thin triangles. 
In contrast, $\kappa$-thickness of triangles (\ref{ex:fat-triangle}) is not inherited in this way.

\begin{wrapfigure}{r}{25 mm}
\vskip-0mm
\centering
\includegraphics{mppics/pic-920}
\end{wrapfigure}

\begin{thm}{Inheritance lemma}
\label{lem:inherit-angle} 
In a metric space, consider a triangle $\trig p x y$ that \index{decomposed triangle}\emph{decomposes} 
into two triangles $\trig p x z$ and $\trig p y z$;
that is, $\trig p x z$ and $\trig p y z$ have common side $[p z]$, and the sides $[x z]$ and $[z y]$ together form the side $[x y]$ of $\trig p x y$.

If the triangle $\trig p x y$ has perimeter $<2\cdot\varpi\kappa$
and both triangles $\trig p x z$ and $\trig p y z$ are $\kappa$-thin, then triangle $\trig p x y$ is  $\kappa$-thin.
\end{thm} 

The following model-space lemma is  extracted from Lemma 2 in \cite{reshetnyak:major}.

\begin{thm}{Lemma}\label{lem:quadrangle}
Let $\trig{\tilde p}{\tilde x}{\tilde y}$ be a triangle in $\Lob2{\kappa}$ and $\tilde z\in[\tilde x\tilde y]$.
Consider the solid triangle $\tilde D=\Conv\trig{\tilde p}{\tilde x}{\tilde y}$.  
Construct  points $\dot p, \dot x, \dot z, \dot y\in \Lob2{\kappa}$ such that 
\begin{align*}
\dist{\dot p}{\dot x}{}&=\dist{\tilde p}{\tilde x}{},
&
\dist{\dot p}{\dot y}{}&=\dist{\tilde p}{\tilde y}{},
&
\dist{\dot p}{\dot z}{}&\le \dist{\tilde p}{\tilde z}{},
\\
\dist{\dot x}{\dot z}{}&=\dist{\tilde x}{\tilde z}{},
&
\dist{\dot y}{\dot z}{}&=\dist{\tilde y}{\tilde z}{},
\end{align*}
where points $\dot x$ and $\dot y$ lie on either side of $[\dot p\dot z]$.
Set 
\[\dot D=\Conv\trig {\dot p}{\dot x}{\dot z}\cup \Conv\trig {\dot p} {\dot y} {\dot z}.\]

Then there is a short map $F\:\tilde D\to \dot D$ that maps $\tilde p$, $\tilde x$, $\tilde y$ and $\tilde z$ to $\dot p$, $\dot x$, $\dot y$ and $\dot z$ respectively.
\end{thm}

{

\begin{wrapfigure}{r}{41 mm}
\vskip-0mm
\centering
\includegraphics{mppics/pic-925}
\end{wrapfigure}

\parit{Proof.} 
By Alexandrov's lemma (\ref{lem:alex}), 
there are nonoverlapping triangles 
$\trig{\tilde p}{\tilde x}{\tilde z_y}\iso\trig {\dot p}{\dot x}{\dot z}$ 
and 
$\trig{\tilde p}{\tilde y}{\tilde z_x}\iso\trig {\dot p}{\dot y}{\dot z}$
 inside triangle $\trig{\tilde p}{\tilde x}{\tilde y}$.

Connect points in each pair
$(\tilde z,\tilde z_x)$, 
$(\tilde z_x,\tilde z_y)$ 
and $(\tilde z_y,\tilde z)$ 
with arcs of circles centered at 
$\tilde y$, $\tilde p$, and $\tilde x$ respectively. 
Define $F$ as follows.

}

\begin{itemize}
\item Map  $\Conv\trig{\tilde p}{\tilde x}{\tilde z_y}$ isometrically onto  $\Conv\trig {\dot p}{\dot x}{\dot y}$;
similarly map $\Conv \trig{\tilde p}{\tilde y}{\tilde z_x}$ onto $\Conv \trig {\dot p}{\dot y}{\dot z}$.

\item If $w$ is in one of the three circular sectors, say at distance $r$ from the center of the circle, let $F(w)$ be the point on  
$[\dot p \dot z]$, 
$[\dot x \dot z]$,
or $[\dot y \dot z]$ whose distance from the left-hand endpoint of the segment is $r$.
\item Finally, if $w$ lies in the remaining curvilinear triangle $\tilde z \tilde z_x \tilde z_y$, 
set $F(w) = \dot z$. 
\end{itemize}
By construction, $F$ meets the conditions of the lemma. 
\qeds


\parit{Proof of \ref{lem:inherit-angle}.}
Construct model triangles $\trig{\dot p}{\dot x}{\dot z}\z=\modtrig\kappa(p x z)$ 
and $\trig {\dot p} {\dot y} {\dot z}\z=\modtrig\kappa(p y z)$ so that $\dot x$ and $\dot y$ lie on opposite sides of $[\dot p\dot z]$.

\begin{wrapfigure}{r}{30 mm}
\vskip-0mm
\centering
\includegraphics{mppics/pic-930}
\end{wrapfigure}

Suppose
\[\angk\kappa{z}{p}{x}+\angk\kappa{z}{p}{y}
<
\pi.\]
Then for some point $\dot w\in[\dot p\dot z]$, we have \[\dist{\dot x}{\dot w}{}+\dist{\dot w}{\dot y}{}
<
\dist{\dot x}{\dot z}{}+\dist{\dot z}{\dot y}{}=\dist{x}{y}{}.\]
Let $w\in[p z]$ correspond to $\dot w$; that is, $\dist{z}{w}{}=\dist{\dot z}{\dot w}{}$. 
Since $\trig p x z$ and $\trig p y z$ are $\kappa$-thin, we have 
\[\dist{x}{w}{}+\dist{w}{y}{}<\dist{x}{y}{},\]
contradicting the triangle inequality. 

Thus 
\[\angk\kappa{z}{p}{x}+\angk\kappa{z}{p}{y}
\ge
\pi.\]
By Alexandrov's lemma (\ref{lem:alex}), this is equivalent to 
\[\angk\kappa x p z\le\angk\kappa x p y.
\eqlbl{eq:for|pz|}\]

Let $\trig{\tilde  p}{\tilde  x}{\tilde  y}=\modtrig\kappa (p x y)$ 
and $\tilde  z\in[\tilde  x\tilde  y]$ correspond to $z$; that is, $\dist{x}{z}{}=\dist{\tilde  x}{\tilde  z}{}$.
Inequality~\ref{eq:for|pz|} is equivalent to $\dist{ p}{ z}{}\le \dist{\tilde  p}{\tilde  z}{}$.
Hence  Lemma~\ref{lem:quadrangle} applies.  Therefore 
there is a short map $F$ that  sends 
$\trig{\tilde  p}{\tilde  x}{\tilde  y}$ to $\dot D=\Conv\trig {\dot p}{\dot x}{\dot z}\cup \Conv\trig {\dot p} {\dot y} {\dot z}$ 
in such a way that 
$\tilde p\mapsto \dot p$,
$\tilde x\mapsto \dot x$,
$\tilde z\mapsto \dot z$
and
$\tilde y\mapsto \dot y$.

By assumption, the natural maps $\trig {\dot p} {\dot x} {\dot z}\to\trig p x z$ and $\trig {\dot p} {\dot y} {\dot z}\to\trig p y z$ are short.  
By composition,  the natural map from $\trig{\tilde  p}{\tilde  x}{\tilde  y}$ to $\trig p y z$ is short, as claimed.
\qeds


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Function comparison} \label{sec:func-comp}


\index{comparison!function comparison}
In this section we give analytic and geometric ways of viewing the point-on-side comparison (\ref{cat-monoton}) as a convexity condition.

First we obtain a corresponding differential inequality for the distance function in $\spc{U}$;
see Section~\ref{sec:conv-fun} for the definition.
 
\begin{thm}{Theorem}\label{thm:function-comp} 
Suppose $\spc{U}$ is a $\varpi\kappa$-geodesic space. 
Then the following are equivalent:
\begin{subthm}{function-comp-cat} 
$\spc{U}$ is $\CAT\kappa$,
\end{subthm}
\begin{subthm}{function-comp}
for any $p\in \spc{U}$, the function $f=\md\kappa\circ\distfun{p}{}{}$ satisfies 
\[f''+\kappa \cdot f\ge 1\] 
in $\oBall(p,\varpi\kappa)$.
\end{subthm}\end{thm}

\begin{thm}{Corollary}
A geodesic space $\spc{U}$ is $\CAT{0}$ if and only if for any $p\in \spc{U}$, the function $\distfun[2]{p}{}{}\:\spc{U}\to\RR$ is $2$-convex.
\end{thm}


\parit{Proof of \ref{thm:function-comp}.}
Fix a sufficiently short geodesic $[x y]$ in $\oBall(p,\varpi\kappa)$.
We can assume that the model triangle $\trig{\tilde p}{\tilde x}{\tilde y}\z=\modtrig\kappa(p x y)$ is defined. 
Let \begin{align*} 
\tilde r(t)&=\dist{\tilde p}{\geod_{[\tilde x\tilde y]}(t)}{},
& 
r(t)&=\dist{p}{\geod_{[xy]}(t)}{}.                           \end{align*}
Let $\tilde f=\md\kappa\circ\tilde r$ and $f=\md\kappa\circ r$.
By \ref{md-diff-eq}, we have $\tilde f''\z=1-\kappa\cdot  \tilde f$.
Clearly $\tilde f(t)$ and $f(t)$ agree at $t=0$ and $t=\dist{x}{y}{}$. 
The point-on-side comparison (\ref{cat-monoton}) is the condition $r(t)\le\tilde r(t)$  for all $t\in[0,\dist{x}{y}{}]$.
Since $\md\kappa$ is increasing on $[0,\varpi\kappa)$, then $r\le \tilde r$ and $f\le \tilde f$ are equivalent.
Thus the claim follows by Jensen's inequality (\ref{y''-mono}).
\qeds

\begin{thm}{Corollary}\label{cor:convex-balls}
Suppose $\spc{U}$ is a $\varpi\kappa$-geodesic $\CAT\kappa$ space.
Then any ball (closed or open) of radius $R<\tfrac{\varpi\kappa}2$ in $\spc{U}$ is convex.

Moreover, any open ball of radius $\tfrac{\varpi\kappa}2$ is convex
and any closed ball of radius $\tfrac{\varpi\kappa}2$ is $\varpi\kappa$-convex.
\end{thm}

\parit{Proof.}
Suppose $p\in\spc{U}$, $ R\le\varpi\kappa/2$,  and two points 
$x$ and $y$ lie in $\cBall[p, R]$ or $\oBall(p, R)$.
By the triangle inequality, if $\dist{x}{y}{}<\varpi\kappa$, then any
 geodesic $[x y]$ lies in $\oBall(p, \varpi\kappa)$.
 
By the function comparison (\ref{thm:function-comp}), 
the geodesic $[x y]$ lies in $\cBall[p,R]$ or $\oBall(p,R)$ respectively.

Thus any ball (closed or open) of radius $R<\tfrac{\varpi\kappa}2$ is $\varpi\kappa$-convex.
This implies convexity unless there is a pair of points in the ball at distance at least $\varpi\kappa$.
By the  triangle inequality, the latter is possible only for the closed ball of radius $\tfrac{\varpi\kappa}2$.
\qeds

Recall that Busemann functions are defined in Proposition \ref{prop:busemann}.
The following exercise is analogous to Exercise~\ref{ex:busemann-CBB}.

\begin{thm}{Exercise}\label{ex:busemann-CBA}{\sloppy 
Let $\spc{U}$ be a complete length $\CAT\kappa$ space
and $\bus_\gamma\:\spc{U}\to \RR$ be the Busemann function for a half-line $\gamma\:[0,\infty)\to \spc{L}$.

}

\begin{subthm}{}
If $\kappa=0$, then the Busemann function $\bus_\gamma$ is  convex.
\end{subthm}

\begin{subthm}{}
If $\kappa=-1$, then the function $f=\exp\circ\bus_\gamma$ satisfies
\[f''- f\ge 0.\]
\end{subthm}

\end{thm}

\section{Development}\label{sec:development-CBA}
 
Geometrically,  the development construction (\ref{def:devel}) translates distance comparison into a local convexity statement for subsets of $\Lob2\kappa$.
Recall that a curve in $\Lob2\kappa$ is \emph{(locally) concave} with respect to $p$ if (locally) its supergraph with respect to $p$ is a convex subset of $\Lob2\kappa$; see Definition~\ref{def:convex-devel}.

\begin{thm}{Development criterion\index{comparison!development comparison}}\label{thm:concave-devel} 
For a $\varpi\kappa$-geodesic space $\spc{U}$,
the following statements hold:

\begin{subthm}{locally-concave-dev}
For any $p\in \spc{U}$ and any geodesic $\gamma\:[0,T]\to\oBall(p,\varpi\kappa)$, suppose the $\kappa$-development $\tilde \gamma$ in $\Lob2\kappa$ of $\gamma$ with respect to $p$ is locally concave. 
Then $\spc{U}$ is $\CAT\kappa$.
\end{subthm}

\begin{subthm}{concave-dev} 
If $\spc{U}$ is $\CAT\kappa$, then for any geodesic $\gamma\:[0,T]\to\spc{U}$ and $p\in \spc{U}$
such that the triangle $\trig{p}{\gamma(0)}{\gamma(T)}$ has perimeter $<2\cdot\varpi\kappa$,
the $\kappa$-development $\tilde \gamma$ in $\Lob2\kappa$ of $\gamma$ with respect to $p$ is concave. 
\end{subthm}

\end{thm}


\parit{Proof; \ref{SHORT.locally-concave-dev}.}  
Let  $\gamma=\geod_{[x y]}$ and $T=\dist{x}{y}{}$. 
Let $\tilde \gamma\:[0,T]\to\Lob2\kappa$ be the concave $\kappa$-development based at $\tilde p$ of $\gamma$ with respect to $p$. 
Let us show that the function  
\[t\mapsto \angk\kappa x p{\gamma(t)}
\eqlbl{eq:ang-nondecreasing}\]   
is nondecreasing. 

For a partition $0=t^0<t^1<\dots<t^n=T$, let 
\[\tilde y^i=\tilde \gamma(t^i)\quad \text{and}\quad \tau^i=\dist{\tilde y^0}{\tilde y^1}{}+\dist{\tilde y^1}{\tilde y^2}{}+\dots+\dist{\tilde y^{i-1}}{\tilde y^i}{}.\]  
Since $\tilde \gamma$ is locally concave, 
for a sufficiently fine partition the polygonal line $\tilde y^0\tilde y^1\dots\tilde y^n$ is  locally concave with respect to $\tilde p$. 
Alexandrov's lemma (\ref{lem:alex}), applied inductively to pairs of triangles  $\modtrig\kappa \{\tau^{i-1},\dist{p}{\tilde y^0}{},\dist{p}{\tilde y^{i-1}}{}\}$ and  $\modtrig\kappa\{\dist{\tilde y^{i-1}}{\tilde y^i}{}, \dist{p}{\tilde y^{i-1}}{},\dist{p}{\tilde y^{i}}{}\}$, shows that the sequence  $\tilde \mangle\mc\kappa\{\dist{\tilde p}{\tilde y^{i}}{};\dist{\tilde p}{\tilde y^0}{},\tau^i\}$ is nondecreasing.

Taking finer partitions and passing to the limit, we get
\[\max\nolimits_i\{|\tau^i-t^i|\}\to0.\] 
Therefore \ref{eq:ang-nondecreasing} and 
the point-on-side comparison (\ref{cat-monoton}) follows. 



\parit{\ref{SHORT.concave-dev}.}  
Consider a partition $0=t^0<t^1<\dots<t^n=T$, and 
let $x^i\z=\gamma(t^i)$. Construct a chain of model triangles  $\trig{\tilde p}{\tilde x^{i-1}}{\tilde x^i}=\modtrig\kappa(p x^{i-1}x^i)$ with the direction of $[\tilde p\tilde x^i]$ turning counterclockwise as $i$ grows. 
By the angle comparison (\ref{cat-hinge}),
\[\mangle\hinge{\tilde x^i}{\tilde x^{i-1}}{\tilde p}+\mangle\hinge{\tilde x^i}{\tilde x^{i+1}}{\tilde p}\ge\pi.\eqlbl{eq1:concave-devel*}
\] 
Since $\gamma$ is a geodesic, 
 \[\length \gamma = \sum_{i=1}^n\dist{x^{i-1}}{x^i}{}\le \dist{p}{x^0}{}+\dist{p}{x^n}{}.
\eqlbl{eq2:concave-devel*}
\]  
By repeated application of Alexandrov's lemma (\ref{lem:alex}), and inequality~\ref{eq2:concave-devel*}, 
\[\sum_{i=1}^n\mangle\hinge{\tilde p}{\tilde x^{i-1}}{\tilde x^i}
\le
\angk\kappa p{x^0}{x^n}\le\pi.\] 
Then by \ref{eq1:concave-devel*},  the polygonal line $\tilde p\tilde x^0\tilde x^1\dots \tilde x^n$  are concave with respect to~$\tilde p$.

Note that  under finer partitions, the polygonal line $\tilde x^0\tilde x^1\dots \tilde x^n$ approach the development of $\gamma$ with respect to $p$.
Since the polygonal lines are convex, their lengths converge to the length of $\gamma$.
Hence the result. 
\qeds


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Patchwork globalization}\label{sec:patchwork}

If $\spc{U}$ is a $\CAT\kappa$ space, then it is locally $\CAT\kappa$.
The converse does not hold even for complete length space.
For example, $\mathbb{S}^1$ is locally isometric to $\RR$, and so
is locally $\CAT0$, but it is easy to find a quadruple of points in $\mathbb{S}^1$ that violates $\CAT0$ comparison.  

The following theorem was essentially proved by Alexandr Alexandrov \cite[Satz 9]{alexandrov:devel}; 
it gives a global condition on geodesics that is  necessary and sufficient for a locally $\CAT\kappa$ space to be globally $\CAT\kappa$. 
The proof uses thin-triangle decompositions 
and the inheritance lemma (\ref{lem:inherit-angle}). 

\begin{thm}{Patchwork globalization theorem}\label{thm:alex-patch}
For any complete length space~$\spc{U}$, the following two statements are equivalent:

\begin{subthm}{thm:alex-patch:ccat}
$\spc{U}$ is $\CAT\kappa$.
\end{subthm}
 
\begin{subthm}{thm:alex-patch:geo-uni}
$\spc{U}$ is locally $\CAT\kappa$; moreover,  pairs of points in $\spc{U}$ at distance $<\varpi\kappa$ are joined by unique geodesics, and these geodesics depend continuously on their endpoint pairs.
\end{subthm}

\end{thm}

Note that the implication \ref{SHORT.thm:alex-patch:ccat}$\Rightarrow$\ref{SHORT.thm:alex-patch:geo-uni} follows from Theorem~\ref{thm:cat-unique}.

\begin{thm}{Corollary}\label{cor:k-for-k}
Let $\spc{U}$ be a complete length  space 
and $\Omega\subset\spc{U}$ be an open locally $\CAT\kappa$ subset. 
Then for any point $p\in \Omega$ there is $R>0$ such that $\cBall[p,R]$ is a convex subset of $\spc{U}$ 
and $\cBall[p,R]$ is $\CAT\kappa$.
\end{thm}

\parit{Proof.}
Fix $R>0$ such that $\CAT\kappa$ comparison holds in $\oBall(p,R)$.

We may assume that $\oBall(p,R)\subset\Omega$ and $R<\varpi\Kappa$.
The same argument as in the proof of the theorem on uniqueness of geodesics (\ref{thm:cat-unique}) 
shows that any two points in $\cBall[p,\tfrac R2]$ can be joined by a unique geodesic that depends continuously on the endpoints.

The same argument as in the proof of Corollary \ref{cor:convex-balls} shows that $\cBall[p,\tfrac R2]$ is a convex set.
Then \ref{SHORT.thm:alex-patch:geo-uni}$\Rightarrow$\ref{SHORT.thm:alex-patch:ccat} of the patchwork globalization theorem implies that $\cBall[p,\tfrac R2]$ is $\CAT\kappa$.
\qeds

The proof of patchwork globalization uses the following construction:

\begin{thm}{Definition (Line-of-sight map)} \label{def:sight}
%Let $\spc{U}$ be a metric space in which pairs of points at distance $<\varpi\kappa$ are joined by unique geodesics and these geodesics depend continuously on their endpoint pairs. 
Let  $p$ be a point and $\alpha$ be a curve of finite length in  a length space $\spc{U}$. 
Let $\bar\alpha:[0,1]\to\spc{U}$ be the constant-speed parametrization of $\alpha$.
If $\gamma_t\:[0,1]\to\spc{U}$ is a geodesic path from $p$ to $\bar\alpha(t)$, we say that the map $[0,1]\times[0,1]\to\spc{U}$ defined by
\[(t,s)\mapsto\gamma_t(s)\]
is a \index{line-of-sight map}\emph{line-of-sight map} for $\alpha$ with respect to $p$.
\end{thm}

Note that a line-of-sight map is closely related to geodesic homotopy (Section~\ref{sec:Hadamard--Cartan}).

\parit{Proof of \ref{thm:alex-patch}.}
It only remains to prove \ref{SHORT.thm:alex-patch:geo-uni}$\Rightarrow$\ref{SHORT.thm:alex-patch:ccat}.

Let $[p x y]$ be a triangle of perimeter $<2\cdot\varpi\kappa$  in $\spc{U}$. 
According to \ref{prop:k-thin} and \ref{prop:inherit-bound}, it is sufficient to show the triangle $\trig p x y$ is $\kappa$-thin.

Since pairs of points at distance $<\varpi\kappa$ are joined by unique geodesics and these geodesics depend continuously on their endpoint pairs, there is a unique and continuous line-of-sight map for  $[x y]$ with respect to~$p$.    

For a partition \[0\z=t^0\z<t^1\z<\z\dots\z<t^N=1,\] 
let $x^{i,j}=\gamma_{t^i}(t^j)$. 
\begin{figure}[!ht]
\vskip0mm
\centering
\includegraphics{mppics/pic-935}
\end{figure}
Since the line-of-sight map is continuous, we may assume each triangle $\trig{x^{i,j}}{x^{i,j+1}}{x^{i+1,j+1}}$ and $\trig{x^{i,j}}{x^{i+1,j}}{x^{i+1,j+1}}$ is $\kappa$-thin 
(see Proposition~\ref{prop:k-thin}).

Now we show that the $\kappa$-thin property propagates to $\trig p x y$, by repeated application of the inheritance lemma (\ref{lem:inherit-angle}):
\begin{itemize}
\item 
First, for fixed $i$, 
sequentially applying the lemma shows  that the triangles 
$\trig{x}{x^{i,1}}{x^{i+1,2}}$, 
$\trig{x}{x^{i,2}}{x^{i+1,2}}$, 
$\trig{x}{x^{i,2}}{x^{i+1,3}}$,
and so on are $\kappa$-thin. 
\end{itemize}
In particular, for each $i$, the long triangle $\trig{x}{x^{i,N}}{x^{i+1,N}}$ is $\kappa$-thin.
\begin{itemize} 
\item 
Applying the lemma again shows that the  triangles $\trig{x}{x^{0,N}}{x^{2,N}}$, $\trig{x}{x^{0,N}}{x^{3,N}}$, and so on are $\kappa$-thin. 
\end{itemize}
In particular, $\trig p x y=\trig{p}{x^{0,N}}{x^{N,N}}$ is $\kappa$-thin.
\qeds

The following exercise implies that if the space is proper, then one can drop the condition on continuous dependence of geodesics in the formulation of patchwork globalization.

\begin{thm}{Exercise}\label{ex:patchwork}
\begin{subthm}{ex:patchwork:proper}
Suppose pairs of points in a geodesic space $\spc{U}$ are joined by unique geodesics.
Show that if $\spc{U}$ is proper, then 
these geodesics depend continuously on their endpoint pairs.
\end{subthm}

\begin{subthm}{ex:patchwork:complete}
Construct an example of a complete geodesic space $\spc{U}$ such that 
pairs of points in $\spc{U}$ are joined by unique geodesics, but
these geodesics do not depend continuously on their endpoint pairs.
\end{subthm}
\end{thm}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Angles}
\label{sec:angles-cba}

Recall that $\o$ denotes a selective nonprincipal ultrafilter on $\NN$, see Section~\ref{ultralimits}. 

\begin{thm}{Angle semicontinuity}\label{lem:ang.semicont}
Suppose $\spc{U}_1,\spc{U}_2,\dots$ is a sequence of $\varpi\kappa$-geodesic $\CAT\kappa$ spaces
and $\spc{U}_n\to \spc{U}_\o$ as $n\to\o$.
Assume that a sequence of hinges $\hinge{p_n}{x_n}{y_n}$ in $\spc{U}_n$ converges to a hinge $\hinge{p_\o}{x_\o}{y_\o}$ in $\spc{U}_\o$ as $n\to\o$.
Then 
\[\mangle\hinge{p_\o}{x_\o}{y_\o}
\ge 
\lim_{n\to\o} \mangle\hinge{p_n}{x_n}{y_n}.\]

\end{thm}

%\begin{wrapfigure}[6]{r}{23mm}
%\begin{lpic}[t(0mm),b(10mm),r(0mm),l(0mm)]{pics/ang.semicont(0.12)}
%\lbl[rt]{7,18;$p_n$}
%\lbl[r]{30,94;$\bar x_n$}
%\lbl[b]{116,160;$x_n$}
%\lbl[t]{59,2;$\bar y_n$}
%\lbl[t]{174,20;$y_n$}
%\end{lpic}
%\end{wrapfigure}

\parit{Proof.}
By the angle-sidelength monotonicity (\ref{cor:monoton-cba}),
\[\mangle\hinge{p_\o}{x_\o}{y_\o}
=
\inf\set{\angk\kappa{p_\o}{\bar x_\o}{\bar y_\o}}{\bar x_\o \in \mathopen{]}p_\o x_\o],\ \bar y_\o\in \mathopen{]}p_\o y_\o]}.\]

For fixed $\bar x_\o \in \mathopen{]}p_\o x_\o]$ 
and $\bar y_\o\in \mathopen{]}p_\o x_\o]$,
choose $\bar x_n\in \mathopen{]} p x_n ]$ and $\bar y_n\in \mathopen{]} p y_n ]$ so that $\bar x_n\to \bar x_\o$ 
and $\bar y_n\to \bar y_\o$ as $n\to\o$.
Clearly 
\[\angk\kappa{p_n}{\bar x_n}{\bar y_n}
\to 
\angk\kappa{p_\o}{\bar x_\o}{\bar y_\o}\] 
as $n\to\o$.

By the angle comparison (\ref{cat-hinge}), $\mangle\hinge{p_n}{x_n}{y_n}\le \angk\kappa{p_n}{\bar x_n}{\bar y_n}$.
Hence the result.
\qeds

Now we verify that the first variation formula 
holds in the $\CAT{}$ setting. 
Compare it to the first variation inequality (\ref{lem:first-var}) which holds for general metric spaces and to the strong angle lemma (\ref{1st-var+}) for $\Alex{}$ spaces. 

\begin{thm}{Strong angle lemma}
\label{lem:strong-angle-cba}
Let $\spc{U}$ be a $\varpi\kappa$-geodesic $\CAT\kappa$  space.
Then for any hinge  $\hinge  p q y$ in $\spc{U}$, 
we have
\[\mangle\hinge p q y
=
\lim_{\bar y\to p}
\set{\angk\kappa p q{\bar y}}{\bar y\in\mathopen{]}py]}
\eqlbl{eq:cba-1st-var+***}\]
for any $\kappa\in\RR$ such that $\dist{p}{q}{}<\varpi\kappa$.
\end{thm}

\parit{Proof.} 
By angle-sidelength  monotonicity  (\ref{cor:monoton-cba}), the right-hand side is defined and bigger than or  equal to the left-hand side. 

By Lemma~\ref{lem:k-K-angle}, we may take $\kappa = 0$ in \ref{eq:cba-1st-var+***}.  
By the cosine law and the first variation inequality (\ref{lem:first-var}),  
the right-hand side is less than or equal to the left-hand side.
\qeds



\begin{thm}{First variation}\label{thm:1st-var-cba}
Let $\spc{U}$ be a $\varpi\kappa$-geodesic $\CAT\kappa$  space.
For any nontrivial geodesic $[py]$ in $\spc{U}$ and point $q\ne p$ such that  $\dist{p}{q}{}<\varpi\kappa$, we have 
\[\dist{q}{\geod_{[p y]}(t)}{}
=
\dist{q}{p}{}-t\cdot\cos\mangle\hinge p q y+o(t).
%\eqlbl{eq:cba-1st-var}
\]
\end{thm}

\parit{Proof.}
The first variation equation is equivalent to the strong angle lemma (\ref{lem:strong-angle-cba}), as follows from the cosine law.
\qeds

\begin{thm} {First variation (both-endpoints version)}\label{cor:both-end-first-var-cba}
Assume that $\spc{U}$ is a $\varpi\kappa$-geodesic $\CAT\kappa$ space.
Then for any nontrivial geodesics $[py]$ and $[qz]$ in $\spc{U}$  such that $p\ne q$ and $\dist{p}{q}{}<\varpi\kappa$, we have 
\[
\dist{\geod_{[p y]}(t)}{\geod_{[q z]}(\tau)}{}
=
\dist{q}{p}{} - t\cdot\cos\mangle\hinge p q y - \tau\cdot\cos\mangle\hinge q p z+o(t+\tau).
%\eqlbl{eq:cba-1st-var}
\]
\end{thm}

\parit{Proof.}
By \ref{cat-hinge},
\[\begin{aligned}
&\dist{\geod_{[p y]}(t)}{\geod_{[q z]}(\tau)}{} \ge
\\
&\ge
\dist{q}{\geod_{[p y]}(t)}{} - \tau\cdot\cos\mangle\hinge q  {\geod_{[p y]}(t)} z +o(\tau)\ge\\
&\ge\dist{q}{p}{} - t\cdot\cos\mangle\hinge p q y + o(t) -  \tau\cdot\cos\mangle\hinge q  {\geod_{[p y]}(t)} z +o(\tau)=\\
&= \dist{q}{p}{} - t\cdot\cos\mangle\hinge p q y -  \tau\cdot\cos\mangle\hinge q  p z +o(t+\tau).
\end{aligned}
\]
Here the final equality follows from   
\[
\lim_{t\to 0}\mangle\hinge q  {\geod_{[p y]}(t)} z = \mangle\hinge q  p z.
\eqlbl{eq:2-side-variation}
\]
The angle semicontinuity (\ref{lem:ang.semicont}) implies ``$\le$'' in \ref{eq:2-side-variation}, and ``$\ge$'' holds by the triangle inequality for angles, since angle comparison (\ref{cat-hinge}) gives 
\[
\lim_{t\to 0}\mangle\hinge q p  {\geod_{[p y]}(t)} = 0.
\]

The opposite inequality follows from \ref{thm:1st-var-cba} and the triangle inequality
\[\dist{\geod_{[p y]}(t)}{\geod_{[q z]}(\tau)}{}
\le
\dist{\geod_{[p y]}(t)}{m}{}+\dist{m}{\geod_{[q z]}(\tau)}{},\]
where $m$ is the midpoint of $[pq]$.
\qeds

We have given elementary proofs of the first-variation statements \ref{lem:strong-angle-cba}, \ref{thm:1st-var-cba} and \ref{cor:both-end-first-var-cba}.
Note however that the no-conjugate-point theorem \ref{thm:no-conj-pt} not only provides proofs of these statements but also extends the statements from geodesics in $\CAT\kappa$ spaces to local geodesics in locally $\CAT\kappa$ spaces as follows:
 
\begin{thm}{First variation for local geodesics}\label{cor:1st-var++cba}
Let $\gamma_t\:[0,1]\to \spc{U}$ be a continuous family of local geodesics in a locally $\CAT\kappa$.
Set
$\alpha(t)=\gamma_t(0)$ and $\beta(t)=\gamma_t(1)$.
Suppose that $\gamma_0$ is unit-speed and $\alpha^+(0)$ and $\beta^+(0)$ are defined.
Then 
\[\length\gamma_t
=
\length\gamma_0
-
(\langle\alpha^+(0),\gamma_0^+(0)\rangle+\langle\beta^+(0),\gamma_0^-(1)\rangle)\cdot t
+
o(t).\]

\end{thm}

\section{Reshetnyak gluing theorem}\label{sec:cba-gluing}

The following theorem was proved by Yuriy Reshetnyak \cite{reshetnyak:major}, assuming $\spc{U}^1$, $\spc{U}^2$ are proper and complete. 
In the following form, the theorem appears in the book of Martin Bridson and Andr\'e Haefliger \cite{bridson-haefliger}.

\begin{thm}{Reshetnyak gluing theorem}\label{thm:gluing}
Suppose 
$\spc{U}^1$, $\spc{U}^2$ are %complete 
$\varpi\kappa$-geodesic spaces 
with isometric complete $\varpi\kappa$-convex sets $A^i\subset\spc{U}^i$.  Let $\iota\:A^1\to A^2$ be an isometry.
Let $\spc{W}=\spc{U}^1\sqcup_{\iota}\spc{U}^2$;
that is, $\spc{W}$ is the gluing of $\spc{U}^1$ and  $\spc{U}^2$ along $\iota$ (see Section~\ref{sec:quotient}).

Then: 
\begin{subthm}{gluing0}
Both canonical mappings $\jmath_i\:\spc{U}^i\to\spc{W}$ are distance-preserving 
and the images $\jmath_i(\spc{U}^i)$ are $\varpi\kappa$-convex subsets in $\spc{W}$.
\end{subthm}

\begin{subthm}{gluing2}
If $\spc{U}^1, \spc{U}^2$ are $\CAT\kappa$,
then so is $\spc{W}$.
\end{subthm} 
\end{thm}

\parit{Proof.} 
Part \ref{SHORT.gluing0}
follows directly from $\varpi\kappa$-convexity of the $A^i$.

\parit{\ref{SHORT.gluing2}.} 
According to \ref{SHORT.gluing0},
we can identify $\spc{U}^i$ with its image $\jmath_i(\spc{U}^i)$ in $\spc{W}$;
in this way, the subsets $A^i\subset \spc{U}^i$ will be identified and denoted further by $A$.
Thus   $A=\spc{U}^1\cap \spc{U}^2\subset \spc{W}$,
and $A$ is $\varpi\kappa$-convex in $\spc{W}$.

Part \ref{SHORT.gluing2} can be reformulated as follows:

\begin{thm}{Reformulation of \ref{gluing2}}\label{thm:gluing2-reformulated}
Let $\spc{W}$ be a 
length space having two 
$\varpi\kappa$-convex subsets $\spc{U}^1,\spc{U}^2\subset\spc{W}$ such that
$\spc{W}=\spc{U}^1\cup\spc{U}^2$.
Assume the subset $A=\spc{U}^1\cap \spc{U}^2$ is complete and $\varpi\kappa$-convex in $\spc{W}$, and $\spc{U}^1$, $\spc{U}^2$ are $\CAT\kappa$ spaces.
Then $\spc{W}$ is a $\CAT\kappa$ space.
\end{thm}

\begin{clm}{}\label{clm:geod-gluing}
If $\spc{W}$ is $\varpi\kappa$-geodesic, then $\spc{W}$ is $\CAT\kappa$.
\end{clm}

Indeed, 
according to \ref{prop:k-thin},
it is sufficient to show that any triangle $\trig {x^0}{x^1}{x^2}$ of perimeter $<2\cdot \varpi\kappa$ 
in $\spc{W}$ is $\kappa$-thin.
This is obviously true if all three points $x^0$, $x^1$, $x^2$ lie in a single $\spc{U}^i$.
Thus, without loss of generality, we may assume that $x^0\in\spc{U}^1$ and $x^1,x^2\in\spc{U}^2$.
\begin{figure}[!ht]
\vskip-0mm
\centering
\includegraphics{mppics/pic-940}
\end{figure}

Choose points $z^1,z^2\in A=\spc{U}^1\cap\spc{U}^2$ 
lying respectively on the sides $[x^0x^1], [x^0x^2]$.
Note that all distances between any pair of points from $x^0$, $x^1$, $x^2$, $z^1$, $z^2$ are less than $\varpi\kappa$.
Therefore
\begin{itemize}
\item triangle $\trig{x^0}{z^1}{z^2}$ lies in $\spc{U}^1$,
\item both triangles $\trig{x^1}{z^1}{z^2}$ and $\trig{x^1}{z^2}{x^2}$ lie in $\spc{U}^2$.
\end{itemize}
In particular, each triangle $\trig{x^0}{z^1}{z^2}$,
$\trig{x^1}{z^1}{z^2}$, $\trig{x^1}{z^2}{x^2}$ is $\kappa$-thin.

Applying the inheritance lemma for thin triangles (\ref{lem:inherit-angle}) twice, 
we get that $\trig {x^0}{x^1}{z^2}$ 
and consequently $\trig {x^0}{x^1}{x^2}$ is $\kappa$-thin.
\claimqeds

\begin{clm}{}\label{clm:geod-gluing0 }
$\spc{W}$ is $\CAT\kappa$ if $\kappa\le0$.
\end{clm}
By \ref{clm:geod-gluing} it suffices to prove that $\spc{W}$ is geodesic.

For $p^1\in \spc{U}^1$, $p^2\in \spc{U}^2$, we may choose a sequence $z_n\in A$ such that $\dist{p^1}{z_n}{}+\dist{p^2}{z_n}{}$
 converges to $\dist{p^1}{p^2}{}$, and $\dist{p^1}{z_n}{}$ and $\dist{p^2}{z_n}{}$ converge.  
 Since $A$ is complete, it suffices to show $z_n$ is a Cauchy sequence.  
 In that case, the limit point $z$ of $z_n$ satisfies $\dist{p^1}{z}{}+\dist{p^2}{z}{}=\dist{p^1}{p^2}{}$, so the geodesics $[p^1z]$ in $\spc{U}^1$ and $[p^2z]$ in $\spc{U}^2$ together give a geodesic $[p^1p^2]$ in $\spc{U}$.  
 
 Suppose $z_n$ is not a Cauchy sequence.
 Then there are subsequences  $x_n$ and $y_n$ of $z_n$ satisfying  $\lim\dist{x_n}{y_n}{}>0$.
 Let $m_n$ be the midpoint of $[x_ny_n]$.
 Since $\dist{p^1}{m_n}{}+\dist{p^2}{m_n}{} \ge \dist{p^1}{p^2}{}$, and  $\dist{p^1}{x_n}{}+\dist{p^2}{x_n}{}$ and  $\dist{p^1}{y_n}{}+\dist{p^2}{y_n}{}$
 converge to $\dist{p^1}{p^2}{}$, then for  any $\epsilon >0$, we may assume (taking subsequences and possibly relabeling $p^1$ and $p^2$)
 \[
 \dist{p^1}{m_n}{}
 \ge
 \dist{p^1}{x_n}{}-\epsilon,
 \qquad
 \dist{p^1}{m_n}{}
 \ge
 \dist{p^1}{y_n}{}-\epsilon.
 \]
 
 Since triangle $\trig{p^1}{x_n}{y_n}$ is thin, the analogous inequalities hold for the Euclidean model triangle  $\trig{\tilde p^1}{\tilde x_n}{\tilde y_n}$.  
 Then there is a nondegenerate limit triangle $\trig{p}{x}{y}$ in the Euclidean plane satisfying $\dist{p}{x}{}=\dist{p}{y}{}\le\dist{p}{m}{}$ where $m$ is the midpoint of $[xy]$.  This  contradiction proves the claim.
\claimqeds

Finally suppose $\kappa>0$; by rescaling, take $\kappa=1$. Consider the Euclidean cones $\Cone\spc{U}^i$ (see Section \ref{sec: tangent space}).
By Theorem \ref{thm:warp-curv-bound:cbb:S}, $\Cone\spc{U}^i$ is a $\CAT0$ space for $i=1,2$.

Geodesics contained in the complement of the tip of $\Cone\spc{U}^i$ project to geodesics of length $<\pi$ in $\spc{U}^i$. 
It follows that $\Cone A$ is convex in $\Cone\spc{U}^1$ and $\Cone\spc{U}^2$.
By the cone distance formula, $\Cone A$ is complete since $A$ is complete.
  
Gluing along $\Cone A$ and applying \ref{clm:geod-gluing} and \ref{clm:geod-gluing0 } for $\kappa=0$, we find that 
$\Cone\spc{W}$ is a $\CAT0$ space.  By Theorem \ref{thm:warp-curv-bound:cbb:S}, $\spc{W}$ is a $\CAT1$ space.
\qeds

\begin{thm}{Exercise}\label{ex:two-rays}
Let $Q$ be the nonconvex subset of the plane bounded by two half-lines $\gamma_1$ and $\gamma_2$ with a common starting point and angle $\alpha$ between them.
Assume $\spc{U}$ is a complete length $\CAT0$ space and $\gamma_1',\gamma_2'$ are two half-lines in $\spc{U}$ with a common
starting point and angle $\alpha$ between them.
Show that the space glued from $Q$ and $\spc{U}$ along the corresponding half-lines is a $\CAT{0}$ space.
\end{thm}

\begin{thm}{Exercise}\label{ex:reshetnyak-doubling}
Suppose $\spc{U}$ is a complete length $\CAT0$ space and $A\subset \spc{U}$ is a closed subset.
Assume that the doubling of $\spc{U}$ in $A$ is $\CAT0$. 
Show that $A$ is a convex set of $\spc{U}$.
\end{thm}

\begin{thm}{Exercise}\label{ex:glue-spherical-suspension}
Let  $\spc{U}$ be a complete length $\CAT1$ space and $K\subset \spc{U}$ be a closed $\pi$-convex set.
Assume $K\subset \cBall[p,\tfrac\pi2]$ for some point $p\in K$.
Show that there is a decreasing continuous one-parameter family of closed convex sets $K_t$ for $t\in[0,1]$ such that $K_0=\cBall[p,\tfrac\pi2]$ and $K_1=K$.

(Decreasing means with respect to inclusion; that is $K_{t_0}\supset K_{t_1}$ if $t_0\le t_1$.
Continuous means with respect to Hausdorff distance; that is $K_t\Hto K_{t_0}$ as $t\to t_0$.)
\end{thm}


\begin{thm}{Exercise}\label{ex:AUB}
Let $A$ and $B$ be two closed convex sets in a complete length $\CAT0$ space.
Assume $A\cap B\ne\emptyset$.
Show that the union $A\cup B$ equipped with induced length metric is $\CAT0$. 
\end{thm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Space of geodesics}\label{sec:geod-space}

In this section we prove a no-conjugate-point theorem for spaces with upper curvature bounds and derive from it a number of statements about local geodesics.
These statements will be used to prove the Hadamard--Cartan theorem (\ref{thm:hadamard-cartan}) and the lifting globalization theorem (\ref{thm:globalization-lift}), in much the same way as  the exponential map is used in Riemannian geometry.

\begin{thm}{Proposition}\label{prop:geo-complete}
{\sloppy 
Let $\spc{U}$ be a locally $\CAT\kappa$ space.
 Let $\gamma_n\:[0,1]\to\spc{U}$ be a sequence of local geodesic paths converging to a path $\gamma_\infty\:[0,1]\to\spc{U}$.
Then $\gamma_\infty$ is a local geodesic path.
Moreover 
\[\length\gamma_n\to\length\gamma_\infty\]
as $n\to\infty$.

}
\end{thm}

\parit{Proof.} 
Fix $t\in[0,1]$.
By Corollary~\ref{cor:k-for-k}, we may choose $R$ satisfying $0<R<\varpi\Kappa$,
and such that
the ball $\spc{B}=\oBall(\gamma_\infty(t),R)$ is a convex subset of $\spc{U}$ and forms a $\CAT\kappa$ space.

A local geodesic segment  with length less than $R/2$ that intersects $\oBall(\gamma_\infty(t),R/2)$ cannot leave $\spc{B}$, and hence  is  minimizing by Corollary~\ref{cor:loc-geod-are-min}.
In particular, for all sufficiently large $n$, 
if subsegment of $\gamma_n$ has length less than $R/2$ and contains $\gamma_n(t)$, then it is a geodesic.


Since $\spc{B}$ is $\CAT\kappa$, geodesic segments in $\spc{B}$ depend uniquely and continuously on their endpoint pairs by Theorem~\ref{thm:cat-unique}.  
Thus there is a subinterval $\II$ of $[0,1]$
that contains a neighborhood of $t$ in $[0,1]$
and such that $\gamma_n|_\II$ is minimizing for all large $n$.
It follows that the restriction $\gamma_\infty|_\II$ is a geodesic,
and therefore $\gamma_\infty$ is a local geodesic.
\qeds


The following theorem was proved by the first author and Richard Bishop \cite{alexander-bishop:h-c}.
In analogy with Riemannian geometry, the main statement of the following theorem could be restated as: 
\textit{In a space of curvature $\le\kappa$, two points cannot be conjugate along a local geodesic of length $<\varpi\kappa$.}


\begin{thm}{No-conjugate-point theorem}
\label{thm:no-conj-pt}{\sloppy 
Suppose $\spc{U}$ is a locally complete, length, locally $\CAT\kappa$ space.
Let $\gamma\:[0,1]\to\spc{U}$ be a local geodesic path with length $<\varpi\kappa$.
Then for some neighborhoods $\Omega^0\ni \gamma(0)$ and $\Omega^1\ni\gamma(1)$, 
there is a unique continuous map from the direct product $\Omega^0\times \Omega^1\times[0,1]$ to $\spc{U}$, 

\[(x,y,t)\mapsto\gamma_{x y}(t),\]  
such that 
$\gamma_{x y}\:[0,1]\to\spc{U}$ is a local geodesic path with 
$\gamma_{x y}(0)=x$ and 
$\gamma_{x y}(1)=y$ for each $(x,y)\in\Omega^0\times\Omega^1$,
and the family $\gamma_{x y}$ contains $\gamma$.
Moreover, we can assume that the map 
\[(x,y,t)\mapsto\gamma_{x y}(t)\:\Omega^0\times\Omega^1\times[0,1]\to\spc{U}\] 
is $\Lip$-Lipschitz
for any
$\Lip>\max\set{\tfrac{\sn\kappa r}{\sn\kappa \ell}}{0\le r\le \ell}$.

}
\end{thm}

{\sloppy

\begin{thm}{Patchwork along a geodesic}
\label{lem:patch}
Let $\spc{U}$ be a locally complete, length, locally $\CAT\kappa$ space, 
and $\alpha\:[a,b]\to\spc{U}$ be a local geodesic.

Then there is a complete length $\CAT\kappa$ space $\spc{N}$
with an open set $\hat\Omega\subset \spc{N}$,
a local geodesic $\hat\alpha\:[a,b]\to\hat\Omega$,
and an open locally distance-preserving map 
$\map\:\hat\Omega\looparrowright\spc{U}$ such that
$\map\circ\hat\alpha=\alpha$.

Moreover if $\alpha$ is simple, then one can assume in addition that $\map$ is an open embedding;
thus $\hat\Omega$ is locally isometric to a neighborhood of $\Omega=\map(\hat\Omega)$ of $\alpha$.
\end{thm}

}

This lemma and its proof were suggested by Alexander Lytchak.
The proof proceeds by piecing together $\CAT{\kappa}$  neighborhoods of points on a curve to construct a new $\CAT{\kappa}$ space.  
Exercise~\ref{ex:cats-cradle} is inspired by the original idea of the proof of the no-conjugate-point theorem (\ref{thm:no-conj-pt}) given in \cite{alexander-bishop:h-c}.

\parit{Proof.} 
According to Corollary~\ref{cor:k-for-k},
we can choose $r>0$ such that 
for any $t\in[a,b]$ the closed ball
$\cBall[\alpha(t),r]$ is a convex set that forms a complete length $\CAT\kappa$ space.

Choose balls $\spc{B}_i=\cBall[\alpha(t_i),r]$
for some partition $a\z=t_0<t_1\z<\z\dots\z<t_n\z=b$
in such a way that 
\[\Int\spc{B}_i\supset \alpha([t_{i-1},t_i])\]
for all $i>0$.
We can assume in addition that $\spc{B}_{i-1}\cap \spc{B}_{i+1}\subset \spc{B}_{i}$ if $0<i<n$.

Consider the disjoint union $\bigsqcup_i\spc{B}_i=\set{(i,x)}{x\in\spc{B}_i}$ with the minimal equivalence relation $\sim$ such that $(i,x)\sim(i-1,x)$ for all $i>0$.
Let $\spc{N}$ be the space obtained by gluing the $\spc{B}_i$ along $\sim$.
Note that $A_i=\spc{B}_i\cap\spc{B}_{i-1}$ is convex in $\spc{B}_i$ and in $\spc{B}_{i-1}$.
Applying the Reshetnyak gluing theorem (\ref{thm:gluing}) several times, 
we conclude that $\spc{N}$ is a complete length $\CAT\kappa$ space.

\begin{figure}[!ht]
\vskip-0mm
\centering
\includegraphics{mppics/pic-945}
\end{figure}

For $t\in[t_{i-1},t_i]$, let $\hat\alpha(t)$  be the equivalence class of $(i,\alpha(t))$ in $\spc{N}$.
Let $\hat\Omega$ be the $\eps$-neighborhood of $\hat\alpha$ in $\spc{N}$, where $\eps>0$ is chosen so that $\oBall(\alpha(t),\eps)\subset\spc{B}_i$ for all $t\in[t_{i-1},t_i]$.

Define $\map\:\hat\Omega\to\spc{U}$
by sending the equivalence class of $(i,x)$ to $x$.
It is straightforward to check that $\map\:\spc{N}\to\spc{U}$, $\hat\alpha\:[a,b]\to\spc{N}$ and $\hat\Omega\subset\spc{N}$ satisfy the conclusion of the main part of the lemma.

To prove the final statement in the lemma,
we only have to choose $\eps>0$ so that in addition, $\dist{\alpha(\tau)}{\alpha(\tau')}{}>2\cdot\eps$ if $\tau\le t_{i-1}$ and $t_i\le\tau'$ for some $i$.
\qeds


\parit{Proof of \ref{thm:no-conj-pt}.}
Apply patchwork along $\gamma$ (\ref{lem:patch}). 
\qeds



The No-conjugate-point theorem (\ref{thm:no-conj-pt}) allows us to move a local geodesic  
so that its endpoints follow given trajectories.
The following corollary describes how this process might terminate. 

\begin{thm}{Corollary}\label{cor:geo-hom}{\sloppy 
Let $\spc{U}$ be a locally complete, length, locally $\CAT\kappa$ space.
Suppose $\gamma\:[0,1]\to\spc{U}$ is a local geodesic with length $< \varpi\kappa$.  Let $\alpha^i\:[0,1]\to \spc{U}$, for $i=0,1$, be curves starting at $\gamma(0)$ and $\gamma(1)$ respectively.  

}

Then there is a uniquely determined pair consisting of an interval $\II $ satisfying $0\in \II\subset[0,1]$, and a continuous family of local geodesics $\gamma_t\:[0,1]\to \spc{U}$ for  $t\in \II$, such that  

\begin{subthm}{cor:geo-hom-length}
$\gamma_0=\gamma$, $\gamma_t(0)=\alpha^0(t)$, $\gamma_t(1)=\alpha^1(t)$, and $\gamma_t$ has length $< \varpi\kappa$,
\end{subthm} 

\begin{subthm}{cor:geo-hom-cauchy}
if $\II\ne [0,1]$, then $\II=[0, a)$, where either $\gamma_t$ converges uniformly to a local geodesic $\gamma_a$ of length $\varpi\kappa$, or 
for some fixed $s\in [0,1]$ the curve $\gamma_t(s):[0,a)\to\spc{U}$ is a Lipschitz curve with no limit 
as $t\to a-$.
%??DO WE REALLY NEED SUCH GENERALITY
\end{subthm}

\end{thm}


\parit{Proof.} Uniqueness follows from  Theorem \ref{thm:no-conj-pt}.

Let $\II$ be the maximal interval for which there is a family $\gamma_t$ satisfying condition \ref{SHORT.cor:geo-hom-length}. 
By Theorem~\ref{thm:no-conj-pt}, such an interval exists and is open in $[0,1]$.  Suppose $\II\ne[0,1]$.
Then  $\II=[0,a)$ for some $0<a\le 1$.

For each fixed $s\in [0,1]$, define the curve $\alpha_s:[0,a)\to\spc{U}$ by $\alpha_s(t)\z=\gamma_t(s)$. 
By Theorem~\ref{thm:no-conj-pt}, 
each $\alpha_s$ is locally Lipschitz.  

If $\alpha_s$ for some value of $s$ does not converge as $t\to a-$, then condition \ref{SHORT.cor:geo-hom-cauchy} holds.
If each $\alpha_s$  converges as $t\to a-$, then $ \gamma_t$ converges as $t\to a-$, say to $\gamma_a$.
By  Proposition~\ref{prop:geo-complete}, $\gamma_a$ is a local geodesic and\[\length\gamma_t\to\length\gamma_a\le \varpi\kappa.\]
By maximality of $\II$, $\length\gamma_a=\varpi\kappa$ and so condition \ref{SHORT.cor:geo-hom-cauchy} again holds.
\qeds

\begin{thm}{Corollary}\label{cor:homotopy-from-p}
Let $\spc{U}$ be a complete locally $\CAT\kappa$ length space, and 
$\alpha\:[0,1]\to \spc{U}$ be a path of length $< \varpi\kappa$ that starts at $p$ and ends at $q$.
Then:  

\begin{subthm}{cor:homotopy-from-p-exist}
There is a unique homotopy of local geodesic paths $\gamma_t\:[0,1]\to \spc{U}$
such that $\gamma_0(t)=\gamma_t(0)=p$ and $\gamma_t(1)=\alpha(t)$ for any~$t$.
\end{subthm}

\begin{subthm}{cor:homotopy-from-p-length}
For any $t\in[0,1]$, 
\[\length\gamma_t\le\length(\alpha|_{[0,t]}),\]
and equality holds for given $t$ if and only if the restriction $\alpha|_{[0,t]}$ is a reparametrization of $\gamma_t$.
\end{subthm}

Moreover, instead of completeness of $\spc{U}$, one can assume that the subspace 
\[W=\set{x\in \spc{U}}{\dist{x}{p}{}+\dist{x}{q}{}\le \ell}\] 
is complete.

\end{thm}

\parit{Proof.}
By Corollary \ref{cor:geo-hom}, taking  $\alpha^0(t)=p$ and  $\alpha^1(t)=\alpha(t)$ for all $t\in [0,1]$, there is an interval $\II$ such that \ref{SHORT.cor:homotopy-from-p-exist} holds for all $t\in\II$, and either $\II=[0,1]$ or $\II=[0,a)$ for some $a\le 1$.

By patchwork along a curve (\ref{lem:patch}), the values of $t$ for which condition \ref{SHORT.cor:homotopy-from-p-length} holds form an open subset of $\II$ containing $0$; clearly this subset is also closed in $\II$.
Therefore \ref{SHORT.cor:homotopy-from-p-length} holds on all of $\II$. 
 
Corollary \ref{cor:geo-hom} implies that
$\II=[0,1]$.
Indeed if $\II=[0,a)$, then either $\length\gamma_t\to\varpi\kappa$ as $t\to a-$,
or for some fixed $s\in [0,1]$ the Lipschitz curve $\gamma_t(s):[0,a)\to\spc{U}$ has no limit as $t\to a-$.
Since $\length\alpha<\varpi\kappa$, \ref{cor:geo-hom} implies that neither of these is possible.
\qeds



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Lifting globalization}\label{sec:cat-globalize}

The Hadamard--Cartan theorem (\ref{thm:hadamard-cartan}) states that 
the universal metric cover of a complete locally $\CAT0$ space is $\CAT0$.
The lifting globalization theorem gives an appropriate generalization of the above statement to arbitrary curvature bounds;
it could be also described as a global version of Gauss's lemma.



\begin{thm}{Lifting globalization theorem}
\label{thm:globalization-lift}
Suppose $\spc{U}$ is a complete length locally $\CAT\kappa$ space and  $p\in\spc{U}$.
Then there is a complete $\CAT\kappa$ length space $\spc{B}$, 
with a point $\hat p$ such that 
there is a locally distance-preserving map $\map\:\spc{B}\to\spc{U}$
such that $\map(\hat p)=p$ and the following lifting property holds: 
for any path $\alpha\:[0,1]\to\spc{U}$ with $\alpha(0)=p$ and $\length\alpha<\varpi\kappa/2$, 
there is a unique path $\hat\alpha \:[0,1]\to \spc{B}$ such that $\hat\alpha(0)=\hat p$ 
and $\map\circ\hat\alpha\equiv\alpha$.
\end{thm}


Note that the lifting property implies that $\map(\spc{B})\supset\oBall(p,\varpi\kappa/2)$ and by completeness $\map(\spc{B})\supset\cBall[p,\varpi\kappa/2]$.
Also, since $\spc{B}$ is $\CAT\kappa$, the closed ball $\cBall[\hat p,\tfrac{\varpi\kappa}2]_{\spc{B}}$ is a weakly convex set in $\spc{B}$ (see \ref{cor:convex-balls});
in particular $\cBall[\hat p,\tfrac{\varpi\kappa}2]_{\spc{B}}$ is a complete length $\CAT\kappa$ space.
Therefore we can assume in addition that $\dist{\hat p}{\hat x}{}\le \varpi\kappa/2$ for any $\hat x\in\spc{B}$;
or equivalently
\[\cBall[\hat p,\tfrac{\varpi\kappa}2]_{\spc{B}}=\spc{B}.\]


Before proving the theorem we state and prove its corollary.

\begin{thm}{Corollary}\label{cor:loc-CAT(k)}
Suppose $\spc{U}$ is a complete length locally $\CAT\kappa$ space.
Then for any $p\in\spc{U}$ there is $\rho_p>0$
such that $\cBall[p,\rho_p]$ is a complete length $\CAT\kappa$ space.

Moreover, we can assume that $\rho_p<\tfrac{\varpi\kappa}2$
for any $p$ and the function $p\mapsto\rho_p$ is 1-Lipschitz.
\end{thm}

\parit{Proof.} 
Assume $\map\:\spc{B}\to \spc{U}$ 
and $\hat p\in \spc{B}$
are provided by the lifting globalization theorem
(\ref{thm:globalization-lift}).

Since $\map$ is local isometry,
we can choose $r>0$ so that the restriction of $\map$ to $\cBall[\hat p,r]$ is distance-preserving.
By the lifting globalization, the image  $\Phi(\cBall[\hat p,r])$ coincides with the ball
$\cBall[p,r]$.
This proves the first part of the theorem.

To prove the second part, let us choose $\rho_p$ to be the maximal value $\le\tfrac{\varpi\kappa}2$ such that $\cBall[p,\rho_p]$ is a complete length $\CAT\kappa$ space.
By Corollary~\ref{cor:convex-balls}, the ball
\[\cBall[q,\rho_p-\dist{p}{q}{}]\] 
is weakly convex in $\cBall[p,\rho_p]$.
Therefore  
\[\cBall[q,\rho_p-\dist{p}{q}{}]\] is a complete length $\CAT\kappa$ space
for any $q\in \oBall(p,\rho_p)$.
In particular, $\rho_q\ge \rho_p-\dist{p}{q}{}$ for any $p,q\in\spc{U}$.
Hence the second statement follows.
\qeds




The proof of the lifting globalization theorem relies heavily on the properties of the space of local geodesic paths discussed in Section~\ref{sec:geod-space}.
The following lemma  is a key step in the proof;
it was proved by the first author and Richard Bishop \cite{alexander-bishop:cbc}. 

\begin{thm}{Radial lemma}\label{lem:radial-glob}
Let $\spc{U}$ be a length locally $\CAT\kappa$ space,
and suppose $p\in\spc{U}$, $R\le\varpi\kappa$.
Assume the ball  $\cBall[p,\bar{R}]$ is complete for any $\bar{R}<R$, and  there is a unique geodesic path, $\geodpath_{[p x]}$, from $p$ to any point $x\in\oBall(p,R)$ 
that depends continuously on $x$.
Then $\oBall(p,\tfrac R2)$ is a $\varpi\kappa$-geodesic $\CAT\kappa$ space.
\end{thm}
 
\parit{Proof.}
Without loss of generality, we may assume  $\spc{U}=\oBall(p,R)$.

Set $f=\md\kappa\circ\distfun{p}{}{}$.  Let us show that
\[f''+\kappa\cdot f\ge 1.
\eqlbl{eq:rad-conv}\]



Fix $z\in \spc{U}$.
We will apply the no-conjugate-point theorem (\ref{thm:no-conj-pt}) for the unique geodesic path $\gamma$
from $p$ to $z$.  
The  notations $\Omega^0$, 
$\Omega^1$,
$\gamma_{x y}$, $\spc{N}$, $\hat{x}$, $\hat{y}$ will be as in the formulation of the lifting globalization theorem (\ref{thm:globalization-lift});
in particular, $z\in\Omega^1$.

By assumption,
$\gamma_{p y}=\geodpath_{[p y]}$ for any $y\in\Omega^1$. 
Consequently,
 $f(y)\z=\md\kappa\dist[{{}}]{\hat{p}}{\hat{y}}{\spc{N}}$.
Applying the function comparison (\ref{thm:function-comp}) in $\spc{N}$,
we have that $f''+\kappa\cdot f\ge 1$ in $\Omega^1$;
whence \ref{eq:rad-conv} follows.
\claimqeds

Fix $r<\tfrac R2$. Proving the following claim takes most of the remaining proof:

\begin{clm}{}\label{clm:B-is-convex}
$\cBall[ p,r]$ is a convex set in $\spc{U}$.
\end{clm}

Choose arbitrary $x,z\in \cBall[ p,r]$.
First note that \ref{eq:rad-conv} implies the following claim.

\begin{clm}{}\label{clm:B-is-almost-convex}
If $ \gamma\:[0,1]\to\spc{U}$ 
is a local geodesic path from $x$ to $z$ and  
$\length \gamma\z<\varpi\kappa$,  
then $\length \gamma \le 2\cdot r$ 
and $ \gamma$ lies completely in $\cBall[ p,r]$.
\end{clm}

Note that  $\dist{x}{z}{}<\varpi\kappa$.
Thus to prove Claim~\ref{clm:B-is-convex}, it is sufficient to show that there is a geodesic path from $x$ to $z$.
Note that by assumption $\cBall[p,2\cdot r]$ is complete.
Therefore Corollary~\ref{cor:homotopy-from-p} implies the following:

\begin{clm}{}\label{clm:loc-geod<path}
Given a path $\alpha\:[0,1]\to\spc{U}$ from $x$ to $z$ with $\length\alpha<2\cdot r$,
there is a local geodesic path $\gamma$ from $x$ to $z$ such that
\[\length\gamma\le\length\alpha.\]

\end{clm}

Further, let us prove the following:

\begin{clm}{}\label{clm:unique-loc-geod}
There is a unique local geodesic path $\gamma_{x z}$ in $\cBall[ p,r]$ from $x$ to $z$.
\end{clm}

Denote by $\Delta_{x z}$ the set of all local geodesic paths in $\cBall[ p,r]$ from $x$ to $z$.
By Corollary \ref{cor:geo-hom}, there is a  bijection $\Delta_{x z}\to\Delta_{p p}$.
According to \ref{eq:rad-conv}, 
$\Delta_{p p}$ contains only the constant path.
Claim~\ref{clm:unique-loc-geod} follows.


Note that 
claims~\ref{clm:B-is-almost-convex}, 
\ref{clm:loc-geod<path} 
and \ref{clm:unique-loc-geod}
imply that $\gamma_{x z}$ is minimizing; hence Claim~\ref{clm:B-is-convex}.

Further, Claim~\ref{clm:B-is-almost-convex} and the no-conjugate-point theorem (\ref{thm:no-conj-pt}) together 
imply that the map $(x,z)\mapsto\gamma_{x z}$ is continuous.

Therefore by the patchwork globalization theorem (\ref{thm:alex-patch}), 
$\cBall[ p,r]$ is a $\varpi\kappa$-geodesic $\CAT\kappa$ space.

Since
\[\oBall( p,R)
=
\bigcup_{r < R}\cBall[ p,r],\] 
then $\oBall( p,R)$ is convex in $\spc{U}$ and 
$\CAT\kappa$ comparison holds  for any quadruple in $\oBall( p,R)$.
Therefore $\oBall( p,\varpi\kappa/2)$ is $\CAT\kappa$.
\qeds


In the following proof, we construct a space $\mathfrak{G}_p$ of  local geodesic paths that start at $p$.
The space $\mathfrak{G}_p$ comes with 
a marked point $\hat p$ 
and the endpoint map $\map\:\mathfrak{G}_p\to\spc{U}$.
One can think of
the map $\map$ as an analog of the exponential map $\exp_p$ in the Riemannian geometry;
in this case,
the space $\mathfrak{G}_p$ corresponds to the ball of radius $\varpi\kappa$ in the tangent space at $p$, equipped with the metric pulled back by $\exp_p$.

We are going to set $\spc{B}=\oBall(\hat p,\varpi\kappa/2)\subset \mathfrak{G}_p$,
and use the radial lemma (\ref{lem:radial-glob}) to prove that $\spc{B}$ is a $\varpi\kappa$-geodesic $\CAT\kappa$ space.

\parit{Proof of \ref{thm:globalization-lift}.}
Suppose $\hat\gamma$ is a homotopy of local geodesic paths that start at $p$.  Thus the map 
\[\hat\gamma\:(t,\tau)\mapsto\hat\gamma_t(\tau)\:[0,1]\times[0,1]\to\spc{U}\] 
is continuous,
and the following holds for each $t$:
\begin{itemize}
\item $\hat\gamma_t(0)=p$,
\item $\hat\gamma_t\:[0,1]\to\spc{U}$ is a local geodesic path in $\spc{U}$.
\end{itemize}

Denote by $\theta(\hat\gamma)$ the length traced by the ends of $\hat\gamma_t$;
that is, $\theta(\hat\gamma)$ is the length of the path $t\mapsto\hat\gamma_t(1)$.

Let $\mathfrak{G}_p$ be the set of all local geodesic paths 
with length $<\varpi\kappa$ in $\spc{U}$ that start at $p$.
Denote by $\hat p\in \mathfrak{G}_p$ the constant path $\hat p(t)\equiv p$.
Given $\alpha,\beta\in \mathfrak{G}_p$, define
\[
\dist{\alpha}{\beta}{\mathfrak{G}_p}
=
\inf_{\hat\gamma} \{\theta(\hat\gamma)\},\]
with the exact lower bound taken along all homotopies 
$\hat\gamma\:[0,1]\times[0,1]\to\spc{U}$ 
such that 
$\hat\gamma_0=\alpha$, 
$\hat\gamma_1=\beta$ 
and $\hat\gamma_t\in \mathfrak{G}_p$ for all $t\in[0,1]$.

By the no-conjugate-point theorem (\ref{thm:no-conj-pt}), we have $\dist{\alpha}{\beta}{\mathfrak{G}_p}>0$ for distinct $\alpha$ and $\beta$;
that is,

\begin{clm}{}
$\dist{{*}}{{*}}{\mathfrak{G}_p}$ is a metric on $\mathfrak{G}_p$.
\end{clm}

Further, again from the no-conjugate-point theorem (\ref{thm:no-conj-pt}), we have

\begin{clm}{}\label{clm:loc-iso}
The map
\[\map\:\xi\mapsto\xi(1)\:\mathfrak{G}_p\to\spc{U}\]
is a local isometry.
In particular, $\mathfrak{G}_p$ is locally $\CAT\kappa$.
\end{clm}

Let $\alpha\:[0,1]\to\spc{U}$ be a path, $\length\alpha<\varpi\kappa$, and $\alpha(0)=p$.
The homotopy constructed in Corollary~\ref{cor:homotopy-from-p} can be regarded as a path in $\mathfrak{G}_p$, say $\hat\alpha\:[0,1]\to \mathfrak{G}_p$,
such that $\hat\alpha(0)=\hat p$ and $\map\circ\hat\alpha=\alpha$;
in particular $\hat\alpha_t(1)\equiv\alpha(t)$ for any $t$. 
By \ref{clm:loc-iso}, 
\[\length(\hat\alpha)_{\mathfrak{G}_p}=\length(\alpha)_{\spc{U}}.\]
Moreover, it follows that $\alpha$ is a local geodesic path of $\spc{U}$  if and only if $\hat\alpha$ is a local geodesic path of $\mathfrak{G}_p$.

Further, from Corollary~\ref{cor:homotopy-from-p},
for any $\xi\in \mathfrak{G}_p$ and path $\hat\alpha\:[0,1]\to\mathfrak{G}_p$ from $\hat p$ to $\xi$,
we have 
\begin{align*}
\length\hat\alpha
&=\length\map\circ\hat\alpha
\ge
\\
&\ge
\length\xi
=
\\
&=\length\hat\xi
\end{align*}
where equality holds only if $\hat\alpha$ is a reparametrization of $\hat\xi$.
In particular, 
\[\dist{\hat p}{\xi}{\mathfrak{G}_p}=\length\xi
\eqlbl{eq:dist=length}\] 
and
$\hat\xi\:[0,1]\to \mathfrak{G}_p$ is the unique geodesic path from $\hat p$ to $\xi$.
Clearly, the map $\xi\mapsto\hat\xi$ is continuous.

By \ref{eq:dist=length} and Proposition~\ref{prop:geo-complete}, 


\begin{clm}{}\label{clm:complete-B} 
For any $\bar R<\varpi\kappa$, the closed ball
$\cBall[\hat p,\bar R]$ in $\mathfrak{G}_p$ is complete.
\end{clm}

Take $\oBall(\hat p,\varpi\kappa/2)$ and $\map$ constructed above.
According to the radial lemma (\ref{lem:radial-glob}), $\oBall(\hat p,\varpi\kappa/2)$ is a $\varpi\kappa$-geodesic $\CAT\kappa$ space.
The map $\map$ extends to its completion $\spc{B}=\cBall[\hat p,\varpi\kappa/2]$. 
All the remaining statements are already proved.
\qeds

\section{Reshetnyak majorization}\label{sec:resh-kirz}

\begin{thm}{Definition}\label{def:majorize}
Let $\spc{X}$ be a metric space,
$\tilde \alpha$ be a simple closed curve of finite length  in $\Lob2{\kappa}$,
and $D\subset\Lob2{\kappa}$ be a closed region bounded by $\tilde \alpha$.
A length-nonincreasing map $F\:D\to\spc{X}$ is called \index{majorizing map}\emph{majorizing} if it is length-preserving on $\tilde \alpha$.

In this case, we say that $D$ \emph{majorizes} the curve $\alpha=F\circ\tilde \alpha$ under the map $F$.
\end{thm}

The following proposition is a consequence of the definition.

\begin{thm}{Proposition}
\label{prop:majorize-geodesic} 
Let  $\alpha$  be a closed curve in a metric space $\spc{X}$.
Suppose $D\subset\Lob2{\kappa}$ majorizes $\alpha$ under $F\: D \to \spc{X}$.  
Then any geodesic subarc of $\alpha$ is the image under $F$ of a subarc of $\partial_{\Lob2{\kappa}} D$ that is geodesic in the length metric of $D$.

In particular, if $D$ is convex, then the corresponding subarc is a geodesic in $\Lob2{\kappa}$.
\end{thm}

\parit{Proof.} For a geodesic subarc $\gamma\:[a,b]\to\spc{X}$ of $\alpha=F\circ\tilde \alpha$, set
\begin{align*}
\tilde r&=\dist{\tilde \gamma(a)}{\tilde \gamma(b)}{D},
&
\tilde \gamma &= (F|_{\Fr D})^{-1}\circ\gamma,
\\
s&=\length \gamma,
&
\tilde s&= \length \tilde \gamma.
\end{align*}
Then
\[\tilde r\ge r = s =\tilde s\ge\tilde r.\]
Therefore $\tilde s=\tilde r$.
\qeds

\begin{thm}{Corollary}\label{cor:maj-triangle}
Let $\trig p x y$ be a triangle of perimeter $<2\cdot\varpi\kappa$ in a metric space $\spc{X}$. Assume a convex region $D\subset \Lob2\kappa$ majorizes $\trig p x y$.
Then $D=\Conv\trig{\tilde p}{\tilde x}{\tilde y}$ for a model triangle $\trig{\tilde p}{\tilde x}{\tilde y}=\modtrig\kappa(p x y)$, and the majorizing map sends  $\tilde p$, $\tilde x$ and $\tilde y$ respectively to $p$, $x$ and $y$.
\end{thm}

Now we come to the main theorem of this section.

\begin{thm}{Majorization theorem}
\label{thm:major}
Any closed curve $\alpha$ with length smaller than $2\cdot \varpi\kappa$ in  a $\varpi\kappa$-geodesic $\CAT\kappa$ space is majorized by a convex region in $\Lob2\kappa$. \end{thm}

This theorem was proved by Yuriy Reshetnyak \cite{reshetnyak:major};
our proof uses a trick that we learned from the lectures of Werner Ballmann \cite{ballmann:lectures}.
Another proof can be built on Kirszbraun's theorem (\ref{thm:kirsz+}), but it works only for complete spaces.

The case when $\alpha$ is a triangle, say $\trig p x y$, is the base  and is nontrivial.
In this case, by Corollary~\ref{cor:maj-triangle}, the majorizing convex region has to be isometric to $\Conv\trig{\tilde p}{\tilde x}{\tilde y}$, where $\trig{\tilde p}{\tilde x}{\tilde y}=\modtrig\kappa(p x y)$.  
There is a majorizing map for $\trig p x y$ whose image $W$ is the image of the line-of-sight map (definition \ref{def:sight}) for $[x y]$ from  $p$,
but as one can see from the following example, the line-of-sight map is not majorizing in general.

\begin{wrapfigure}{r}{30 mm}
\vskip-0mm
\centering
\includegraphics{mppics/pic-950}
\end{wrapfigure}

\parbf{Example.} Let $\spc{Q}$ be a solid quadrangle $[p x z y]$ in $\EE^2$ formed by two congruent triangles, which is non-convex at $z$ (as in the picture).  
Equip $\spc{Q}$ with the length metric. 
Then $\spc{Q}$ is $\CAT0$
by Reshetnyak gluing  (\ref{thm:gluing}). 
For triangle ${\trig p x y}_\spc{Q}$ in $\spc{Q}$ and its model triangle $\trig{\tilde p}{\tilde x}{\tilde y}$ in $\EE^2$,  
we have 
\[\dist{\tilde x}{\tilde y}{}=\dist{x}{y}{\spc{Q}}=\dist{x}{z}{}+\dist{z}{y}{}.\]
Then the map $F$ defined by matching line-of-sight parameters satisfies $F(\tilde x)=x$ and $\dist{x}{F(\tilde w)}{}>\dist{\tilde x}{\tilde w}{}$ if $\tilde w$ is near the midpoint $\tilde z$ of $[\tilde x\tilde y]$ and lies on $[\tilde p\tilde z]$. 
Indeed, by the first variation formula (\ref{1st-var+}), for $\eps=1-s$ we have
\[\dist{\tilde x}{\tilde w}{}
=\dist{\tilde x}{\tilde \gamma_\frac12(s)}{}
=\dist{x}{z}{}+o(\eps)\] and 
\[\dist{x}{F(\tilde w)}{}
=\dist{x}{\gamma_\frac12(s)}{}
=\dist{x}{z}{}-\eps\cdot\cos\mangle\hinge z p x+o(\eps).\]  
Thus $F$ is not majorizing.

\medskip

In  the following proofs, $x^1 \dots x^n$ ($n\ge 3$) denotes a polygonal line $x^1,\dots,x^n$, and $[x^1\dots x^n ]$ denotes the corresponding (closed) polygon.
For a subset $R$ of the ambient metric space,
we denote by $[x^1\dots x^n ]_R$ a polygon in the length metric of $R$.

Our first lemma gives a model space construction based on repeated application of Lemma~\ref{lem:quadrangle} from the proof of the inheritance.
Recall that convex and concave curves with respect to a point are defined in~\ref{def:convex-devel}.

\begin{thm}{Lemma}\label{lem:majorize-subgraph}
In $\Lob2{\kappa}$, let  
$\beta$ be a curve from $x$ to $y$ 
that is concave with respect  to $p$.
Let $D$  be the subgraph of $\beta$ with respect to $p$.
Assume 
\[\length\beta\z+\dist{p}{x}{}+\dist{p}{y}{}<2\cdot\varpi\kappa.\]
\begin{subthm}{curvilinear} 
Then $\beta$ forms a geodesic $[x y]_D$ in $D$ and therefore $\beta$, $[p x]$ and $[p y]$ form a triangle 
${\trig p x y}_D$ in the length metric of $D$.
\end{subthm}
\begin{subthm} {short-to-subgraph}
Let $\trig{\tilde p}{\tilde x}{\tilde y}$ be the model triangle for 
${\trig p x y}_D$.
Then there is a short map $G\:\Conv\trig{\tilde p}{\tilde x}{\tilde y}\to D$ such that $\tilde p\mapsto p$, $\tilde x\mapsto x$, $\tilde y\mapsto y$, and $G$ is length-preserving on each side of $\trig{\tilde p}{\tilde x}{\tilde y}$.
In particular, $\Conv\trig{\tilde p}{\tilde x}{\tilde y}$ majorizes triangle $[p x y]_D$ in $D$ under~$G$.
\end{subthm}
\end{thm} 


\parit{Proof.}
We prove the lemma for a polygonal line $\beta$;
the general case then follows by approximation.
Namely, since $\beta$ is concave 
it can be approximated by polygonal lines that are concave with respect to $p$, 
with their lengths converging to $\length \beta$. 
Passing to a partial limit we will obtain the needed map $G$.  

Suppose $\beta=x^0x^1\dots x^n$ is a polygonal line with $x^0=x$ and $x^n=y$.
Consider a sequence of polygonal lines $\beta_i=x^0x^1\dots x^{i-1}y_i$ such that $\dist{p}{y_i}{}=\dist{p}{y}{}$ and 
$\beta_i$ has same length as $\beta$; 
that is, 
\[\dist{x^{i-1}}{y_i}{}=\dist{x^{i-1}}{x^{i}}{}+\dist{x^{i}}{x^{i+1}}{}+\dots+\dist{x^{n-1}}{x^n}{}.\]

\begin{figure}[!ht]
\vskip-0mm
\centering
\includegraphics{mppics/pic-955}
\end{figure}

Clearly $\beta_n=\beta$.
Sequentially applying Alexandrov's lemma (\ref{lem:alex}) shows that each of the polygonal lines $\beta_{n-1}, \beta_{n-2},\dots,\beta_1$ is concave with respect to $p$.
Let $D_i$ be the subgraph of $\beta_i$ with respect to $p$.
Applying Lemma~\ref{lem:quadrangle} gives a short map $G_i\:D_{i}\to D_{i+1}$ that maps $y_{i}\mapsto y_{i+1}$ and does not move $p$ and $x$ (in fact,  $G_i$ is the identity everywhere except on $\Conv\trig{p}{x^{i-1}}{y_i}$).
Thus the composition 
\[G_{n-1}\circ\dots\circ G_1\: D_1\to D_n\] 
is short.
The result follows since $D_1\iso\Conv\trig{\tilde p}{\tilde x}{\tilde y}$.\qeds

\begin{thm}{Lemma}\label{lem:majorize-triangle}
Let $\trig{p}{x}{y}$ be a triangle of perimeter $<2\cdot\varpi\kappa$ in a $\varpi\kappa$-geodesic $\CAT\kappa$ space $\spc{U}$.
In $\Lob2{\kappa}$, let $\tilde \gamma$ be the $\kappa$-development of $[x y]$ with respect to $p$, where $\tilde \gamma$ has basepoint $\tilde p$ and subgraph $D$.
Consider the map $H\:D\to\spc{U}$ that sends the point with parameter $(t,s)$ under the line-of-sight map for $\tilde \gamma$ with respect to $\tilde p$, to the point with the same parameter under the line-of-sight map $f$ for $[x y]$ with respect to $p$.
Then $H$ is  length-nonincreasing.
In particular, $D$ majorizes triangle $\trig p x y$.
\end{thm}

\parit{Proof.}
Let $\gamma=\geod_{[x y]}$ and $T=\dist{x}{y}{}$. 
As in the proof of the development criterion (\ref{thm:concave-devel}), take a partition 
\[0=t^0<t^1<\dots<t^n=T,\]
and set $x^i=\gamma(t^i)$. 
Construct a chain of model triangles  $\trig{\tilde p}{\tilde x^{i-1}}{\tilde x^i}\z=
\modtrig\kappa(p x^{i-1} {x^i})$, with $\tilde x^0=\tilde x$ and the direction of $[\tilde p\tilde x^i]$ turning counterclockwise as $i$ grows.  
Let $D_n$ be the subgraph with respect to $\tilde p$ of the polygonal line $\tilde x^0\dots \tilde x^n$.


Let  $\delta_n$ be the maximum radius of a circle inscribed in any of the triangles $\trig{\tilde p}{\tilde x^{i-1}}{\tilde x^i}$.  

Now we construct a map $H_n \: D_n\to\spc{U}$  that increases distances by at most  $2\cdot\delta_n$.
Suppose $w\in D_n$.
Then $w$ lies on or inside some triangle $\trig{\tilde p}{\tilde x^{i-1}}{\tilde x^i}$.  
Define $H_n(w)$ by first mapping $w$ to a nearest point on $\trig{\tilde p}{\tilde x^{i-1}}{\tilde x^i}$ (choosing one if there are several), followed by the natural map to the triangle  $\trig {p}{x^{i-1}}{ x^i}$. 

Since triangles in $\spc{U}$ are $\kappa$-thin (\ref{prop:k-thin}), the restriction of $H_n$ to each triangle $\trig{\tilde p}{\tilde x^{i-1}}{\tilde x^i}$ is short.   
Then the triangle inequality implies that the restriction of $H_n$ to 
\[U_n=\bigcup_{1\le i\le n}\trig{\tilde p}{\tilde x^{i-1}}{\tilde x^i}\]
is short with respect to the length metric on $D_n$. 
Since nearest-point projection from $D_n$ to $U_n$ increases the $D_n$-distance between two points by at most $2\cdot\delta_n$, the map $H_n$ also increases the $D_n$-distance by at most $2\cdot\delta_n$. 

Consider converging sequences $v_n\to v$ and $w_n\to w$ such that $v_n,w_n\in D_n$ and therefore $v,w\in D$.
Note that 
\[\dist{H_n(v_n)}{H_n(w_n)}{} \le \dist{v_n}{w_n}{D_n} + 2\cdot\delta_n,\eqlbl{eq:|H(v)-H(w)|}\]
for each $n$.
Since $\delta_n\to 0$ and geodesics in $\spc{U}$ vary continuously with their endpoints (\ref{thm:alex-patch}), we have $H_n(v_n)\to 
H(v)$ and $H_n(w_n)\to H(w)$.
Therefore the left-hand side in \ref{eq:|H(v)-H(w)|} converges to $\dist{H(v)}{H(w)}{}$ and the right-hand side converges to $\dist{v}{w}{D}$, it follows that $H$ is short.
\qeds




\parit{Proof of \ref{thm:major}.}
We begin by proving the theorem in case $\alpha$ is polygonal.

First suppose $\alpha$ is a triangle, say $\trig p x y$.
By assumption, the perimeter of $\trig p x y$ is less than
$2\cdot\varpi\kappa$.
This is the base case for the induction.

 Let $\tilde \gamma$ be the $\kappa$-development of $[x y]$ with respect to $p$, where $\tilde \gamma$ has basepoint $\tilde p$ and subgraph $D$.
By the development criterion (\ref{thm:concave-devel}),  $\tilde \gamma$ is concave.
By Lemma~\ref{lem:majorize-subgraph},  there is a short map $G\:\Conv\modtrig\kappa(p x y)\to D$.
Further, by Lemma~\ref{lem:majorize-triangle},  $D$ majorizes $\trig p x y$ under a majorizing map $H\:D\to\spc{U}$. Clearly $H\circ G$ is a majorizing map for $\trig p x y$.

\begin{wrapfigure}{r}{40 mm}
\vskip-1mm
\centering
\includegraphics{mppics/pic-960}
\vskip0mm
\end{wrapfigure}

Now we claim that any closed $n$-gon $[x^1x^2 \dots x^n ]$ of perimeter less than $2\cdot \varpi\kappa$ in a $\CAT{\kappa}$ space  is majorized by a convex polygonal region \[R_n=\Conv[\tilde x^1\tilde x^2\dots\tilde x^n]\]
under a map $F_n$ such that $F_n\:\tilde x^i\mapsto x^i$ for each $i$. 


Assume the statement is true for $(n-1)$-gons, $n\ge 4$.  
Then  $[x^1 x^2 \dots x^{n-1}]$  is majorized by a convex polygonal region 
\[R_{n-1}=\Conv[\tilde x^1 \tilde x^2,\dots \tilde x^{n-1}],\] 
in $\Lob2\kappa$ under a map $F_{n-1}$ satisfying $F_{n-1}(\tilde x^i)=x^i$ for all $i$. 
Take $\dot x^n\in\Lob2{\kappa}$ such that $\trig{\tilde x^1}{\tilde x^{n-1}}{\dot x^n}=\modtrig\kappa(x^1 x^{n-1} x^n)$ 
and this triangle lies on the other side of $[\tilde x^1\tilde x^{n-1}]$ from $R_{n-1}$.  
Let $\dot R\z=\Conv\trig{\tilde x^1}{\tilde x^{n-1}}{\dot x^n}$, 
and $\dot F\:\dot R\to \spc{U}$ be a majorizing map for $\trig { x^1}{x^{n-1}}{ x^n}$ as provided above.

Set 
$R= R_{n-1}\cup \dot R$, where $R$ carries its length metric.
Since $F_n$ and $F$ agree on $[\tilde x^1 \tilde x^{n-1}]$, we may define $F\:R\to\spc{U}$ by 
\[
F(x)=
\begin{cases}
F_{n-1}(x),\quad & x\in R_{n-1},\\
\dot F(x),\quad & x\in \dot R.\\
\end{cases}
\]
Then $F$ is length-nonincreasing and is a majorizing map for $[x^1 x^2 \dots x^n ]$ (as in Definition~\ref{def:majorize}).

If $R$ is a convex subset of $\Lob2\kappa$, we are done. 

If $R$ is not convex,  the total internal angle of $R$ at $\tilde x^1$ or $ \tilde x^{n-1} $ or both is $>\pi$.  
By relabeling we may suppose this holds for $\tilde x^{n-1}$.  

The region $R$ is obtained by gluing $R_{n-1}$ to $\dot R$ by $[x^1x^{n-1}]$.
Thus, by Reshetnyak gluing (\ref{thm:gluing}), $R$ carrying its length metric is a $\CAT{\kappa}$-space.  
Moreover $[\tilde x^{n-2}\tilde x^{n-1}]\cup[\tilde x^{n-1} \dot x^n]$ is a geodesic of $R$.
Thus $[\tilde x^1 \tilde x^2 \dots \tilde x^{n-2} \dot x^n]_R$ is a closed $(n-1)$-gon in $R$, to which the induction hypothesis applies. The resulting short map from a convex region in $ \Lob2\kappa$ to~$R$, followed by $F$,  is the desired majorizing map.

\medskip

Note that in fact we have proved the following:

\begin{clm}{}
Let $F_{n-1}$ be a majorizing map for the polygon $[x^1x^2\dots x^{n-1}]$,
and $\dot F$ be a majorizing map for the triangle $[x^1x^{n-1}x^{n}]$.
Then there is a majorizing map $F_n$ for the polygon $[x^1x^2\dots x^n]$
such that \[\Im F_{n+1}= \Im F_n\cup\Im \dot F.\]

\end{clm}

We now use this claim to prove the theorem for general curves.

Assume $\alpha\:[0,\ell]\to\spc{U}$ is an  arbitrary closed curve with natural parameter.
Choose a sequence of partitions $0=t^0_n<t^2_n<\dots<t^n_n=\ell$
so that:
\begin{itemize}
\item The set $\{t_{n+1}^i\}_{i=0}^{n+1}$ 
is obtained from the set  $\{t_n^i\}_{i=0}^n$ by adding one element.
\item For some sequence $\eps_n\to0+$,
we have $t^i_n-t^{i-1}_n<\eps_n$ for all $i$.
\end{itemize}

Inscribe in $\alpha$ a sequence of polygons $P_n$ with vertexes $\alpha(t^i_n)$.
Apply the claim above, to get a sequence of majorizing maps $F_n\:R_n\to\spc{U}$.
Note that for all $m>n$ we have
\begin{itemize}
\item $\Im F_m$ lies in an  $\eps_n$-neighborhood of $\Im F_n$,
\item $\Im F_m\backslash \Im F_n$ lies in an  $\eps_n$-neighborhood of $\alpha$.
\end{itemize}
It follows that the set
\[K=\alpha\cup\left(\bigcup_n\Im F_n\right)\]
is compact.
Therefore the sequence $(F_n)$
has a partial limit as $n\to\infty$; 
say $F$.
Clearly $F$ is a majorizing map for $\alpha$.
\qeds

If $p_1\dots p_n$ is a polygon, then values $\theta_i=\pi-\mangle\hinge{p_i}{p_{i-1}}{p_{i+1}}$ for all $i\pmod n$ are called \emph{external angles} of the polygon.
The following exercise is a generalization of Fenchel's theorem.

\begin{thm}{Exercise}\label{ex:fenchel}
Show that the sum of external angles of any polygon in a complete length $\CAT0$ space cannot be smaller than $2\cdot\pi$. 
\end{thm}

\begin{thm}{Very advanced exercise}\label{ex:FM}
Suppose that a simple polygon $\beta$ in a complete length $\CAT0$ space does not bound an embedded disc.
Show that the sum of external angles of $\beta$ cannot be smaller than $4\cdot\pi$.

Give an example of such a polygon $\beta$ with the sum of external angles exactly $4\cdot\pi$.
\end{thm}

The following exercise is the rigidity case 
of the majorization theorem.

{\sloppy 

\begin{thm}{Exercise}\label{ex:isometric-majorization}
Let $\spc{U}$ be a $\varpi\kappa$-geodesic $\CAT\kappa$ space
and $\alpha\:[0,\ell]\to\spc{U}$ be a closed curve with arclength parametrization.
Assume that $\ell\z<2\cdot \varpi\kappa$
and there is a closed convex curve $\tilde \alpha\:[0,\ell]\to\Lob{2}{\kappa}$ such that 
\[\dist{\alpha(t_0)}{\alpha(t_1)}{\spc{U}}=\dist{\tilde \alpha(t_0)}{\tilde \alpha(t_1)}{\Lob{2}{\kappa}}\]
for any $t_0$ and $t_1$.
Then there is a distance-preserving map $F\:\Conv\tilde \alpha\to \spc{U}$
such that $F\:\tilde \alpha(t)\mapsto \alpha(t)$ for any $t$.
\end{thm}

}

\begin{thm}{Exercise}\label{ex:bishop}
Two majorizations $F\:D\to \spc{U}$ and $F'\:D'\to \spc{U}$ will be called \index{majorizing map!equivalent majorizations}\emph{equivalent} if $F'=F\circ\iota$ for an isometry $\iota\:D\to D'$.

Show that a closed rectifiable curve in a $\CAT0$ space has an isometric majorization map if and only if the majorization map is unique up to equivalence.
\end{thm}

The following lemma states, in particular, that in a $\CAT\kappa$ space, 
a sharp triangle comparison implies the
presence of an isometric copy of the convex hull of the model triangle.
The latter statement was proved by Alexandr Alexandrov \cite{alexandrov:devel}.
  
\begin{thm}{Arm lemma}\label{lem:arm}
Let $\spc{U}$ be a $\varpi\kappa$-geodesic $\CAT\kappa$ space, 
and $P=[x^0x^1\dots x^{n+1}]$ be a polygon of length $<2\cdot \varpi\kappa$ in $\spc{U}$.
Suppose $\tilde P=[\tilde x^0\tilde x^1\dots \tilde x^{n+1}]$ is a convex  polygon in $\Lob{2}{\kappa}$
such that 
\[
\dist{\tilde x^i}{\tilde x^{i-1}}{\Lob{2}{\kappa}}
=
\dist{x^i}{x^{i-1}}{\spc{U}}
\quad \text{and}\quad 
\mangle\hinge{x^i}{x^{i-1}}{x^{i+1}}\ge\mangle\hinge{\tilde x^i}{\tilde x^{i-1}}{\tilde x^{i+1}}
\eqlbl{eq:arm}
\]
for all $i$.
Then 

\begin{subthm}{subthm:arm-ineq}
$\dist{\tilde x^0}{\tilde x^{n+1}}{\Lob{2}{\kappa}}
\le
\dist{x^0}{x^{n+1}}{\spc{U}}$.
\end{subthm}

\begin{subthm}{subthm:arm-eq}
Equality holds in \ref{SHORT.subthm:arm-ineq} if and only if the map $\tilde x^i\mapsto x^i$ can be extended 
to a distance-preserving map of $\Conv(\tilde x^0,\tilde x^1\dots \tilde x^{n+1})$ onto $\Conv(x^0,x^1\dots x^{n+1})$.
\end{subthm}
\end{thm}

\parit{Proof; \ref{SHORT.subthm:arm-ineq}.}
By majorization (\ref{thm:major}), $P$ is majorized by a convex region $\tilde D$ in $\Lob{2}{\kappa}$.
By Proposition \ref{prop:majorize-geodesic} and the definition of angle,
$\tilde D$ is bounded by a convex polygon $\tilde P_R=[\tilde y^0\tilde y^1\dots \tilde y^{n+1}]$ that satisfies
\begin{align*}
\dist{\tilde y^i}{\tilde y^{i\pm1}}{\Lob{2}{\kappa}}
&=
\dist{x^i}{x^{i\pm1}}{\spc{U}}, \qquad \dist{\tilde y^0}{\tilde y^{n+1}}{\Lob{2}{\kappa}}
=
\dist{x^0}{x^{n+1}}{\spc{U}},
\\
& \mangle\hinge{\tilde y^i}{\tilde y^{i-1}}{\tilde y^{i+1}}\ge\mangle\hinge{x^i}{x^{i-1}}{x^{i+1}}\ge\mangle\hinge{\tilde x^i}{\tilde x^{i-1}}{\tilde x^{i+1}}
\end{align*}
for $1\le i\le n$; the last inequality follows from \ref{eq:arm}.

The classical arm lemma \cite{sabitov} gives $\dist{\tilde x^0}{\tilde x^{n+1}}{}\le \dist{\tilde y^0}{\tilde y^{n+1}}{}$.
Since $ \dist{\tilde y^0}{\tilde y^{n+1}}{}=\dist{x^0}{x^{n+1}}{}$, part \ref{SHORT.subthm:arm-ineq} follows.

\parit{\ref{SHORT.subthm:arm-eq}.}
Suppose equality holds in \ref{SHORT.subthm:arm-ineq}.
Then angles at the $j$-th vertex of~$\tilde P$, $P$, and $\tilde P_R$ are equal for $1\le j\le n$, and we may take $\tilde P=\tilde P_R$.  

Let $F\:\tilde D\to\spc{U}$ be the majorizing map for $P$, where $\tilde D$ is the convex region bounded by $\tilde P$, and $F|_{\tilde P}$ is length-preserving.  

\begin{clm}{}\label{clm:arm-triangle}
Let $\tilde x,\tilde y,\tilde z$ be three vertexes of $\tilde P$, and $x,y,z$ be the corresponding vertexes of $P$.  If $\dist{\tilde x}{\tilde y}{}=
\dist{x}{y}{}$, $\dist{\tilde y}{\tilde z}{}=
\dist{x}{z}{}$ and $\mangle\hinge{\tilde y}{\tilde x}{\tilde z} = \mangle\hinge{y}{x}{z}$, then $F|_{\Conv(\tilde x, \tilde y, \tilde z)}$ is distance-preserving.
\end{clm} 

Indeed, since $F$ is majorizing, $F$ restricts to   distance-preserving maps from $[\tilde x\tilde y]$ to $[xy]$ and $[\tilde y\tilde z]$ to $[yz]$.
Suppose $\tilde p\in [\tilde x \tilde y]$ and $\tilde q\in[\tilde y\tilde z]$.  Then 
\[
\dist{\tilde p}{\tilde q}{\Lob{2}{\kappa}}
=
\dist{F( \tilde p )}{F(\tilde q)}{\spc{U}}.
 \eqlbl{eq:arm-eq}
\]
This inequality holds in one direction by majorization, and in the other direction by the angle comparison (\ref{cat-hinge}).
By the first variation formula (\ref{cor:both-end-first-var-cba}), it follows that each pair of corresponding angles of triangles $[\tilde x \tilde y \tilde z]$ and $[x y z]$ are equal.
But then \ref{eq:arm-eq} holds for $p,q$ on any two sides of these triangles, so $F$ is distance-preserving on every geodesic of $\Conv(\tilde p, \tilde x, \tilde y)$.
Hence the claim.
\claimqeds

\begin{clm}{}\label{clm:arm-induction}
Suppose $F|_{\Conv(\tilde x^0,\tilde x^1,\dots,\tilde x^{k})}$ is distance-preserving for some $k$, $2\le k\le n-1$.
Then $F|_{\Conv(\tilde x^0,\tilde x^1,\dots, \tilde x^{k+1})}$ is distance-preserving.
\end{clm}

To verify this claim, let 
\[
\tilde p=[\tilde x^{k-1}\tilde x^{k+1}] \cap [\tilde x^{k}\tilde x^{0}]
\quad\text{and}\quad
p=F(p).
\]

Note that the following maps are distance-preserving:
\begin{enumerate}
\item[(i)]
$F|_{\Conv(\tilde x^{k-1},\tilde x^k,\tilde x^{k+1})}$,

\item[(ii)]
 $F|_{\Conv(\tilde x^{k+1},\tilde x^{k-1},\tilde x^{0})}$,

\item[(iii)]
$F|_{\Conv(\tilde x^{0},\tilde x^{k},\tilde x^{k+1})}$.
\end{enumerate}
Indeed, (i) follows from \ref{clm:arm-triangle}.  
Therefore $\dist{\tilde x^{k-1}}{\tilde x^{k+1}}{}=\dist{x^{k-1} }{x^{k+1}}{}$, and so $F$ restricts to a distance-preserving map from $[\tilde x^{k-1}\tilde x^{k+1}]$ onto $[x^{k-1} x^{k+1}]$.  With the induction hypothesis in
\ref{clm:arm-induction},
 it follows that $p=[x^{k-1}x^{k+1}] \cap [x^{k}x^{0}]$, hence 
\[
\mangle\hinge{\tilde x^{k-1}}{\tilde x^{k+1}}{\tilde x^{0}} 
= \mangle\hinge{x^{k-1}}{x^{k+1}}{x^{0}}.
 \eqlbl{eq:angle-arm-eq}
\] 
Then (ii) follows from \ref{eq:angle-arm-eq} and \ref{clm:arm-triangle}.  Since $\dist{\tilde x^{k}}{\tilde x^{0}}{}=\dist{x^{k} }{x^{0}}{}$, (iii) follows from \ref{eq:angle-arm-eq} and (i). 

Let $\tilde \gamma$ be a geodesic of $\Conv(\tilde x^{0},\tilde x^0,\tilde x^1\dots \tilde x^{k+1})$.
Then $\length \tilde \gamma \z< \varpi\kappa$.
If $\tilde \gamma$ does not contain the point $\tilde p$, then by the induction hypothesis in
\ref{clm:arm-induction} and (i)+(ii)+(iii), we get that  $\gamma = F\circ\tilde \gamma$ is a local geodesic of length $<\varpi\kappa$.
By \ref{cor:loc-geod-are-min}, $\gamma$ is a geodesic.

By continuity, $F\circ\tilde \gamma$ is a geodesic for all $\tilde \gamma$;
so \ref{clm:arm-induction} follows.

The base of the induction is provided by \ref{clm:arm-triangle}.
It finishes the proof of part \ref{SHORT.subthm:arm-eq}.
\qeds
 
\begin{thm}{Exercise}\label{ex:square}
Let $\spc{U}$ be a complete length $\CAT0$ space and 
suppose 
for 4 points $x^1,x^2,x^3,x^4\in \spc{U}$
there is a convex quadrangle
$[\tilde x^1\tilde x^2\tilde x^3\tilde x^4]$
in $\EE^2$
such that 
\[\dist{x^i}{x^j}{\spc{U}}=\dist{\tilde x^i}{\tilde x^j}{\EE^2}\]
for all $i$ and $j$.
Show that $\spc{U}$ contains an isometric copy of the 
\emph{solid quadrangle}
$[\tilde x^1\tilde x^2\tilde x^3\tilde x^4]$; that is, the convex hull of $\tilde x^1,\tilde x^2,\tilde x^3,\tilde x^4$ in $\EE^2$.
\end{thm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Hadamard--Cartan theorem}\label{sec:Hadamard--Cartan}

The development of Alexandrov geometry was greatly influenced by the Hadamard--Cartan theorem.
Its original formulation states that if $M$ is a complete Riemannian manifold with nonpositive sectional curvature, 
then the exponential map at any point $p\in M$ is a covering;
in particular it implies that the universal cover of $M$ is diffeomorphic to the Euclidean space of the same dimension.

In this generality, the theorem appeared in the lectures of \'Elie Cartan \cite{cartan}.
For surfaces in the Euclidean space, 
the theorem was proved by
Hans von Mangoldt \cite{mangoldt},  
and a few years later independently by Jacques Hadamard \cite{hadamard}.

Formulations for metric spaces of different generality were proved by 
Herbert Busemann \cite{busemann-CBA},
Willi Rinow \cite{rinow}, and 
Michael Gromov \cite[p.~119]{gromov:hyp-groups}. 
A detailed proof of Gromov's statement when $\spc{U}$ is proper  was given by Werner Ballmann \cite{ballmann:cartan-hadamard}, using Birkhoff's curve-shortening.  
A proof in the non-proper 
geodesic case 
was given by the first author and Richard Bishop~\cite{alexander-bishop:h-c}.  
This proof applies more generally, to {}\emph{convex spaces} (see Exercise \ref{ex:cats-cradle}).
It was pointed out by Bruce Kleiner \cite{ballmann:lectures} 
and independently by Martin Bridson and Andr\'{e} Haefliger \cite{bridson-haefliger} that 
%the no-conjugate-point theorem (\ref{thm:no-conj-pt}) allows curve-shortening as in Corollary \ref{cor:homotopy-from-p}, and hence the Hadamard--Cartan theorem
this proof extends to length spaces, as well as geodesic spaces, giving the following statement:

\begin{thm}{Hadamard--Cartan theorem}
\label{thm:hadamard-cartan}
Let $\kappa\le 0$, and $\spc{U}$ be a complete, simply connected length locally $\CAT\kappa$ space.
Then $\spc{U}$ is $\CAT\kappa$.
\end{thm}

\parit{Proof.} Since $\varpi\kappa=\infty$, Theorem~\ref{thm:globalization-lift} implies that there is a $\CAT\kappa$ space $\spc{B}$ and a \index{metric covering}\emph{metric covering} $\map\:\spc{B}\to\spc{U}$; that is, $\map$ is a length-preserving covering map. 

Since $\spc{U}$ is simply connected, $\map\:\spc{B}\to\spc{U}$ is an isometry --- hence the result.
\qeds

To formulate the generalized Hadamard--Cartan theorem,
we need the following definition.

\begin{thm}{Definition}\label{def:l-s.c.}
Given $\ell\in (0,\infty]$,
a metric space $\spc{X}$ is called 
$\ell$-simply connected 
if it is connected and 
any closed curve of length $<\ell$ 
is null-homotopic in the class of curves of length $<\ell$ in $\spc{X}$.
\end{thm}

Note that there is a subtle difference between 
simply connected and $\infty$-simply connected spaces;
the first states that any closed curve is null-homotopic while the second means that any rectifiable curve is null-homotopic in the class of rectifiable curves.
However, as follows from Proposition~\ref{prop:sc}, for locally $\CAT\kappa$ spaces these two definitions are equivalent.
This fact makes it possible to deduce the Hadamard--Cartan theorem directly from the generalized Hadamard--Cartan theorem.

\begin{thm}{Generalized Hadamard--Cartan theorem}\label{thm:hadamard-cartan-gen}
A complete length space
$\spc{U}$ is $\CAT\kappa$ 
if and only if $\spc{U}$ is $2\cdot\varpi\kappa$-simply connected
and $\spc{U}$ is locally $\CAT\kappa$.
\end{thm}

For proper spaces, the generalized Hadamard--Cartan theorem was proved by Brian Bowditch \cite{bowditch}.
In the proof we need the following lemma.

\begin{thm}{Lemma}
Assume $\spc{U}$ is a complete length  locally $\CAT\kappa$ space,
$\eps>0$,
and $\gamma_1,\gamma_2\:\mathbb{S}^1\to\spc{U}$ are two closed curves.
Assume 
\begin{subthm}{}
$\length\gamma_i<2\cdot\varpi\kappa-4\cdot\eps$ for $i=1,2$;
\end{subthm}
 
\begin{subthm}{} $\dist{\gamma_1(x)}{\gamma_2(x)}{}<\eps$ for any $x\in\mathbb{S}^1$, and the geodesic $[\gamma_1(x)\gamma_2(x)]$ is uniquely defined and depends continuously on $x$;
\end{subthm}

\begin{subthm}{}  $\gamma_1$ is majorized by a convex region in $\Lob2\kappa$.
\end{subthm}

Then  $\gamma_2$ is majorized by a convex region in $\Lob2\kappa$.
\end{thm}

\parit{Proof.} Let $D$ be a convex region in $\Lob2\kappa$ that majorizes $\gamma_1$ under the map $F\:D\to\spc{U}$ 
(see Definition~\ref{def:majorize}).
Denote by $\tilde \gamma_1$ 
the curve bounding $D$ 
such that $F\circ\tilde \gamma_1=\gamma_1$.
Since  
\begin{align*}
\length\tilde \gamma_1
&=
\length\gamma_1
<
\\
&<
2\cdot\varpi\kappa-4\cdot\eps,
\end{align*}
there is a point $\tilde p\in D$ such that 
$\dist{\tilde p}{\tilde \gamma(x)}{\Lob2\kappa}<\tfrac{\varpi\kappa}2-\eps$
for any $x\in\mathbb{S}^1$.
Denote by $\alpha_x$ the concatenation of the paths $F\circ\geodpath_{[p\tilde \gamma_1(x)]_{\Lob2\kappa}}$ 
and  $\geodpath_{[\gamma_1(x)\gamma_2(x)]}$ in $\spc{U}$.
Note that $\alpha_x$ depends continuously on $x$, and
$$\length\alpha_x<\tfrac{\varpi\kappa}{2}\quad \text{and}\quad \alpha_x(1)=\gamma_2(x)$$ 
hold for any $x$.

Let us apply the lifting globalization theorem (\ref{thm:globalization-lift}) for $p\z=F(\tilde p)$.
We obtain a $\varpi\kappa$-geodesic $\CAT\kappa$ space $\spc{B}$
and a locally distance-preserving map $\map\:\spc{B}\to\spc{U}$
with $\map(\hat p)=p$ for some $\hat p \in \spc{B}$, and with the lifting property for the curves starting at $p$ with length $<\varpi\kappa/2$.
Applying the lifting property for $\alpha_x$, 
we get existence of a curve $\hat\gamma_2\:\mathbb{S}^1\to \spc{B}$ such that
$$\gamma_2=\map\circ\hat\gamma_2.$$

Since $\spc{B}$ is a geodesic $\CAT\kappa$ space, we can apply the majorization theorem (\ref{thm:major}) for $\hat\gamma_2$.
The composition of the obtained majorization with $\map$ is a majorization of $\gamma_2$.
\qeds

\parit{Proof of Theorem \ref{thm:hadamard-cartan-gen}.}
The only-if part follows from the Reshetnyak majorization theorem (\ref{thm:major}).

Let  $\gamma_t$, $t\in[0,1]$ 
be a null-homotopy of curves in $\spc{U}$;
that is, $\gamma_0(x)\z=p$ for some $p\in \spc{U}$
and any $x\in\mathbb{S}^1$.
Assume further that $\length \gamma_t\z<2\cdot\varpi\kappa$ for any $t$.
To prove the if part, it is sufficient to show that $\gamma_1$ is majorized by a convex region in $\Lob2\kappa$ if $\spc{U}$ is locally $\CAT\kappa$. 

By semicontinuity of length (\ref{thm:semicont-of-length}),
we can choose  $\eps>0$ sufficiently small that
$$\length \gamma_t<2\cdot\varpi\kappa-4\cdot\eps$$
for all $t$.

By Corollary~\ref{cor:loc-CAT(k)},
we may assume in addition that
$\oBall(\gamma_t(x),\eps)$ is $\CAT\kappa$ 
for any $t$ and $x$.

Choose a partition $0=t_0<t_1<\dots<t_n=1$
so that $\dist{\gamma_{t_i}(x)}{\gamma_{t_{i-1}}(x)}{}<\eps$
for any $i$ and $x$.
According to \ref{thm:cat-unique},
for any $i$,
the geodesic $[\gamma_{t_i}(x)\gamma_{t_{i-1}}(x)]$ depends continuously on $x$.

Note that $\gamma_0=\gamma_{t_0}$ is majorized by a convex region in $\Lob2\kappa$.
Applying the lemma $n$ times, we see that the same holds for $\gamma_1\z=\gamma_{t_n}$.
\qeds

\begin{thm}{Proposition}\label{prop:sc}
Let $\spc{U}$ be a complete length locally $\CAT\kappa$ space.
Then $\spc{U}$ is simply connected if and only if it is $\infty$-simply connected.
\end{thm}

\parit{Proof; if part.}
It is sufficient to show that any closed curve in $\spc{U}$ is homotopic to a polygon.

Let $\gamma_0$ be a closed curve in $\spc{U}$.
According to Corollary~\ref{cor:loc-CAT(k)},
there is $\eps>0$ such that 
$\oBall(\gamma(x),\eps)$ is $\CAT\kappa$
for any $x$.

Choose a polygon $\gamma_1$ such that $\dist{\gamma_0(x)}{\gamma_1(x)}{}<\eps$ for any $x$.
By \ref{thm:cat-unique}, 
$\geodpath_{[\gamma_0(x)\gamma_1(x)]}$ 
is uniquely defined 
and depends continuously on~$x$.

Hence $\gamma_t(x)=\geodpath_{[\gamma_0(x)\gamma_1(x)]}(t)$ gives a homotopy from $\gamma_0$ to $\gamma_1$.

\parit{Only-if part.} The proof is similar.

Assume $\gamma_t$ is a homotopy between two rectifiable curves $\gamma_0$ and $\gamma_1$.
Fix $\eps>0$ so that the ball $\oBall(\gamma_t(x),\eps)$ is $\CAT\kappa$
for any $t$ and $x$.
Choose a partition $0=t_0<t_1<\dots<t_n=1$ 
so that 
$$\dist{\gamma_{t_{i-1}}(x)}{\gamma_{t_i}(x)}{}<\tfrac\eps{10}$$
for any $i$ and $x$.
Set $\hat\gamma_{t_0}=\gamma_0$, $\hat\gamma_{t_n}=\gamma_{t_n}$.
For each $0<i<n$, approximate $\gamma_{t_i}$ by a polygon $\hat\gamma_{i}$.

Construct the \index{geodesic homotopy}\emph{geodesic homotopy} 
from $\hat\gamma_{t_{i-1}}$ 
to $\hat\gamma_{t_i}$;  
that is,
set 
$$\hat\gamma_t
=
\geodpath_{[\hat\gamma_{t_{i-1}}(x)\hat\gamma_{t_i}(x)]}(t)$$
for $t\in [t_{i-1},t_i]$.
Since $\eps$ is sufficiently small, 
by \ref{cor:cat-unique}, we get that
$$\length\hat\gamma_t
<
10\cdot(\length\hat\gamma_{t_{i-1}}+\length\hat\gamma_{t_i})$$
for any $t\in [t_{i-1},t_i]$.
In particular, $\hat\gamma_t$ is rectifiable for all $t$.

Joining the obtained homotopies for all $i$, we obtain a homotopy from $\gamma_0$ to $\gamma_1$ in the class of rectifiable curves.
\qeds

\begin{thm}{Exercise}\label{ex:cover-branching-along-2-lines}
Let $\spc{X}$ be a double cover of $\EE^3$ that branches along two distinct lines $\ell$ and $m$.
Show that  $\spc{X}$ is $\CAT0$ if and only if $\ell$ intersects $m$ at a right angle.
\end{thm}

\begin{thm}{Exercise}\label{ex:branching}
Let $\spc{U}$ be a complete length $\CAT0$ space.
Assume $\tilde{\spc{U}}\to \spc{U}$ is a metric covering branching along a geodesic.
Show that $\tilde{\spc{U}}$ is $\CAT0$.

More generally, assume $A\subset \spc{U}$ is a closed convex subset and $f\:\spc{X}\to \spc{U}\backslash A$ is a metric cover.
Denote by $\bar{\spc{X}}$ the completion of $\spc{X}$, and 
$\bar f\:\bar{\spc{X}}\to \spc{U}$ the continuous extension of $f$.
Let $\tilde{\spc{U}}$ be the space glued from $\bar{\spc{X}}$ and $A$ by identifying $x$ and $\bar f(x)$ if $\bar f(x)\in A$.
Show that $\tilde{\spc{U}}$ is $\CAT0$.
\end{thm}

\section{Convex sets}
\label{sec:convex-CBA}

Recall that according to Corollary~\ref{cor:convex-balls}, any ball (closed or open) of radius $R<\tfrac{\varpi\kappa}2$ in a $\varpi\kappa$-geodesic $\CAT\kappa$ space is convex.
From the uniqueness of geodesics in $\CAT\kappa$ spaces (\ref{thm:cat-unique}) we get the following:

\begin{thm}{Observation}
Any weakly $\varpi\kappa$-convex set 
in a complete length $\CAT\kappa$ space is $\varpi\kappa$-convex.
\end{thm}


\begin{thm}{Closest-point projection lemma}\label{lem:closest point}{\sloppy 
Let $\spc{U}$ be a complete length $\CAT\kappa$ space, and $K\subset \spc{U}$ be a closed $\varpi\kappa$-convex set. 
Assume that $\distfun{K}{p}{}<\tfrac{\varpi\kappa}2$ for some point $p\in \spc{U}$.
Then  
there is a unique point $p^*\in K$ that minimizes the distance to $p$;
that is, $\dist{p^*}{p}{}=\distfun{K}{p}{}$. 

}

\end{thm}

\parit{Proof.} 
Fix $r$ properly between $\distfun{K}{p}{}$ and $\tfrac{\varpi\kappa}2$.
By the function comparison (\ref{thm:function-comp}),
the function $f=\md\kappa\circ\distfun{p}{}{}$ is strongly convex in $\cBall[p,r]$.

The lemma follows from Lemma~\ref{lem:argmin(convex)} applied to the subspace $K'\z=K\cap\cBall[p,r]$ 
and the restriction $f|_{K'}$. 
\qeds

\begin{thm}{Exercise}\label{ex:closest-point-projection}
Let  $\spc{U}$ be a complete length $\CAT0$ space and $K\subset \spc{U}$ be a closed convex set.
Show that the closest-point projection $\spc{U}\to K$ is short. 
\end{thm}

\begin{thm}{Advanced exercise}\label{ex:short-retraction-CBA(1)}
Let  $\spc{U}$ be a complete length $\CAT1$ space and $K\subset \spc{U}$ be a closed $\pi$-convex set.
Assume $K\subset \cBall[p,\tfrac\pi2]$ for some point $p\in K$.
Show that there is a short retraction of $\spc{U}$ to~$K$. 
\end{thm}

\begin{thm}{Proposition}\label{lem:dist-to-convex}
Let $\spc{U}$  be a $\varpi\kappa$-geodesic $\CAT\kappa$ space
and $K\subset \spc{U}$ be a closed $\varpi\kappa$-convex set.
Let
\[f=\sn\kappa\circ\distfun{K}{}{}.\]
Then
\[f''+\kappa \cdot f\ge 0\]
holds in $\oBall(K,\tfrac{\varpi\kappa}2)$.
\end{thm}

\parit{Proof.}
It is sufficient to show that Jensen's inequality (\ref{y''-mono})
holds on a sufficiently short 
geodesic $[pq]$ in $\oBall(K,\tfrac{\varpi\kappa}2)$.
We may assume that 
\[\dist{p}{q}{}+\distfun{K}{p}{}+\distfun{K}{q}{}<\varpi\kappa.\eqlbl{eq:sum=<varpi}\]

For each $x\in[pq]$,
we need to find a value $h(x)\in \RR$
such that 
\[
h(p)=f(p),\qquad 
h(q)=f(q),\qquad
h(x)\le f(x)\qquad
\]
for any $x\in [pq]$,
and
\[h''+\kappa\cdot h\ge 0\eqlbl{h''+kh=<0}\]
along $[pq]$.

Denote by $p^{*}$ and $q^{*}$ the closest-point projections of $p$ and $q$ on $K$; 
they are provided by \ref{lem:closest point}.
From \ref{eq:sum=<varpi} and the triangle inequality,
we have
\[\dist{p^*}{q^*}{}<\varpi\kappa.\]
Since $K$ is $\varpi\kappa$-convex, $K\supset[p^*q^*]$;
in particular
\[\distfun{K}{x}{}\le \distfun{[p^*q^*]}{x}{}\]
for any $x\in \spc{U}$.

There is a majorizing map $F: D\to \spc U$ for quadrangle $[pp^{*}q^{*}q]$, as in Definition  \ref{def:majorize} and the Reshetnyak majorization theorem (\ref{thm:major}).
By Proposition \ref{prop:majorize-geodesic}, 
the figure $D$ is a solid convex quadrangle $[\tilde p\tilde p^*\tilde q^*\tilde q]$ in $\Lob2\kappa$ such that 
\begin{align*}
\dist{\tilde p}{\tilde p^*}{\Lob2\kappa}&=\dist{p}{p^*}{\spc{U}}
&
\dist{\tilde p}{\tilde q}{\Lob2\kappa}&=\dist{p}{q}{\spc{U}}
\\
\dist{\tilde q}{\tilde q^*}{\Lob2\kappa}&=\dist{q}{q^*}{\spc{U}}
&
\dist{\tilde p^*}{\tilde q^*}{\Lob2\kappa}&=\dist{p^*}{q^*}{\spc{U}}.
\end{align*}
Given $x\in [pq]$, denote by $\tilde x$ the corresponding point on $[\tilde p\tilde q]$.
Then
\[\distfun{[pq]}{x}{}
\le
\distfun{[\tilde p\tilde q]}{\tilde x}{}.\]
Set 
\[h(x)
=
\sn\kappa\circ
\distfun{[\tilde p\tilde q]}{\tilde x}{}.\]
By straightforward calculations, \ref{h''+kh=<0} holds
and hence the statement follows.
\qeds

\begin{thm}{Corollary}\label{cor::dist-to-convex}
Let $\spc{U}$  be a complete length $\CAT\kappa$ space
and $K\subset \spc{U}$ be a closed  locally convex set.
Then there is an open set $\Omega\supset K$
such that the function 
$f=\sn\kappa\circ\distfun{K}{}{}$
satisfies 
\[f''+\kappa\cdot f\ge 0\]
in $\Omega$.
\end{thm}

\parit{Proof.}
Fix $p\in K$.
By Corollary~\ref{cor:convex-balls},
$\cBall[p,r]$ is convex for all small $r>0$.

Since $K$ is locally convex, there is $r_p>0$ such that 
the intersection
$K'=K\cap \oBall(p,r_p)$ is convex. 

Note that 
\[\distfun{K}{x}{}=\distfun{K'}{x}{}\]
for any $x\in \oBall(p,\tfrac{r_p}2)$.
Therefore the statement holds for 
\[\Omega=\bigcup_{p\in K}\oBall(p,\tfrac{r_p}2).\]
\qedsf



\begin{thm}{Theorem}\label{thm:local-global-convexity}
Assume $\spc{U}$ is a complete length $\CAT\kappa$ space and $K\subset \spc{U}$ is a closed connected locally convex set.
Assume $\dist{x}{y}{}<\varpi\kappa$ for any $x,y\in K$.
Then $K$ is convex.

In particular, if $\kappa\le 0$, then any closed connected locally convex set in $\spc{U}$ is convex.
\end{thm}

The following proof is due to Sergei Ivanov \cite{ivanov:local-global-convexity}.

\begin{wrapfigure}{o}{50 mm}
\vskip-1mm
\centering
\includegraphics{mppics/pic-970}
\vskip0mm
\end{wrapfigure}

\parit{Proof.}
Since $K$ is locally convex,
it is locally path-connected.
Since $K$ is connected and locally path connected it is path-connected.

Fix two points $x,y\in K$. 
Let us connect $x$ to $y$ by a path $\alpha\:[0,1]\to K$.
Since $\dist{x}{\alpha(s)}{}<\varpi\kappa$ for any $s$,
Theorem~\ref{thm:cat-unique} implies that the geodesic $[x\alpha(s)]$ 
is uniquely defined and depends continuously on $s$.

Let $\Omega\supset K$ be the open set provided by Corollary~\ref{cor::dist-to-convex}.
If $[xy]\z=[x\alpha(1)]$ does not completely lie in $K$, then 
there is a value $s\in [0,1]$ such that $[x\alpha(s)]$ 
lies in $\Omega$ but does not completely lie in $K$.
By Corollary~\ref{cor::dist-to-convex},
the function $f=\sn\kappa\circ\distfun{K}{}{\spc{U}}$ 
satisfies the differential inequality
\[f''+\kappa\cdot f\ge 0\eqlbl{f''+kappa f=<0}\]
along $[x\alpha(s)]$.

Since 
\begin{align*}
\dist{x}{\alpha(s)}{}&<\varpi\kappa,
&
f(x)&=f(\alpha(s))=0,
\end{align*}
then the barrier inequality (\ref{barrier}) 
implies that $f(z)\le 0$ for $z\in [x\alpha(s)]$;
that is $[x\alpha(s)]\subset K$, a contradiction.
\qeds

\section{Remarks}

The following question was known in folklore in the 80's,
% Dave Berg remembers this
but it seems that in print
it was first mentioned by Michael Gromov \cite[6.B$_1\mathrm{(f)}$]{gromov:asymt-inv}.
We do not see any reason why it should be true, 
but we also cannot construct a counterexample.

\begin{thm}{Open question}
Let $\spc{U}$ be a complete length $\CAT0$ space and $K\subset \spc{U}$ be a compact set.
Is it true that $K$ lies in a convex compact set $\bar K\subset\spc{U}$?
\end{thm}

The question can  easily be reduced to the case when $K$ is finite;
so far it is not even known if any three points in a complete length $\CAT0$ space lie in a compact convex set.

We expect that \ref{lem:patch} can be extended to all curves, not necessarily local geodesics,
but the proof does not admit a straightforward generalization.

\parbf{About convex spaces.}
A \index{convex space}\emph{convex space} $\spc{X}$ is a geodesic space such that the function
$t\mapsto\dist{\gamma(t)}{\sigma(t)}{}$ is convex 
for any two  geodesic paths $\gamma,\sigma:[0,1]\to \spc{X}$.  
A \index{convex space!locally convex space}\emph{locally convex space} is a length space in which every point has a neighborhood that is a convex space in the restricted metric.

\begin{thm}{Exercise}\label{ex:cats-cradle}
Assume $\spc{X}$ is a convex space 
such that the angle of any hinge is defined.
Show that $\spc{X}$ is $\CAT{0}$.
\end{thm}

The following exercise gives an analog of the Hadamard--Cartan theorem for locally convex spaces;
see also \cite{alexander-bishop:h-c}.

\begin{thm}{Exercise}\label{ex:Hadamard--Cartan}
Show that a complete, simply connected, locally convex space is a convex space.
\end{thm}

\parbf{Examples and constructions.}
Let us list some important sources of examples of $\CAT{}$ spaces.% V: I changed the phrasing because we are not listing a lot of VERY important examples such as aymptotic cones, including asymptotic cones of hyperbolic and semi hyperbolic groups and Eucliudean and spherical buildings. 

This should be beneficial to the reader even though we do not provide all the proofs and some proofs are deferred to later chapters.

\textit{Riemannian manifolds} with sectional curvature at most $\kappa$ are locally $\CAT{\kappa}$.
This statement follows from the Rauch comparison, and it is one of the main motivations for $\CAT{\kappa}$ comparison.
\textit{Hilbert spaces} are another motivating example of $\CAT{0}$ spaces.

The question of when Riemannian \textit{manifold-with-boundary} is locally $\CAT{\kappa}$ have been completely answered by the first author, David Berg, and Richard Bishop \cite{alexander-berg-bishop1993}.
If the sectional curvatures of the interior and the outward sectional curvatures of the boundary do not exceed $\kappa$ then it is locally $\CAT\kappa$ (where an outward sectional curvature is one that corresponds to a tangent $2$-plane all of whose normal curvature vectors point outward).
In particular, if a Riemannian manifold and its boundary have sectional curvature at most $\kappa$, then it is locally $\CAT{\kappa}$.

Further, any simply-connected \textit{subset of the plane} equipped with induced length metric is $\CAT{0}$.
In higher dimensions things are more complicated;
see \cite[Chapter 4]{alexander-kapovitch-petrunin-CAT} for related questions (open and solved).


Note that any \textit{metric tree} (see Section~\ref{sec:Ultralimit of spaces}) is $\CAT{-\infty}$;
that is, a metric tree is $\CAT{\kappa}$ for \textit{any} $\kappa\in\RR$.
In particular, any tree (in the graph-theoretical sense) with a length metric such that every edge is isometric to a line segment is $\CAT{-\infty}$.

Suppose $A^1, \dots, A^n$ is an array of convex closed sets in the Euclidean space $\EE^m$.
Let us prepare $n+1$ copy of $\EE^m$ and glue successive pairs of spaces along $A^1, \dots, A^n$.
The resulting space is called \textit{puff pastry};
by the Reshetnyak gluing theorem it is $\CAT0$.
(This observation was used in one of the most beautiful applications of the Reshetnyak gluing theorem given by Dmitri Burago,  Serge Ferleger,
and Alexey Kononenko \cite{burago-ferleger-kononenko1998-1,burago-ferleger-kononenko1998-2,burago-ferleger-kononenko1998-3,burago-ferleger-kononenko1998-4}.
They use it to study billiards; a short survey on the subject was written by Dmitri Burago \cite{burago-1998};
see also our book \cite{alexander-kapovitch-petrunin-CAT}.)

An if-and-only-if condition on \textit{polyhedral spaces} is given in \ref{thm:PL-CAT}.
It implies the so-called Gromov's flag condition \ref{thm:flag} which provides in particular a flexible way to construct $\CAT0$ \textit{cube complexes}.
(Several applications are mentioned in Section~\ref{sec:poly-reamarks}.)

By \ref{prop:CAT-olim} and \ref{thm:ultra-GH}, the \textit{ultralimits}, as well as \textit{Gromov--Hausdorff limits} of $\CAT\kappa$ spaces are $\CAT\kappa$.
In particular, if  $\spc{U}$ is a $\CAT{0}$ space then its \textit{asymptotic cone}\index{asymptotyc cone}   defined as  the ultarlimit of its rescalings $\tfrac1n\cdot \spc{U}$ as $n\to \o$ is again  $\CAT{0}$.
Unlike in the case of $\Alex{0}$ spaces, the use of ultralimits is necessary even if $\spc{U}$ is a manifold due to the lack of compactness theorem.
Asymptotic cones of $\CAT{0}$ spaces and their generalizations play an important role in geometric group theory.

Further, $\CAT{}$ spaces behave nicely with respect to some natural constructions.
For example, the product of $\CAT{0}$ spaces is again $\CAT{0}$.
Also, the Euclidean cone over $\CAT{1}$ space is  $\CAT{0}$.
These are the first examples of the so-called \textit{warped products} that are discussed in Chapter~\ref{chapter:warped products};
a general statement is given in \ref{thm:warp-CAT}.

\textit{Conformal deformations} of $\CAT{}$ spaces were studied by Alexander Lytchak and Stephan Stadler \cite{lytchak-stadler}.
In particular, if $\spc{U}$ is a $\CAT0$ space and $f\:\spc{U}\to\RR$ is  continuous convex
and bounded below,
then the conformally equivalent space with conformal factor $e^f$ is $\CAT0$.
