%%!TEX root = all.tex
%arXiv
\chapter{First order differentiation}\label{chap:tan}

\section{Intrinsic property of tangent space}\label{halbeisen}

\begin{thm}{Theorem}
Let $\spc{U}$ be a complete length $\CAT\kappa$ space and $p\in \spc{U}$.
Then $\T_p\spc{U}$ is a length space.
\end{thm}

\parit{Proof.}
Since $\T_p=\Cone \Sigma_p$, it is sufficient to show that for any hinge $\hinge pxy$ such that 
$\mangle \hinge pxy<\pi$ and any $\eps>0$, there is $z\in \spc{U}$ such that 
\[\mangle \hinge pxz<\tfrac12\cdot\mangle \hinge pxy+\eps,\quad\mangle \hinge pyz<\tfrac12\cdot\mangle \hinge pxy+\eps.\eqlbl{eq:midpoint}\]

Fix a small positive number $\delta\ll \eps$.
Let $\bar x\in \mathopen{]}px]$ and $\bar y\in \mathopen{]}py]$ denote the points such that 
$\dist{p}{\bar x}{}=\dist{p}{\bar y}{}=\delta$.
Let $z$ denote the midpoint of $\bar x$ and $\bar y$.

Since $\delta\ll \eps$  we can assume that 
\[\angk\kappa p{\bar x}{\bar y}<\mangle \hinge pxy+\eps.\]
By  Alexandrov's lemma (\ref{lem:alex}), we have
\[\angk\kappa p{\bar x}{z}+\angk\kappa p{\bar y}{z}< \angk\kappa p{\bar x}{\bar y}.\]
By construction,
\[\angk\kappa p{\bar x}{z}=\angk\kappa p{\bar y}{z}.\]
Applying the angle comparison (\ref{cat-hinge}), we get \ref{eq:midpoint}.
\qeds

The following example was constructed by Stephanie Halbeisen \cite{halbeisen}.
It shows that an analogous statement does not hold for $\Alex{}$ spaces.
If the dimension is finite, such examples do not exist; %??? see \ref{thm:tan4finite}; 
for proper spaces the question is open, see \ref{open:Halb-proper}.

\begin{thm}{Example}\label{Halbeisen's example}
There is a complete length $\Alex{}$ space $\check{\spc{L}}$
with a point $p\in\check{\spc{L}}$ such that the space of directions $\Sigma_p\check{\spc{L}}$ is not a $\pi$-length space, and therefore the tangent space $\T_p\check{\spc{L}}$ is not a length space. 
\end{thm}



\parit{Construction.}
Let $\HH$ be a Hilbert space formed by infinite sequences of real numbers $\bm{x}=(x_0,x_1,\dots)$ with norm
$|\bm{x}|^2=\sum_i(x_i)^2$. 
Fix $\eps=0.001$ and consider two functions $f,\check f:\HH\to\RR$
\[f(\bm{x})=|\bm{x}|,\]
\[\check f(\bm{x})
=
\max\left\{|\bm{x}|,\max_{n\ge1}\{(1+\eps)\cdot x_n-\tfrac{1}{n}\}\right\}.\] 
Both of these functions are convex and Lipschitz, therefore their graphs in $\HH\times \RR$ equipped with its length-metric form infinite dimensional Alexandrov spaces, say $\spc{L}$  and $\check{\spc{L}}$ (this is proved formally in \ref{lem:hil-con}).
Set $p$ to be the origin of $\HH\times \RR$.

Note that $\check{\spc{L}}\cap\spc{L}$ is starshaped in $\HH$ with center at $p$.
Further $\check{\spc{L}}\backslash\spc{L}$ consist of a countable number of disjoint sets
\[\Omega_n=\set{(\bm{x},\check f(\bm{x}))\in\check{\spc{L}}}{(1+\eps)\cdot x_n-\tfrac{1}{n}>|\bm{x}|}.\]
Note that $\dist{\Omega_n}{p}{}>\tfrac{1}{n}$ for each $n$.
It follows that for any geodesic $[p q]$ in $\check{\spc{L}}$,
a small subinterval $[p \bar q]\subset [p q]$ 
coincides with a straight segment in $\HH\times\RR$, 
which is also a geodesic in $\spc{L}$.
Thus we can treat $\Sigma_p\spc{L}$ and $\Sigma_p\check{\spc{L}}$ as one set, with two angle metrics $\mangle$ and $\check\mangle$;
let us denote by $\mangle_{\HH\times \RR}$ the angle in $\HH\times\RR$.

The space $\spc{L}$  is isometric to the Euclidean cone
over $\Sigma_p\spc{L}$ with vertex at~$p$; 
$\Sigma_p\spc{L}$ is isometric to a sphere in Hilbert space with radius~$\frac{1}{\sqrt{2}}$.
In particular, $\mangle$ is the length-metric of $\mangle_{\HH\times\RR}$ on $\Sigma_p{\spc{L}}$.

Therefore in order to show that $\check \mangle$ does not define a length-metric on $\Sigma_p{\spc{L}}$
it is sufficient to construct a pair of directions $(\xi_+,\xi_-)$ such that
\[\check \mangle(\xi_+,\xi_-)<\mangle(\xi_+,\xi_-).\] 
Set $\bm{e}_0=(1,0,0,\dots)$, $\bm{e}_1=(0,1,0,\dots),\dots\in \HH$. 
Consider the following two rays in $\HH\times \RR$:
\[\gamma_+(t)
=
\tfrac{t}{\sqrt{2}}\cdot(\bm{e}_0,1)
\ \  \text{and}\ \ 
\gamma_-(t)
=
\tfrac{t}{\sqrt{2}}\cdot(-\bm{e}_0,1),
\ \ t\in[0,+\infty).\] 
They form unit-speed geodesics in both $\spc{L}$ and $\check{\spc{L}}$.
Let $\xi_\pm$ be the directions of $\gamma_\pm$ at $p$.
Denote by $\sigma_n$ the half-planes in $\HH$ 
spanned by $\bm{e}_0$ and $\bm{e}_n$;
that is, $\sigma_n\z=\set{x\cdot\bm{e}_0+y\cdot\bm{e}_n}{y\ge 0}$.
Consider a sequence of $2$-dimensional sectors $Q_n=\check{\spc{L}}\cap (\sigma_n\times \RR)$. 
For each $n$, the sector $Q_n$ intersects $\Omega_n$ and is bounded by two geodesic rays $\gamma_\pm$.
Note that $Q_n\GHto Q$, where  $Q$ is a solid Euclidean angle
in $\EE^2$ with angle measure $\beta<\mangle(\xi_+,\xi_-)=\tfrac\pi{\sqrt{2}}$.
Indeed, $Q_n$ is isometric to the subset of $\EE^3$ described by
\begin{align*}
 y\ge0 \ \ 
\text{and}\ \  
&
z=\max\left\{\sqrt{x^2+y^2},
(1+\eps)\cdot y-\tfrac{1}{n} \right\}
\intertext{with length-metric.
Thus, its limit $Q$ is isometric to the subset of $\EE^3$ described by}
y\ge0
\ \ \text{and}\ \  
&
z=\max\left\{\sqrt{x^2+y^2},(1+\eps)\cdot y\right\}
\end{align*}
with length-metric.
In particular, for any $t,\tau\ge0$, 
\begin{align*}
\dist{\gamma_+(t)}{\gamma_-(\tau)}{\check{\spc{L}}} 
&\le 
\lim_{n\to\infty}\dist{\gamma_+(t)}{\gamma_-(\tau)}{Q_n}
=
\\ 
&=\side0 \{\beta;t,\tau\}.
\end{align*}
That is, $\check\mangle(\xi_+,\xi_-) \le \beta<\mangle(\xi_+,\xi_-)$.\qeds

\begin{thm}{Lemma}\label{lem:hil-con}
Let $\HH$ be a Hilbert space,
$f\:\HH\to \RR$ be a convex Lipschitz function 
and $S\subset \HH\times \RR$ be the graph of $f$ 
equipped with  the length-metric.
Then $S$ is $\Alex{0}$.
\end{thm}

\parit{Proof.} Recall that for a subset $X\subset \HH\times \RR$, 
we will denote by $\dist{*}{*}{X}$ the
length-metric on $X$.

By Buyalo's theorem%%\ref{thm:buyalo}
, any convex hypersurface in a Euclidean space, equipped with the length-metric, is non-negatively curved.
Thus it is sufficient to show that for any 4-point set $\{x_0,x_1,x_2,x_3\}\subset S$, 
there is a finite-dimensional subspace $E\subset \HH\times \RR$ 
such that $\{x_i\}\in E$ and $\dist{x_i}{x_j}{S\cap E}$ is arbitrary close to $\dist{x_i}{x_j}{S}$.

Clearly $\dist{x_i}{x_j}{S\cap E}\ge \dist{x_i}{x_j}{S}$; 
thus it is sufficient to show that for given $\eps>0$ one can choose $E$, so that 
\[\dist{x_i}{x_j}{S\cap E}
<
\dist{x_i}{x_j}{S}+\eps
\eqlbl{eq:claim:hil-con*}.\]

For each pair $(x_i,x_j)$, choose a broken line $\beta_{i j}$ connecting $x_i,x_j$ that lies under $S$ (that is, outside of $\Conv S$) in $\HH\times \RR$ 
and has length at most $\dist{x_i}{x_j}{S}+\eps$.
Take $E$ to be the affine hull of all the vertexes in all $\beta_{i j}$.
Thus,
\[\dist{x_i}{x_j}{S\cap E}\le \length \beta_{i j}\] 
and \ref{eq:claim:hil-con*} follows.\qeds

\begin{thm}{Exercise}
Construct a non-compact complete geodesic $\Alex{0}$ space that contains no rays.
\end{thm}

\section{Differential}


\begin{thm}{Exercise}\label{ex:d_q dist_p(v)=-<dri p q, v>-CAT}
Let $\spc{U}$ be a complete length $\CAT\kappa$ space and $p,q\in \spc{U}$.
Assume $\dist{p}{q}{}<\varpi\kappa$.
Show that 
\[(\dd_q\distfun{p}{}{})(v)=-\<\dir q p,v\>.\]

\end{thm}


\begin{thm}{Exercise}\label{ex:d_q dist_p(v)=-<dri p q, v>}
Let $\spc{L}$ be a length $\Alex{\kappa}$ space and $p,q\in \spc{L}$ be distinct points. 
Assume  $q\in \Str(p)$ or $p\in \Str(q)$
Show that 
\[(\dd_q\distfun{p}{}{})(v)=-\<\dir q p,v\>.\]

\end{thm}



As it shown in Halbeisen's example (see section \ref{halbeisen}),  
a $\Alex{}$ space  might have a tangent spaces that are not length spaces; 
thus concavity of the differential $\dd_p f$ of a semiconcave function $f$ is meaningless. 
Nevertheless, as the following lemma shows, differential $\dd_p f$ of a semiconcave function allways satisfy the following weaker property similar to concavity (compare \cite[136]{plaut:survey}, \cite[4.2]{ohta}).  
In the finite dimensional case $\dd_p f$ is concave. % (see ???)

\begin{thm}{Lemma}\label{lem:ohta} 
Let $\spc{L}$ be a complete length $\Alex{}$ space
$f\:\spc{L}\subto\RR$ be a locally Lipschitz semiconcave subfunction 
and $p\in \Dom f$.
Then
\[\sup\set{(\dd_p f)(\xi)}{\xi\in\Sigma_p}
\ge 
\frac{(\dd_p f)(u)+(\dd_p f)(v)}{\sqrt{|u|^2+2\cdot\<u,v\> +|v|^2}}\]
for any $u,v\in \T_p$.
\end{thm}

\parit{Proof of \ref{lem:ohta}.}
We can assume that $\alpha=\mangle(u,v)>0$, otherwise the statement is trivial.
Moreover, since $\T'_p=\Cone(\Sigma'_p)$\index{$\T'_{{*}}$} is dense in $\T_p$ and $\dd_p f\:\T_p\to\RR$ is Lipschitz, we can assume that $u,v\in \T'_p$; that is, $\exp_p(t\cdot u)$
 and $\exp_p(t\cdot v)$ are defined for all small $t>0$.

\begin{wrapfigure}{r}{30mm}
\begin{lpic}[t(0mm),b(-0mm),r(0mm),l(0mm)]{pics/puvvw(1)}
\lbl[t]{3,-0.5;$\tilde p$}
\lbl[b]{10,14;$\tilde u$}
\lbl[t]{15,-0.5;$\tilde v$}
\lbl[t]{28,0;$\tilde v'$}
\lbl[lb]{14,7;$\tilde w$}
\lbl{6,3.3;$\alpha$}
\end{lpic}
\end{wrapfigure}

Prepare a model configuration of five points: $\tilde p,\tilde u,\tilde v,\tilde v',\tilde w\in\EE^2$ such that
\begin{itemize}
\item $\mangle\hinge{\tilde p}{\tilde u}{\tilde v}=\alpha$, 
\item $\dist{\tilde p}{\tilde u}{}=|u|$, 
\item $\dist{\tilde p}{\tilde v}{}=|v|$, 
\item $\tilde v'$ lies on the extension of $[\tilde p\tilde v]$ so that $\tilde v$ is midpoint of $[\tilde p\tilde v']$, 
\item $\tilde w$ is the midpoint for $\tilde u$ and ${\tilde v}$.
\end{itemize}
Note that 
\[\dist{\tilde p}{\tilde w}{}
=
\tfrac{1}{2}\cdot\sqrt{|u|^2+2\cdot\<u,v\>+|v|^2}.\]

Assume that $\spc{L}$ is geodesic.

For all small $t>0$, construct points $u_t,v_t,v'_t,w_t\in \spc{L}$ the following way:
\begin{enumerate}[(a)]
\item $v_t=\exp_p(t\cdot v)$,\ \  $v_t'=\exp_p(t\cdot v')$
\item\label{u_t}  $u_t=\exp_p(t\cdot u)$.
\item $w_t$ is the midpoint of $[u_t v_t]$.
\end{enumerate}
Clearly $\dist{p}{u_t}{}=t\cdot |u|$, $\dist{p}{v_t}{}=t\cdot|v|$, $\dist{p}{v_t'}{}=t\cdot|v'|$. 
Since $\mangle(u,v)$ is defined, 
we have $\dist{u_t}{v_t}{}=t\cdot\dist{\tilde u}{\tilde v}{}+o(t)$ 
and $\dist{u_t}{v_t'}{}=t\cdot\dist{\tilde u}{\tilde v'}{}+o(t)$ 
(see Theorem~\ref{angle} and Section~\ref{sec:angle}).

From point-on-side and hinge comparison (\ref{point-on-side}$+$\ref{SHORT.angle}), we get that 
\[\angk\kappa{v_t}p{w_t}
\ge
\angk\kappa{v_t}p{u_t}
\ge
\mangle\hinge{\tilde v}{\tilde p}{\tilde u}+\tfrac{o(t)}t\]
and
\[\angk\kappa{v_t}{v_t'}{w_t}
\ge
\angk\kappa{v_t}{v_t'}{u_t}
\ge
\mangle\hinge{\tilde v}{\tilde v'}{\tilde u}+\tfrac{o(t)}t.\]
Clearly, 
$\mangle\hinge{\tilde v}{\tilde p}{\tilde u}+\mangle\hinge{\tilde v}{\tilde x}{\tilde u'}=\pi$. 
From adjacent angle comparison (\ref{2-sum}), 
$\angk\kappa{v_t}p{v_t}\z+\angk\kappa{v_t}{u_t}{v_t'}\le \pi$.
Hence
$\angk\kappa{v_t}p{w_t}
\to
\mangle\hinge{\tilde v}{\tilde p}{\tilde v}$ as $t\to0+$
and thus 
\[\dist{p}{w_t}{}=t\dist{\tilde p}{\tilde w}{}+o(t).\]

Since $f$ is $\lambda$-concave we have 
\begin{align*}
2\cdot f(w_t)&\ge f(u_t)+f(v_t)+\tfrac\lambda4\cdot\dist[2]{u_t}{v_t}{}=
\\
&=2\cdot f(p)
+t\cdot [(\dd_p f)(u)+(\dd_p f)(v)]+o(t).
\end{align*}
 
Applying $\lambda$-concavity of $f$, we get
\[(\dd_p f)(\dir p{w_t})
\ge 
\frac{t\cdot[(\dd_p f)(u)+(\dd_p f)(v)]
+o(t)}{2\cdot t\cdot\dist[{{}}]{\tilde p}{\tilde w}{}+o(t)}
\eqlbl{eq:lem:ohta*}\]
and the lemma follows.

\medskip

Finally, if $\spc{L}$ is not geodesic one needs to make two adjustments in the above constructions.
Namely: 
\begin{enumerate}[(i)]
\item For geodesic $[u_t v_t]$ to be defined, one has to take in (\ref{u_t}) $u_t\in \Str(v_t)$, $u_t\approx\exp_p(t\cdot u)$. 
More precicely, 
\[\dist{u_t}{\exp_p(t\cdot u)}{}=o(t).\] 
Thus instead of $\dist{p}{u_t}{}=t\cdot|u|$ we have 
\[\dist{p}{u_t}{}=t|u|+o(t),\] but it is sufficient for the rest of proof.
\item The direction $\dir p{w_t}$ might be undefined.
Thus, in the estimate \ref{eq:lem:ohta*}, instead of $\dir p{w_t}$, one should take $\dir p{w'_t}$ for some point $w_t'\in \Str(p)$ near $w_t$ (that is, $\dist{w_t}{w_t'}{}=o(t)$)
\end{enumerate}
\qedsf




\section{Ultratangent space} 

The following theorem is often used together with the 
observation that ultralimit of any sequence of length spaces is geodesic (see \ref{obs:ultralimit-is-geodesic}).

\begin{thm}{Theorem}\label{thm:tan-is}
\begin{subthm}{thm:tan-is-CBB}
If $\spc{L}$ is a $\Alex{\kappa}$ space and $p\in \spc{L}$, then $\T^\o_p$ is $\Alex{0}$.
\end{subthm}

\begin{subthm}{thm:tan-is-CBA}
If $\spc{U}$ is a $\CAT\kappa$ space and $p\in \spc{U}$, then $\T^\o_p$ is $\CAT0$.
\end{subthm}

\end{thm}

The proofs of both parts are nearly identical.

\parit{Proof; (\ref{SHORT.thm:tan-is-CBB}).}
Since $\spc{L}$ is a complete length $\Alex{\kappa}$ space, then for its blowup $n\cdot\spc{L}$ is a complete length $\Alex{\kappa/{n^{2}}}$ space.
By Proposition~\ref{prp:A^omega}, $\o\cdot\spc{L}$ is $\Alex0$
and so is $\T_p^\o$ as a metric component of~$\o\cdot\spc{L}$.

\parit{(\ref{SHORT.thm:tan-is-CBA}).}
Since $\spc{U}$ is a complete length $\CAT\kappa$ space, its blowup $n\cdot\spc{U}$ is $\CAT{\kappa/{n^{2}}}$.
By Proposition~\ref{prop:CAT^omega}, $\o\cdot\spc{U}$ is $\CAT0$
and so is $\T_p^\o$ as a metric component of~$\o\cdot\spc{U}$.
\qeds

Recall that the tangent space $\T_p$ can be considered as a subset of $\T^\o_p$ (see \ref{thm:tangent-ultratangent}).
Therefore we get the following:

\begin{thm}{Corollary}\label{cor:real-tan-is}
\begin{subthm}{cor:tan-is-CBB}
If $\spc{L}$ is a $\Alex{\kappa}$ space and $p\in \spc{L}$, then $\T_p$ is $\Alex{0}$.
Moreover, $\T_p$ satisfies (1+\textit{n})-point comparison (\ref{thm:pos-config}).
\end{subthm}

\begin{subthm}{cor:tan-is-CBA}
If $\spc{U}$ is a $\CAT\kappa$ space and $p\in \spc{U}$, then $\T_p$ is $\CAT0$.
Moreover, $\T_p$ satisfies (2\textit{n}+2)-comparison (\ref{CBA-n-point}).
\end{subthm}

\end{thm}



\begin{thm}{Proposition}
Assume $\spc{X}$ is a complete length $\Alex{}$ space or $\CAT{}$ space
and $f\:\spc{X}\subto\RR$ be a semiconcave locally Lipscitz subfunction.
Then for any $p\in\Dom f$, the ultradifferential $\dd^\o_p\:\T^\o_p\to\RR$ is a concave function.
\end{thm}

\parit{Proof.}
Fix a geodesic $[x^\o y^\o]$ in $\T^\o_p$.
It is sufficient to show that for any subarc $[\bar x^\o \bar y^\o]$ of $[x^\o y^\o]$
that does not contains the ends
there is a sequence of geodesics $[\bar x^n\bar y^n]$ in $n\cdot \spc{X}$ converging to $[\bar x^\o\bar y^\o]$.

Choose any sequences $\bar x^n,\bar y^n\in n\cdot \spc{X}$ such that $\bar x^n\to \bar x^\o$ and $\bar y^n\to \bar y^\o$ as $n\to\o$.
Note taht $[\bar x^n \bar y^n]$ 
converges to $[\bar x^\o \bar y^\o]$
as $n\to\o$.
The latter holds tivially in case $\CAT{}$
and in $\Alex{}$ case follows from \ref{cor:unique-geod-cbb}.
\qeds



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Gradient}\label{sec:grad-def}

\begin{thm}{Definition of gradient}\label{def:grad} 
Let $\spc{L}$ be a complete length $\Alex{}$ space, 
$f\:\spc{L}\subto\RR$ be a subfunction
and for a point
$p\in\Dom f$ the differential $\dd_p f\:\T_p\to\RR$ is defined.

A tangent vector $g\in \T_p$ is called a 
\emph{gradient of $f$ at $p$}\index{gradient} 
(briefly,  $g=\nabla_p f$\index{$\nabla$}) if
\begin{subthm}{}
$(\dd_p f)(w)\le \<g,w\>$ for any $w\in \T_p$, and
\end{subthm}

\begin{subthm}{}
$(\dd_p f)(g) = \<g,g\> .$
\end{subthm}
\end{thm}

\begin{thm}{Existence and uniqueness of the gradient}\label{thm:ex-grad} 
Let $\spc{L}$ be a complete $\Alex\kappa$ space
and $f\:\spc{L}\subto\RR$ be 
locally Lipschitz 
and 
semiconcave subfunction.
Then for any point $p\in \Dom f$, there is unique gradient $\nabla_p f\in \T_p$.
\end{thm}

\parit{Proof; uniqueness.} 
If $g,g'\in \T_p$ are two gradients of $f$
then 
\begin{align*}
\<g,g\>
&=(\dd_p f)(g)\le \<g,g'\>,
&
\<g',g'\>
&=(\dd_p f)(g')\le \<g,g'\>.
\end{align*}
Therefore,
\[\dist[2]{g}{g'}{}=\<g,g\>-2\cdot\<g,g'\>+\<g',g'\>=0;\] 
that is, $g=g'$.

\parit{Existence.} 
Note first that if $\dd_p f\le 0$, then one can take $\nabla_p f=\0$.

Otherwise, if $s=\sup\set{(\dd_p f)(\xi)}{\xi\in\Sigma_p}>0$, 
it is sufficient to show that there is  $\overline{\xi}\in \Sigma_p$ such that 
\[
(\dd_p f)\left(\overline{\xi}\right)=s.
\eqlbl{overlinexi}
\]
Indeed, if $\overline{\xi}$ exists, then applying Lemma~\ref{lem:ohta} for $u=\overline{\xi}$, $v=\eps\cdot w$ with $\eps\to0+$, 
we get
\[(\dd_p f)(w)\le \<w,s\cdot\overline{\xi}\>\] 
for any $w\in\T_p$;
that is, $s\cdot\overline{\xi}$ is the gradient at $p$.

Take a sequence of directions $\xi_n\in \Sigma_p$, such that $(\dd_p f)(\xi_n)\to s$.
Yet once applying Lemma~\ref{lem:ohta} for $u=\xi_n$, $v=\xi_m$, we get
\[s
\ge
\frac{(\dd_p f)(\xi_n)+(\dd_p f)(\xi_m)}{\sqrt{2+2\cdot\cos\mangle(\xi_n,\xi_m)}}.\]
Therefore $\mangle(\xi_n,\xi_m)\to0$ as $n,m\to\infty$;
that is, $(\xi_n)$ converges in itself.
Clearly $\overline{\xi}=\lim_n\xi_n$ is satisfies \ref{overlinexi}.
\qeds














\section*{Calculus}\label{sec:grad-calculus}



The next lemma roughly states that the gradient points 
in the direction of maximal slope; 
moreover if the slope in the given direction is almost maximal, then it is almost direction of the gradient.

\begin{thm}{Lemma}\label{lem:alm-grad}
Let $\spc{L}$ be a complete length $\Alex{\kappa}$ space,
$f\:\spc{L}\subto\RR$ be locally Lipschitz and semiconcave 
and $p\in \Dom f$.

Assume $|\nabla_p f|>0$;
set $\overline{\xi}=\tfrac{1}{|\nabla_p f|}\cdot\nabla_p f$.
Then
\begin{subthm}{near-grad} If for some $v\in\T_p$, we have 
\[|v|\le 1+\eps
\quad
\text{and}
\quad
(\dd_p f)(v) > |\nabla_p f|\cdot(1-\eps),
\]
then
\[\dist{\overline{\xi}}{v}{}<100\cdot\sqrt{\eps}.\]
\end{subthm}

\begin{subthm}{conv-to-grad} 
If $v_n\in \T_p$ be a sequence of vectors such that 
\[\limsup_{n\to\infty} |v_n|\le 1\ \  
\t{and}\ \  \liminf_{n\to\infty}(\dd_p f)(v_n)\ge |\nabla_p f|\] 
then 
\[\lim_{n\to\infty} v_n=\overline{\xi}.\]
\end{subthm}

\begin{subthm}{alm-max} $\overline{\xi}$ is the unique maximum direction for the restriction $\dd_p f|_{\Sigma_p}$. 
In particular, 
\[|\nabla_p f|=\sup\set{\dd_p f}{\xi\in\Sigma_p f}.\]
\end{subthm}
\end{thm}

\parit{Proof.} According to definition of gradient,
\begin{align*}
 |\nabla_p f|\cdot(1-\eps)
&<
(\dd_p f)(v)
\le
\\
&\le\<v,\nabla_p f\>
=
\\
&=
|v|\cdot|\nabla_p f|\cdot\cos\mangle(\nabla_p f,v).
\end{align*}
Thus 
$
|v|>1-\eps$
and
$
\cos\mangle(\nabla_p f,v)>\tfrac{1-\eps}{1+\eps}.
$
Hence  (\ref{SHORT.near-grad}).

Statements (\ref{SHORT.conv-to-grad}) and (\ref{SHORT.alm-max}) follow directly from (\ref{SHORT.near-grad}).
\qeds

As a corollary of the above lemma and Proposition~\ref{prop:conv-comp} we get the following: 

\begin{thm}{Chain rule} %???DO WE NEED IT???
Let $\spc{L}$ be a complete length $\Alex{}$ space, 
$f\:\spc{L}\subto \RR$ be a semiconcave function
and $\phi\:\RR\to\RR$ be a non-decreasing semiconcave function.
Then $\phi\circ f$ is semiconcave and  $\nabla_x(\phi\circ f)=\phi^+(f(x))\cdot\nabla_x f$ for any $x\in\Dom f$.
\end{thm}


\begin{wrapfigure}{r}{30mm}
\begin{lpic}[t(0mm),b(0mm),r(0mm),l(0mm)]{pics/grad-lip(1)}
\lbl[t]{1,0;$p$}
\lbl[t]{29,0;$q$}
\lbl[b]{13,4;$\dir pq$}
\lbl[t]{15,0;$\ell$}
\lbl[br]{6,12;$\nabla_p f$}
\end{lpic}
\end{wrapfigure}

The following inequalities describe an important property of the ``gradient
vector field''.


\begin{thm}{Lemma} 
\label{lem:grad-lip}
Let $\spc{L}$ be a complete length $\Alex{}$ space, 
$f\:\spc{L}\subto\RR$ satisfies $f''+\kappa\cdot f\le \lambda$ for some $\kappa,\lambda\in\RR$, 
$[p q]\subset \Dom f$ 
and $\ell=\dist{p}{q}{}$.
Then
\[\<\dir pq,\nabla_p f\>\ge
\frac
{{f(q)}-{f(p)\cdot\cs\kappa\ell}-\lambda\cdot\md\kappa\ell}
{\sn\kappa\ell}.\]


In particular, 
\begin{subthm}{lem:grad-lip:lam=0}
if $\kappa=0$, 
\[\<\dir pq,\nabla_p f\>\ge
{\left({f(q)}-{f(p)}-\tfrac\lambda2\cdot\ell^2\right)}/{\ell};\]
\end{subthm}

\begin{subthm}{} if $\kappa=1$, $\lambda=0$ we have
\[\<\dir pq,\nabla_p f\>\ge
\left(f(q)-f(p)\cdot\cos\ell\right)/\sin\ell;\]
\end{subthm}

\begin{subthm}{} if $\kappa=-1$, $\lambda=0$ we have
\[\<\dir pq,\nabla_p f\>\ge
\left(f(q)-f(p)\cdot\cosh\ell\right)/\sinh\ell;\]
\end{subthm}
\end{thm}

\parit{Proof of \ref{lem:grad-lip}.} 
Note that 
$\geod_{[p q]}(0)=p$, 
$\geod_{[p q]}(\ell)=q$, 
$(\geod_{[p q]})^+(0)=\dir pq$.
Thus,
\begin{align*}
\<\dir pq,\nabla_p f\>
&\ge 
d_p f(\dir pq)=
\\
&=
(f\circ\geod_{[p q]})^+(0)
\ge
\\
&\ge
\frac
{{f(q)}-{f(p)\cdot\cs\kappa\ell}-\lambda\cdot\md\kappa\ell}
{\sn\kappa\ell}.
\end{align*}
\qedsf

The following corollary states that gradient vector field is monotonic in the sense similar to definition of \emph{monotone operators}; see for example \cite{phelps}.

%???Maybe it is more natural to call this property ``semi-monotonicity or ``$\lambda$-monotonicity'' ???

\begin{thm}{Monotonicity of gradient} 
\label{cor:grad-lip}
Let $\spc{L}$ be a complete length $\Alex{\kappa}$ space, 
$f\:\spc{L}\subto\RR$ be locally Lipschitz and $\lambda$-concave 
and $[p q]\subset \Dom f$.
Then
\[
\<\dir p q,\nabla_p f\>
+
\<\dir q p,\nabla_q f\>
\ge 
-\lambda\cdot\dist[{{}}]{p}{q}{}.
\]

\end{thm}

\parit{Proof.} Add two inequalities from \ref{lem:grad-lip:lam=0}.
\qeds

\begin{thm}{Lemma}\label{lem:close-grad}
Let $\spc{L}$ be a complete length $\Alex{\kappa}$ space, 
$f,g\:\spc{L}\subto\RR$ 
and $p\in\Dom f\cap\Dom g$.

Then 
\[\dist[2]{\nabla_p f}{\nabla_p g}{\T_p}
\le 
(|\nabla_p f|+|\nabla_p g|)
\cdot
\sup\set{|(\dd_p f)(\xi)-(\dd_p g)(\xi)|}{\xi\in\Sigma_p}.\]

In particular, if $f_n\:\spc{L}\subto\RR$ is a sequence of locally Lipschitz and semiconcave subfunctions,
$p\in \Dom f_n$ for each $n$ 
and $\dd_p f_n$ converges uniformly on ${\Sigma_p}$ 
then sequence $\nabla_p f_n\in \T_p$ converges.
\end{thm}

\parit{Proof.}
Set 
\[s
=
\sup
\set{\,|(\dd_p f)(\xi)-(\dd_p g)(\xi)|}{\xi\in\Sigma_p}.\]
Clearly for any $v\in \T_p$, we have 
\[|(\dd_p f)(v)-(\dd_p g)(v)|\le s\cdot|v|.\]
From the definition of gradient (\ref{def:grad}) we have:
\begin{align*}
&(\dd_p f)(\nabla_p g)\le\<\nabla_p f,\nabla_p g\>,
&&(\dd_p g)(\nabla_p f)\le\<\nabla_p f,\nabla_p g\>,
\\
&(\dd_p f)(\nabla_p f)=\<\nabla_p f,\nabla_p f\>,
&&(\dd_p g)(\nabla_p g)=\<\nabla_p g,\nabla_p g\>.
\end{align*}
Therefore,
\begin{align*}
\dist[{{}}]{\nabla_pf}{\nabla_pg}{}
&=\<\nabla_p f,\nabla_p f\>+\<\nabla_p g,\nabla_p g\>-2\cdot\<\nabla_p f,\nabla_p g\>
\le
\\
&\le (\dd_p f)(\nabla_p f)+(\dd_p g)(\nabla_p g)-
\\
&\quad -(\dd_p f)(\nabla_p g)-(\dd_p g)(\nabla_p f)
\le
\\
&\le s\cdot(|\nabla_p f|+|\nabla_p g|).
\end{align*}
\qedsf


\begin{thm}{Exercise}\label{ex:d dist(grad)<0}
Let $\spc{L}$ be an $m$-dimensional complete length $\Alex\kappa$ space and $a,b,p$
are mutually distinct points in $\spc{L}$.
Prove that 
\[(d_p\distfun{a}{}{})(\nabla_p\distfun{b}{}{})
+\cos\angk\kappa pab\le 0.\]
\end{thm}

\begin{thm}{Exercise}\label{ex:df(v)=<grad f,v>}
Let $\spc{L}$ be an $m$-dimensional complete length $\Alex\kappa$ space,
the function
$f\:\spc{L}\to\RR$ be semiconcave and locally Lipschitz
and
$\alpha\:\II\to\spc{L}$ be a Lipschitz curve.
Show that 
\[\<\nabla_{\alpha(t)}f,\alpha^+(t)\>
=
(\dd_{\alpha(t)}f)(\alpha^+(t))\]
for almost all $t\in\II$.

\end{thm}

\section*{Semicontinuity}\label{sec:grad-semicont}

In this section we collect number of corollaries of the following lemma.

\begin{thm}{Ultralimit of \textbar gradient\textbar} \label{lem:gradcon}
Assume
\begin{itemize}
\item $(\spc{L}_n)$ is a sequence of complete $\Alex\kappa$ spaces and $(\spc{L}_n,p_n) \to (\spc{L}_\o,p_\o)$ as $n\to\o$;
\item $f_n\:\spc{L}_n\subto \RR$ and $f_\o\:\spc{L}_\o\subto \RR$ are locally Lipschitz and $\lambda$-concave and $f_n\to f_\o$ as $n\to\o$;
\item $x_n\in\Dom f_n$ and $x_n\to x_\o\in \Dom f_\o$ as $n\to\o$.
\end{itemize}
Then 
\[|\nabla_{x_\o} f_\o|
\le 
\lim_{n\to \o} |\nabla_{x_n} f_n|.\]

\end{thm}


\parbf{Remarks.}
To construct an example such that 
$|\nabla_{x_\o} f_\o|
<
\lim_{n\to\o} |\nabla_{x_n} f_n|$;
one can take $\spc{L}_n=\spc{L}_\o=\RR$, $f_n(x)=f_\o(x)=-|x|$ and $x_n\to 0+$.

 From the convergence of gradient curves (proved later in \ref{ultr-lim-g-curve}), 
one can deduce the following slightly stronger statement.
 
\begin{thm}{Proposition}\label{prop:lim|grad|=|grad|}
Assume
\begin{itemize}
\item $\spc{L}_n$ is a sequence of complete $\Alex\kappa$ spaces and $(\spc{L}_n,p_n) \to (\spc{L}_\o,p_\o)$ as $n\to\o$;
\item $f_n\:\spc{L}_n\subto \RR$ and $f_\o\:\spc{L}_\o\subto \RR$ are locally Lipschitz and $\lambda$-concave and $f_n\to f_\o$ as $n\to\o$.
\end{itemize}
Then 
\[|\nabla_{x_\o} f_\o|
=
\inf \{\lim_{n\to \o} |\nabla_{x_n} f_n|\},\]
where infimum is taken for all sequences $x_n\in\Dom f_n$ such that $x_n\to x_\o\in \Dom f_\o$ as $n\to\o$.
\end{thm}

\parit{Proof of \ref{lem:gradcon}.} 
Fix an $\eps>0$ and choose $y_\o\in \Dom f_\o$ sufficiently close to $x_\o$ such that 
\[|\nabla_{x_\o} f_\o|-\eps<\frac{f_\o(y_\o)-f_\o(x_\o)}{\dist{x_\o}{y_\o}{}}.\]
Choose $y_n\in \spc{L}_n$ such that $y_n\to y_\o$ as $n\to\o$. 
Sinse $\dist{x_\o}{y_\o}{}$ is sufficiently small, the $\lambda$-concavity of $f_n$ implies that
\[ |\nabla_{x_\o} f_\o|-2\cdot\eps
<
(\dd_{x_n}f_n)(\dir{x_n}{y_n}),\]
for $\o$-almost all $n$.
Hence,
\[
|\nabla_{x_\o} f_\o|-2\cdot\eps
\le 
\lim_{n\to \o} |\nabla_{x_n} f_n|.\]
Sinse $\eps>0$ is arbitrary, the proposition follows.
\qeds

Note that the distance preserving map $\iota\:\spc{L}\hookrightarrow \spc{L}^\o$ induces an embedding 
\[\dd_p\iota\:\T_p \spc{L}\hookrightarrow \T_p \spc{L}^\o.\]
Thus, we can (and will) consider $\T_p \spc{L}$ as a subcone of $\T_p \spc{L}^\o$.

\begin{thm}{Corollary}\label{nablaf=mablaf^o}
Let $\spc{L}$ be a complete length $\Alex{}$ space 
and $f\:\spc{L}\subto\RR$ be locally Lipschitz semiconcave subfunction.
Then for any point $p\in\Dom f$ we have
\[\nabla_p f=\nabla_p f^\o.\]

\end{thm}

\parit{Proof.} 
Note that $\spc{L}\supset\Dom f\subset \Dom f^\o\subset \spc{L}^\o$. 
Applying \ref{lem:gradcon} for $\spc{L}_n=\spc{L}$ and $x_n=x$, we get that $|\nabla_x f|\ge|\nabla_x f^\o|$.

On the other hand, $f=f^\o|_{\spc{L}}$, hence $\dd_p f=\dd_p f^\o|\T_p \spc{L}$.
Thus, from \ref{alm-max},
$|\nabla_x f|\le|\nabla_x f^\o|$. 
Therefore
\[
|\nabla_x f|=|\nabla_x f^\o|.
\eqlbl{gradfgradultraf}
\]



Further,
\begin{align*}
|\nabla_x f|^2&=(\dd_p f)(\nabla_x f)\\
&=\dd_pf^\o(\nabla_x f)\le\\ 
&\le\<\nabla_x f^\o,\nabla_x f\>=\\
&=|\nabla_x f^\o|\cdot|\nabla_x f|\cdot\cos\mangle(\nabla_x f^\o,\nabla_x f).
\end{align*}
Together with \ref{gradfgradultraf}, this implies $\mangle(\nabla_x f^\o,\nabla_x f)=0$ and the statement follows.
\qeds

\begin{thm}{Semicontinuity of \textbar gradient\textbar}\label{cor:gradlim} 
Let $\spc{L}$ be a complete length $\Alex{}$ space 
and $f\:\spc{L}\subto\RR$ be locally Lipschitz semiconcave subfunction. 
Then the function $x\mapsto|\nabla_x f|$  is lower-continuous;
that is for any sequence $x_n\to x\in \Dom f$, we have 
\[|\nabla_x f|\le \liminf_{n\to \infty} |\nabla_{x_n} f|.\]
\end{thm}

\noi\textit{Proof.} 
According to \ref{nablaf=mablaf^o}, $|\nabla_x f|=|\nabla_x f^\o|$. 
Applying \ref{lem:gradcon} for $x_n\to x$, we get that
\[\lim_{n\to\o}|\nabla_{x_n}f|
\ge
|\nabla_x f^\o|
=
|\nabla_x f|.\]
Passing to arbitrary subsequence of $(x_n)$ we obtain the result. \qeds



\section{Polar vectors}

Here we give a corollary of Lemma \ref{lem:close-grad}.
It will be used to prove basic properties of tangent space.


\begin{thm}{Anti-sum lemma}\label{lem:minus-sum} 
Let $\spc{L}$ be a complete length $\Alex{}$ space and $p\in \spc{L}$.

Given two vectors $u,v\in \T_p$ there is unique vector $w\in \T_p$ such that
\[\<u,x\>+\<v,x\>+\<w,x\>\ge 0\]
for any $x\in \T_p$ and
\[\<u,w\>+\<v,w\>+\<w,w\>=0.\]

\end{thm}

If $\T_p$ would be a length space, then the lemma would follow from the existence  of the gradient (\ref{thm:ex-grad}) applied to the function $\T_p\to \RR$ defined by $x\mapsto -(\<u,x\>+\<v,x\>)$.
However, tangent space $\T_p$ might be not a length space; see  Halbeisen's example \ref{Halbeisen's example}.


Applying the above lemma for $u=v$, we get the following statement.

\begin{thm}{Existence of polar vector}\label{cor:polar}
Let $\spc{L}$ be a complete length $\Alex{}$ space 
and $p\in \spc{L}$. 
Given a vector $u\in \T_p$ there is unique vector $u^*\in\T_p$ such that $\<u^*,u^*\>+\<u,u^*\>= 0$ and
$u^*$ is \emph{polar}\index{polar vector} to $u$;
that is,
 $\<u^*,x\>+\<u,x\>\ge 0$ for any $x\in \T_p$.

In particular, for any vector $u\in \T_p$ there is a polar vector $u^*\in\T_p$ such that
$|u^*|\le |u|$.
\end{thm}

The Milka's lemma %??? (\ref{lem:milka})
provides a refinement of this statement;
it states that in the finite-dimensional case, we can assume that $|u^*|= |u|$. 

\parit{Proof of \ref{lem:minus-sum}.}
Choose two sequences of points $a_n,b_n\in \Str(p)$ such that $\dir{p}{a_n}\to u/|u|$ and $\dir{p}{b_n}\to v/|v|$.
Consider sequence of functions 
\[f_n=|u|\cdot\distfun{a_n}{}{}+|v|\cdot\distfun{b_n}{}{}.\]
According to Exercise~\ref{ex:d_q dist_p(v)=-<dri p q, v>}, 
\[(\dd_pf_n)(x)=-|u|\cdot\<\dir{p}{a_n},x\>-|v|\cdot\<\dir{p}{b_n},x\>.\]
Thus, we have the following uniform convergence for all $x\in\Sigma_p$
\[(\dd_pf_n)(x)\xto[n\to\infty]{}-\<u,x\>-\<v,x\>.\] 
According to Lemma~\ref{lem:close-grad}, 
sequence $\nabla_pf_n$ converges.
Set 
\[w=\lim_n\nabla_pf_n.\]

From definition of gradient
\[\begin{aligned}
\<w,w\>&=\lim_{n\to\infty}\<\nabla_pf_n,\nabla_pf_n\>=
&&&%right side
\<w,x\>&=\lim_{n\to\infty}\<\nabla_pf_n,x\>\ge
\\%second line
&=\lim_{n\to\infty}(\dd_p f_n)(\nabla_p f_n)
=
&&&%second line right side
&\ge
\lim_{n\to\infty}(\dd_pf_n)(x)
=
\\%line 3
&=-\<u,w\>-\<v,w\>,
&&&%line 3 right side
&=-\<u,x\>-\<v,x\>.
\end{aligned}\]
\qedsf












\section{Linear subspace of tangent space}

\begin{thm}{Definition}\label{def:opp+Lin}
Let $\spc{L}$ be a complete length $\Alex{\kappa}$ space, $p\in \spc{L}$ and $u,v\in\T_p$.
We say that vectors $u$ and $v$ are \emph{opposite}\index{opposite}\label{def:opposite:page} to each other, (briefly, $u+v=0$) if $|u|=|v|=0$ or $\mangle(u,v)=\pi$ and $|u|=|v|$.

The subcone
\[\Lin_p=\set{v\in\T_p}{\exists\ w\in\T_p\ \ \t{such that}\ \ w+v=0}\]
will be called \emph{linear subcone}\index{linear subspace} of $\T_p$.
\end{thm}

The reason for the name ``linear'' will become evident in Theorem~\ref{thm:lin-subcone}.

\begin{thm}{Proposition}\label{prop:opposite}
Let $\spc{L}$ be a complete length $\Alex{}$ space and $p\in \spc{L}$.
Given two vectors $u,v\in\T_p$, the following statements are equivalent:
\begin{subthm}{opposite} $u+v=0$;
\end{subthm}
\begin{subthm}{<x,u>} $\<u,x\>+\<v,x\>=0$ for any $x\in\T_p$;
\end{subthm}
\begin{subthm}{<xi,u>} $\<u,\xi\>+\<v,\xi\>=0$ for any $\xi\in\Sigma_p$.
\end{subthm}
\end{thm}

\parit{Proof.}
The condition $u+v=0$ is equivalent to 
\[\<u,u\>=-\<u,v\>=\<v,v\>;\]
thus 
(\ref{SHORT.<x,u>})$\Rightarrow$(\ref{SHORT.opposite}).
Since $\T_p$ is isometric to a subset of $\T^\o_p$,
the splitting theorem (\ref{thm:splitting}) applied for $\T_p^\o$
gives (\ref{SHORT.opposite})$\Rightarrow$(\ref{SHORT.<x,u>}).

The equivalence  (\ref{SHORT.<x,u>})$\Leftrightarrow$(\ref{SHORT.<xi,u>}) is trivial.
\qeds

\begin{thm}{Proposition}\label{prop:two-opp}
Let $\spc{L}$  be a complete length $\Alex{}$ space and $p\in \spc{L}$.
Then for any three vectors $u,v,w\in\T_p$, $u+v=0$ and $u+ w=0$ implies $v=w$.
\end{thm}

\parit{Proof.} From Proposition~\ref{prop:opposite} both $v$ and $w$ satisfy the condition in corollary~\ref{cor:polar}. 
Hence the result.\qeds

Let $u\in \Lin_p$; that is $u+v=0$ for some $v\in\T_p$.
Given $s<0$, set 
\[s\cdot u\df (-s)\cdot v.\]
This way we define multiplication of any vector in $\Lin_p$ by any real number (positive and negative).
Proposition~\ref{prop:two-opp} implies that such multiplication is uniquely defined.


\begin{thm}{Theorem}\label{thm:lin-subcone}
Let $\spc{L}$  be a complete length $\Alex{\kappa}$ space and $p\in \spc{L}$. 
Then $\Lin_p$ is a subcone of $\T_p$ isometric to a Hilbert space.
\end{thm}

Before comming to the proof of the theorem, 
let us give its corollary.

\begin{thm}{Corollary}\label{cor:euclid-subcone}
Let $\spc{L}$  be a complete length $\Alex{\kappa}$ space
and $p\in \Str(x_1,x_2,\dots,x_n)$.
Then there is a subcone $E\subset \T_p$ that isometric to a Euclidean space such that $\ddir p{x_i}\in E$ for every $i$.
\end{thm}

\parit{Proof.} 
By the definition of $\Str$ (\ref{def:straight}), $\ddir{p}{x_i}\in \Lin_p$ for each $i$.
It remains to apply Theorem~\ref{thm:lin-subcone}.
\qeds

The main difficulty in the proof of Theorem~\ref{thm:lin-subcone} comes from the fact that in general $\T_p$ is not a length space;
see Habeisen's example (\ref{Halbeisen's example}).
Othervise, if the tangent space is a length space, the statement would follow directly from the splitting theorem (\ref{thm:splitting}).
In fact the proof of this theorem is a far walk around --- we use construction of gradient, as well as the splitting theorem, namely its corollary (\ref{cor:splitting}).
Thus in order to understand our proof one needs to read most of Chapter~\ref{chap:grad}.

\parit{Proof of \ref{thm:lin-subcone}.}
First we show that $\Lin_p$ is a complete geodesic $\Alex0$ space.

Recall that $\T^\o_p$ is a complete geodesic $\Alex0$ space (see \ref{obs:ultralimit-is-geodesic} and \ref{thm:tan-is-CBB}) and $\Lin_p$ is a closed subset of $\T^\o_p$.
Thus, it is sufficient to show that the metric on $\Lin_p$ inherited from $\T^\o_p$ is a length-metric.

Fix two vectors $x,y\in\Lin_p$.
Let $u$ and $v$ be such that $u+\tfrac{1}{2}\cdot x=0$ 
and $v+\tfrac{1}{2}\cdot y=0$.
Apply Lemma~\ref{lem:minus-sum} 
to the vectors $u$ and $v$;
let $w\in \T_p$ denotes the obtained tangent vector.
\begin{clm}{}\label{clm:w-mid(xy)}
$w$ is a midpoint of $[x y]$.
\end{clm}

Indeed, according to Lemma~\ref{lem:minus-sum}, 
\begin{align*}
|w|^2
&=
-\<w,u\>-\<w,v\>
=
\\
&=
\tfrac{1}{2}\cdot\<w,x\>+\tfrac{1}{2}\cdot\<w,y\>.
\\
\intertext{Therefore,}
\dist[2]{x}{w}{}+\dist[2]{w}{y}{}
&=2\cdot|w|^2+|x|^2+|y|^2-2\cdot\<w,x\>-2\cdot\<w,y\>=
\\
&=|x|^2+|y|^2-\<w,x\>-\<w,y\>\le
\\
&\le |x|^2+|y|^2+\<u,x\>+\<v,x\>+\<u,y\>+\<v,y\>=
\\
&=\tfrac{1}{2}\cdot|x|^2+\tfrac{1}{2}\cdot|y|^2-\<x,y\>=
\\
&=\tfrac{1}{2}\cdot\dist[2]{x}{y}{}.
\end{align*}
Thus $\dist{x}{w}{}=\dist{w}{y}{}=\tfrac{1}{2}\cdot\dist[{{}}]{x}{y}{}$ and \ref{clm:w-mid(xy)} follows.
\claimqeds

Note that for any $v\in\Lin_p$ there is a line $\ell$ that contains $v$ and $\0$, thus applying \ref{cor:splitting}, we get that $\Lin_p$ is isometric to a Hilbert space.
\qeds




\section{Comments}

\begin{thm}{Open question}\label{open:Halb-proper}
Let $\spc{L}$ be a proper length $\Alex\kappa$ space.
Is it true that for any $p\in \spc{L}$, the tangent space $\T_p$ is a length space?
\end{thm}



